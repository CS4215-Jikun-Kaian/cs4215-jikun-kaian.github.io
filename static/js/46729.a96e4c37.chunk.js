(globalThis.webpackChunkfrontend=globalThis.webpackChunkfrontend||[]).push([[46729,36896],{42693:(e,t,a)=>{"use strict";a.d(t,{Z:()=>o});var s=a(84879),n=a(92379),i=a(72791),r=a(80184);const o=e=>((0,i.useEffect)((()=>{var t;null===(t=e.loadContentDispatch)||void 0===t||t.call(e)}),[]),(0,r.jsx)("div",{className:"ContentDisplay row center-xs",children:(0,r.jsx)("div",{className:(e.fullWidth?"col-md-12":"col-md-10 col-xs-11")+" contentdisplay-content-parent",children:(0,r.jsx)(s.Z,{className:"contentdisplay-content",elevation:n.u.THREE,children:e.display})})}))},34165:(e,t,a)=>{"use strict";a.d(t,{g:()=>o});var s=a(95725),n=(a(72791),a(17862)),i=a(80184);const r=({onClick:e})=>(0,i.jsx)(n.Z,{label:"Return to Academy",icon:s.d.ARROW_RIGHT,onClick:e,options:{iconOnRight:!0}}),o=e=>e.questionProgress[0]===e.questionProgress[1]?(0,i.jsx)(r,{onClick:e.onClickReturn},"return_to_academy"):(0,i.jsx)(n.Z,{label:"Next",icon:s.d.ARROW_RIGHT,onClick:e.onClickNext,options:{iconOnRight:!0}})},68206:(e,t,a)=>{"use strict";a.d(t,{f:()=>r});var s=a(95725),n=(a(72791),a(17862)),i=a(80184);const r=e=>e.questionProgress[0]<=1?null:(0,i.jsx)(n.Z,{label:"Previous",icon:s.d.ARROW_LEFT,onClick:e.onClick})},63309:(e,t,a)=>{"use strict";a.d(t,{M:()=>i});a(72791);var s=a(17862),n=a(80184);const i=({questionProgress:e})=>(0,n.jsx)(s.Z,{label:`Question ${e[0]} of ${e[1]}  `,isDisabled:!0})},71697:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(95725),n=(a(72791),a(17862)),i=a(80184);const r=({onClick:e})=>(0,i.jsx)(n.Z,{label:"Reset",icon:s.d.REPEAT,onClick:e})},1799:(e,t,a)=>{"use strict";a.d(t,{t:()=>o});var s=a(50698),n=a(95725),i=(a(72791),a(17862)),r=a(80184);const o=e=>{const t=e.hasUnsavedChanges?{intent:s.S.WARNING,minimal:!1}:{};return(0,r.jsx)(i.Z,{label:"Save",icon:n.d.FLOPPY_DISK,onClick:e.onClickSave,options:t,isDisabled:e.isDisabled})}},23899:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var s=a(39997),n=a(63978),i=a(41418),r=a.n(i),o=a(72791),l=a(80184);const c=()=>{const e=(0,o.useRef)(null);(0,o.useEffect)((()=>{window.ToneMatrix&&window.ToneMatrix.initialise_matrix(e.current)}),[]);return(0,l.jsxs)("div",{className:"sa-tone-matrix",children:[(0,l.jsx)("div",{className:"row",children:(0,l.jsxs)("div",{className:r()("controls","col-xs-12",s.Pyr,s.ZoI),children:[(0,l.jsx)(n.z,{id:"clear-matrix",onClick:()=>{window.ToneMatrix.clear_matrix()},children:"Clear"}),(0,l.jsx)(n.z,{id:"randomise-matrix",onClick:()=>{window.ToneMatrix.randomise_matrix()},children:"Randomise"})]})}),(0,l.jsx)("div",{className:"row",children:(0,l.jsx)("div",{className:"col-xs-12",ref:e})})]})},d=o.memo(c,(()=>!0))},62725:(e,t,a)=>{"use strict";a.d(t,{Dh:()=>r,IU:()=>i,gS:()=>o,lu:()=>l});var s=a(72426),n=a.n(s);const i=e=>{const t=n()(e),a=n()();return t.isBefore(a)},r=e=>n()(e).format("Do MMMM, HH:mm"),o=e=>n()(e).format("MMMM Do YYYY, HH:mm"),l=e=>n()(e).format("MMMM Do YYYY")},77189:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Component:()=>eh,default:()=>th});var s=a(39997),n=a(84879),i=a(16499),r=a(14634),o=a(41418),l=a.n(o),c=a(72791),d=a(78687),h=a(57689),u=a(95134),g=a(30298),p=a(61509),m=a(63978),x=a(50698),b=a(71594),y=a(9631),f=a(80184);const v=()=>{const e=(0,d.I0)();return(0,f.jsx)("div",{className:"research-prompt",children:(0,f.jsxs)(g.V,{className:s.Pyr,title:"Agreement to Participate in Educational Research",canOutsideClickClose:!1,canEscapeKeyClose:!1,isCloseButtonShown:!1,isOpen:!0,children:[(0,f.jsxs)("div",{className:s.TmF,children:[(0,f.jsxs)(p.H4,{children:["Welcome to your new ",y.Z.sourceAcademyDeploymentName," course!"]}),(0,f.jsxs)("div",{children:["Here at ",y.Z.sourceAcademyDeploymentName,", our mission is to bring out the beauty and fun in programming and the ideas behind programming, and to make these ideas universally accessible. This includes educational research!"]}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{children:["We collect programs that students run in ",y.Z.sourceAcademyDeploymentName," and store them anonymously for our research. You are free to opt out of this collection, with no penalty for you whatsoever. Contact your course instructor if you have questions or concerns about this research."]})]}),(0,f.jsx)("div",{className:s.Alt,children:(0,f.jsxs)("div",{className:s.e$L,children:[(0,f.jsx)(m.z,{text:"I would like to opt out",onClick:()=>e((0,b.updateCourseResearchAgreement)(!1))}),(0,f.jsx)(m.z,{text:"I consent!",intent:x.S.SUCCESS,onClick:()=>e((0,b.updateCourseResearchAgreement)(!0))})]})})]})})};var j=a(90362),C=a(34957),S=a(92379),k=a(51002),I=a(77640),w=a(20535),A=a(93580),T=a(85060),M=a(77226),P=a(32183),E=a(95725),N=a(763),R=a.n(N),L=a(11087),_=a(12538),O=a(5602),D=a(42543),G=a(79637),B=a(92469),U=a(76796),F=a(78498);const z=(e,t,a,s)=>()=>{if(!s)return e();if(t.type===U.LD.mcq){if(null===t.answer)return(0,F.N9)("Please select an option!",750);if(void 0===t.solution)return e();if(t.answer!==t.solution)return(0,F.N9)("Your MCQ solution is incorrect!",750)}else if(t.type===U.LD.programming){if(!a.reduce(((e,t)=>e&&(0,B.stringify)(t.result)===t.answer),!0))return(0,F.N9)("Your solution has not passed all testcases!",750)}return e()};var V=a(78922),H=a(18465),$=a(94694),W=a(60054),X=a(89360),K=a(27156),Z=a(34165),q=a(68206),Y=a(63309),J=a(71697),Q=a(50472),ee=a(1799),te=a(17862),ae=a(42441),se=a(74106),ne=a(45686),ie=a(94492);const re=({index:e,result:t})=>{return(0,f.jsx)("div",{className:l()("ResultCard","pass"===t.resultType?"correct":"wrong"),"data-testid":"ResultCard",children:(0,f.jsxs)(n.Z,{elevation:S.u.ONE,children:[(0,f.jsxs)("div",{className:"result-data",children:[(0,f.jsx)("div",{className:"result-idx","data-testid":"result-idx",children:e+1}),(0,f.jsx)("div",{className:"result-status","data-testid":"result-status",children:t.resultType.toUpperCase()})]}),(0,f.jsx)(p.SU,{className:"result-expected","data-testid":"result-expected",children:t.expected}),(0,f.jsx)(p.SU,{className:"result-actual","data-testid":"result-actual",children:"error"===t.resultType?(a=t.errors,a.map((e=>{switch(e.errorType){case"timeout":return"[TIMEOUT] Submission exceeded time limit for this test case.";case"syntax":return`[SYNTAX] Line ${e.line}: ${e.errorExplanation}`;case"runtime":return`[RUNTIME] Line ${e.line}: ${e.errorExplanation}`;case"systemError":return`[SYSTEM] ${e.errorMessage}`;default:return`[UNKNOWN] Autograder error: type ${e.errorType}`}})).join("\n\n")):t.actual})]})});var a};var oe=a(61881);const le=e=>{const{index:t,testcase:a,handleTestcaseEval:i}=e,r=c.useMemo((()=>{const e=void 0!==a.result||a.errors,t=(0,B.stringify)(a.result)===a.answer;return{correct:e&&t,wrong:e&&!t,secret:a.type===U.Be.secret||a.type===U.Be.opaque}}),[a]),o=c.useCallback((()=>{i(t)}),[t,i]);return(0,f.jsx)("div",{className:l()("AutograderCard",r),"data-testid":"AutograderCard",children:(0,f.jsx)(n.Z,{className:s.znr,elevation:S.u.ONE,onClick:o,children:a.type===U.Be.opaque&&"assessment"===e.workspaceLocation?(0,f.jsx)(p.SU,{className:"testcase-placeholder","data-testid":"testcase-placeholder",children:"Hidden testcase"}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(p.SU,{className:"testcase-program",children:a.program}),(0,f.jsx)(p.SU,{className:"testcase-expected",children:a.answer}),(0,f.jsx)(p.SU,{className:"testcase-actual","data-testid":"testcase-actual",children:a.errors?(0,oe.parseError)(a.errors):void 0!==a.result?(0,B.stringify)(a.result):"No Answer"})]})})})},ce=(0,f.jsxs)("div",{className:"autograder-help-tooltip",children:[(0,f.jsx)("p",{children:"Click on each testcase below to execute it with the program in the editor."}),(0,f.jsx)("p",{children:"To execute all testcases at once, evaluate the program in the editor with this tab active."}),(0,f.jsx)("p",{children:"A green or red background indicates a passed or failed testcase respectively."}),(0,f.jsx)("p",{children:"Private testcases (only visible to staff when grading) have a grey background."})]}),de=(e,t)=>(0,f.jsxs)("div",{className:e,children:[t,(0,f.jsx)(I.I,{icon:E.d.CARET_DOWN})]}),he=(0,f.jsxs)("div",{className:"testcases-header","data-testid":"testcases-header",children:[de("header-fn","Testcase"),de("header-expected","Expected result"),de("header-actual","Actual result")]}),ue=(0,f.jsxs)("div",{className:"results-header","data-testid":"results-header",children:[(0,f.jsxs)("div",{className:"header-data",children:[de("header-sn","S/N"),de("header-status","Testcase status")]}),de("header-expected","Expected result"),de("header-actual","Actual result")]}),ge=(e,t,a)=>(0,f.jsx)(te.Z,{label:e,icon:t?E.d.CARET_DOWN:E.d.CARET_RIGHT,onClick:a,options:{className:"collapse-button",minimal:!0}}),pe=e=>{const[t,a]=c.useState(!0),[s,n]=c.useState(!0),{testcases:i,autogradingResults:r,handleTestcaseEval:o,workspaceLocation:l}=e,d=c.useMemo((()=>i.length>0?(0,f.jsxs)("div",{className:"testcaseCards",children:[he,i.map(((e,t)=>(0,f.jsx)(le,{index:t,testcase:e,handleTestcaseEval:o,workspaceLocation:l},t)))]}):(0,f.jsx)("div",{className:"noResults","data-testid":"noResults",children:"There are no testcases provided for this question."})),[i,o,l]),h=c.useMemo((()=>r.length>0?(0,f.jsxs)("div",{children:[ue,r.map(((e,t)=>(0,f.jsx)(re,{index:t,result:e},t)))]}):(0,f.jsx)("div",{className:"noResults","data-testid":"noResults",children:"There are no results to show."})),[r]),u=c.useCallback((()=>{a(!t)}),[t]),g=c.useCallback((()=>n(!s)),[s]);return(0,f.jsxs)("div",{className:"Autograder",children:[(0,f.jsxs)(m.z,{className:"collapse-button",icon:t?E.d.CARET_DOWN:E.d.CARET_RIGHT,minimal:!0,onClick:u,children:[(0,f.jsx)("span",{children:"Testcases"}),(0,f.jsx)(w.u,{content:ce,placement:ie.I.LEFT,children:(0,f.jsx)(I.I,{icon:E.d.HELP})})]}),(0,f.jsx)(A.U,{isOpen:t,keepChildrenMounted:!0,children:d}),ge("Autograder Results",s,g),(0,f.jsx)(A.U,{isOpen:s,keepChildrenMounted:!0,children:h})]})};var me=a(39215);const xe=({handleContestEntryClick:e,contestEntry:t,rank:a})=>(0,f.jsx)("div",{className:l()("LeaderboardCard"),children:(0,f.jsxs)(n.Z,{className:s.znr,elevation:S.u.ONE,onClick:()=>{var a;return e(t.submission_id,null!==(a=t.answer.code)&&void 0!==a?a:"")},"data-testid":"SideContentLeaderboardCard",children:[(0,f.jsx)(p.SU,{className:"contestentry-entryid",children:t.student_name}),(0,f.jsx)(p.SU,{className:"contestentry-rank",children:a}),(0,f.jsx)(p.SU,{className:"contestentry-score","data-testid":"contestentry-score",children:t.final_score})]})}),be=e=>{const{orderedContestEntries:t,handleContestEntryClick:a,leaderboardType:s}=e,[n,i]=(0,c.useState)(!0),r=(0,c.useMemo)((()=>s===me.B_.scoreLeaderboard?"Score Leaderboard":s===me.B_.popularVoteLeaderboard?"Popular Vote Leaderboard":"Contest Leaderboard"),[s]),o=(0,c.useMemo)((()=>s===me.B_.scoreLeaderboard?"View the highest scoring contest entries!":s===me.B_.popularVoteLeaderboard?"View the most popular contest entries!":"View the top-rated contest entries!"),[s]),l=(e,t)=>(0,f.jsxs)("div",{className:e,children:[t,(0,f.jsx)(I.I,{icon:E.d.CARET_DOWN})]}),d=(0,c.useMemo)((()=>(0,f.jsxs)("div",{className:"leaderboard-header",children:[l("header-entryid","Student Name"),l("header-entryrank","Rank"),l("header-score",s===me.B_.scoreLeaderboard?"Calculated Score":s===me.B_.popularVoteLeaderboard?"Popularity Score":"Metric")]})),[s]),h=(0,c.useMemo)((()=>(0,f.jsxs)("div",{children:[d,t.length>0?t.map(((e,t)=>(0,f.jsx)(xe,{handleContestEntryClick:a,contestEntry:e,rank:t+1},e.submission_id))):(0,f.jsx)("div",{className:"noResults",children:"There are no eligible contest leaderboard entries found."})]})),[a,t,d]);return(0,f.jsxs)("div",{className:"ContestLeaderboard",children:[(0,f.jsxs)(m.z,{className:"collapse-button",icon:n?E.d.CARET_DOWN:E.d.CARET_RIGHT,minimal:!0,onClick:()=>i(!n),children:[(0,f.jsx)("span",{children:r}),(0,f.jsx)(w.u,{content:o,children:(0,f.jsx)(I.I,{icon:E.d.HELP})})]}),(0,f.jsx)(A.U,{isOpen:n,keepChildrenMounted:!0,children:h})]})},ye=[{name:"S",color:"rgb(255, 127, 127)",score:10},{name:"A",color:"rgb(255, 223, 127)",score:7},{name:"B",color:"rgb(255, 255, 127)",score:4},{name:"C",color:"rgb(191, 255, 127)",score:2},{name:"D",color:"rgb(127, 191, 255)",score:1}],fe=({contestEntries:e,canSave:t,isValid:a,handleContestEntryClick:i,handleVotingSubmissionChange:r})=>{const[o,d]=(0,c.useState)(!0),[h,u]=(0,c.useState)(null),[g,x]=(0,c.useState)(null),b=(0,c.useMemo)((()=>[...e].sort(((e,t)=>e.submission_id-t.submission_id))),[e]),y=e=>{u(e.currentTarget),e.dataTransfer.effectAllowed="move"},v=(0,c.useCallback)((e=>t=>{const a=t.currentTarget.closest(".tier");if(a){const t=a.id.split("-")[1],s=ye.find((e=>e.name.toLowerCase()===t));r(e.submission_id,(null===s||void 0===s?void 0:s.score)||0)}x(null)}),[r]),j=(0,c.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),C=(0,c.useCallback)((e=>{setTimeout((()=>{const t=e.target.closest(".tier");t&&x(t.id)}),0)}),[]),k=(0,c.useCallback)((e=>{const t=e.target.closest(".tier");t&&t.id===g&&x(null)}),[g]),T=(0,c.useCallback)((e=>{e.preventDefault();const t=e.target.closest(".item-container");t&&t.appendChild(h)}),[h]),M=(0,c.useRef)({}),P=(0,c.useRef)({}),N=(0,c.useMemo)((()=>ye.map(((e,t)=>(0,f.jsxs)("div",{className:l()("tier",{"hovered-tier":g===`tier-${e.name.toLowerCase()}`}),id:`tier-${e.name.toLowerCase()}`,"data-testid":"tier",children:[(0,f.jsx)("h2",{style:{backgroundColor:e.color},children:e.name}),(0,f.jsx)("div",{className:"item-container",onDragOver:j,onDragLeave:k,onDragEnter:C,onDrop:T,ref:e=>P.current[t]=e})]},`tier-${e.name.toLowerCase()}`)))),[g,j,k,C,T]),R=(0,c.useMemo)((()=>(0,f.jsxs)("div",{className:"tier-list",children:[N,b.length>0?(0,f.jsx)("div",{className:"tier",id:"bank","data-testid":"tier",children:(0,f.jsx)("div",{className:"item-container",id:"items",onDragOver:j,onDragLeave:k,onDragEnter:C,onDrop:T,"data-testid":"voting-item-container",children:b.map(((e,r)=>(0,f.jsx)("div",{className:l()("item",{wrong:!a}),draggable:t,id:`item-${r+1}`,onDragStart:y,onDragEnd:v(e),ref:e=>M.current[r]=e,"data-testid":"voting-item",children:(0,f.jsx)(n.Z,{className:s.znr,elevation:S.u.ONE,onClick:()=>{var t;return i(e.submission_id,null!==(t=e.answer.code)&&void 0!==t?t:"")},children:(0,f.jsx)(p.SU,{className:"contestentry-entryid",children:r+1})})},`item-${r+1}`)))})}):(0,f.jsx)("div",{className:"noResults",children:"There are no eligible entries for voting found."})]})),[a,t,b,i,v,C,k,j,T,N]);return(0,c.useEffect)((()=>{b.forEach(((e,t)=>{if(null!==e.score){const a=ye.findIndex((t=>!!e.score&&t.score<=e.score));if(-1!==a){const e=P.current[a],s=M.current[t];e&&s&&e.appendChild(s)}}}))}),[b]),(0,f.jsxs)("div",{className:"ContestEntryVoting",children:[(0,f.jsxs)(m.z,{className:"collapse-button",icon:o?E.d.CARET_DOWN:E.d.CARET_RIGHT,minimal:!0,onClick:()=>d(!o),children:[(0,f.jsx)("span",{children:"Contest Voting"}),(0,f.jsx)(w.u,{content:(0,f.jsx)("span",{children:"Rank your favourite contest entries from tiers D (worst) to S (best)!"}),children:(0,f.jsx)(I.I,{icon:E.d.HELP})})]}),(0,f.jsx)(A.U,{isOpen:o,keepChildrenMounted:!0,children:R})]})},ve=({canSave:e,contestEntries:t,handleSave:a,handleContestEntryClick:s})=>{const[n,i]=(0,c.useState)(!0),[r,o]=(0,c.useState)([]);(0,c.useEffect)((()=>{o(t)}),[t]);return(0,f.jsx)(fe,{isValid:n,canSave:e,handleContestEntryClick:s,handleVotingSubmissionChange:(e,t)=>{const s=r.map((a=>a.submission_id===e?{...a,score:t}:a));o(s);const n=(e=>e.reduce(((e,t)=>e&&void 0!==t.score&&null!==t.score),!0))(s);n?(a(s),i(!0)):((0,F.N9)("Please assign every entry to a tier."),i(!1))},contestEntries:r})};var je=a(23899),Ce=a(60341),Se=a(97767),ke=a(90713),Ie=a(1269),we=a(32070),Ae=a(89702),Te=a(52645),Me=a(91447),Pe=a(62725);const Ee=e=>(0,f.jsx)("div",{className:"GradingResult",children:(0,f.jsxs)("div",{className:"grading-result-table",children:[(0,f.jsx)(Te.v,{children:(0,f.jsxs)("tbody",{children:[(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"XP:"}),(0,f.jsx)("td",{children:(0,f.jsxs)(k.x,{children:[e.xp," / ",e.maxXp]})})]}),(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Comments:"}),(0,f.jsx)("td",{children:!e.comments&&(0,f.jsx)(k.x,{children:"None"})})]})]})}),e.comments&&(0,f.jsx)(Te.v,{children:(0,f.jsx)("tbody",{children:(0,f.jsx)("tr",{children:(0,f.jsxs)("td",{children:[(0,f.jsx)(Me.i,{}),(0,f.jsx)(se.Z,{content:e.comments,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0}),(0,f.jsx)(Me.i,{})]})})})}),(0,f.jsx)("br",{}),(0,f.jsx)("div",{className:"grading-result-info",children:(0,f.jsxs)(k.x,{children:["Graded by ",(0,f.jsx)("b",{children:e.graderName})," on ",(0,Pe.Dh)(e.gradedAt)]})})]})}),Ne="assessment",Re=e=>{var t,a,o,p,v;const[C,S]=(0,c.useState)(!1),[k,I]=(0,c.useState)(!1),[w,A]=(0,c.useState)(!1),[P,R]=(0,c.useState)(""),{isMobileBreakpoint:L}=(0,j.Fs)(),_=(0,j.ix)((t=>t.session.assessments.get(e.assessmentId))),O=(0,j.ix)((e=>e.session.assessmentOverviews)),B=(0,j.ix)((e=>e.session.teamFormationOverview)),F=null===O||void 0===O?void 0:O.find((e=>e.id===(null===_||void 0===_?void 0:_.id))),{selectedTab:ie,setSelectedTab:re}=(0,Se.__)(Ne,void 0!==(null===_||void 0===_?void 0:_.questions[e.questionId].grader)?me.B_.grading:me.B_.questionOverview),oe=(0,h.s0)(),{courseId:le}=(0,j.ix)((e=>e.session)),{isFolderModeEnabled:ce,activeEditorTabIndex:de,editorTabs:he,autogradingResults:ue,editorTestcases:ge,hasUnsavedChanges:xe,isRunning:ye,output:fe,replValue:Te,currentAssessment:Me,currentQuestion:Pe}=(0,j.ix)((e=>e.workspaces[Ne])),Re=(0,d.I0)(),{handleTeamOverviewFetch:Le,handleTestcaseEval:_e,handleClearContext:Oe,handleChangeExecTime:De,handleUpdateCurrentAssessmentId:Ge,handleResetWorkspace:Be,handleRunAllTestcases:Ue,handleEditorEval:Fe,handleAssessmentFetch:ze,handleEditorValueChange:Ve,handleEditorUpdateBreakpoints:He,handleReplEval:$e,handleSave:We,handleCheckLastModifiedAt:Xe,handleUpdateHasUnsavedChanges:Ke,handleEnableTokenCounter:Ze,handleDisableTokenCounter:qe}=(0,c.useMemo)((()=>({handleTeamOverviewFetch:e=>Re((0,b.fetchTeamFormationOverview)(e)),handleTestcaseEval:e=>Re((0,Ae.evalTestcase)(Ne,e)),handleClearContext:(e,t)=>Re((0,Ae.beginClearContext)(Ne,e,t)),handleChangeExecTime:e=>Re((0,Ae.changeExecTime)(e,Ne)),handleUpdateCurrentAssessmentId:(e,t)=>Re((0,Ae.updateCurrentAssessmentId)(e,t)),handleResetWorkspace:e=>Re((0,Ae.resetWorkspace)(Ne,e)),handleRunAllTestcases:()=>Re((0,Ae.runAllTestcases)(Ne)),handleEditorEval:()=>Re((0,Ae.evalEditor)(Ne)),handleAssessmentFetch:(e,t)=>Re((0,b.fetchAssessment)(e,t)),handleEditorValueChange:(e,t)=>Re((0,Ae.updateEditorValue)(Ne,e,t)),handleEditorUpdateBreakpoints:(e,t)=>Re((0,Ae.setEditorBreakpoint)(Ne,e,t)),handleReplEval:()=>Re((0,Ae.evalRepl)(Ne)),handleCheckLastModifiedAt:(e,t,a)=>Re((0,b.checkAnswerLastModifiedAt)(e,t,a)),handleSave:(e,t)=>Re((0,b.submitAnswer)(e,t)),handleUpdateHasUnsavedChanges:e=>Re((0,Ae.updateHasUnsavedChanges)(Ne,e)),handleEnableTokenCounter:()=>Re((0,Ae.enableTokenCounter)(Ne)),handleDisableTokenCounter:()=>Re((0,Ae.disableTokenCounter)(Ne))})),[Re]);(0,c.useEffect)((()=>{Ve(0,"")}),[]),(0,c.useEffect)((()=>{Le(e.assessmentId)}),[]),(0,c.useEffect)((()=>{let t=null;if(e.needsPassword&&(t=window.prompt("Please enter password.",""),!t))return void window.history.back();if(ze(e.assessmentId,t||void 0),0===e.questionId&&e.notAttempted&&S(!0),!_)return;let a=e.questionId;e.questionId>=_.questions.length&&(a=_.questions.length-1);const s=_.questions[a];let n="";s.type===U.LD.programming&&(n=s.answer?s.answer:s.solutionTemplate),Ve(0,n)}),[]),(0,c.useEffect)((()=>{et()})),(0,c.useEffect)((()=>{null!==_&&void 0!==_&&_.hasTokenCounter?Ze():qe()}),[null===_||void 0===_?void 0:_.hasTokenCounter,Ze,qe]),(0,c.useEffect)((()=>{ie&&!L&&V.JN.includes(ie)&&re(me.B_.questionOverview)}),[L,e,ie,re]);const Ye=(0,c.useCallback)((e=>(0,H.cM)(P,e)),[P]),Je=(0,c.useRef)(ie);Je.current=ie;const Qe=(0,c.useCallback)((()=>{Je.current===me.B_.autograder?Ue():Fe();const e={time:Date.now(),type:"keyboardCommand",data:$.SO.run};Ye(e)}),[Fe,Ue,Ye]),et=()=>{var t,a,s,n,i,r;if(void 0===_)return;const{assessmentId:o,questionId:l}=e;if(Me===o&&Pe===l)return;const c=_.questions[l],d={};switch(c.type){case U.LD.programming:const t=c;var h,g;if(d.autogradingResults=t.autogradingResults,d.programPrependValue=t.prepend,d.programPostpendValue=t.postpend,d.editorTestcases=t.testcases,d.editorValue=t.answer||t.solutionTemplate,!P)R((0,H.wH)(`${_.number}/${e.questionId}`,{chapter:c.library.chapter,externalLibrary:(null===c||void 0===c||null===(h=c.library)||void 0===h||null===(g=h.external)||void 0===g?void 0:g.name)||"NONE",editorValue:d.editorValue}));break;case U.LD.voting:const a=c;d.programPrependValue=a.prepend,d.programPostpendValue=a.postpend;case U.LD.mcq:}He(0,[]),Ge(o,l);const p=(0,Ie.p_)()({autogradingResults:null!==(t=d.autogradingResults)&&void 0!==t?t:[],editorTabs:[{value:null!==(a=d.editorValue)&&void 0!==a?a:"",highlightedLines:[],breakpoints:[]}],programPrependValue:null!==(s=d.programPrependValue)&&void 0!==s?s:"",programPostpendValue:null!==(n=d.programPostpendValue)&&void 0!==n?n:"",editorTestcases:null!==(i=d.editorTestcases)&&void 0!==i?i:[]});Be(p),De(null!==(r=c.library.execTimeMs)&&void 0!==r?r:u.t7.assessment.execTime),Oe(c.library,!0),Ke(!1),d.editorValue&&Ve(0,d.editorValue)},tt=(e,t)=>{const a=_.questions[t],s=void 0!==a.grader,n=void 0!==F&&F.maxTeamSize>1,i=(null===a||void 0===a?void 0:a.type)===U.LD.voting,r=(e,t)=>{Ve(0,t)},o=[{label:`Question ${t+1}`,iconName:E.d.NINJA,body:(0,f.jsx)(se.Z,{content:a.content}),id:me.B_.questionOverview}];var l,c,d;(n&&o.push({label:"Team",iconName:E.d.PEOPLE,body:(0,f.jsx)("div",{children:void 0===B?"You are not assigned to any team!":(0,f.jsxs)("div",{children:["Your teammates for this assessment:"," ",B.studentNames.map(((e,t)=>(0,f.jsxs)("span",{children:[t>0?", ":"",e]},t)))]})})}),i)?o.push({label:"Contest Voting Briefing",iconName:E.d.BRIEFCASE,body:(0,f.jsx)(se.Z,{content:_.longSummary}),id:me.B_.briefing},{label:"Contest Voting",iconName:E.d.NEW_LAYERS,body:(0,f.jsx)(ve,{canSave:e.canSave,handleSave:e=>We(a.id,e),handleContestEntryClick:r,contestEntries:null!==(l=null===a||void 0===a?void 0:a.contestEntries)&&void 0!==l?l:[]}),id:me.B_.contestVoting},{label:"Score Leaderboard",iconName:E.d.CROWN,body:(0,f.jsx)(be,{handleContestEntryClick:r,orderedContestEntries:null!==(c=null===a||void 0===a?void 0:a.scoreLeaderboard)&&void 0!==c?c:[],leaderboardType:me.B_.scoreLeaderboard}),id:me.B_.scoreLeaderboard},{label:"Popular Vote Leaderboard",iconName:E.d.PEOPLE,body:(0,f.jsx)(be,{handleContestEntryClick:r,orderedContestEntries:null!==(d=null===a||void 0===a?void 0:a.popularVoteLeaderboard)&&void 0!==d?d:[],leaderboardType:me.B_.popularVoteLeaderboard}),id:me.B_.popularVoteLeaderboard}):o.push({label:"Briefing",iconName:E.d.BRIEFCASE,body:(0,f.jsx)(se.Z,{className:"sidecontent-overview",content:_.longSummary}),id:me.B_.briefing},{label:"Autograder",iconName:E.d.AIRPLANE,body:(0,f.jsx)(pe,{testcases:ge,autogradingResults:s||!e.assessmentConfiguration.isManuallyGraded?ue:[],handleTestcaseEval:_e,workspaceLocation:"assessment"}),id:me.B_.autograder});s&&o.push({label:"Report Card",iconName:E.d.TICK,body:(0,f.jsx)(Ee,{graderName:a.grader.name,gradedAt:a.gradedAt,xp:a.xp,maxXp:a.maxXp,comments:a.comments}),id:me.B_.grading});a.library.external.symbols.includes("get_matrix")&&o.push({label:"Tone Matrix",iconName:E.d.GRID_VIEW,body:(0,f.jsx)(je.Z,{}),id:me.B_.toneMatrix});return{selectedTabId:ie,tabs:{beforeDynamicTabs:o,afterDynamicTabs:[]},onChange:(e,t,a)=>{e!==t&&re(e)},workspaceLocation:Ne}},at=t=>{var a;const s=`/courses/${le}/${(0,ke.q1)(_.type)}`,n=s+`/${_.id.toString()}`,i=_.questions,r=i[t],o=[t+1,i.length],l=()=>{oe(n+`/${(t+1).toString()}`),re(me.B_.questionOverview)},c=()=>oe(s),d=()=>{0!==(null===F||void 0===F?void 0:F.maxTeamSize)&&r.type===U.LD.programming&&Xe(r.id,r.lastModifiedAt,h)},h=async t=>{if(0!==(null===F||void 0===F?void 0:F.maxTeamSize)&&r.type===U.LD.programming&&t){if(!await(0,G.pG)({contents:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("p",{children:"Save answer?"}),(0,f.jsx)("p",{children:"Note: The changes made by your teammate will be lost."})]}),positiveIntent:"danger",positiveLabel:"Save"}))return}We(r.id,he[0].value),setTimeout((()=>{ze(e.assessmentId)}),1e3)},u=i.filter((e=>null!==e.answer)).length-1,g=t>=u,p=(0,f.jsx)(Z.g,{onClickNext:r.blocking?z(l,r,ge,g):l,onClickReturn:r.blocking?z(c,r,ge,g):c,questionProgress:o},"next_question"),m=(0,f.jsx)(q.f,{onClick:()=>{oe(n+`/${(t-1).toString()}`),re(me.B_.questionOverview)},questionProgress:o},"previous_question"),x=(0,f.jsx)(Y.M,{questionProgress:o},"question_view"),b=r.type!==U.LD.mcq?(0,f.jsx)(J.A,{onClick:()=>{A(!0)}},"reset_template"):null,v=(0,f.jsx)(Q.h,{isEntrypointFileDefined:null!==de,handleEditorEval:Qe},"run"),j=e.canSave&&r.type===U.LD.programming?(0,f.jsx)(ee.t,{hasUnsavedChanges:xe,isDisabled:!(1===(null===F||void 0===F?void 0:F.maxTeamSize))&&!B,onClickSave:()=>{k||(I(!0),d(),setTimeout((()=>{I(!1)}),3e3))}},"save"):null,C=(0,f.jsx)(W.b,{handleChapterSelect:()=>{},isFolderModeEnabled:ce,sourceChapter:r.library.chapter,sourceVariant:null!==(a=r.library.variant)&&void 0!==a?a:y.Z.defaultSourceVariant,disabled:!0},"chapter");return{editorButtons:L?[j,b]:[v,j,b,C],flowButtons:[m,x,p]}},st=(0,c.useMemo)((()=>{const e=(0,f.jsx)(X._,{handleReplOutputClear:()=>Re((0,Ae.clearReplOutput)(Ne))},"clear_repl");return[(0,f.jsx)(K.e,{handleReplEval:$e,isRunning:ye},"eval_repl"),e]}),[Re,ye,$e]),nt=(0,c.useMemo)((()=>({setActiveEditorTabIndex:e=>Re((0,Ae.updateActiveEditorTabIndex)(Ne,e)),removeEditorTabByIndex:e=>Re((0,Ae.removeEditorTab)(Ne,e)),handleDeclarationNavigate:e=>Re((0,Ae.navigateToDeclaration)(Ne,e)),handlePromptAutocomplete:(e,t,a)=>Re((0,Ae.promptAutocomplete)(Ne,e,t,a))})),[Re]),it=(0,c.useMemo)((()=>({handleBrowseHistoryDown:()=>Re((0,Ae.browseReplHistoryDown)(Ne)),handleBrowseHistoryUp:()=>Re((0,Ae.browseReplHistoryUp)(Ne)),handleReplValueChange:e=>Re((0,Ae.updateReplValue)(e,Ne))})),[Re]),rt=(0,c.useMemo)((()=>({handleSideContentHeightChange:e=>Re((0,Ce.changeSideContentHeight)(e,Ne))})),[Re]);if(null===_||void 0===_||!_.questions.length)return(0,f.jsx)(i.t,{className:l()("WorkspaceParent",s.Pyr),description:"Getting mission ready...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})});const ot=(0,f.jsx)(g.V,{className:"assessment-briefing",isOpen:C,children:(0,f.jsxs)(n.Z,{children:[(0,f.jsx)(se.Z,{content:_.longSummary}),(0,f.jsx)(m.z,{className:"assessment-briefing-button",onClick:()=>S(!1),text:"Continue"})]})}),lt=()=>A(!1),ct=(0,f.jsxs)(g.V,{className:"assessment-reset",icon:E.d.ERROR,isCloseButtonShown:!0,isOpen:w,onClose:lt,title:"Confirmation: Reset editor?",children:[(0,f.jsxs)(T.a,{children:[(0,f.jsx)(se.Z,{content:"Are you sure you want to reset the template?"}),(0,f.jsx)(se.Z,{content:"*Note this will not affect the saved copy of your program, unless you save over it.*"})]}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",onClick:lt,options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Confirm",onClick:()=>{lt(),Ve(0,_.questions[dt].solutionTemplate),Ke(!0)},options:{minimal:!1,intent:x.S.DANGER}})]})})]}),dt=e.questionId>=_.questions.length?_.questions.length-1:e.questionId,ht=_.questions[dt],ut=ht.type===U.LD.programming||ht.type===U.LD.voting?{editorVariant:"normal",isFolderModeEnabled:ce,activeEditorTabIndex:de,setActiveEditorTabIndex:nt.setActiveEditorTabIndex,removeEditorTabByIndex:nt.removeEditorTabByIndex,editorTabs:he.map(ae.F),editorSessionId:"",sessionDetails:null,sourceChapter:ht.library.chapter||D.Chapter.SOURCE_4,sourceVariant:null!==(t=ht.library.variant)&&void 0!==t?t:D.Variant.DEFAULT,externalLibraryName:ht.library.external.name||"NONE",handleDeclarationNavigate:nt.handleDeclarationNavigate,handleEditorEval:Qe,handleEditorValueChange:Ve,handleUpdateHasUnsavedChanges:Ke,handleEditorUpdateBreakpoints:He,handlePromptAutocomplete:nt.handlePromptAutocomplete,isEditorAutorun:!1,onChange:(e,t)=>{null===Ke||void 0===Ke||Ke(!0),Ve(0,e);const a={time:Date.now(),type:"codeDelta",data:t};Ye(a)},onCursorChange:e=>{const t={time:Date.now(),type:"cursorPositionChange",data:e.getCursor()};Ye(t)},onSelectionChange:e=>{const t=e.getRange(),a=e.isBackwards();if(!(0,N.isEqual)(t.start,t.end)){const e={time:Date.now(),type:"selectionRangeData",data:{range:t,isBackwards:a}};Ye(e)}}}:void 0,gt={mcq:ht,handleMCQSubmit:e=>We(_.questions[dt].id,e)},pt={handleBrowseHistoryDown:it.handleBrowseHistoryDown,handleBrowseHistoryUp:it.handleBrowseHistoryUp,handleReplEval:$e,handleReplValueChange:it.handleReplValueChange,output:fe,replValue:Te,sourceChapter:(null===ht||void 0===ht||null===(a=ht.library)||void 0===a?void 0:a.chapter)||D.Chapter.SOURCE_4,sourceVariant:null!==(o=ht.library.variant)&&void 0!==o?o:D.Variant.DEFAULT,externalLibrary:(null===ht||void 0===ht||null===(p=ht.library)||void 0===p||null===(v=p.external)||void 0===v?void 0:v.name)||"NONE",replButtons:st},mt={tabs:[]},xt={controlBarProps:at(dt),editorContainerProps:ut,handleSideContentHeightChange:rt.handleSideContentHeightChange,hasUnsavedChanges:xe,mcqProps:gt,sideBarProps:mt,sideContentProps:tt(e,dt),replProps:pt},bt={editorContainerProps:ut,hasUnsavedChanges:xe,mcqProps:gt,replProps:pt,sideBarProps:mt,mobileSideContentProps:(t=>({mobileControlBarProps:{...at(t)},...tt(e,t),onChange:(e,t,a)=>{e!==t&&(t===me.B_.autograder&&e===me.B_.mobileEditorRun||re(e))},selectedTabId:ie,handleEditorEval:Qe}))(dt)};return(0,f.jsxs)("div",{className:l()("WorkspaceParent",s.Pyr),children:[ot,ct,L?(0,f.jsx)(ne.Z,{...bt}):(0,f.jsx)(we.Z,{...xt})]})};var Le=a(42693),_e=a(91009),Oe=a(78096);function De(e){return t=>t.filter((t=>!t.submission_id&&t.assessment_id===e))}var Ge=a(81083);const Be=e=>{switch(e){case Ge.j.new:return"This assessment is new.";case Ge.j.submitted:return"This submission is new.";case Ge.j.unsubmitted:return"This assessment has been unsubmitted.";case Ge.j.published_grading:return"This submission's grading has been published.";case Ge.j.unpublished_grading:return"This submission's grading has been unpublished.";case Ge.j.new_message:return"There are new messages.";default:return"Unknown notification"}},Ue=e=>{const t=(0,d.I0)(),{notifications:a}=(0,j.kP)(),s=e.notificationFilter?e.notificationFilter(a):a;if(!s.length)return null;const n=(0,f.jsx)(_e.V,{intent:x.S.DANGER,round:!0,large:e.large,"data-testid":"NotificationBadge",children:s.length});if(!e.disableHover){const a=e=>(0,f.jsx)(_e.V,{className:"row badge-tag",minimal:!0,multiline:!0,onRemove:()=>{return t((0,b.acknowledgeNotifications)((a=e.id,e=>e.filter((e=>e.id===a)))));var a},children:Be(e.type)},`${e.id}`),i=(0,f.jsx)("div",{className:"col",children:s.map(a)});return(0,f.jsx)(Oe.J,{className:e.className,content:i,interactionKind:Oe.V.HOVER,placement:P.Ly.RIGHT,hoverOpenDelay:50,hoverCloseDelay:50,lazy:!0,children:n})}return n},Fe=()=>(0,f.jsx)("div",{className:l()("NoPage",s.Pyr),children:(0,f.jsx)(i.t,{icon:E.d.ERROR,title:"Assessment Not Found",description:"Please check the top right dropdown menu to see if you are in the right course."})}),ze=e=>{let t,a,s;return e?(t=E.d.TICK,a=x.S.SUCCESS,s="Fully graded"):(t=E.d.TIME,a=x.S.WARNING,s="Grading in progress"),(0,f.jsx)(w.u,{className:"listing-title-tooltip",content:s,placement:P.Ly.RIGHT,children:(0,f.jsx)(I.I,{icon:t,intent:a})})},Ve=(e,t,a)=>(0,f.jsx)(te.Z,{label:e,icon:t?E.d.CARET_DOWN:E.d.CARET_RIGHT,onClick:a,options:{minimal:!0,className:"collapse-button"}}),He=e=>{var t,a;const s=(0,h.UO)(),{isMobileBreakpoint:o}=(0,j.Fs)(),[v,C]=(0,c.useState)(null),[P,R]=(0,c.useState)(!1),[D,G]=(0,c.useState)(!0),[B,F]=(0,c.useState)(!0),{courseId:z,role:V,assessmentOverviews:H}=(0,j.kP)(),$=(0,d.I0)(),W=()=>R(!P),X=()=>G(!D),K=()=>F(!B),Z=()=>C(null),q=e=>(0,N.sortBy)(e,[e=>-e.id]),Y=(e,t)=>(0,f.jsxs)(m.z,{disabled:e.status!==U.PF.attempted,icon:E.d.CONFIRM,intent:e.status===U.PF.attempted?x.S.DANGER:x.S.NONE,minimal:!0,onClick:()=>C(e),children:[(0,f.jsx)("span",{children:"Finalize"}),(0,f.jsx)("span",{className:"custom-hidden-xxs",children:" Submission"})]}),J=e=>{let t,a,s="";switch(e.status){case U.PF.not_attempted:t=E.d.PLAY,a="Attempt";break;case U.PF.attempting:t=E.d.PLAY,a="Continue",s=" Attempt";break;case U.PF.attempted:t=E.d.EDIT,a="Review",s=" Attempt";break;case U.PF.submitted:t=E.d.EYE_OPEN,a="Review",s=" Submission";break;default:t=E.d.PLAY,a="Review"}return(0,f.jsx)(L.OL,{to:`/courses/${z}/${(0,ke.q1)(e.type)}/${e.id.toString()}/${y.Z.defaultQuestionId}`,children:(0,f.jsxs)(m.z,{icon:t,minimal:!0,onClick:()=>$((0,b.acknowledgeNotifications)(De(e.id))),children:[(0,f.jsx)("span",{"data-testid":"Assessment-Attempt-Button",children:a}),(0,f.jsx)("span",{className:"custom-hidden-xxxs",children:s})]})})},Q=(e,t,a,s)=>(0,f.jsx)("div",{children:(0,f.jsxs)(n.Z,{className:"row listing",elevation:S.u.ONE,children:[(0,f.jsxs)("div",{className:l()("listing-picture",!o&&"col-xs-3"),children:[(0,f.jsx)(Ue,{className:"badge",notificationFilter:De(e.id),large:!0}),(0,f.jsx)("img",{alt:"Assessment",className:`cover-image-${e.status}`,src:e.coverImage?e.coverImage:O})]}),(0,f.jsxs)("div",{className:l()("listing-text",!o&&"col-xs-9"),children:[ee(e,t,s),(0,f.jsx)("div",{className:"listing-xp",children:(0,f.jsx)(p.H6,{children:e.isGradingPublished?`XP: ${e.xp} / ${e.maxXp}`:`Max XP: ${e.maxXp}`})}),(0,f.jsx)("div",{className:"listing-description",children:(0,f.jsx)(se.Z,{content:e.shortSummary})}),e.maxTeamSize>1?(0,f.jsx)("div",{className:"listing-team_information",children:(0,f.jsx)(p.H6,{children:" This is a team assessment. "})}):(0,f.jsx)("div",{children:(0,f.jsx)(p.H6,{children:" This is an individual assessment. "})}),(0,f.jsxs)("div",{className:"listing-footer",children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)(k.x,{className:"listing-due-date",children:[(0,f.jsx)(I.I,{className:"listing-due-icon",iconSize:12,icon:E.d.CALENDAR}),`${(0,Pe.IU)(e.openAt)?"Opened":"Opens"}: ${(0,Pe.Dh)(e.openAt)}`]}),(0,Pe.IU)(e.openAt)&&(0,f.jsxs)(k.x,{className:"listing-due-date",children:[(0,f.jsx)(I.I,{className:"listing-due-icon",iconSize:12,icon:E.d.TIME}),`Due: ${(0,Pe.Dh)(e.closeAt)}`]})]}),(0,f.jsx)("div",{className:"listing-button",children:a?J(e):null})]})]})]})},t),ee=(e,t,a)=>(0,f.jsxs)("div",{className:"listing-header",children:[(0,f.jsx)(k.x,{ellipsize:!0,children:(0,f.jsxs)(p.H4,{className:"listing-title",children:[e.title,e.private?(0,f.jsx)(w.u,{className:"listing-title-tooltip",content:"This assessment is password-protected.",children:(0,f.jsx)(I.I,{icon:"lock"})}):null,a?ze(e.isGradingPublished):null]})}),(0,f.jsx)("div",{className:"listing-button",children:Y(e)})]}),ae=(0,c.useMemo)((()=>null===H||void 0===H?void 0:H.filter((t=>t.type===e.assessmentConfiguration.type))),[H,e.assessmentConfiguration.type]);if(s.assessmentId&&(null===(t=s.assessmentId)||void 0===t||!t.match(_.CJ))||s.questionId&&(null===(a=s.questionId)||void 0===a||!a.match(_.CJ)))return(0,f.jsx)(h.Fg,{to:`/courses/${z}/${e.assessmentConfiguration.type}`});const ne=(0,ke.GA)(s.assessmentId),ie=(0,ke.GA)(s.questionId)||y.Z.defaultQuestionId;if(null!==ne&&void 0!==ae){const t=ae.filter((e=>e.id===ne))[0];if(!t)return(0,f.jsx)(Fe,{});const a=t.status===U.PF.not_attempted,s={assessmentId:ne,questionId:ie,notAttempted:a,needsPassword:!!t.private&&a,canSave:V!==u.uU.Student||t.status!==U.PF.submitted&&!(0,Pe.IU)(t.closeAt),assessmentConfiguration:e.assessmentConfiguration};return(0,f.jsx)(Re,{...s})}let re;if(void 0===ae)re=(0,f.jsx)(i.t,{description:"Fetching assessment...",icon:(0,f.jsx)(r.$,{})});else if(0===ae.length)re=(0,f.jsx)(i.t,{title:"There are no assessments.",icon:E.d.FLAME});else{const e=e=>!(0,Pe.IU)(e.closeAt)&&!(0,Pe.IU)(e.openAt),t=q(ae.filter(e)).map(((e,t)=>Q(e,t,V!==u.uU.Student,!1))),a=e=>!(0,Pe.IU)(e.closeAt)&&(0,Pe.IU)(e.openAt)&&e.status!==U.PF.submitted,s=q(ae.filter((e=>a(e)))).map(((e,t)=>Q(e,t,!0,!1))),n=q(ae.filter((t=>!a(t)&&!e(t)))).map(((e,t)=>Q(e,t,!0,!0))),i=(0,f.jsxs)(f.Fragment,{children:[Ve("Upcoming",B,K),(0,f.jsx)(A.U,{isOpen:B,children:t})]}),r=(0,f.jsxs)(f.Fragment,{children:[Ve("Open",D,X),(0,f.jsx)(A.U,{isOpen:D,children:s})]}),o=(0,f.jsxs)(f.Fragment,{children:[Ve("Closed",P,W),(0,f.jsx)(A.U,{isOpen:P,children:n})]});re=(0,f.jsxs)(f.Fragment,{children:[t.length>0?i:null,s.length>0?r:null,n.length>0?o:null]})}const oe=(null===v||void 0===v?void 0:v.earlySubmissionXp)>0?(0,f.jsxs)("p",{children:["Finalising your submission early grants you additional XP, but"," ",(0,f.jsx)("span",{className:"warning",children:"this action is irreversible."})]}):(0,f.jsxs)("p",{children:["Finalising your submission early does not grant you additional XP, and"," ",(0,f.jsx)("span",{className:"warning",children:"this action is irreversible."})]}),le=v?(0,f.jsxs)("p",{children:["You are about to finalise your submission for the ",v.type.toLowerCase()," ",(0,f.jsxs)("i",{children:['"',v.title,'"']}),"."]}):(0,f.jsx)("p",{children:"You are about to finalise your submission."}),ce=(0,f.jsxs)(f.Fragment,{children:[le,oe]}),de=(0,f.jsxs)(g.V,{className:"betcha-dialog",icon:E.d.ERROR,isCloseButtonShown:!0,isOpen:null!==v,onClose:Z,title:"Finalise submission?",children:[(0,f.jsx)(T.a,{children:(0,f.jsx)(k.x,{children:ce})}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",onClick:Z,options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Finalise",onClick:()=>{v&&($((0,b.submitAssessment)(v.id)),Z())},options:{minimal:!1,intent:x.S.DANGER}})]})})]});return(0,f.jsxs)("div",{className:"Assessment",children:[(0,f.jsx)(Le.Z,{display:re,loadContentDispatch:()=>$((0,b.fetchAssessmentOverviews)())}),de]})};var $e=a(36896),We=a(42805);const Xe={coverImage:`${We.ej}/default.png`,description:"",completionText:""},Ke={uuid:"",title:"Achievement Title Here",xp:0,isVariableXp:!1,isTask:!1,position:0,prerequisiteUuids:[],goalUuids:[],cardBackground:`${We.Y9}/default.png`,view:Xe},Ze=({allowNewUuid:e,setNewUuid:t})=>{const a=(0,c.useContext)(We.gc);return(0,f.jsx)(m.z,{className:"command-button",disabled:!e,icon:E.d.NEW_OBJECT,onClick:()=>t(a.insertAchievement(Ke)),text:"Create Achievement"})};var qe=a(37919),Ye=a(97267);const Je=({deleteItem:e,item:t})=>(0,f.jsx)(w.u,{content:"Delete",children:(0,f.jsx)(m.z,{icon:E.d.TRASH,intent:"danger",onClick:async()=>{await(0,G.pG)({contents:`Are you sure you want to delete '${t}' ?`,negativeLabel:"No",positiveIntent:"danger",positiveLabel:"Yes, delete"})&&e()}})}),Qe=({discardChanges:e,saveChanges:t})=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:"Save Changes",children:(0,f.jsx)(m.z,{icon:E.d.FLOPPY_DISK,intent:"primary",onClick:()=>{t(),(0,F.rO)("Saved changes locally")}})}),(0,f.jsx)(w.u,{content:"Discard Changes",children:(0,f.jsx)(m.z,{icon:E.d.CROSS,intent:"danger",onClick:()=>{e(),(0,F.N9)("Discarded changes")}})})]});var et=a(65606),tt=a(22986),at=a(88489);const st=({changeGoalUuids:e,goalUuids:t})=>{const a=(0,c.useContext)(We.gc),s=a.getAllGoalUuids(),n=t.filter((e=>!a.isInvalidGoal(a.getGoal(e)))),i=at.N.ofType(),r=new Set(n),o=new Set((0,N.without)(s,...t)),l=t=>{void 0!==l&&(r.delete(t),o.add(t),e([...r]))};return(0,f.jsx)(i,{itemRenderer:(e,{handleClick:t})=>(0,f.jsx)(tt.s,{onClick:t,text:e.text},e.uuid),items:[...o].map((e=>a.getGoal(e))),noResults:(0,f.jsx)(tt.s,{disabled:!0,text:"No available goal"}),onItemSelect:t=>{return a=t.uuid,r.add(a),o.delete(a),void e([...r]);var a},selectedItems:[...r].map((e=>a.getGoal(e))),tagInputProps:{onRemove:e=>l((e=>a.getUuidByText(e))(e.toString()))},tagRenderer:e=>e.text,itemPredicate:(e,t)=>t.text.toLowerCase().includes(e.toLowerCase()),resetOnSelect:!0})};var nt=a(46576);const it=({changePosition:e,position:t})=>{const a=(0,c.useContext)(We.gc).listTaskUuids().length+1,s=[...Array(a+1).keys()],n=nt.P.ofType();return(0,f.jsx)(n,{filterable:!1,itemRenderer:(e,{handleClick:t})=>(0,f.jsx)(tt.s,{onClick:t,text:e},e),items:s,onItemSelect:e,children:(0,f.jsx)(m.z,{text:t})})},rt=({changePrerequisiteUuids:e,uuid:t,prerequisiteUuids:a})=>{const s=(0,c.useContext)(We.gc),n=[],i=a.filter((e=>!s.isInvalidAchievement(s.getAchievement(e)))),r=at.N.ofType(),o=new Set(i),l=new Set((0,N.without)(n,...i));return(0,f.jsx)(r,{itemRenderer:(e,{handleClick:t})=>(0,f.jsx)(tt.s,{onClick:t,text:e.title},e.uuid),items:[...l].map((e=>s.getAchievement(e))),noResults:(0,f.jsx)(tt.s,{disabled:!0,text:"No available achievement"}),onItemSelect:t=>{return a=t.uuid,o.add(a),l.delete(a),void e([...o]);var a},selectedItems:[...o].map((e=>s.getAchievement(e))),tagInputProps:{onRemove:t=>{var a;void 0!==(a=(e=>s.getUuidByTitle(e))(t.toString()))&&(o.delete(a),l.add(a),e([...o]))}},tagRenderer:e=>e.title,itemPredicate:(e,t)=>t.title.toLowerCase().includes(e.toLowerCase()),resetOnSelect:!0})},ot=({changeCardBackground:e,changeGoalUuids:t,changePosition:a,changePrerequisiteUuids:s,changeIsVariableXp:n,editableAchievement:i})=>{const{uuid:r,cardBackground:o,goalUuids:l,position:d,prerequisiteUuids:h,isVariableXp:u}=i,[p,x]=(0,c.useState)(!1),b=()=>x(!p);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:"More Settings",children:(0,f.jsx)(m.z,{icon:E.d.WRENCH,onClick:b})}),(0,f.jsx)(g.V,{title:"More Settings",icon:E.d.WRENCH,isOpen:p,onClose:b,children:(0,f.jsxs)("div",{style:{padding:"0 0.5em"},children:[(0,f.jsx)("h3",{children:"Card Background"}),(0,f.jsx)(qe.s,{multiline:!0,onChange:e,placeholder:"Enter card background URL here",value:o}),(0,f.jsx)("h3",{children:"Position"}),(0,f.jsx)("p",{children:"Note: Select position 0 to hide achievement"}),(0,f.jsx)(it,{changePosition:a,position:d}),(0,f.jsx)("h3",{children:"Prerequisites"}),(0,f.jsx)(rt,{changePrerequisiteUuids:s,uuid:r,prerequisiteUuids:h}),(0,f.jsx)("h3",{children:"Goals"}),(0,f.jsx)(st,{changeGoalUuids:t,goalUuids:l}),(0,f.jsx)("h3",{children:"Variable XP"}),(0,f.jsx)(et.XZ,{label:"The rewarded XP will be equal to the sum of 'count' of goals",checked:u,onChange:n})]})})]})},lt=({uuid:e})=>(0,f.jsx)(w.u,{content:"Click to copy achievement UUID",children:(0,f.jsx)(m.z,{icon:E.d.CLIPBOARD,onClick:()=>{navigator.clipboard.writeText(e),(0,F.rO)("UUID copied to clipboard")}})});let ct=function(e){return e.CHANGE_CARD_BACKGROUND="CHANGE_CARD_BACKGROUND",e.CHANGE_DEADLINE="CHANGE_DEADLINE",e.CHANGE_GOAL_UUIDS="CHANGE_GOAL_UUIDS",e.CHANGE_POSITION="CHANGE_POSITION",e.CHANGE_PREREQUISITE_UUIDS="CHANGE_PREREQUISITE_UUIDS",e.CHANGE_RELEASE="CHANGE_RELEASE",e.CHANGE_TITLE="CHANGE_TITLE",e.CHANGE_IS_VARIABLE_XP="CHANGE_VARIABLE_XP",e.CHANGE_VIEW="CHANGE_VIEW",e.CHANGE_XP="CHANGE_XP",e.DELETE_ACHIEVEMENT="DELETE_ACHIEVEMENT",e.DISCARD_CHANGES="DISCARD_CHANGES",e.SAVE_CHANGES="SAVE_CHANGES",e}({});var dt=a(96687),ht=a(61134);const ut=({type:e,date:t,changeDate:a})=>{const[s,n]=(0,c.useState)(!1),i=()=>n(!s),r=void 0===t?`No ${e}`:`${(0,ht.ti)(t)}`;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:r,children:(0,f.jsx)(m.z,{minimal:!0,onClick:i,outlined:!0,children:`${e}`})}),(0,f.jsxs)(g.V,{isCloseButtonShown:!1,isOpen:s,onClose:i,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${e}`,children:[(0,f.jsx)(dt.M,{onChange:a,timePickerProps:{showArrowButtons:!0},value:t}),(0,f.jsx)(m.z,{onClick:()=>a(void 0),text:`Remove ${e}`})]})]})},gt=({changeView:e,view:t})=>{const{coverImage:a,description:s,completionText:n}=t,[i,r]=(0,c.useState)(!1),o=()=>r(!i);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:"Edit View",children:(0,f.jsx)(m.z,{icon:E.d.WIDGET_HEADER,onClick:o})}),(0,f.jsx)(g.V,{title:"Edit View",icon:E.d.WIDGET_HEADER,isOpen:i,onClose:o,children:(0,f.jsxs)("div",{style:{padding:"0 0.5em"},children:[(0,f.jsx)("h3",{children:"Cover Image"}),(0,f.jsx)(qe.s,{multiline:!0,onChange:a=>e({...t,coverImage:a}),placeholder:"Enter cover image URL here",value:a}),(0,f.jsx)("h3",{children:"Description"}),(0,f.jsx)(qe.s,{multiline:!0,onChange:a=>e({...t,description:a}),placeholder:"Enter description here",value:s}),(0,f.jsx)("h3",{children:"Completion Text"}),(0,f.jsx)(qe.s,{multiline:!0,onChange:a=>e({...t,completionText:a}),placeholder:"Enter completion text here",value:n})]})})]})},pt=e=>({editableAchievement:e,isDirty:!1}),mt=(e,t)=>{switch(t.type){case ct.SAVE_CHANGES:return{...e,isDirty:!1};case ct.DISCARD_CHANGES:return pt(t.payload);case ct.DELETE_ACHIEVEMENT:return{...e,isDirty:!1};case ct.CHANGE_CARD_BACKGROUND:return{editableAchievement:{...e.editableAchievement,cardBackground:t.payload},isDirty:!0};case ct.CHANGE_DEADLINE:return{editableAchievement:{...e.editableAchievement,deadline:t.payload},isDirty:!0};case ct.CHANGE_GOAL_UUIDS:return{editableAchievement:{...e.editableAchievement,goalUuids:t.payload},isDirty:!0};case ct.CHANGE_POSITION:return{editableAchievement:{...e.editableAchievement,isTask:0!==t.payload,position:t.payload},isDirty:!0};case ct.CHANGE_PREREQUISITE_UUIDS:return{editableAchievement:{...e.editableAchievement,prerequisiteUuids:t.payload},isDirty:!0};case ct.CHANGE_RELEASE:return{editableAchievement:{...e.editableAchievement,release:t.payload},isDirty:!0};case ct.CHANGE_TITLE:return{editableAchievement:{...e.editableAchievement,title:t.payload},isDirty:!0};case ct.CHANGE_VIEW:return{editableAchievement:{...e.editableAchievement,view:t.payload},isDirty:!0};case ct.CHANGE_XP:return{editableAchievement:{...e.editableAchievement,xp:t.payload},isDirty:!0};case ct.CHANGE_IS_VARIABLE_XP:return{editableAchievement:{...e.editableAchievement,isVariableXp:!e.editableAchievement.isVariableXp},isDirty:!0};default:return e}},xt=({uuid:e,isNewAchievement:t,releaseUuid:a,removeCard:s,requestPublish:n})=>{const i=(0,c.useContext)(We.gc),r=i.getAchievement(e),o=(0,c.useMemo)((()=>(0,N.cloneDeep)(r)),[r]),[l,d]=(0,c.useReducer)(mt,o,pt),[h,u]=(0,c.useState)(t),{editableAchievement:g,isDirty:p}=l,{cardBackground:m,deadline:x,release:b,title:y,view:v,xp:j}=g;return(0,f.jsxs)("li",{className:"editable-card",style:{background:`url(${m}) center/cover`},children:[(0,f.jsx)("div",{className:"action-button",children:p?(0,f.jsx)(Qe,{discardChanges:()=>d({type:ct.DISCARD_CHANGES,payload:o}),saveChanges:()=>{d({type:ct.SAVE_CHANGES}),i.modifyAchievement(g),h&&(a(),u(!1)),n()}}):(0,f.jsx)(Je,{deleteItem:()=>{d({type:ct.DELETE_ACHIEVEMENT}),i.removeAchievement(e),h&&(a(),u(!1)),s(e),n()},item:y})}),(0,f.jsxs)("div",{className:"content",children:[(0,f.jsx)("h3",{className:"title",children:(0,f.jsx)(qe.s,{onChange:e=>d({type:ct.CHANGE_TITLE,payload:e}),placeholder:"Enter your title here",value:y})}),(0,f.jsx)("div",{className:"xp",children:(0,f.jsx)(w.u,{content:"XP",children:(0,f.jsx)(Ye.A,{value:j,min:0,allowNumericCharactersOnly:!0,leftIcon:E.d.TRENDING_UP,placeholder:"XP",onValueChange:e=>d({type:ct.CHANGE_XP,payload:e})})})}),(0,f.jsxs)("div",{className:"details",children:[(0,f.jsx)(ut,{changeDate:e=>d({type:ct.CHANGE_RELEASE,payload:e}),date:b,type:"Release"}),(0,f.jsx)(ut,{changeDate:e=>d({type:ct.CHANGE_DEADLINE,payload:e}),date:x,type:"Deadline"}),(0,f.jsx)(lt,{uuid:e})]})]}),(0,f.jsxs)("div",{className:"content-button",children:[(0,f.jsx)(gt,{changeView:e=>d({type:ct.CHANGE_VIEW,payload:e}),view:v}),(0,f.jsx)(ot,{changeCardBackground:e=>d({type:ct.CHANGE_CARD_BACKGROUND,payload:e}),changeGoalUuids:e=>{d({type:ct.CHANGE_GOAL_UUIDS,payload:e})},changePosition:e=>d({type:ct.CHANGE_POSITION,payload:e}),changePrerequisiteUuids:e=>d({type:ct.CHANGE_PREREQUISITE_UUIDS,payload:e}),changeIsVariableXp:()=>d({type:ct.CHANGE_IS_VARIABLE_XP}),editableAchievement:g})]})]})};let bt=[];const yt=({requestPublish:e})=>{const t=(0,c.useContext)(We.gc),[a,s]=(0,c.useState)(""),n=""===a,i=()=>s(""),r=e=>{let t=0;for(;bt[t].key!==e&&t<bt.length;)t++;bt.splice(t,1)},o=(t,a)=>(0,f.jsx)(xt,{uuid:t,isNewAchievement:a,releaseUuid:i,removeCard:r,requestPublish:e},t);0===bt.length&&(bt=t.listSortedAchievementUuids().map((e=>o(e,!1))));return(0,f.jsxs)("div",{className:"achievement-editor",children:[(0,f.jsx)("div",{className:"command",children:(0,f.jsx)(Ze,{allowNewUuid:n,setNewUuid:e=>{s(e),bt[bt.length]=bt[0],bt[0]=o(e,!0)}})}),(0,f.jsx)("ul",{className:"achievement-container",children:bt})]})};var ft=a(79752);const vt=({filterState:e,icon:t,ownStatus:a})=>{const[s,n]=e;return(0,f.jsxs)("div",{className:"filter",onClick:()=>n(a),style:{color:(0,We.jf)(s,a)},children:[(0,f.jsx)(I.I,{icon:t,iconSize:30}),(0,f.jsx)("p",{children:a})]})};var jt=a(47010),Ct=a(81920),St=a(4031);const kt=({studentXp:e})=>(0,f.jsxs)("div",{className:"milestone",children:[(0,f.jsx)("h3",{children:"Your Total XP"}),(0,f.jsxs)("div",{className:"user-xp",children:[e," XP"]}),(0,f.jsx)("h3",{children:"CA Achievement Level"}),(0,f.jsxs)("div",{className:"details",children:[(0,f.jsxs)("div",{className:"level-badge",children:[(0,f.jsx)("span",{className:"level-icon"}),(0,f.jsx)("p",{children:y.Z.caFulfillmentLevel})]}),(0,f.jsx)("p",{className:"description",children:"Complete CS1101S CA Component"})]}),(0,f.jsx)("div",{className:"footer",children:(0,f.jsxs)("p",{children:["Full CA level of ",y.Z.caFulfillmentLevel," is subjected to change."]})})]}),It=({studentXp:e})=>{const[t,a]=(0,c.useState)(!1),s=Math.floor(e/We.Dt)+1,n=e%We.Dt,i=n/We.Dt;return(0,f.jsxs)("div",{className:"level",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[(0,f.jsxs)("div",{className:"level-badge",children:[(0,f.jsx)("span",{className:"level-icon"}),(0,f.jsx)("p",{children:`Level ${s}`})]}),(0,f.jsxs)("span",{className:"level-progress",children:[(0,f.jsx)(St.k,{animate:!1,className:"progress-bar",stripes:!1,value:i}),(0,f.jsxs)("p",{children:[n," / ",We.Dt," XP"]})]}),0!==y.Z.caFulfillmentLevel&&t&&(0,f.jsx)(kt,{studentXp:e})]})},wt=({name:e,userState:t})=>{const[a]=t,s=null===a||void 0===a?void 0:a.courseRegId,n=(0,j.ix)((e=>e.session.courseRegId)),i=(0,d.I0)();(0,c.useEffect)((()=>{i(s&&s!==n?{type:Ct.wn,payload:s}:{type:Ct.e_})}),[s,n,i]);const r=(0,j.ix)((e=>e.session.xp));return(0,f.jsxs)("div",{className:"achievement-overview",children:[(0,f.jsx)(It,{studentXp:r}),(0,f.jsx)("h3",{children:e})]})},At=new Date(0,0,2).getTime()-new Date(0,0,0).getTime(),Tt=({deadline:e})=>{const t=void 0!==e&&!(0,ht.Bw)(e)&&(0,ht.Y4)(e)<=At?We.dh.RED:We.dh.BLACK;return(0,f.jsxs)("div",{className:"deadline",children:[(0,f.jsx)(I.I,{color:t,icon:E.d.STOPWATCH}),(0,f.jsx)("p",{style:{color:t},children:(0,ht.xI)(e)})]})},Mt=(e,t)=>(t?"Total ":"")+e+" XP",Pt=({isBonus:e,xp:t})=>(0,f.jsx)("div",{className:"xp",children:0!==t&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(I.I,{icon:E.d.BANK_ACCOUNT}),(0,f.jsx)("p",{children:Mt(t,e)})]})}),Et=({uuid:e,focusState:t,isDropdownOpen:a,shouldRender:s,toggleDropdown:n})=>{const i=(0,c.useContext)(We.gc),[r,o]=t,{cardBackground:l,title:d}=i.getAchievement(e),h=i.getDisplayDeadline(e),u=i.getDescendantXp(e),g=i.getProgressFrac(e),p=i.getStatus(e),m=void 0!==a&&0!==i.getImmediateChildren(e).size;return(0,f.jsxs)("div",{className:"achievement-card",onClick:()=>o(e),onClickCapture:n,style:{...(0,We.cb)(e,r),opacity:s?"100%":"20%",background:`url(${l}) center/cover`},children:[(0,f.jsx)("div",{className:"dropdown-button",children:m&&(0,f.jsx)(I.I,{icon:a?E.d.CARET_DOWN:E.d.CARET_RIGHT})}),(0,f.jsxs)("div",{className:"content",children:[(0,f.jsxs)("div",{className:"heading",children:[(0,f.jsx)("h3",{children:d.toUpperCase()}),p===ft.Cv.COMPLETED&&(0,f.jsx)(I.I,{icon:E.d.CONFIRM,intent:x.S.SUCCESS,style:{padding:"1em"}})]}),(0,f.jsxs)("div",{className:"details",children:[(0,f.jsx)(Tt,{deadline:h}),(0,f.jsx)(Pt,{isBonus:m,xp:u})]}),(0,f.jsx)(St.k,{animate:!1,className:"progress",intent:1===g?"success":"primary",stripes:!1,value:g})]})]})},Nt=({uuid:e,filterStatus:t,focusState:a})=>{const s=(0,c.useContext)(We.gc),n=[...s.getImmediateChildren(e)],i=(0,We.Xb)(),[r,o]=(0,c.useState)(!1),l=e=>{const a=s.getStatus(e);switch(t){case ft.fS.ALL:return!0;case ft.fS.ACTIVE:return a===ft.Cv.ACTIVE;case ft.fS.COMPLETED:return a===ft.Cv.COMPLETED;default:return!1}};return(0,f.jsx)(f.Fragment,{children:(e=>(e=>!s.isPrerequisite(e)&&l(e))(e)||(e=>[...s.getImmediateChildren(e)].reduce(((e,t)=>e||l(t)),!1))(e))(e)&&(0,f.jsxs)("li",{className:"task",children:[(0,f.jsx)(Et,{uuid:e,focusState:a,isDropdownOpen:r,shouldRender:l(e),toggleDropdown:()=>o(!r)}),(0,f.jsx)(A.U,{isOpen:r,keepChildrenMounted:!0,children:(0,f.jsx)("div",{className:"prerequisite-container",children:n.map((e=>(0,f.jsxs)("div",{className:"prerequisite",children:[(0,f.jsx)("div",{className:"dropdown-lines",style:{borderBottom:`1px solid ${i}`,borderLeft:`1px solid ${i}`}}),(0,f.jsx)(Et,{uuid:e,focusState:a,shouldRender:l(e)})]},e)))})})]})})},Rt="AchievementCommentCard_assessment-feedback__k-sBc",Lt="AchievementCommentCard_feedback-list__o20Gz",_t="AchievementCommentCard_assessment-comments__0xF7w",Ot="AchievementCommentCard_question-header__rBnJx",Dt="AchievementCommentCard_box-comment__CXsWS",Gt="AchievementCommentCard_to-assessment-button__akAcI",Bt=({assessment:e,showToQuestion:t})=>{const a=(0,h.s0)(),s=(0,j.ix)((e=>e.session.courseId)),n=(0,c.useMemo)((()=>t=>{if(!s)return void(0,F.N9)("Course ID not found");const n=`/courses/${s}/${(0,ke.q1)(null===e||void 0===e?void 0:e.type)}`+`/${null===e||void 0===e?void 0:e.id.toString()}`;a(n+`/${t}`)}),[null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.type,s,a]);return(0,f.jsxs)("div",{children:[(0,f.jsx)("h1",{className:Rt,children:"Feedback"}),(0,f.jsx)("div",{className:Lt,children:e&&e.questions.map(((e,a)=>(0,f.jsxs)("div",{className:_t,children:[(0,f.jsx)("span",{children:(0,f.jsx)("h2",{className:Ot,children:"Q"+(a+1)})}),(0,f.jsxs)("div",{className:Dt,children:[(0,f.jsx)("p",{children:null===e.comments?"No Comments":e.comments}),(0,f.jsx)("p",{className:"xp",children:"XP: "+e.xp+"/"+e.maxXp})]}),t&&(0,f.jsx)("button",{className:Gt,onClick:()=>n(a),children:"To Question"})]},a)))})]})},Ut=({awardedXp:e,completionText:t})=>{const a=t?t.split("\n"):[""];return(0,f.jsxs)("div",{className:"completion",children:[e>0&&(0,f.jsx)("h1",{children:`AWARDED ${e}XP`}),a.map(((e,t)=>(0,f.jsxs)("p",{children:[e,(0,f.jsx)("br",{})]},t)))]})},Ft=({goals:e})=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h1",{className:"progress-header",children:"Progress"}),e.map((e=>(e=>{const{uuid:t,text:a,targetCount:s,count:n,completed:i}=e,r=Math.min(0===s?0:n/s,1);return(0,f.jsxs)("div",{className:"goal",children:[(0,f.jsxs)("div",{className:"goal-badge",children:[(0,f.jsx)("span",{className:"goal-icon"}),(0,f.jsxs)("p",{children:[n," / ",s]})]}),(0,f.jsxs)("div",{className:"goal-progress",children:[(0,f.jsx)("p",{children:a}),(0,f.jsx)(St.k,{animate:!1,className:"progress",intent:i?"success":void 0,stripes:!1,value:r})]})]},t)})(e)))]}),zt=({focusUuid:e,userState:t})=>{var a;const s=Number.isNaN(+e)||0===+e?void 0:+e;let n;if(t){const[e]=t;n=null===e||void 0===e?void 0:e.courseRegId}const i=(0,j.ix)((e=>e.session.courseRegId)),r=void 0!==n&&n!==i,o=(0,d.I0)();(0,c.useEffect)((()=>{o({type:U.pL}),s&&o(r?{type:Ct.hc,payload:{assessmentId:s,courseRegId:n}}:{type:Ct.cp,payload:{assessmentId:s}})}),[o,s,n,r]);const l=(0,c.useContext)(We.gc),h=(0,j.ix)((e=>e.session.assessments)).get(s),u=(null!==(a=(0,j.ix)((e=>e.session.assessmentOverviews)))&&void 0!==a?a:[]).find((e=>e.id===s));if(""===e)return(0,f.jsxs)("div",{className:"no-view",children:[(0,f.jsx)(I.I,{icon:E.d.MOUNTAIN,iconSize:60}),(0,f.jsx)("h2",{children:"Select an achievement"})]});const g=l.getAchievement(e),{deadline:p,title:m,view:x}=g,{coverImage:b,completionText:y,description:v}=x,C=l.getAchievementXp(e),S=l.listGoals(e),k=l.getStatus(e),w=v?v.split("\n"):[""];return(0,f.jsxs)("div",{className:"view",style:{...(0,We.wI)(),...(0,We.v_)()},children:[(0,f.jsxs)("div",{className:"cover",style:{background:`rgba(0, 0, 0, 0.5) url(${b}) center/cover`,backgroundBlendMode:"darken"},children:[(0,f.jsx)("h1",{children:m.toUpperCase()}),p&&(0,f.jsx)("p",{children:`Deadline: ${(0,ht.ti)(p)}`}),(0,f.jsx)("span",{className:"description",children:w.map(((e,t)=>(0,f.jsxs)("p",{children:[e,(0,f.jsx)("br",{})]},t)))})]}),k===ft.Cv.COMPLETED&&h&&u&&u.isManuallyGraded&&(0,f.jsx)(Bt,{assessment:h,showToQuestion:!r}),S.length>0&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Ft,{goals:S}),k===ft.Cv.COMPLETED&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("hr",{}),(0,f.jsx)(Ut,{awardedXp:C,completionText:y})]})]})]})};var Vt=a(16219),Ht=a(72426),$t=a.n(Ht);function Wt(e){return e.isGradingPublished}const Xt=function(e,t,a){const s=[...e].sort(((e,t)=>$t()(e.closeAt).diff($t()(t.closeAt)))),n=e.length,i=t.map((e=>e.type)),r=i.map((e=>[]));s.forEach(((e,t)=>{if(!(0,ht.Oe)(new Date(e.openAt))||(0,ht.Bw)(new Date(e.closeAt))&&e.status!==U.PF.submitted)return;const s=e.id.toString();a.hasAchievement(s)||(a.insertFakeGoalDefinition({uuid:s+"0",text:`Submitted ${e.title}`,achievementUuids:[s],meta:{type:ft.lC.ASSESSMENT,assessmentNumber:e.id,requiredCompletionFrac:0}},e.status===U.PF.submitted),e.isManuallyGraded&&a.insertFakeGoalDefinition({uuid:s+"1",text:`Graded ${e.title}`,achievementUuids:[s],meta:{type:ft.lC.ASSESSMENT,assessmentNumber:e.id,requiredCompletionFrac:0}},e.isGradingPublished),a.insertFakeAchievement({uuid:s,title:e.title,xp:Wt(e)?e.xp:e.maxXp,isVariableXp:!1,deadline:new Date(e.closeAt),release:new Date(e.openAt),isTask:void 0!==e.isPublished&&e.isPublished,position:t-n-100,prerequisiteUuids:[],goalUuids:e.isManuallyGraded?[s+"0",s+"1"]:[s+"0"],cardBackground:`${We.Y9}/default.png`,view:{coverImage:e.coverImage,description:e.shortSummary,completionText:`XP: ${e.xp} / ${e.maxXp}`}}),Wt(e)&&i.forEach(((t,a)=>{t===e.type&&r[a].push(s)})))})),r.forEach(((e,t)=>{const s=i[t];e.length>0&&a.insertFakeAchievement({uuid:s,title:"Completed "+s,xp:0,isVariableXp:!1,deadline:void 0,release:void 0,isTask:!0,position:-1-t,prerequisiteUuids:e,goalUuids:[],cardBackground:`${We.Y9}/default.png`,view:{coverImage:`${We.ej}/default.png`,description:"Your completed "+s+" are listed here!",completionText:""}})}))};var Kt=a(58596);const Zt=(e,t,a)=>e.map((e=>(0,f.jsx)(Nt,{uuid:e,filterStatus:t,focusState:a},e))),qt=()=>{const e=(0,c.useState)(void 0),[t]=e,{isMobileBreakpoint:a}=(0,j.Fs)(),{group:s,name:n,role:i,assessmentOverviews:r,assessmentConfigurations:o}=(0,j.kP)(),{assessmentOverviews:l,users:h}=(0,j.ix)((e=>e.achievement)),g=(0,j.ix)((e=>new Vt.Z(e.achievement.achievements,e.achievement.goals))),p=(0,d.I0)(),{handleFetchAssessmentOverviews:m,handleGetAchievements:x,handleGetGoals:y,handleGetOwnGoals:v,handleGetUserAssessmentOverviews:C,handleGetUsers:S,handleUpdateGoalProgress:k}=(0,c.useMemo)((()=>({handleFetchAssessmentOverviews:()=>p((0,b.fetchAssessmentOverviews)()),handleGetAchievements:()=>p((0,Kt.getAchievements)()),handleGetGoals:e=>p((0,Kt.getGoals)(e)),handleGetOwnGoals:()=>p((0,Kt.getOwnGoals)()),handleGetUserAssessmentOverviews:e=>p((0,Kt.getUserAssessmentOverviews)(e)),handleGetUsers:()=>p((0,Kt.getUsers)()),handleUpdateGoalProgress:(e,t)=>p((0,Kt.updateGoalProgress)(e,t))})),[p]);(0,c.useEffect)((()=>{t?y(t.courseRegId):v(),t?C(t.courseRegId):m(),x()}),[m,x,y,v,C,t]);const I=t?l:r;I&&o&&Xt(I,o,g);const w=(0,c.useState)(ft.fS.ALL),[A]=w,T=(0,c.useState)(""),[M,P]=T,N=(0,c.useState)(!1),[R]=N;return(0,c.useEffect)((()=>{P("")}),[t,P]),(0,f.jsx)(We.gc.Provider,{value:g,children:(0,f.jsxs)("div",{className:"AchievementDashboard",children:[(0,f.jsx)(wt,{name:t?t.name||t.username:n||"User",userState:e}),i&&i!==u.uU.Student&&(0,f.jsx)(jt.Z,{userState:e,hiddenState:N,studio:s||"Staff",users:h,getUsers:S,updateGoalProgress:k}),(0,f.jsxs)("div",{className:a?"achievement-main-mobile":"achievement-main",children:[(0,f.jsxs)("div",{className:"filter-container",children:[(0,f.jsx)(vt,{filterState:w,icon:E.d.GLOBE,ownStatus:ft.fS.ALL}),(0,f.jsx)(vt,{filterState:w,icon:E.d.LOCATE,ownStatus:ft.fS.ACTIVE}),(0,f.jsx)(vt,{filterState:w,icon:E.d.ENDORSED,ownStatus:ft.fS.COMPLETED})]}),(0,f.jsx)("ul",{className:"task-container",children:Zt(i!==u.uU.Student&&R?g.listAllSortedAchievementUuids():g.listSortedReleasedTaskUuids(),A,T)}),(0,f.jsx)("div",{className:"view-container",children:(0,f.jsx)(zt,{focusUuid:M,userState:e})})]})]})})},Yt=({awaitPublish:e,publishChanges:t})=>{const a=(0,c.useContext)(We.gc),[s,n]=(0,c.useReducer)((e=>!e),!1),i=(0,c.useState)(""),[r]=i;return(0,f.jsxs)("div",{className:"achievement-preview",children:[(0,f.jsxs)("div",{className:"command",children:[(0,f.jsx)(m.z,{className:"command-button",icon:s&&E.d.ARROW_LEFT,rightIcon:!s&&E.d.ARROW_RIGHT,text:s?"Task":"View",onClick:n}),e&&(0,f.jsx)(m.z,{className:"command-button",icon:E.d.CLOUD_UPLOAD,intent:"primary",text:"Publish Changes",onClick:t})]}),s?(0,f.jsx)("div",{className:"preview-container",children:(0,f.jsx)(zt,{focusUuid:r})}):(0,f.jsx)("ul",{className:"preview-container",children:Zt(a.listSortedTaskUuids(),ft.fS.ALL,i)})]})};let Jt=function(e){return e.CHANGE_META="CHANGE_META",e.CHANGE_TEXT="CHANGE_TEXT",e.DELETE_GOAL="DELETE_GOAL",e.DISCARD_CHANGES="DISCARD_CHANGES",e.SAVE_CHANGES="SAVE_CHANGES",e}({});const Qt=e=>{switch(e){case ft.lC.ASSESSMENT:return{type:ft.lC.ASSESSMENT,assessmentNumber:0,requiredCompletionFrac:0};case ft.lC.BINARY:return{type:ft.lC.BINARY,condition:!1,targetCount:1};case ft.lC.MANUAL:return{type:ft.lC.MANUAL,targetCount:1};case ft.lC.EVENT:return{type:ft.lC.EVENT,eventNames:[ft.tw.RUN_CODE],targetCount:1,release:void 0,deadline:void 0,observeFrom:void 0,observeTo:void 0}}},ea={uuid:"",text:"Goal Text Here",achievementUuids:[],meta:Qt(ft.lC.MANUAL)},ta=({assessmentMeta:e,changeMeta:t})=>{const{assessmentNumber:a,requiredCompletionFrac:s}=e;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:"Assessment Number",children:(0,f.jsx)(Ye.A,{allowNumericCharactersOnly:!0,onValueChange:a=>t({...e,assessmentNumber:a}),placeholder:"Enter assessment number here",value:a})}),(0,f.jsx)(w.u,{content:"Required Completion Percentage",children:(0,f.jsx)(Ye.A,{allowNumericCharactersOnly:!0,max:100,min:0,onValueChange:a=>{const s=a/100;t({...e,requiredCompletionFrac:s})},placeholder:"Enter required completion percentage here",rightElement:(0,f.jsx)("p",{children:"%"}),value:100*s})})]})};function aa(...e){return{type:"AND",operands:e}}function sa(...e){return{type:"OR",operands:e}}const na=nt.P.ofType(),ia=(e,{handleClick:t})=>(0,f.jsx)(tt.s,{onClick:t,text:e},e),ra=e=>{if("object"===typeof e&&"type"in e){const{type:t,operands:a}=e,s=a.length,n=[];for(let e=0;e<s;e++)n.push(ra(a[e])),e!==s-1&&n.push(t);return n.flat()}return[JSON.stringify(e)]},oa=({binaryMeta:e,changeMeta:t})=>{const{condition:a,targetCount:s}=e,n=[],i=[],r=ra(a);for(let l=0;l<r.length;l++)l%2===0?i[i.length]=r[l]:n[n.length]=r[l];const o=()=>{let a=JSON.parse(i[0]);for(let e=1;e<i.length;e++)a="AND"===n[e-1]?aa(a,JSON.parse(i[e])):sa(a,JSON.parse(i[e]));t({...e,condition:a})};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:"Target Count",children:(0,f.jsx)(Ye.A,{allowNumericCharactersOnly:!0,leftIcon:E.d.BANK_ACCOUNT,min:0,onValueChange:a=>t({...e,targetCount:a}),placeholder:"Enter target count here",value:s})}),r.map(((e,t)=>(0,f.jsx)("div",{children:t%2===0?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:"Condition",children:(0,f.jsx)(qe.s,{onChange:e=>((e,t)=>{i[t]=e,o()})(e,t/2),multiline:!0,placeholder:"Enter condition here",value:e})}),i.length>1&&(0,f.jsx)(w.u,{content:"Delete Condition",children:(0,f.jsx)(m.z,{intent:"danger",icon:"trash",onClick:()=>(e=>{for(let t=e;t<i.length-1;t++)i[t]=i[t+1],n[t]=n[t+1];i.length=i.length-1,n.length=n.length-1,o()})(t)})})]}):(0,f.jsx)(w.u,{content:"And/Or",children:(0,f.jsx)(na,{filterable:!1,itemRenderer:ia,items:["AND","OR"],onItemSelect:e=>((e,t)=>{n[t]=e,o()})(e,(t-1)/2),children:(0,f.jsx)(m.z,{minimal:!0,outlined:!0,text:e})})})},t))),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{minimal:!0,outlined:!0,text:"Add Condition",onClick:()=>{n.push("AND"),i.push('{"event":"", "restriction":""}'),o()}})]})},la=({type:e,date:t,changeDate:a})=>{const[s,n]=(0,c.useState)(!1),i=()=>n(!s),r=void 0===t?`No ${e}`:`${(0,ht.ti)(t)}`;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:r,children:(0,f.jsx)(m.z,{minimal:!0,onClick:i,outlined:!0,children:`${e}`})}),(0,f.jsxs)(g.V,{isCloseButtonShown:!1,isOpen:s,onClose:i,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${e}`,children:[(0,f.jsx)(dt.M,{onChange:a,timePickerProps:{showArrowButtons:!0},value:t}),(0,f.jsx)(m.z,{onClick:()=>a(void 0),text:`Remove ${e}`})]})]})};var ca=a(83348);const da=({type:e,time:t,changeTime:a})=>{const[s,n]=(0,c.useState)(!1),i=()=>n(!s),r=void 0===t?`No ${e}`:`${(0,ht.yG)(t)}`;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:r,children:(0,f.jsx)(m.z,{minimal:!0,onClick:i,outlined:!0,children:`${e}`})}),(0,f.jsxs)(g.V,{isCloseButtonShown:!1,isOpen:s,onClose:i,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${e}`,children:[(0,f.jsx)(ca.j,{onChange:a,showArrowButtons:!0,value:t}),(0,f.jsx)(m.z,{onClick:()=>a(void 0),text:`Remove ${e}`})]})]})},ha=nt.P.ofType(),ua=(e,{handleClick:t})=>(0,f.jsx)(tt.s,{onClick:t,text:e},e),ga=({changeMeta:e,eventMeta:t})=>{const{eventNames:a,targetCount:s,release:n,deadline:i,observeFrom:r,observeTo:o}=t,l=s=>n=>((s,n)=>{s===ft.tw.NONE?e({...t,eventNames:a.filter(((e,t)=>t!==n))}):(a[n]=s,e({...t,eventNames:a}))})(n,s);return(0,f.jsxs)(f.Fragment,{children:[a.map(((e,t)=>(0,f.jsx)(w.u,{content:"Change event type "+t,children:(0,f.jsx)(ha,{filterable:!1,items:Object.values(ft.tw),itemRenderer:ua,onItemSelect:l(t),children:(0,f.jsx)(m.z,{outlined:!0,text:e})})},t))),(0,f.jsx)(w.u,{content:"Add Event",children:(0,f.jsx)(m.z,{outlined:!0,text:"Add Event",onClick:()=>{a[a.length]=ft.tw.RUN_CODE,e({...t,eventNames:a})}})}),(0,f.jsx)(w.u,{content:"Target Count",children:(0,f.jsx)(Ye.A,{allowNumericCharactersOnly:!0,leftIcon:E.d.LOCATE,min:0,onValueChange:a=>e({...t,targetCount:a}),placeholder:"Enter target count here",value:s})}),(0,f.jsx)("br",{}),(0,f.jsx)(la,{type:"Release",date:n,changeDate:a=>{e({...t,release:a})}}),(0,f.jsx)(la,{type:"Deadline",date:i,changeDate:a=>{e({...t,deadline:a})}}),(0,f.jsx)(da,{type:"Observe From",time:r,changeTime:a=>{e({...t,observeFrom:a})}}),(0,f.jsx)(da,{type:"Observe To",time:o,changeTime:a=>{e({...t,observeTo:a})}})]})},pa=({changeMeta:e,manualMeta:t})=>{const{targetCount:a}=t;return(0,f.jsx)(w.u,{content:"Target Count",children:(0,f.jsx)(Ye.A,{allowNumericCharactersOnly:!0,leftIcon:E.d.BANK_ACCOUNT,min:0,onValueChange:a=>e({...t,targetCount:a}),placeholder:"Enter target count here",value:a})})},ma=({changeMeta:e,meta:t})=>{const{type:a}=t,s=nt.P.ofType();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:"Change Goal Type",children:(0,f.jsx)(s,{filterable:!1,itemRenderer:(e,{handleClick:t})=>(0,f.jsx)(tt.s,{onClick:t,text:e},e),items:Object.values(ft.lC),onItemSelect:t=>e(Qt(t)),children:(0,f.jsx)(m.z,{minimal:!0,outlined:!0,text:a})})}),(a=>{switch(a){case ft.lC.ASSESSMENT:return(0,f.jsx)(ta,{assessmentMeta:t,changeMeta:e});case ft.lC.BINARY:return(0,f.jsx)(oa,{binaryMeta:t,changeMeta:e});case ft.lC.MANUAL:return(0,f.jsx)(pa,{changeMeta:e,manualMeta:t});case ft.lC.EVENT:return(0,f.jsx)(ga,{eventMeta:t,changeMeta:e});default:return null}})(a)]})},xa=e=>({editableGoal:e,isDirty:!1}),ba=(e,t)=>{switch(t.type){case Jt.SAVE_CHANGES:return{...e,isDirty:!1};case Jt.DISCARD_CHANGES:return xa(t.payload);case Jt.DELETE_GOAL:return{...e,isDirty:!1};case Jt.CHANGE_META:return{editableGoal:{...e.editableGoal,meta:t.payload},isDirty:!0};case Jt.CHANGE_TEXT:return{editableGoal:{...e.editableGoal,text:t.payload},isDirty:!0};default:return e}},ya=({uuid:e,isNewGoal:t,releaseUuid:a,removeCard:s,requestPublish:n})=>{const i=(0,c.useContext)(We.gc),r=i.getGoalDefinition(e),o=(0,c.useMemo)((()=>(0,N.cloneDeep)(r)),[r]),[l,d]=(0,c.useReducer)(ba,o,xa),[h,u]=(0,c.useState)(t),{editableGoal:g,isDirty:p}=l,{meta:m,text:x}=g;return(0,f.jsxs)("li",{className:"editable-goal",id:e,children:[(0,f.jsx)("div",{className:"action-button",children:p?(0,f.jsx)(Qe,{discardChanges:()=>d({type:Jt.DISCARD_CHANGES,payload:o}),saveChanges:()=>{d({type:Jt.SAVE_CHANGES}),i.modifyGoalDefinition(g),h&&(a(),u(!1)),n()}}):(0,f.jsx)(Je,{deleteItem:()=>{d({type:Jt.DELETE_GOAL}),i.removeGoalDefinition(e),h&&(a(),u(!1)),s(e),n()},item:x})}),(0,f.jsx)("h3",{children:(0,f.jsx)(qe.s,{onChange:e=>d({type:Jt.CHANGE_TEXT,payload:e}),placeholder:"Enter goal text here",value:x})}),(0,f.jsx)("div",{className:"meta",children:(0,f.jsx)(ma,{changeMeta:e=>d({type:Jt.CHANGE_META,payload:e}),meta:m})})]})},fa=({allowNewUuid:e,setNewUuid:t})=>{const a=(0,c.useContext)(We.gc);return(0,f.jsx)(m.z,{className:"command-button",disabled:!e,icon:E.d.NEW_OBJECT,onClick:()=>t(a.insertGoalDefinition(ea)),text:"Create Goal"})};let va=[];const ja=({requestPublish:e})=>{const t=(0,c.useContext)(We.gc),[a,s]=(0,c.useState)(""),n=""===a,i=()=>s(""),r=e=>{let t=0;for(;va[t].key!==e&&t<va.length;)t++;va.splice(t,1)},o=(t,a)=>(0,f.jsx)(ya,{uuid:t,isNewGoal:a,releaseUuid:i,requestPublish:e,removeCard:r},t);0===va.length&&(va=t.getAllGoalUuids().map((e=>o(e,!1))));return(0,f.jsxs)("div",{className:"goal-editor",children:[(0,f.jsx)("div",{className:"command",children:(0,f.jsx)(fa,{allowNewUuid:n,setNewUuid:e=>{s(e),va[va.length]=va[0],va[0]=o(e,!0)}})}),(0,f.jsx)("ul",{className:"goal-container",children:va})]})};var Ca=a(84131);const Sa=()=>{const e=(0,d.I0)(),{handleBulkUpdateAchievements:t,handleBulkUpdateGoals:a,handleGetAchievements:s,handleGetOwnGoals:n,handleRemoveAchievement:i,handleRemoveGoal:r}=(0,c.useMemo)((()=>({handleBulkUpdateAchievements:t=>e((0,Kt.bulkUpdateAchievements)(t)),handleBulkUpdateGoals:t=>e((0,Kt.bulkUpdateGoals)(t)),handleGetAchievements:()=>e((0,Kt.getAchievements)()),handleGetOwnGoals:()=>e((0,Kt.getOwnGoals)()),handleRemoveAchievement:t=>e((0,Kt.removeAchievement)(t)),handleRemoveGoal:t=>e((0,Kt.removeGoal)(t))})),[e]),o=(0,j.ix)((e=>new Vt.Z(e.achievement.achievements,e.achievement.goals)));(0,c.useEffect)((()=>{s(),n()}),[s,n]);const[l,h]=(0,c.useState)(!1),u=()=>{h(!0),g()},[,g]=(0,c.useReducer)((e=>e+1),0);return(0,f.jsxs)(We.gc.Provider,{value:o,children:[(0,f.jsx)(Ca.N,{message:"You have unpublished changes. Are you sure you want to leave?",when:l}),(0,f.jsxs)("div",{className:"AchievementControl",children:[(0,f.jsx)(Yt,{awaitPublish:l,publishChanges:()=>{a(o.getAllGoals()),t(o.getAllAchievements()),o.getGoalsToDelete().forEach(r),o.getAchievementsToDelete().forEach(i),o.resetToDelete(),h(!1)}}),(0,f.jsx)(yt,{requestPublish:u}),(0,f.jsx)(ja,{requestPublish:u})]})]})},ka=()=>{const e=(0,j.ix)((e=>e.session.role)),t=e===u.uU.Admin||e===u.uU.Staff?(0,f.jsx)(Sa,{}):(0,f.jsx)($e.default,{});return(0,f.jsxs)(h.Z5,{children:[(0,f.jsx)(h.AW,{path:"/",element:(0,f.jsx)(qt,{})}),(0,f.jsx)(h.AW,{path:"control",element:t}),(0,f.jsx)(h.AW,{path:"*",element:(0,f.jsx)($e.default,{})})]})};var Ia=a(94500),wa=a(46957),Aa=a(85492),Ta=a(60363),Ma=a(2366),Pa=a(79037),Ea=a(37325),Na=a(87781),Ra=a(1324),La=a(36944),_a=a(67543),Oa=a(26070),Da=a(92398);const Ga={FIRST_STEP:"a",NEXT_STEP:"f",PREVIOUS_STEP:"b",LAST_STEP:"e"};class Ba extends c.Component{constructor(e){super(e),this.handleResize=(0,N.debounce)((()=>{const e=this.calculateWidth(this.props.editorWidth),t=this.calculateHeight(this.props.sideContentHeight);e===this.state.width&&t===this.state.height||(this.setState({height:t,width:e}),La.Z.updateDimensions(e,t))}),300),this.zoomStage=(e,t)=>{this.isJava()?Da.S.zoomStage(e,t):Oa.A.zoomStage(e,t)},this.sliderRelease=e=>{e===this.props.stepsTotal?this.setState({lastStep:!0}):this.setState({lastStep:!1}),this.props.handleEditorEval()},this.sliderShift=e=>{this.props.handleStepUpdate(e),this.setState((t=>({value:e})))},this.stepPrevious=()=>{0!==this.state.value&&(this.sliderShift(this.state.value-1),this.sliderRelease(this.state.value-1))},this.stepNext=()=>{const e=this.props.stepsTotal;this.state.value!==e&&(this.sliderShift(this.state.value+1),this.sliderRelease(this.state.value+1),_a.I.enableAnimations())},this.stepFirst=()=>{this.sliderShift(0),this.sliderRelease(0)},this.stepLast=e=>()=>{this.sliderShift(e),this.sliderRelease(e)},this.stepNextBreakpoint=()=>{for(const e of this.props.breakpointSteps)if(e>this.state.value)return this.sliderShift(e),void this.sliderRelease(e);this.sliderShift(this.props.stepsTotal),this.sliderRelease(this.props.stepsTotal)},this.stepPrevBreakpoint=()=>{for(let e=this.props.breakpointSteps.length-1;e>=0;e--){const t=this.props.breakpointSteps[e];if(t<this.state.value)return this.sliderShift(t),void this.sliderRelease(t)}this.sliderShift(0),this.sliderRelease(0)},this.stepNextChangepoint=()=>{for(const e of this.props.changepointSteps)if(e>this.state.value)return this.sliderShift(e),void this.sliderRelease(e);this.sliderShift(this.props.stepsTotal),this.sliderRelease(this.props.stepsTotal)},this.stepPrevChangepoint=()=>{for(let e=this.props.changepointSteps.length-1;e>=0;e--){const t=this.props.changepointSteps[e];if(t<this.state.value)return this.sliderShift(t),void this.sliderRelease(t)}this.sliderShift(0),this.sliderRelease(0)},this.state={visualization:null,value:-1,width:this.calculateWidth(e.editorWidth),height:this.calculateHeight(e.sideContentHeight),lastStep:!1,stepLimitExceeded:!1,chapter:e.chapter},this.isJava()?Da.S.init((e=>this.setState({visualization:e})),(t=>{e.setEditorHighlightedLines(0,t)})):La.Z.init((e=>{this.setState({visualization:e},(()=>_a.I.playAnimation())),e&&this.props.handleAlertSideContent()}),this.state.width,this.state.height,(t=>{e.setEditorHighlightedLines(0,t)}),(e=>{this.setState({stepLimitExceeded:!1})}))}isJava(){return this.props.chapter===D.Chapter.FULL_JAVA}calculateWidth(e){let t;return t=void 0===e?window.innerWidth-50:Math.min(5e3,window.innerWidth*(100-parseFloat(e))/100-50),Math.min(t,5e3)}calculateHeight(e){let t;return t=window.innerWidth<y.Z.mobileBreakpoint||void 0===e?window.innerHeight-150:e-150,Math.min(t,5e3)}componentDidMount(){this.handleResize(),window.addEventListener("resize",this.handleResize),La.Z.redraw()}componentWillUnmount(){this.handleResize.cancel(),window.removeEventListener("resize",this.handleResize)}componentDidUpdate(e){e.sideContentHeight===this.props.sideContentHeight&&e.editorWidth===this.props.editorWidth||this.handleResize(),e.needCseUpdate&&!this.props.needCseUpdate&&(this.stepFirst(),this.isJava()?Da.S.clearCse():La.Z.clearCse())}render(){const e=this.state.visualization?{FIRST_STEP:this.stepFirst,NEXT_STEP:this.stepNext,PREVIOUS_STEP:this.stepPrevious,LAST_STEP:this.stepLast(this.props.stepsTotal)}:{FIRST_STEP:()=>{},NEXT_STEP:()=>{},PREVIOUS_STEP:()=>{},LAST_STEP:()=>{}};return(0,f.jsxs)(Ea.HotKeys,{keyMap:Ga,handlers:e,style:{maxHeight:"100%",overflow:this.state.visualization?"hidden":"auto"},children:[(0,f.jsxs)("div",{className:l()("sa-substituter",s.Pyr),children:[(0,f.jsx)(Ma.i,{disabled:!this.state.visualization,min:0,max:this.props.stepsTotal,onChange:this.sliderShift,onRelease:this.sliderRelease,value:this.state.value<0?0:this.state.value}),(0,f.jsxs)("div",{style:{display:"flex",justifyContent:this.isJava()?"center":"space-between",alignItems:"center"},children:[!this.isJava()&&(0,f.jsxs)(Pa.h,{children:[(0,f.jsx)(w.u,{content:"Control and Stash",compact:!0,children:(0,f.jsx)(m.A,{onMouseUp:()=>{this.state.visualization&&(La.Z.toggleControlStash(),La.Z.redraw())},icon:"layers",disabled:!this.state.visualization,children:(0,f.jsx)(et.XZ,{checked:La.Z.getControlStash(),disabled:!this.state.visualization,style:{margin:0}})})}),(0,f.jsx)(w.u,{content:"Truncate Control",compact:!0,children:(0,f.jsx)(m.A,{onMouseUp:()=>{this.state.visualization&&(La.Z.toggleStackTruncated(),La.Z.redraw())},icon:"minimize",disabled:!this.state.visualization,children:(0,f.jsx)(et.XZ,{checked:La.Z.getStackTruncated(),disabled:!this.state.visualization,style:{margin:0}})})})]}),(0,f.jsxs)(Pa.h,{children:[(0,f.jsx)(m.z,{disabled:!this.state.visualization,icon:"double-chevron-left",onClick:this.stepPrevBreakpoint}),(0,f.jsx)(m.z,{disabled:!this.state.visualization,icon:"chevron-left",onClick:this.isJava()||La.Z.getControlStash()?this.stepPrevious:this.stepPrevChangepoint}),(0,f.jsx)(m.z,{disabled:!this.state.visualization,icon:"chevron-right",onClick:this.isJava()||La.Z.getControlStash()?this.stepNext:this.stepNextChangepoint}),(0,f.jsx)(m.z,{disabled:!this.state.visualization,icon:"double-chevron-right",onClick:this.stepNextBreakpoint})]}),!this.isJava()&&(0,f.jsxs)(Pa.h,{children:[(0,f.jsx)(w.u,{content:"Print",compact:!0,children:(0,f.jsx)(m.A,{onMouseUp:()=>{this.state.visualization&&(La.Z.togglePrintableMode(),La.Z.redraw())},icon:"print",disabled:!this.state.visualization,children:(0,f.jsx)(et.XZ,{disabled:!this.state.visualization,checked:La.Z.getPrintableMode(),style:{margin:0}})})}),(0,f.jsx)(w.u,{content:"Save",compact:!0,children:(0,f.jsx)(m.A,{icon:"floppy-disk",disabled:!this.state.visualization,onClick:Oa.A.exportImage})})]})]})]})," ",this.state.visualization&&this.props.machineOutput.length&&"errors"===this.props.machineOutput[0].type?this.props.machineOutput.map(((e,t)=>(0,f.jsx)(Ra.r,{output:e,usingSubst:!1,isHtml:!1},t))):(0,f.jsx)("div",{}),this.state.visualization?this.state.stepLimitExceeded?(0,f.jsxs)("div",{id:"cse-machine-default-text",className:s.Qyt,"data-testid":"cse-machine-default-text",children:["Maximum number of steps exceeded.",(0,f.jsx)(Me.i,{}),"Please increase the step limit if you would like to see futher evaluation."]}):this.state.visualization:(0,f.jsxs)("div",{id:"cse-machine-default-text",className:s.Qyt,"data-testid":"cse-machine-default-text",children:[this.isJava()?(0,f.jsxs)("span",{children:["The CSEC machine generates control, stash, environment and class model diagrams adapted from the notation introduced in"," ",(0,f.jsx)("a",{href:y.y.textbookChapter3_2,rel:"noopener noreferrer",target:"_blank",children:(0,f.jsx)("i",{children:"Structure and Interpretation of Computer Programs, JavaScript Edition, Chapter 3, Section 2"})}),". ","You have chosen the sublanguage"," ",(0,f.jsx)("a",{href:`${y.y.sourceDocs}java_csec/`,rel:"noopener noreferrer",target:"_blank",children:(0,f.jsx)("i",{children:"Java CSEC"})})]}):(0,f.jsxs)("span",{children:["The CSE machine generates control, stash and environment model diagrams following a notation introduced in"," ",(0,f.jsx)("a",{href:y.y.textbookChapter3_2,rel:"noopener noreferrer",target:"_blank",children:(0,f.jsx)("i",{children:"Structure and Interpretation of Computer Programs, JavaScript Edition, Chapter 3, Section 2"})})]}),".",(0,f.jsx)("br",{}),(0,f.jsx)("br",{})," On this tab, the REPL will be hidden from view, so do check that your code has no errors before running the stepper. You may use this tool by running your program and then dragging the slider above to see the state of the control, stash and environment at different stages in the evaluation of your program. Clicking on the fast-forward button (double chevron) will take you to the next breakpoint in your program",(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)(Me.i,{}),"Some useful keyboard shortcuts:",(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),"a: Move to the first step",(0,f.jsx)("br",{}),"e: Move to the last step",(0,f.jsx)("br",{}),"f: Move to the next step",(0,f.jsx)("br",{}),"b: Move to the previous step",(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),"Note that these shortcuts are only active when the browser focus is on this tab."]}),(0,f.jsxs)(Pa.h,{vertical:!0,style:{position:"absolute",bottom:"20px",right:"20px"},children:[(0,f.jsx)(m.z,{icon:"plus",disabled:!this.state.visualization,onClick:()=>this.zoomStage(!0,5),style:{marginBottom:"5px",borderRadius:"3px"}}),(0,f.jsx)(m.z,{icon:"minus",disabled:!this.state.visualization,onClick:()=>this.zoomStage(!1,5),style:{borderRadius:"3px"}})]})]})}}const Ua=(0,d.$j)(((e,t)=>{let a;const[s]=(0,Se.k$)(t.workspaceLocation);if("sicp"===s)a=e.workspaces.sicp;else a=e.workspaces.playground;return{...t,stepsTotal:a.stepsTotal,currentStep:a.currentStep,breakpointSteps:a.breakpointSteps,changepointSteps:a.changepointSteps,needCseUpdate:a.updateCse,machineOutput:a.output,chapter:a.context.chapter}}),((e,t)=>(0,Na.DE)({handleEditorEval:()=>(0,Ae.evalEditor)(t.workspaceLocation),handleStepUpdate:e=>(0,Ae.updateCurrentStep)(e,t.workspaceLocation),handleAlertSideContent:()=>(0,Ce.beginAlertSideContent)(me.B_.cseMachine,t.workspaceLocation),setEditorHighlightedLines:(e,a)=>(0,Ae.setEditorHighlightedLinesControl)(t.workspaceLocation,e,a)},e)))(Ba),Fa=e=>({label:"CSE Machine",iconName:E.d.GLOBE,body:(0,f.jsx)(Ua,{workspaceLocation:e}),id:me.B_.cseMachine});var za=a(3515);class Va extends c.PureComponent{constructor(e){super(e),this.handleSeeked=()=>{this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData)},this.handleAudioLoaded=()=>{this.props.handleSetSourcecastDuration(this.audio.current.duration)},this.applyDeltas=e=>{this.props.handleSetCodeDeltasToApply(e)},this.stopPreviousPlaybackAndApplyFromStart=e=>{this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1},(()=>this.applyPlaybackDataFromStart(e)))},this.applyPlaybackDataFromStart=async e=>{const t=e=>new Promise((t=>setTimeout(t,e))),a=this.state.currentDeltaRevision;let s=1e3*this.audio.current.currentTime;this.props.handleEditorValueChange(e.init.editorValue),this.props.handleExternalSelect(e.init.externalLibrary),this.props.handleChapterSelect(e.init.chapter);const n=e.inputs.filter((e=>e.time<=s&&"codeDelta"===e.type)).map((e=>e.data));this.applyDeltas(n);const i=e.inputs.filter((e=>e.time>s)),r=i.length;let o=0;for(;o<r&&this.state.currentDeltaRevision===a;)s=1e3*this.audio.current.currentTime,i[o].time<s?(this.props.handleSetInputToApply(i[o]),o++):await t(20)},this.handlePlayerPausing=()=>{this.audio.current.pause(),this.props.handleSetIsEditorReadonly(!1),this.props.handleSetSourcecastStatus($.PO.paused),this.stopCurrentPlayback()},this.handlePlayerPlaying=()=>{this.audio.current.play(),this.props.handleSetIsEditorReadonly(!0),this.props.handleSetSourcecastStatus($.PO.playing),this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData),this.props.setSelectedTab&&this.props.setSelectedTab(me.B_.mobileEditor)},this.handlePlayerStopping=()=>{this.props.handleSetIsEditorReadonly(!1),this.props.handleSetSourcecastStatus($.PO.paused),this.props.handleSetCurrentPlayerTime(0),this.setState({currentPlayerProgress:0})},this.updatePlayerTime=e=>{const{currentTime:t}=e.target;this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:t/this.props.duration}),this.props.playbackStatus===$.PO.forcedPaused&&this.handlePlayerPausing()},this.handlePlayerProgressBarChange=e=>{if(this.audio.current){const t=this.props.duration*e;this.audio.current.currentTime=t,this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:e})}},this.renderLabel=e=>{if(this.props.duration){const t=this.props.duration*e,a=Math.floor(t/60),s=Math.floor(t-60*a);return(a<10?"0"+a:a)+":"+(s<10?"0"+s:s)}return"00:00"},this.audio=c.createRef(),this.state={currentDeltaRevision:0,currentPlayerProgress:0,currentSourcecastItem:null,duration:0}}render(){const e=(0,f.jsx)(te.Z,{label:"Play",icon:E.d.PLAY,onClick:this.handlePlayerPlaying,isDisabled:!this.props.duration}),t=(0,f.jsx)(te.Z,{label:"Pause",icon:E.d.PAUSE,onClick:this.handlePlayerPausing});return(0,f.jsxs)("div",{className:"SourcecastControlBar",children:[(0,f.jsx)("audio",{src:this.props.audioUrl,ref:this.audio,onEnded:this.handlePlayerStopping,onLoadedMetadata:this.handleAudioLoaded,onSeeked:this.handleSeeked,onTimeUpdate:this.updatePlayerTime,preload:"metadata"}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{className:"PlayerControl",children:[(0,f.jsxs)(Pa.h,{className:"PlayerControlButton",children:[this.props.playbackStatus===$.PO.paused&&e,this.props.playbackStatus===$.PO.playing&&t]}),(0,f.jsx)("div",{className:"Slider",children:(0,f.jsx)(Ma.i,{min:0,max:1,stepSize:1e-4,onChange:this.handlePlayerProgressBarChange,value:this.state.currentPlayerProgress,labelRenderer:this.renderLabel})})]})]})}stopCurrentPlayback(){this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1})}}const Ha=Va;a(45724);var $a=a(32362),Wa=a(15853),Xa=a(24340);const Ka=e=>{const[t,a]=(0,c.useState)(!1),n=()=>a(!1);return(0,f.jsxs)("div",{children:[(0,f.jsx)(te.Z,{icon:E.d.TRASH,onClick:()=>a(!0)}),(0,f.jsxs)(g.V,{icon:"info-sign",isOpen:t,onClose:n,title:"Delete Sourcecast",canOutsideClickClose:!0,children:[(0,f.jsx)("div",{className:s.TmF,children:(0,f.jsx)("p",{children:"Are you sure to delete this sourcecast entry?"})}),(0,f.jsx)("div",{className:s.Alt,children:(0,f.jsxs)("div",{className:s.e$L,children:[(0,f.jsx)(te.Z,{label:"Confirm Delete",icon:E.d.TRASH,onClick:()=>{const{data:t}=e;e.handleDeleteSourcecastEntry(t.id)}}),(0,f.jsx)(te.Z,{label:"Cancel",icon:E.d.CROSS,onClick:n})]})})]})]})},Za=({data:e,handleSetSourcecastData:t})=>(0,f.jsx)(w.u,{content:"Load Sourcecast Recording",children:(0,f.jsx)(te.Z,{label:`${e.title}`,icon:E.d.PAPERCLIP,onClick:()=>{t(e.title,e.description,e.uid,e.url,JSON.parse(e.playbackData))}})});var qa=a(78029);const Ya=e=>{const t=(0,c.useRef)(null),[a]=(0,c.useState)(`${window.location.protocol}//${window.location.host}/courses/${e.courseId}/sourcecast/${e.data.uid}`),s=(0,f.jsxs)("div",{children:[(0,f.jsx)("input",{defaultValue:a,readOnly:!0,ref:t}),(0,f.jsx)(w.u,{content:"Copy link to clipboard",children:(0,f.jsx)(qa,{text:a,children:(0,f.jsx)(te.Z,{icon:E.d.DUPLICATE,onClick:()=>{null!==t.current&&(t.current.focus(),t.current.select())}})})})]},a);return(0,f.jsx)(Oe.J,{popoverClassName:"Popover-share",inheritDarkTheme:!1,content:s,children:(0,f.jsx)(w.u,{content:"Get shareable link",children:(0,f.jsx)(te.Z,{icon:E.d.SHARE})})})};class Ja extends c.Component{constructor(e){super(e),this.handleFilterChange=e=>{const t=e.target.value;this.setState({filterValue:t}),this.gridApi&&this.gridApi.setQuickFilter(t)},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),window.onresize=()=>this.gridApi.sizeColumnsToFit()},this.state={columnDefs:[{headerName:"Title",field:"title",cellRenderer:Za,cellRendererParams:{handleSetSourcecastData:this.props.handleSetSourcecastData},minWidth:200,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"left"},hide:!this.props.handleSetSourcecastData},{headerName:"Title",field:"title",minWidth:100,suppressMovable:!0,suppressMenu:!0,hide:!!this.props.handleSetSourcecastData},{headerName:"Uploader",field:"uploader.name",minWidth:150,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"}},{headerName:"Date",valueGetter:e=>(0,Pe.lu)(e.data.inserted_at),minWidth:150,suppressMovable:!0,suppressMenu:!0},{headerName:"Share",field:"uid",cellRenderer:Ya,cellRendererParams:{courseId:this.props.courseId},minWidth:80,suppressMovable:!0,suppressMenu:!0},{headerName:"Delete",field:"",cellRenderer:Ka,cellRendererParams:{handleDeleteSourcecastEntry:this.props.handleDeleteSourcecastEntry},minWidth:100,maxWidth:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"},hide:!this.props.handleDeleteSourcecastEntry},{headerName:"description",field:"description",hide:!0},{headerName:"inserted_at",field:"inserted_at",hide:!0},{headerName:"updated_at",field:"updated_at",hide:!0},{headerName:"audio",field:"audio",hide:!0},{headerName:"playbackData",field:"playbackData",hide:!0},{headerName:"url",field:"url",hide:!0}],filterValue:"",groupFilterEnabled:!1},this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}render(){const e=(0,f.jsx)(i.t,{className:"Sourcecast",description:"Fetching sourcecast index...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})}),t=(0,N.sortBy)(this.props.sourcecastIndex,[e=>-e.id]),a=(0,f.jsxs)("div",{className:"SourcecastContainer",children:[(0,f.jsx)("br",{}),(0,f.jsx)("div",{children:(0,f.jsx)($a.c,{label:"",labelFor:"text-input",children:(0,f.jsx)(Wa.B,{id:"searchBar",large:!1,leftIcon:"search",placeholder:"Search",value:this.state.filterValue,onChange:this.handleFilterChange})})}),(0,f.jsx)(Me.i,{}),(0,f.jsx)("div",{className:"SourcecastTable",children:(0,f.jsx)("div",{className:"ag-grid-parent",children:(0,f.jsx)(Xa.AgGridReact,{domLayout:"autoHeight",columnDefs:this.state.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,rowData:t,rowHeight:30,pagination:!1,paginationPageSize:50})})}),(0,f.jsx)("br",{})]});return(0,f.jsx)("div",{children:void 0===this.props.sourcecastIndex?e:a})}}const Qa=Ja,es="sourcecast",ts="Welcome to Sourcecast!",as=()=>{const{isMobileBreakpoint:e}=(0,j.Fs)(),t=(0,h.UO)(),{audioUrl:a,currentPlayerTime:n,codeDeltasToApply:i,title:r,description:o,externalLibrary:u,isEditorAutorun:g,isEditorReadonly:m,inputToApply:x,isRunning:b,isDebugging:y,output:v,playbackDuration:C,playbackData:S,playbackStatus:k,replValue:I,sourcecastIndex:w,context:{chapter:A,variant:T},uid:M,isFolderModeEnabled:P,activeEditorTabIndex:N,editorTabs:R}=(0,j.ix)((e=>e.workspaces[es])),L=(0,j.ix)((e=>e.session.courseId)),_=(0,d.I0)(),{handleFetchSourcecastIndex:O,handleChapterSelect:G,handleEditorEval:B,handleEditorValueChange:U,handleExternalSelect:F,handleReplEval:z,handleSetSourcecastData:V,handleSetSourcecastStatus:H,handleReplOutputClear:Z,handleSideContentHeightChange:q}=(0,c.useMemo)((()=>({handleFetchSourcecastIndex:()=>_((0,wa.fetchSourcecastIndex)(es)),handleChapterSelect:e=>_((0,Ae.chapterSelect)(e,D.Variant.DEFAULT,es)),handleEditorEval:()=>_((0,Ae.evalEditor)(es)),handleEditorValueChange:e=>_((0,Ae.updateEditorValue)(es,0,e)),handleExternalSelect:e=>_((0,Ae.externalLibrarySelect)(e,es)),handleReplEval:()=>_((0,Ae.evalRepl)(es)),handleSetSourcecastData:(e,t,a,s,n)=>_((0,Aa.setSourcecastData)(e,t,a,s,n,es)),handleSetSourcecastStatus:e=>_((0,Aa.setSourcecastStatus)(e,es)),handleReplOutputClear:()=>_((0,Ae.clearReplOutput)(es)),handleSideContentHeightChange:e=>_((0,Ce.changeSideContentHeight)(e,es))})),[_]),{selectedTab:Y,setSelectedTab:J}=(0,Se.__)(es,me.B_.introduction),Q=()=>{const e=t.sourcecastId;if(e&&e!==M&&w){const t=w.find((t=>t.uid===e));t&&V(t.title,t.description,t.uid,t.url,JSON.parse(t.playbackData))}};(0,c.useEffect)((()=>{O()}),[]),(0,c.useEffect)((()=>{if(Q(),x)switch(x.type){case"activeTabChange":J(x.data);break;case"chapterSelect":G(x.data);break;case"externalLibrarySelect":F(x.data);break;case"forcePause":H($.PO.forcedPaused)}}),[Q,x]),(0,c.useEffect)((()=>{e||Y!==me.B_.mobileEditor&&Y!==me.B_.mobileEditorRun||J(me.B_.introduction)}),[e,Y,J]);const ee=(0,c.useMemo)((()=>({handleDebuggerPause:()=>_((0,Ia.beginDebuggerPause)(es)),handleDebuggerReset:()=>_((0,Ia.debuggerReset)(es)),handleDebuggerResume:()=>_((0,Ia.debuggerResume)(es)),handleInterruptEval:()=>_((0,Ia.beginInterruptExecution)(es)),handleToggleEditorAutorun:()=>_((0,Ae.toggleEditorAutorun)(es))})),[_]),te=(0,f.jsx)(Ta.k,{handleDebuggerPause:ee.handleDebuggerPause,handleDebuggerReset:ee.handleDebuggerReset,handleDebuggerResume:ee.handleDebuggerResume,handleEditorEval:B,handleInterruptEval:ee.handleInterruptEval,handleToggleEditorAutorun:ee.handleToggleEditorAutorun,isEntrypointFileDefined:null!==N,isDebugging:y,isEditorAutorun:g,isRunning:b},"autorun"),se=(0,f.jsx)(W.b,{handleChapterSelect:({chapter:e},t)=>G(e),isFolderModeEnabled:P,sourceChapter:A,sourceVariant:T},"chapter"),ie=(0,f.jsx)(X._,{handleReplOutputClear:Z},"clear_repl"),re=(0,f.jsx)(K.e,{handleReplEval:z,isRunning:b},"eval_repl"),oe=(0,za.Z)(es),le=Fa(es),ce=[{label:"Sourcecast Table",iconName:E.d.HOME,body:(0,f.jsxs)("div",{children:[(0,f.jsx)("span",{className:"Multi-line",children:(0,f.jsx)(p.SU,{children:r?"Title: "+r+"\nDescription: "+o:ts})}),(0,f.jsx)(Qa,{handleSetSourcecastData:V,sourcecastIndex:w,courseId:L})]}),id:me.B_.introduction},oe,le],de=(e,t,a)=>{e!==t&&J(e)},he=(0,c.useMemo)((()=>({handleDeclarationNavigate:e=>_((0,Ae.navigateToDeclaration)(es,e)),handleEditorUpdateBreakpoints:e=>_((0,Ae.setEditorBreakpoint)(es,0,e)),setActiveEditorTabIndex:e=>_((0,Ae.updateActiveEditorTabIndex)(es,e)),removeEditorTabByIndex:e=>_((0,Ae.removeEditorTab)(es,e))})),[_]),ue={editorVariant:"sourcecast",isFolderModeEnabled:P,activeEditorTabIndex:N,setActiveEditorTabIndex:he.setActiveEditorTabIndex,removeEditorTabByIndex:he.removeEditorTabByIndex,editorTabs:R.map(ae.F),codeDeltasToApply:i,isEditorReadonly:m,editorSessionId:"",handleDeclarationNavigate:he.handleDeclarationNavigate,handleEditorEval:B,handleEditorValueChange:U,isEditorAutorun:g,inputToApply:x,isPlaying:k===$.PO.playing,handleEditorUpdateBreakpoints:he.handleEditorUpdateBreakpoints},ge=(0,c.useMemo)((()=>({handleBrowseHistoryDown:()=>_((0,Ae.browseReplHistoryDown)(es)),handleBrowseHistoryUp:()=>_((0,Ae.browseReplHistoryUp)(es)),handleReplValueChange:e=>_((0,Ae.updateReplValue)(e,es))})),[_]),pe={output:v,replValue:I,handleBrowseHistoryDown:ge.handleBrowseHistoryDown,handleBrowseHistoryUp:ge.handleBrowseHistoryUp,handleReplEval:z,handleReplValueChange:ge.handleReplValueChange,sourceChapter:A,sourceVariant:T,externalLibrary:u,replButtons:[re,ie]},xe={tabs:[]},be={controlBarProps:{editorButtons:[te,se]},editorContainerProps:ue,handleSideContentHeightChange:q,replProps:pe,sideBarProps:xe,sideContentProps:{selectedTabId:Y,onChange:de,tabs:{beforeDynamicTabs:ce,afterDynamicTabs:[]},workspaceLocation:es}},ye={editorContainerProps:ue,replProps:pe,sideBarProps:xe,mobileSideContentProps:{mobileControlBarProps:{editorButtons:[te,se]},selectedTabId:Y,onChange:de,tabs:{beforeDynamicTabs:ce,afterDynamicTabs:[]},workspaceLocation:es}},fe=(0,c.useMemo)((()=>({handlePromptAutocomplete:(e,t,a)=>_((0,Ae.promptAutocomplete)(es,e,t,a)),handleSetCurrentPlayerTime:e=>_((0,Aa.setCurrentPlayerTime)(e,es)),handleSetCodeDeltasToApply:e=>_((0,Aa.setCodeDeltasToApply)(e,es)),handleSetIsEditorReadonly:e=>_((0,Ae.setIsEditorReadonly)(es,e)),handleSetInputToApply:e=>_((0,Aa.setInputToApply)(e,es)),handleSetSourcecastDuration:e=>_((0,Aa.setSourcecastDuration)(e,es))})),[_]),ve={handleEditorValueChange:U,handlePromptAutocomplete:fe.handlePromptAutocomplete,handleSetCurrentPlayerTime:fe.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:fe.handleSetCodeDeltasToApply,handleSetIsEditorReadonly:fe.handleSetIsEditorReadonly,handleSetInputToApply:fe.handleSetInputToApply,handleSetSourcecastDuration:fe.handleSetSourcecastDuration,handleSetSourcecastStatus:H,audioUrl:a,currentPlayerTime:n,duration:C,playbackData:S,playbackStatus:k,handleChapterSelect:G,handleExternalSelect:F,setSelectedTab:J};return(0,f.jsxs)("div",{className:l()("Sourcecast",s.Pyr),children:[(0,f.jsx)(Ha,{...ve}),e?(0,f.jsx)(ne.Z,{...ye}):(0,f.jsx)(we.Z,{...be})]})};a(8155);var ss=a(37753),ns=a(56009),is=a(59603),rs=a(28452),os=a(22234),ls=a(77763);const cs=e=>{const[t,a]=c.useState([]),[n,i]=c.useState(""),r=c.useRef(),{CSVReader:o}=(0,ls.ds)(),l=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Xa.AgGridReact,{domLayout:"autoHeight",columnDefs:[{headerName:"Name",field:"name"},{headerName:"Username",field:"username"},{headerName:"Role",field:"role"}],defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{r.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:t,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})}),d=[...y.Z.authProviders.entries()].map((([e,t])=>e)),[h,g]=c.useState(d[0]);return(0,f.jsxs)("div",{className:"add-users",children:[(0,f.jsx)(p.H2,{children:"Add Stories Users"}),l,(0,f.jsx)(p.H4,{children:"Upload a CSV file to mass insert or update users in your course."}),(0,f.jsx)("div",{className:"upload-container",children:(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"upload-settings",children:[(0,f.jsx)("div",{className:"file-input",children:(0,f.jsx)(o,{onUploadAccepted:e=>(e=>{const{data:s,errors:n}=e;if(n.length)return void i("Error detected while uploading the CSV file! Please recheck the file and try again.");const r=[...t];if(s.length+t.length>1e3)i("Please limit each upload to 1000 entries!");else{for(let e=0;e<s.length;e++){if(3!==s[e].length)return void i((0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{children:["Invalid format (line ",e,")! Please ensure that the name, username and role is specified for each row entry!"]}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{children:["Format: ",(0,f.jsx)("i",{children:"name,username,role"})]}),(0,f.jsx)("br",{}),(0,f.jsx)("div",{children:"(please hover over the question mark above for more details)"})]}));if(!Object.values(u.xo).includes(s[e][2]))return void i(`Invalid role (line ${e})! Please ensure that the third column of each entry contains one of the following: 'member, moderator, admin'`)}s.forEach((e=>{r.push({name:e[0],username:e[1],role:e[2]})})),(0,N.uniqBy)(r,(e=>e.username)).length===r.length?(a(r),i("")):i("There are duplicate usernames in the uploaded CSV(s)!")}})(e),config:{delimiter:",",skipEmptyLines:!0},children:({getRootProps:e,acceptedFile:t,ProgressBar:a,getRemoveFileProps:n})=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("label",{className:s.NdO,...e(),children:[(0,f.jsx)("div",{style:{minWidth:250},children:" "}),(0,f.jsx)("span",{className:s.KZz,children:"Upload CSV"})]}),(0,f.jsx)(Oe.J,{content:(0,f.jsxs)("div",{children:[(0,f.jsxs)("p",{children:[(0,f.jsx)("u",{children:"CSV Format"}),": \xa0",(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"name,username,role"})})]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"name"})}),": the name of the user"]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"username"})}),": username of the user in the corresponding authentication"]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"role"})}),": the role of the user ",(0,f.jsx)("i",{children:"(member | moderator | admin)"})]}),(0,f.jsx)("p",{children:"\xa0"}),(0,f.jsx)("p",{children:(0,f.jsx)("u",{children:"Examples:"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(Luminus): \xa0 Wei Kai,e1234567,member"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(Google): \xa0 Timothy,learner@gmail.com,moderator"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(GitHub): \xa0 Mingkai,ghusername,admin"})})]}),interactionKind:"hover",position:P.Ly.TOP,popoverClassName:"file-input-popover",children:(0,f.jsx)(I.I,{icon:E.d.HELP,className:"file-input-icon"})})]})})}),(0,f.jsx)($a.c,{className:"html-select",label:(0,f.jsxs)("div",{className:"html-select-label",children:[(0,f.jsx)("div",{children:"Authentication Provider"}),(0,f.jsx)(Oe.J,{content:"The authentication provider your learners will use to log in with",interactionKind:"hover-target",position:P.Ly.TOP,popoverClassName:"html-select-popover",children:(0,f.jsx)(I.I,{icon:E.d.HELP,className:"html-select-label-icon"})})]}),inline:!0,children:(0,f.jsx)(rs.L,{options:d,value:h,onChange:e=>g(e.target.value)})})]}),n&&(0,f.jsx)(os.U,{intent:x.S.DANGER,title:"Invalid CSV file provided!",children:n})]})}),(0,f.jsx)(m.z,{className:"add-button",text:"Add Stories Users",intent:0===t.length?x.S.NONE:x.S.WARNING,onClick:()=>{e.handleAddNewUsersToCourse(t,h),a([]),g(d[0])}})]})},ds=e=>{const[t,a]=c.useState([]),[n,i]=c.useState(""),r=c.useRef(),{CSVReader:o}=(0,ls.ds)(),l=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Xa.AgGridReact,{domLayout:"autoHeight",columnDefs:[{headerName:"Username",field:"username"},{headerName:"Role",field:"role"},{headerName:"Group",field:"group"}],defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{r.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:t,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})}),d=[...y.Z.authProviders.entries()].map((([e,t])=>e)),[h,g]=c.useState(d[0]);return(0,f.jsxs)("div",{className:"add-users",children:[(0,f.jsx)(p.H2,{children:"Add Users"}),l,(0,f.jsx)(p.H4,{children:"Upload a CSV file to mass insert or update users in your course."}),(0,f.jsx)("div",{className:"upload-container",children:(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"upload-settings",children:[(0,f.jsx)("div",{className:"file-input",children:(0,f.jsx)(o,{onUploadAccepted:e=>(e=>{const{data:s,errors:n}=e;if(n.length)return void i("Error detected while uploading the CSV file! Please recheck the file and try again.");const r=[...t];if(s.length+t.length>1e3)i("Please limit each upload to 1000 entries!");else{for(let e=0;e<s.length;e++){if(2!==s[e].length&&3!==s[e].length)return void i((0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{children:["Invalid format (line ",e,")! Please ensure that the username and role is specified for each row entry!"]}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{children:["Format: ",(0,f.jsx)("i",{children:"username,role"})," ",(0,f.jsx)("b",{children:"OR"})," ",(0,f.jsx)("i",{children:"username,role,group"})]}),(0,f.jsx)("br",{}),(0,f.jsx)("div",{children:"(please hover over the question mark above for more details)"})]}));if(!Object.values(u.uU).includes(s[e][1]))return void i(`Invalid role (line ${e})! Please ensure that the second column of each entry contains one of the following: 'admin, staff, student'`)}s.forEach((e=>{r.push({username:e[0],role:e[1],group:e[2]})})),(0,N.uniqBy)(r,(e=>e.username)).length===r.length?(a(r),i("")):i("There are duplicate usernames in the uploaded CSV(s)!")}})(e),config:{delimiter:",",skipEmptyLines:!0},children:({getRootProps:e,acceptedFile:t,ProgressBar:a,getRemoveFileProps:n})=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("label",{className:s.NdO,...e(),children:[(0,f.jsx)("div",{style:{minWidth:250},children:" "}),(0,f.jsx)("span",{className:s.KZz,children:"Upload CSV"})]}),(0,f.jsx)(Oe.J,{content:(0,f.jsxs)("div",{children:[(0,f.jsxs)("p",{children:[(0,f.jsx)("u",{children:"CSV Format"}),": \xa0",(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"username,role"})}),"\xa0\xa0OR\xa0\xa0",(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"username,role,group"})})]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"username"})}),": the username of the learner in the corresponding authentication provider"]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"role"})}),": the role of the learner in this course"," ",(0,f.jsx)("i",{children:"(admin | staff | student)"})]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("b",{children:(0,f.jsx)("i",{children:"group (optional)"})}),": the group name that the learner belongs to in this course"]}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(*Note that staff or admin will automatically be assigned as group leader and each group"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"can only have one leader. If there are duplicates the latest entry will take effect)"})}),(0,f.jsx)("p",{children:"\xa0"}),(0,f.jsx)("p",{children:(0,f.jsx)("u",{children:"Examples:"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(Luminus): \xa0e1234567,student \xa0\u2022\xa0 e1234567,student,Group1"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(Google): \xa0learner@gmail.com,staff \xa0\u2022\xa0 learner@gmail.com,staff,Group1"})}),(0,f.jsx)("p",{children:(0,f.jsx)("i",{children:"(GitHub): \xa0ghusername,admin \xa0\u2022\xa0 ghusername,admin,Group1"})})]}),interactionKind:"hover",position:P.Ly.TOP,popoverClassName:"file-input-popover",children:(0,f.jsx)(I.I,{icon:E.d.HELP,className:"file-input-icon"})})]})})}),(0,f.jsx)($a.c,{className:"html-select",label:(0,f.jsxs)("div",{className:"html-select-label",children:[(0,f.jsx)("div",{children:"Authentication Provider"}),(0,f.jsx)(Oe.J,{content:"The authentication provider your learners will use to log in with",interactionKind:"hover-target",position:P.Ly.TOP,popoverClassName:"html-select-popover",children:(0,f.jsx)(I.I,{icon:E.d.HELP,className:"html-select-label-icon"})})]}),inline:!0,children:(0,f.jsx)(rs.L,{options:d,value:h,onChange:e=>g(e.target.value)})})]}),n&&(0,f.jsx)(os.U,{intent:x.S.DANGER,title:"Invalid CSV file provided!",children:n})]})}),(0,f.jsx)(m.z,{className:"add-button",text:"Add Users",intent:0===t.length?x.S.NONE:x.S.WARNING,onClick:()=>{e.handleAddNewUsersToCourse(t,h),a([]),g(d[0])}})]})},hs=e=>{const{data:t}=e,a=t[e.field],s=c.useCallback((()=>{e.setStateHandler(e.rowIndex,!a)}),[e,a]);return(0,f.jsx)(et.rs,{checked:a,onChange:s})},us=({data:e,rowIndex:t,deleteRowHandler:a})=>{const[s,n]=(0,c.useState)(!1),i=(0,c.useCallback)((()=>{a(t),n(!1)}),[a,t]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(m.z,{icon:E.d.CROSS,onClick:()=>{n(!0)}}),(0,f.jsxs)(g.V,{icon:E.d.WARNING_SIGN,isOpen:s,onClose:()=>n(!1),title:"Warning",children:[(0,f.jsxs)(T.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",(0,f.jsx)("b",{children:"delete"})," the assessment type ",(0,f.jsx)("i",{children:e.type}),"?"]}),(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"All related assessments, submissions and answers will be deleted as well upon clicking the main save button."})})]}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",icon:E.d.CROSS,onClick:()=>n(!1),options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Ok",icon:E.d.TICK,onClick:i,options:{minimal:!1,intent:x.S.WARNING}})]})})]})]})},gs=e=>{const{data:t}=e,a=c.useCallback((t=>{e.setStateHandler(e.rowIndex,t)}),[e]);return(0,f.jsx)(Ye.A,{value:t[e.field],min:0,clampValueOnBlur:!0,onValueChange:a})};function ps(e,t){for(let a=0;a<e.length;a++)if((0,N.isEqual)(e[a],t))return a;return-1}const ms=({assessmentConfig:e,setAssessmentConfig:t,setAssessmentConfigsToDelete:a,setHasChangesAssessmentConfig:s})=>{const n=c.useRef(),i=[{headerName:"Assessment Type",field:"type",rowDrag:!0,editable:!0},{headerName:"Is Manually Graded",field:"isManuallyGraded",cellRenderer:hs,cellRendererParams:{setStateHandler:(a,s)=>{var i,r;const o=[...e.current];var l,c;(o[a]={...o[a],isManuallyGraded:s},s)&&(o[a].isGradingAutoPublished=!1,null===(l=n.current)||void 0===l||null===(c=l.getDisplayedRowAtIndex(a))||void 0===c||c.setDataValue("isGradingAutoPublished",!1));t(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(a))||void 0===r||r.setDataValue("isManuallyGraded",s)},field:"isManuallyGraded"}},{headerName:"Is Auto-published",field:"isGradingAutoPublished",cellRenderer:hs,cellRendererParams:{setStateHandler:(a,s)=>{var i,r;const o=[...e.current];var l,c;(o[a]={...o[a],isGradingAutoPublished:s},s)&&(o[a].isManuallyGraded=!1,null===(l=n.current)||void 0===l||null===(c=l.getDisplayedRowAtIndex(a))||void 0===c||c.setDataValue("isManuallyGraded",!1));t(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(a))||void 0===r||r.setDataValue("isGradingAutoPublished",s)},field:"isGradingAutoPublished"}},{headerName:"Display in Dashboard",field:"displayInDashboard",cellRenderer:hs,cellRendererParams:{setStateHandler:(a,s)=>{var i,r;const o=[...e.current];o[a]={...o[a],displayInDashboard:s},t(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(a))||void 0===r||r.setDataValue("displayInDashboard",s)},field:"displayInDashboard"}},{headerName:"Voting Features*",field:"hasVotingFeatures",cellRenderer:hs,cellRendererParams:{setStateHandler:(a,s)=>{var i,r;const o=[...e.current];o[a]={...o[a],hasVotingFeatures:s},t(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(a))||void 0===r||r.setDataValue("hasVotingFeatures",s)},field:"hasVotingFeatures"}},{headerName:"Token Counter*",field:"hasTokenCounter",cellRenderer:hs,cellRendererParams:{setStateHandler:(a,s)=>{var i,r;const o=[...e.current];o[a]={...o[a],hasTokenCounter:s},t(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(a))||void 0===r||r.setDataValue("hasTokenCounter",s)},field:"hasTokenCounter"}},{headerName:"Max Bonus XP",field:"earlySubmissionXp",cellRenderer:gs,cellRendererParams:{setStateHandler:(a,s)=>{var i,r;const o=[...e.current];o[a]={...o[a],earlySubmissionXp:s},t(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(a))||void 0===r||r.setDataValue("earlySubmissionXp",s)},field:"earlySubmissionXp"}},{headerName:"Early Hours Before Decay",field:"hoursBeforeEarlyXpDecay",cellRenderer:gs,cellRendererParams:{setStateHandler:(a,s)=>{var i,r;const o=[...e.current];o[a]={...o[a],hoursBeforeEarlyXpDecay:s},t(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(a))||void 0===r||r.setDataValue("hoursBeforeEarlyXpDecay",s)},field:"hoursBeforeEarlyXpDecay"}},{headerName:"Delete Row",field:"placeholderToPreventColumnRerender",cellRenderer:us,cellRendererParams:{deleteRowHandler:s=>{var i;if(e.current.length<=1)return void(0,F.N9)("You must have at least 1 assessment type!");const r=[...e.current],o=r.splice(s,1);null===(i=n.current)||void 0===i||i.setRowData(r),t(r),a(o[0])}},maxWidth:120,resizable:!1}],r=c.useCallback((t=>{const a=t.node,s=t.overNode;if(a!==s){const t=a.data,n=null===s||void 0===s?void 0:s.data,i=ps(e.current,t),r=ps(e.current,n),o=[...e.current];!function(e,t,a){const s=e[t];e.splice(t,1),e.splice(a,0,s)}(o,i,r),e.current=o}}),[e]),o=t=>{var a;null===(a=n.current)||void 0===a||a.setRowData(e.current),s(!0)},l=(0,f.jsxs)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:[(0,f.jsx)(Xa.AgGridReact,{domLayout:"autoHeight",columnDefs:i,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:e=>{n.current=e.api,e.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:e.current,rowHeight:36,rowDragManaged:!0,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0,onRowDragMove:r,onRowDragLeave:o,onRowDragEnd:o,onCellValueChanged:t=>{if("type"===t.colDef.field){const a=[...e.current];a[t.rowIndex]={...a[t.rowIndex],type:t.value},e.current=a,s(!0)}}}),(0,f.jsxs)("div",{className:"footer-text",children:["*If you create an assessment with these toggles enabled, they will be activated within the assessment ",(0,f.jsx)("b",{children:"by default"}),". However, you can also visit ground control to manually override these settings if needed."]})]});return(0,f.jsxs)("div",{className:"assessment-configuration",children:[(0,f.jsxs)("div",{className:"assessment-configuration-header-container",children:[(0,f.jsx)(p.H2,{children:"Assessment Configuration"}),(0,f.jsx)(m.z,{text:"Add Row",onClick:()=>{var a;if(e.current.length>=8)return void(0,F.N9)("You can have at most 8 assessment types!");const s=[...e.current];s.push({assessmentConfigId:-1,type:"untitled",isManuallyGraded:!0,isGradingAutoPublished:!1,displayInDashboard:!0,hoursBeforeEarlyXpDecay:0,hasTokenCounter:!1,hasVotingFeatures:!1,earlySubmissionXp:0}),t(s),null===(a=n.current)||void 0===a||a.setRowData(s)},className:"add-row-button"})]}),l]})};var xs=a(16959);let bs=function(e){return e.WRITE="WRITE",e.PREVIEW="PREVIEW",e}({});const ys=e=>{const{isMobileBreakpoint:t}=(0,j.Fs)(),[a,s]=c.useState(bs.WRITE),{courseName:n,courseShortName:i,viewable:r,enableGame:o,enableAchievements:l,enableSourcecast:d,enableStories:h,moduleHelpText:u}=e.courseConfiguration,g=(0,f.jsx)(xs.K,{id:"moduleHelpText",className:"input-textarea",fill:!0,value:u||"",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,moduleHelpText:t.target.value})}),m=(0,f.jsx)("div",{className:"input-markdown",children:(0,f.jsx)(se.Z,{content:u||"",openLinksInNewWindow:!0})}),x=c.useCallback(((e,t,a)=>{e!==t&&s(e)}),[s]);return(0,f.jsxs)("div",{className:"course-configuration",children:[(0,f.jsx)(p.H2,{children:n}),(0,f.jsx)(p.H3,{children:i}),(0,f.jsxs)("div",{className:"inputs",children:[(0,f.jsxs)("div",{className:"text",children:[(0,f.jsx)($a.c,{helperText:"Please enter the course name that will be used for course selection.",inline:!0,label:"Course Name",labelFor:"courseName",children:(0,f.jsx)(Wa.B,{id:"courseName",defaultValue:n,onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,courseName:t.target.value})})}),(0,f.jsx)($a.c,{helperText:"Please enter the course short name. This will be displayed on the top left.",inline:!0,label:"Course Short Name",labelFor:"courseShortName",children:(0,f.jsx)(Wa.B,{id:"courseShortName",defaultValue:i,onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,courseShortName:t.target.value})})}),(0,f.jsxs)($a.c,{helperText:"Please enter the module help text that will be used in the course help dialog.",inline:!0,label:"Module Help Text",labelFor:"moduleHelpText",children:[(0,f.jsxs)(ss.mQ,{selectedTabId:a,onChange:x,className:"module-help-text-tabs",children:[(0,f.jsx)(ns.O,{id:bs.WRITE,title:"Write"}),(0,f.jsx)(ns.O,{id:bs.PREVIEW,title:"Preview"})]}),a===bs.WRITE&&g,a===bs.PREVIEW&&m]})]}),!t&&(0,f.jsx)(Me.i,{}),(0,f.jsxs)("div",{className:"booleans",children:[(0,f.jsx)(et.rs,{checked:r,label:"Viewable",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,viewable:t.target.checked})}),(0,f.jsx)(et.rs,{checked:o,label:"Enable Game",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,enableGame:t.target.checked})}),(0,f.jsx)(et.rs,{checked:l,label:"Enable Achievements",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,enableAchievements:t.target.checked})}),(0,f.jsx)(et.rs,{checked:d,label:"Enable Sourcecast",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,enableSourcecast:t.target.checked})}),(0,f.jsx)(et.rs,{checked:h,label:"Enable Stories",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,enableStories:t.target.checked})})]})]})]})},fs=e=>{const[t,a]=c.useState(),s=e.data[e.field];s.sort(((e,t)=>e.minutes-t.minutes));const n=e=>e.minutes>=60?Math.round(e.minutes/60*100)/100+" hour(s)":`${e.minutes} minute(s)`,i=s.filter((e=>e.isDefault));1===i.length&&(t&&t.id===i[0].id||a(i[0]));return(0,f.jsx)(nt.P,{filterable:!1,items:s,itemRenderer:(e,{handleClick:t,handleFocus:a,modifiers:s,query:i})=>(0,f.jsx)(tt.s,{active:s.active,disabled:s.disabled,onClick:t,onFocus:a,roleStructure:"listoption",text:n(e)},e.id+""+e.minutes),onItemSelect:t=>{a(t);const n=s.map((e=>({...e,isDefault:e.id===t.id&&e.minutes===t.minutes})));e.setStateHandler(e.rowIndex,n)},noResults:(0,f.jsx)(tt.s,{disabled:!0,text:"No results.",roleStructure:"listoption"}),children:(0,f.jsx)(m.z,{text:t?n(t):"Choose default",rightIcon:"caret-down"})})};var vs=a(35139);const js=e=>{const t=e.data[e.field],[a,s]=(0,c.useState)(t.map((e=>(e.minutes/60).toFixed(2).toString())));return(0,f.jsx)(vs.E,{values:a,onRemove:(n,i)=>{s(a.filter((e=>e!==n))),e.setDelete(t[i]),e.setStateHandler(e.rowIndex,t.filter(((e,t)=>t!==i)))},onAdd:n=>{if(function(e){const a=parseFloat(e),s=60*a;return!!(0,N.isInteger)(s)&&!t.some((e=>e.minutes===s))&&!isNaN(a)&&isFinite(a)&&a>=0}(n)){const i={id:-1,minutes:60*parseFloat(n),isDefault:!1};s([...a,n]),e.setStateHandler(e.rowIndex,[...t,i])}}})},Cs=()=>{const e=c.useRef(),t=(0,d.I0)(),a=(0,j.ix)((e=>e.session)),s=c.useRef(a.notificationConfigs),[n,i]=(0,c.useState)([]),[r,o]=(0,c.useState)(!1),l=e=>{s.current=e,o(!0)};(0,c.useEffect)((()=>{t((0,b.fetchNotificationConfigs)())}),[t]),(0,c.useEffect)((()=>{s.current=(0,N.cloneDeep)(a.notificationConfigs)}),[a]);const h=(t,a)=>{var n,i,r;const c=[...null!==(n=s.current)&&void 0!==n?n:[]];c[t]={...c[t],timeOptions:a},l(c),null===(i=e.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(t))||void 0===r||r.setDataValue("timeOptions",a),o(!0)},u=[{headerName:"Notification Type",field:"notificationType.name",rowDrag:!0},{headerName:"Assessment Type",field:"assessmentConfig.type",valueFormatter:e=>{var t;return(null===(t=e.data.assessmentConfig)||void 0===t?void 0:t.type)||"-"}},{headerName:"Recipients",field:"notificationType.forStaff",valueFormatter:e=>e.data.notificationType.forStaff?"Staff":"Student"},{headerName:"Reminder Time Options (hours)",field:"timeOptions",cellRenderer:js,cellRendererParams:{setStateHandler:h,setDelete:e=>{if(-1!==e.id){const t=[...n];t.push(e),i(t)}},field:"timeOptions"}},{headerName:"Default Reminder (hours)",field:"timeOptions",cellRenderer:fs,cellRendererParams:{setStateHandler:h,field:"timeOptions"}},{headerName:"Enabled",field:"isEnabled",cellRenderer:hs,cellRendererParams:{setStateHandler:(t,a)=>{var n,i,r;const c=[...null!==(n=s.current)&&void 0!==n?n:[]];c[t]={...c[t],isEnabled:a},l(c),null===(i=e.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(t))||void 0===r||r.setDataValue("isEnabled",a),o(!0)},field:"isEnabled"}}],g=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Xa.AgGridReact,{domLayout:"autoHeight",columnDefs:u,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:t=>{e.current=t.api,t.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.sizeColumnsToFit()},rowData:s.current,rowHeight:36,rowDragManaged:!0,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})});return(0,f.jsxs)("div",{className:"assessment-configuration",children:[(0,f.jsx)("div",{className:"assessment-configuration-header-container",children:(0,f.jsx)(p.H2,{children:"Notification Configuration"})}),g,(0,f.jsx)(m.z,{text:"Save",style:{marginTop:"15px"},intent:r?x.S.WARNING:x.S.NONE,onClick:()=>{if(r){var e,a;o(!1);const r=[];null===(e=s.current)||void 0===e||e.forEach((e=>{const t=e.timeOptions.map((t=>({...t,notificationConfigId:e.id})));r.push(...t)})),r.length>0&&t((0,b.updateTimeOptions)(r)),n.length>0&&(t((0,b.deleteTimeOptions)(n.map((e=>e.id)))),i([])),t((0,b.updateNotificationConfigs)(null!==(a=s.current)&&void 0!==a?a:[]))}}})]})},Ss=e=>{const{data:t}=e,a=c.useCallback((a=>{e.handleUpdateUserRole(t.courseRegId,a.target.value)}),[t,e]),s=[{label:"Student",value:u.uU.Student},{label:"Staff",value:u.uU.Staff},{label:"Admin",value:u.uU.Admin}];return(0,f.jsx)(Oe.J,{content:"You cannot downgrade yourself from an admin role!",interactionKind:"click",position:P.Ly.TOP,disabled:e.courseRegId!==t.courseRegId,children:(0,f.jsx)(rs.L,{options:s,onChange:a,fill:!0,minimal:!0,style:{textAlign:"center"},value:t.role,disabled:e.courseRegId===t.courseRegId})})},ks=({data:e,handleDeleteUserFromCourse:t})=>{const[a,s]=(0,c.useState)(!1),n=(0,c.useCallback)((()=>{t(e.courseRegId),s(!1)}),[e.courseRegId,t]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Oe.J,{content:"You cannot delete an admin!",interactionKind:"click",position:P.Ly.TOP,disabled:e.role!==u.uU.Admin,children:(0,f.jsx)(m.z,{text:"Delete User",icon:E.d.CROSS,onClick:()=>{e.role!==u.uU.Admin?s(!0):(0,F.N9)("You cannot delete an admin user!")},disabled:e.role===u.uU.Admin})}),(0,f.jsxs)(g.V,{icon:E.d.WARNING_SIGN,isOpen:a,onClose:()=>s(!1),title:"Deleting User From Course",canOutsideClickClose:!0,children:[(0,f.jsxs)(T.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",(0,f.jsx)("b",{children:"delete"})," the user"," ",(0,f.jsxs)("i",{children:[e.name," (",e.username,")"]}),"?"]}),(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"All their assessment answers will be deleted as well."})})]}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",icon:E.d.CROSS,onClick:()=>s(!1),options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Confirm",icon:E.d.TRASH,onClick:n,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})},Is=e=>{var t;const a=c.useRef(),s=null===(t=e.userCourseRegistrations)||void 0===t?void 0:t.map((e=>e.name?e:{...e,name:"(user has yet to log in)"})),n=[{headerName:"Name",field:"name",sort:"asc"},{headerName:"Username",field:"username"},{headerName:"Group",field:"group"},{headerName:"Role",field:"role",cellRenderer:Ss,cellRendererParams:{courseRegId:e.courseRegId,handleUpdateUserRole:e.handleUpdateUserRole},width:110},{headerName:"Actions",field:"actions",cellRenderer:ks,cellRendererParams:{handleDeleteUserFromCourse:e.handleDeleteUserFromCourse},width:120,filter:!1,resizable:!1}],i=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Xa.AgGridReact,{domLayout:"autoHeight",columnDefs:n,defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{a.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:s,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})});return(0,f.jsxs)("div",{className:"users-configuration",children:[(0,f.jsxs)("div",{className:"users-header-container",children:[(0,f.jsx)(p.H2,{children:"Users"}),(0,f.jsx)(m.z,{text:"Export as CSV",className:"export-csv-button",onClick:()=>{a.current&&a.current.exportDataAsCsv({fileName:`SA Users (${(new Date).toISOString()}).csv`,columnKeys:["name","username","group","role"]})}})]}),i]})},ws=()=>{const[e,t]=c.useState(!1),[a,s]=c.useState(!1),[n,i]=c.useState({courseName:"",courseShortName:"",viewable:!0,enableGame:!0,enableAchievements:!0,enableSourcecast:!0,enableStories:!1,moduleHelpText:""}),r=(0,d.I0)(),o=(0,j.ix)((e=>e.session)),l=c.useRef(o.assessmentConfigurations),[h,u]=c.useState([]);c.useEffect((()=>{r((0,b.fetchCourseConfig)()),r((0,b.fetchAssessmentConfigs)()),r((0,b.fetchAdminPanelCourseRegistrations)()),r((0,b.fetchNotificationConfigs)())}),[r]),c.useEffect((()=>{i({courseName:o.courseName,courseShortName:o.courseShortName,viewable:o.viewable,enableGame:o.enableGame,enableAchievements:o.enableAchievements,enableSourcecast:o.enableSourcecast,enableStories:o.enableStories,moduleHelpText:o.moduleHelpText}),l.current=(0,N.cloneDeep)(o.assessmentConfigurations)}),[o]);const g={courseConfiguration:n,setCourseConfiguration:e=>{i(e),t(!0)}},y=c.useMemo((()=>({assessmentConfig:l,setAssessmentConfig:e=>{l.current=e,s(!0)},setAssessmentConfigsToDelete:e=>{if(-1!==e.assessmentConfigId){const t=[...h];t.push(e),u(t)}},setHasChangesAssessmentConfig:s})),[h]),v={courseRegId:o.courseRegId,userCourseRegistrations:o.userCourseRegistrations,handleUpdateUserRole:(e,t)=>r((0,b.updateUserRole)(e,t)),handleDeleteUserFromCourse:e=>r((0,b.deleteUserCourseRegistration)(e))},C={handleAddNewUsersToCourse:(e,t)=>r((0,is.addNewUsersToCourse)(e,t))},S={handleAddNewUsersToCourse:(e,t)=>r((0,is.addNewStoriesUsersToCourse)(e,t))},k=(0,f.jsxs)("div",{className:"admin-panel",children:[(0,f.jsx)(p.H1,{children:"Admin Panel"}),(0,f.jsxs)(ss.mQ,{id:"admin-panel",renderActiveTabPanelOnly:!0,children:[(0,f.jsx)(ns.O,{id:"configuration",title:"Configuration",panel:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ys,{...g}),(0,f.jsx)(Me.i,{}),(0,f.jsx)(ms,{...y}),(0,f.jsx)(m.z,{text:"Save",style:{marginTop:"15px"},intent:e||a?x.S.WARNING:x.S.NONE,onClick:()=>{e&&(r((0,b.updateCourseConfig)(n)),t(!1)),h.length>0&&(h.forEach((e=>{r((0,b.deleteAssessmentConfig)(e))})),u([])),a&&(r((0,b.setAssessmentConfigurations)([])),r((0,b.updateAssessmentConfigs)(l.current)),s(!1))}})]})}),(0,f.jsx)(ns.O,{id:"users",title:"Users",panel:(0,f.jsx)(Is,{...v})}),(0,f.jsx)(ns.O,{id:"add-users",title:"Add Users",panel:(0,f.jsx)(ds,{...C})}),(0,f.jsx)(ns.O,{id:"add-stories-users",title:"Add Stories Users",panel:(0,f.jsx)(cs,{...S})}),(0,f.jsx)(ns.O,{id:"notification-config",title:"Notifications",panel:(0,f.jsx)(Cs,{})})]})]});return(0,f.jsx)(Le.Z,{display:k,fullWidth:!1})};var As=a(86859);const Ts={filter:!0,resizable:!0,sortable:!0},Ms=()=>{const e=(0,d.I0)(),t=(0,j.ix)((e=>e.dashboard.gradingSummary));let a;const s=t.cols.map((e=>({headerName:(0,N.startCase)(e),field:e}))),n=(0,f.jsx)("div",{className:"Dashboard",children:(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Xa.AgGridReact,{domLayout:"autoHeight",columnDefs:s,defaultColDef:Ts,onGridReady:e=>{a=e.api},onGridSizeChanged:()=>{a&&a.sizeColumnsToFit()},rowData:t.rows,rowHeight:30,suppressCellFocus:!0,suppressMovableColumns:!0})})});return(0,f.jsx)("div",{children:(0,f.jsx)(Le.Z,{display:n,loadContentDispatch:()=>e((0,As.fetchGroupGradingSummary)())})})};var Ps=a(68503),Es=a(37744);const Ns={zektonFont:{key:"zekton",pngPath:"../../assets/zekton.png",fntPath:"../../assets/zekton.fnt"},zektonDarkFont:{key:"zektonDark",pngPath:"../../assets/zekton_dark.png",fntPath:"../../assets/zekton.fnt"},alienCowsFont:{key:"alienAndCows",pngPath:"../../assets/alien_and_cows.png",fntPath:"../../assets/alien_and_cows.fnt"},alienLeagueFont:{key:"alienLeague",pngPath:"../../assets/alien_league.png",fntPath:"../../assets/alien_league.fnt"},pixelFont:{key:"pixel",pngPath:"../../assets/pixel.png",fntPath:"../../assets/pixel.fnt"}},Rs={assetsFolder:y.y.sourceAcademyAssets,fadeDuration:600,nullFunction:()=>{},nullInteractionId:"",nullSequenceNumber:-1,popUpDuration:1e3,defaultAssetPath:"/ui/wristDeviceButton.png",defaultFontStyle:{key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},defaultCursor:""},Ls={x:1920,y:1080},_s={x:Ls.x/2,y:Ls.y/2},Os={navy:"#03092c",lightBlue:"#ece1fb",offWhite:"#bbc1c9",white:"#ffffff",darkGrey:"#333333",lightGrey:"#555555",blue:"#1133ff",darkBlue:"#0d2440",orange:"#ff9933",yellow:"#ffee33",red:"0#ff0000",maroon:"#142B2E",black:"#000000",purple:"#dd33dd",paleYellow:"#f6ffbd"},Ds=R().mapValues(Os,(e=>parseInt(e.slice(1),16)));let Gs=function(e){return e.Row="Row",e.Column="Column",e}({});function Bs({direction:e=Gs.Row,numOfItems:t,maxXSpace:a=Ls.x,maxYSpace:s=Ls.y,numItemLimit:n=0,redistributeLast:i=!0}){let r=n||t;const o=Math.ceil(t/r);return R().times(t,(n=>{const l=n%r,c=Math.floor(n/r);return i&&c===o-1&&(r=t%o||r),e===Gs.Row?[Us(Ls.x,a,l,r),Us(Ls.y,s,c,o)]:[Us(Ls.x,a,c,o),Us(Ls.y,s,l,r)]}))}function Us(e,t,a,s){const n=t/s;return(e-t+n)/2+n*a}function Fs({numOfItems:e,xSpacing:t=30,ySpacing:a=30}){const s=new Array;for(let n=0;n<e;n++)s.push([n*t,n*a]);return s}const zs={fontFamily:"Verdana",fontSize:"15px",fill:Os.lightBlue,align:"left",wordWrap:{width:290}};class Vs extends Phaser.GameObjects.Container{constructor(e,t,a,s,n=300){super(e,t,a),this.renderTextHover(s,n)}renderTextHover(e,t){const a=parseInt(zs.fontSize.substring(0,zs.fontSize.length-2)),s=e.length*a*.75,n=Math.min(s,t),i=new Phaser.GameObjects.Text(this.scene,30,10,e,{...zs,wordWrap:{width:n-10}}),r=new Phaser.GameObjects.Rectangle(this.scene,20,0,n,i.getBounds().bottom+10,Ds.darkBlue).setOrigin(0,0).setAlpha(.8);this.add([r,i]),this.setDepth(1),this.setVisible(!1)}}const Hs=Vs,$s=(e,t,{x:a,y:s,oriX:n,oriY:i},r)=>new Phaser.GameObjects.BitmapText(e,a,s,r.key,t,r.size,r.align).setOrigin(n,i),Ws={key:Ns.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Xs={key:Ns.alienLeagueFont.key,size:50,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ks={key:Ns.zektonFont.key,size:18,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Zs={fontFamily:"Verdana",fontSize:"18px",fill:Os.lightBlue,align:"center",lineSpacing:10,wordWrap:{width:500}},qs={id:"default-award",assetKey:Rs.nullInteractionId,assetPath:Rs.nullInteractionId,title:Rs.nullInteractionId,description:"There is no asset associated with this award.",completed:!1},Ys="Asset key can be used to include the asset into your room by using 'create_award' function.",Js=.3*-Ls.x,Qs=.05*-Ls.y,en=Qs+275,tn={arrow:{x:.08*Ls.x,y:.34*Ls.y,xOffset:80,xScale:.4,yScale:.3},itemsPerPage:7,list:{yStart:.31*-Ls.y,ySpace:100},listTextConfig:{x:.09*-Ls.x,y:0,oriX:0,oriY:.55},noPreviewTextConfig:{x:Js,y:-40,oriX:.5,oriY:.5},preview:{descText:{yOffset:320},rect:{dim:430,x:Js,y:Qs,xOffset:30,yOffset:15},key:{x:Js,y:en,width:430,height:35},keyTagTextConfig:{x:Js-205,y:en,oriX:0,oriY:.5},keyTextConfig:{x:Js-90,y:en,oriX:0,oriY:.5},explanation:{x:Js-150,y:Qs+200},titleTextConfig:{x:Js+20,y:Qs-275,oriX:.5,oriY:.5}}},an=e=>e.map((e=>sn(e))),sn=e=>{const t=Ll.getInstance().getAwardsMapping().get(e);return t||{...qs,title:e}};let nn=function(e){return e.Image="Image",e.Sprite="Sprite",e}({}),rn=function(e){return e.Background="Background",e.Object="Object",e}({});const on={spaceshipBg:{type:nn.Image,key:"spaceship-bg",path:"/locations/spaceshipBackground.png"},saBanner:{type:nn.Image,key:"sa-banner",path:"/ui/sourceAcadBannerOneLine.png"},shortButton:{type:nn.Image,key:"short-button",path:"/ui/shortButton.png"},mediumButton:{type:nn.Image,key:"med-button",path:"/ui/mediumButton.png"},longButton:{type:nn.Image,key:"long-button",path:"/ui/longButton.png"},topButton:{type:nn.Image,key:"top-button",path:"/ui/topButton.png"},speechBox:{type:nn.Image,key:"speechBox",path:"/ui/speechbox.png"},speakerBox:{type:nn.Image,key:"speakerBox",path:"/ui/speakerBox.png"},defaultLocationImg:{type:nn.Image,key:"loc-default",path:"/ui/defaultLocation.jpg"},locationPreviewFrame:{type:nn.Image,key:"loc-preview-frame",path:"/ui/locationPreviewFrame.png"},locationPreviewFill:{type:nn.Image,key:"loc-preview-fill",path:"/ui/locationPreviewFill.png"},talkOptButton:{type:nn.Image,key:"talk-opt-button",path:"/ui/talkOptButton.png"},talkOptCheck:{type:nn.Image,key:"talk-opt-check",path:"/ui/talkOptCheck.png"},modeMenuBanner:{type:nn.Image,key:"mode-banner",path:"/ui/modeMenuBanner.png"},popUpFrame:{type:nn.Image,key:"pop-up-frame",path:"/ui/popUpFrame.png"},mediumBox:{type:nn.Image,key:"medium-box",path:"/ui/mediumBox.png"},diamond:{type:nn.Image,key:"diamond",path:"/ui/zircon.png"},arrow:{type:nn.Image,key:"arrow",path:"/ui/arrow.png"},cookies:{type:nn.Image,key:"cookies",path:"/images/cookies.png"},scrollFrame:{type:nn.Image,key:"scroll-frame",path:"/ui/scrollFrame.png"},messageBar:{type:nn.Image,key:"message-bar",path:"/ui/messageBg.png"},escapeMenuBackground:{type:nn.Image,key:"escape-bg",path:"/ui/escapeMenu.png"},awardsMenu:{type:nn.Image,key:"award-bg",path:"/ui/collectiblesBg.png"},awardsBanner:{type:nn.Image,key:"award-banner",path:"/ui/awardsBanner.png"},awardsPageChosen:{type:nn.Image,key:"award-pg-chosen",path:"/ui/collectiblesPageOptChosen.png"},awardsPage:{type:nn.Image,key:"award-pg-opt",path:"/ui/collectiblesPageOpt.png"},awardsBackground:{type:nn.Image,key:"award-hall-bg",path:"/ui/awardsHall.png"},gear:{type:nn.Image,key:"gear",path:"/ui/settings.png"},journal:{type:nn.Image,key:"journal",path:"/ui/journal.png"},chapterRepeatButton:{type:nn.Image,key:"chapter-repeat",path:"/ui/chapterRepeat.png"},chapterContinueButton:{type:nn.Image,key:"chapter-continue",path:"/ui/chapterContinue.png"},StarGold:{type:nn.Image,key:"StarGold",path:"/ui/StarGold.png"},StarSilver:{type:nn.Image,key:"StarSilver",path:"/ui/StarSilver.png"},StarBronze:{type:nn.Image,key:"StarBronze",path:"/ui/StarBronze.png"},chapterSelectFrame:{type:nn.Image,key:"chapter-select-frame",path:"/ui/chapterSelectionFrame.png"},chapterSelectBorder:{type:nn.Image,key:"chapter-select-border",path:"/ui/chapterSelectionBorder.png"},chapterSelectArrow:{type:nn.Image,key:"chapter-select-arrow",path:"/ui/chapSelectArrow.png"},mainMenuOptBanner:{type:nn.Image,key:"menu-option",path:"/ui/menuOption.png"},settingBanner:{type:nn.Image,key:"settings-bg",path:"/ui/settingsBg.png"},settingOption:{type:nn.Image,key:"settings-opt",path:"/ui/settingsOption.png"},verifiedFrame:{type:nn.Image,key:"verified-frame",path:"/ui/verifiedFrame.png"},sourceCrashedPod:{type:nn.Image,key:"source-crashed-pod",path:"/locations/sourceCrashedPod.png"},squareKeyboardIcon:{type:nn.Image,key:"keyboard-key-square",path:"/ui/keyboardKeyIcon.png"},medKeyboardIcon:{type:nn.Image,key:"keyboard-key-medium",path:"/ui/TabIcon.png"}},ln={volume:0,ease:"Power2"};let cn=function(e){return e[e.SFX=0]="SFX",e[e.BGM=1]="BGM",e}({});const dn={buttonHover:{key:"btn-hover",path:"/sfx/buttonHover.mp3",config:{volume:.1},soundType:cn.SFX},buttonClick:{key:"btn-click",path:"/sfx/buttonClick.mp3",config:{volume:.1},soundType:cn.SFX},radioButtonClick:{key:"radio-btn-click",path:"/sfx/radioButtonClick.mp3",config:{volume:.15},soundType:cn.SFX},dialogueAdvance:{key:"dialogue-advance",path:"/sfx/dialogueAdvance.mp3",config:{volume:.3},soundType:cn.SFX},popUpEnter:{key:"pop-up-enter",path:"/sfx/popUpEnter.mp3",config:{volume:.35},soundType:cn.SFX},popUpExit:{key:"pop-up-exit",path:"/sfx/popUpExit.mp3",config:{volume:.35},soundType:cn.SFX},menuEnter:{key:"menu-enter",path:"/sfx/menuEnter.mp3",config:{volume:.5},soundType:cn.SFX},menuExit:{key:"menu-exit",path:"/sfx/menuExit.mp3",config:{volume:.5},soundType:cn.SFX},modeEnter:{key:"mode-enter",path:"/sfx/modeEnter.mp3",config:{volume:.1},soundType:cn.SFX},notifEnter:{key:"notif-enter",path:"/sfx/notifEnter.mp3",config:{volume:.25},soundType:cn.SFX},notifExit:{key:"notif-exit",path:"/sfx/notifExit.mp3",config:{volume:.25},soundType:cn.SFX},radioStatic:{key:"radio-static",path:"/sfx/radioStatic.mp3",config:{volume:.1},soundType:cn.SFX},galacticHarmony:{key:"galactic-harmony",path:"/bgm/GalacticHarmony.mp3",config:{volume:.25,loop:!0},soundType:cn.BGM}};let hn=function(e){return e[e.Effects=0]="Effects",e[e.Background=1]="Background",e[e.Character=2]="Character",e[e.Speaker=3]="Speaker",e[e.PopUp=4]="PopUp",e[e.Dialogue=5]="Dialogue",e[e.SpeakerBox=6]="SpeakerBox",e[e.UI=7]="UI",e[e.Objects=8]="Objects",e[e.BBox=9]="BBox",e[e.Escape=10]="Escape",e[e.Selector=11]="Selector",e[e.Dashboard=12]="Dashboard",e[e.WorkerMessage=13]="WorkerMessage",e}({});const un=[hn.Background,hn.Selector,hn.Objects,hn.BBox,hn.Character,hn.Speaker,hn.PopUp,hn.Dialogue,hn.SpeakerBox,hn.Effects,hn.Dashboard,hn.Escape,hn.UI,hn.WorkerMessage];var gn=a(27542);function pn(e){return new Promise((t=>setTimeout(t,e)))}function mn(e,t,a){return Math.min(Math.max(e,t),a)}function xn(e,t=!1){return e.startsWith("/")&&(e=e.substr(1)),Rs.assetsFolder+(t?fn()+e:e)}function bn(e,t){if(void 0===e)throw new Error(t||"Object not found");return e}const yn=()=>gn.h.getState().session.courseId,fn=()=>gn.h.getState().session.assetsPrefix||"",vn=(e,t=Rs.fadeDuration)=>({alpha:0,targets:e,duration:t,ease:"Power2"}),jn=(e,t=Rs.fadeDuration)=>({alpha:1,targets:e,duration:t,ease:"Power2"});function Cn(e,t,{fadeDuration:a}={}){t&&(e.add.tween(vn([t],a||Rs.fadeDuration)),setTimeout((()=>t.destroy()),a||Rs.fadeDuration))}function Sn(e){return new Phaser.GameObjects.Rectangle(e,_s.x,_s.y,Ls.x,Ls.y,0)}function kn(e,t){let a=0;const s=setInterval((()=>{a%2!==0?(t.setAlpha(0),e.tweens.add(jn([t],250))):(t.setAlpha(1),e.tweens.add(vn([t],250))),a++}),500);return function(){a=0,clearInterval(s)}}const In={y:0,duration:300,ease:"Power2"},wn={y:-Ls.y,duration:250,ease:"Power2"},An=(Ls.x,{x:0,duration:500,ease:"Power2"}),Tn={x:Ls.x,duration:500,ease:"Power2"},Mn=3e3,Pn={x:1900,y:100,oriX:1,oriY:.5},En={key:Ns.zektonDarkFont.key,size:24,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},Nn=(()=>{let e=Promise.resolve();return(t,a)=>{e=e.then((()=>async function(e,t){const a=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Sprite(e,Ls.x,100,on.messageBar.key);s.setScale(-1.5,.8);const n=$s(e,t,Pn,En);a.add([s,n]),e.getLayerManager().addToLayer(hn.Effects,a),a.setPosition(Ls.x,0),a.setAlpha(0),Ll.getInstance().getSoundManager().playSound(dn.notifEnter.key),e.add.tween({targets:a,alpha:1,...An}),await pn(An.duration+Mn),Ll.getInstance().getSoundManager().playSound(dn.notifExit.key),e.add.tween({targets:a,alpha:1,...Tn}),await pn(Tn.duration),Cn(e,a,{fadeDuration:Rs.fadeDuration})}(t,a)))}})();const Rn={prompt:{x:30,y:60,xPad:30,yPad:10},rect:{x:10,y:760,width:Ls.x-20},text:{xPad:100,yPad:70},speakerTextConfig:{x:320,y:745,oriX:.5,oriY:.5}},Ln={fontFamily:"Verdana",fontSize:"30px",fill:Os.lightBlue,align:"left",lineSpacing:10,wordWrap:{width:Rn.rect.width-2*Rn.text.xPad-2*Rn.rect.x}},_n={key:Ns.zektonFont.key,size:36,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},On=Rn;const Dn=function(e,{x:t=0,y:a=0,textStyle:s={},typeWriterInterval:n=1}){const i=new Phaser.GameObjects.Text(e,t,a,"",s);let r,o="",l=0;const c=()=>{r&&clearInterval(r)};return{container:i,changeLine:e=>{e&&(o=e,i.text="",l=0,c(),r=setInterval((()=>{i.text+=o[l++],l===o.length&&clearInterval(r)}),n))},clearTyping:c}};const Gn=class{constructor(e){const t=ei.getInstance().getGameManager();var a;this.dialogueBox=(a=t,new Phaser.GameObjects.Image(a,_s.x,_s.y,on.speechBox.key).setAlpha(.9)).setInteractive({useHandCursor:!0,pixelPerfect:!0}),this.typewriter=function(e,t){return Dn(e,{x:On.rect.x+On.text.xPad,y:On.rect.y+On.text.yPad,textStyle:t})}(t,e),this.blinkingDiamond=this.drawDiamond(t)}getDialogueContainer(){const e=ei.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0);return t.add([this.dialogueBox,this.blinkingDiamond.container,this.typewriter.container]),t}drawDiamond(e){const t=new Phaser.GameObjects.Image(e,Ls.x-On.prompt.x-On.prompt.xPad,Ls.y-On.prompt.y-On.prompt.yPad,on.diamond.key).setDisplaySize(On.prompt.x,On.prompt.y);return{container:t,clearBlink:kn(e,t)}}getDialogueBox(){return this.dialogueBox}destroy(){const e=ei.getInstance().getGameManager();this.typewriter.clearTyping(),this.blinkingDiamond.clearBlink(),this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP),Cn(e,this.getDialogueContainer())}changeText(e){this.typewriter.changeLine(e)}},Bn={Dashboard:Phaser.Input.Keyboard.KeyCodes.TAB,Menu:Phaser.Input.Keyboard.KeyCodes.ESC,Next:Phaser.Input.Keyboard.KeyCodes.SPACE,Notif:Phaser.Input.Keyboard.KeyCodes.SPACE,Explore:Phaser.Input.Keyboard.KeyCodes.E,Move:Phaser.Input.Keyboard.KeyCodes.V,Talk:Phaser.Input.Keyboard.KeyCodes.T,Options:[Phaser.Input.Keyboard.KeyCodes.ONE,Phaser.Input.Keyboard.KeyCodes.TWO,Phaser.Input.Keyboard.KeyCodes.THREE,Phaser.Input.Keyboard.KeyCodes.FOUR]};const Un=class{constructor(e){this.keyboardListeners=[],this.eventListeners=[],this.scene=e}setDefaultCursor(e){this.scene.input.setDefaultCursor(e)}enableMouseInput(e){this.scene.input.mouse.enabled=e}enableKeyboardInput(e){this.scene.input.keyboard.enabled=e}registerKeyboardListener(e,t,a){const s=this.scene.input.keyboard.addKey(e).addListener(t,a);this.keyboardListeners.push(s)}registerEventListener(e,t){const a=this.scene.input.addListener(e,t);this.eventListeners.concat(a)}clearListeners(){this.keyboardListeners.forEach((e=>e.removeAllListeners())),this.eventListeners.forEach((e=>e.removeAllListeners()))}clearKeyboardListeners(e){this.keyboardListeners.forEach((t=>{e.includes(t.keyCode)&&t.removeAllListeners()}))}},Fn={key:Ns.alienLeagueFont.key,size:100,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},zn={x:_s.x,y:On.rect.y+2*Fn.size,oriX:.5,oriY:.9};const Vn=1,Hn=.9;function $n(e,t){return"[ "+e+" ]  "+t}function Wn(e,{assetKey:t,message:a="",textConfig:s={x:0,y:0,oriX:0,oriY:0},bitMapTextStyle:n=Rs.defaultFontStyle,onDown:i=Rs.nullFunction,onUp:r=Rs.nullFunction,onHover:o=Rs.nullFunction,onOut:l=Rs.nullFunction,onPointerMove:c=Rs.nullFunction,onHoverEffect:d=!0,onClickSound:h=dn.buttonClick.key,onHoverSound:u=dn.buttonHover.key}){const g=new Phaser.GameObjects.Container(e,0,0),p=new Phaser.GameObjects.Sprite(e,0,0,t);p.setInteractive({pixelPerfect:!0,useHandCursor:!0}),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{Ll.getInstance().getSoundManager().playSound(h),r()})),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>{Ll.getInstance().getSoundManager().playSound(u),d&&g.setAlpha(Vn),o()})),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>{d&&g.setAlpha(Hn),l()})),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,(()=>{i()})),p.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,((e,t,a)=>{c(e,t,a)}));const m=$s(e,a,s,n);return g.add([p,m]),d&&g.setAlpha(Hn),g}const Xn={textPad:20,textConfig:{x:15,y:-15,oriX:.5,oriY:.5},y:100,width:450,yInterval:100},Kn={fontFamily:"Verdana",fontSize:"20px",fill:Os.offWhite,align:"right",lineSpacing:10,wordWrap:{width:Xn.width-2*Xn.textPad}},Zn={key:Ns.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};async function qn(e,t,a){const s=new Phaser.GameObjects.Container(e,0,0),n=Math.ceil(a.length/5),i=a.length>5?5:a.length,r=new Phaser.GameObjects.Text(e,Ls.x-Xn.textPad,Xn.y,t,Kn).setOrigin(1,0),o=new Phaser.GameObjects.Rectangle(e,Ls.x,Xn.y-Xn.textPad,Xn.width*n,.5*r.getBounds().bottom+Xn.textPad,Ds.darkBlue,.8).setOrigin(1,0),l=new Phaser.GameObjects.Rectangle(e,Ls.x,Xn.y-Xn.textPad,Xn.width*n,.5*o.getBounds().bottom+(i+.5)*Xn.yInterval,Ds.lightBlue,.2).setOrigin(1,0);s.add([l,o,r]);const c=Fs({numOfItems:a.length,xSpacing:0,ySpacing:Xn.yInterval});ei.getInstance().addToLayer(hn.UI,s);const d=new Promise((t=>{s.add(a.map(((a,i)=>Wn(e,{assetKey:on.mediumButton.key,message:a,textConfig:Xn.textConfig,bitMapTextStyle:Zn,onUp:()=>{s.destroy(),t(i)}}).setPosition(Ls.x-Xn.width/2-Xn.width*(n-Math.floor(i/5)-1),c[i][1]%(5*Xn.yInterval)+o.getBounds().bottom+75))))}));s.setPosition(Ls.x,0),Ll.getInstance().getSoundManager().playSound(dn.notifEnter.key),e.add.tween({targets:s,alpha:1,...An}),await pn(An.duration);const h=await d;return Ll.getInstance().getSoundManager().playSound(dn.notifExit.key),e.add.tween({targets:s,alpha:1,...Tn}),await pn(Tn.duration),Cn(e,s,{fadeDuration:Rs.fadeDuration}),h}let Yn=function(e){return e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu",e.EscapeMenu="EscapeMenu",e.None="None",e.Sequence="Sequence",e.Dashboard="Dashboard",e}({}),Jn=function(e){return e.EscapeMenu="EscapeMenu",e.Dashboard="Dashboard",e}({});class Qn{constructor(){this.getGameManager=()=>bn(this.gameManager),this.gameManager=void 0}static getInstance(){return Qn.instance||(Qn.instance=new Qn),Qn.instance}setGameManager(e){this.gameManager=e}getCurrLocId(){return this.getGameManager().currentLocationId}getLocationAtId(e){return this.getGameManager().getStateManager().getGameMap().getLocationAtId(e)}async changeLocationTo(e){await this.getGameManager().changeLocationTo(e)}getLocationModes(e){return this.getGameManager().getStateManager().getLocationModes(e)}addLocationMode(e,t){this.getGameManager().getStateManager().addLocationMode(e,t)}removeLocationMode(e,t){this.getGameManager().getStateManager().removeLocationMode(e,t)}hasTriggeredInteraction(e){return this.getGameManager().getStateManager().hasTriggeredInteraction(e)}triggerStateChangeAction(e){this.getGameManager().getStateManager().triggerStateChangeAction(e)}triggerInteraction(e){this.getGameManager().getStateManager().triggerInteraction(e)}watchGameItemType(e,t){this.getGameManager().getStateManager().watchGameItemType(e,t)}getGameMap(){return this.getGameManager().getStateManager().getGameMap()}getGameItemsInLocation(e,t){return this.getGameManager().getStateManager().getGameItemsInLocation(e,t)}addItem(e,t,a){this.getGameManager().getStateManager().addItem(e,t,a)}removeItem(e,t,a){return this.getGameManager().getStateManager().removeItem(e,t,a)}makeObjectGlow(e,t){this.getGameManager().getObjectManager().makeObjectGlow(e,t)}makeObjectBlink(e,t){this.getGameManager().getObjectManager().makeObjectBlink(e,t)}setObjProperty(e,t){this.getGameManager().getStateManager().setObjProperty(e,t)}renderObjectLayerContainer(e){this.getGameManager().getObjectManager().renderObjectsLayerContainer(e)}getAllActivatables(){return[...this.getGameManager().getObjectManager().getActivatables(),...this.getGameManager().getBBoxManager().getActivatables()]}setBBoxProperty(e,t){this.getGameManager().getStateManager().setBBoxProperty(e,t)}renderBBoxLayerContainer(e){this.getGameManager().getBBoxManager().renderBBoxLayerContainer(e)}areAllObjectivesComplete(){return this.getGameManager().getStateManager().areAllObjectivesComplete()}isObjectiveComplete(e){return this.getGameManager().getStateManager().isObjectiveComplete(e)}areObjectivesComplete(e){return this.getGameManager().getStateManager().areObjectivesComplete(e)}completeObjective(e){this.getGameManager().getStateManager().completeObjective(e)}isTaskComplete(e){return this.getGameManager().getStateManager().isTaskComplete(e)}areTasksComplete(e){return this.getGameManager().getStateManager().areTasksComplete(e)}completeTask(e){this.getGameManager().getStateManager().completeTask(e),Nn(this.getGameManager(),"Task completed!")}showTask(e){this.getGameManager().getStateManager().showTask(e),Nn(this.getGameManager(),"New task added")}getAllVisibleTaskData(){return this.getGameManager().getStateManager().getAllVisibleTaskData()}addCollectible(e){Ll.getInstance().getUserStateManager().addCollectible(e)}async isInUserState(e,t){return Ll.getInstance().getUserStateManager().isInUserState(e,t)}clearSeveralLayers(e){this.getGameManager().getLayerManager().clearSeveralLayers(e)}addToLayer(e,t){this.getGameManager().getLayerManager().addToLayer(e,t)}showLayer(e){this.getGameManager().getLayerManager().showLayer(e)}hideLayer(e){this.getGameManager().getLayerManager().hideLayer(e)}async fadeInLayer(e,t){await this.getGameManager().getLayerManager().fadeInLayer(e,t)}async fadeOutLayer(e,t){await this.getGameManager().getLayerManager().fadeOutLayer(e,t)}async bringUpUpdateNotif(e){await async function(e,t){const a=new Gn({}),s=a.getDialogueContainer();e.getLayerManager().addToLayer(hn.Effects,s),e.getLayerManager().fadeInLayer(hn.Effects);const n=$s(e,t,zn,Fn).setAlpha(0);s.add(n),Ll.getInstance().getSoundManager().playSound(dn.notifEnter.key),e.add.tween(jn([n],2*Rs.fadeDuration)),await pn(2*Rs.fadeDuration);const i=new Un(e),r=()=>{Ll.getInstance().getSoundManager().playSound(dn.notifExit.key),Cn(e,n,{fadeDuration:Rs.fadeDuration/4}),a.destroy()},o=new Promise((e=>{i.registerKeyboardListener(Bn.Notif,"up",(async()=>{i.clearKeyboardListeners([Bn.Notif]),r(),e()})),a.getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{r(),e()}))}));await o}(this.getGameManager(),e)}async processGameActions(e){await this.getGameManager().getPhaseManager().pushPhase(Yn.Sequence),await this.getGameManager().getActionManager().processGameActions(e),await this.getGameManager().getPhaseManager().popPhase()}async processGameActionsInSamePhase(e){await this.getGameManager().getActionManager().processGameActions(e)}async showDialogue(e){await this.getGameManager().getPhaseManager().pushPhase(Yn.Sequence),await this.getGameManager().getDialogueManager().showDialogue(e),await this.getGameManager().getPhaseManager().popPhase()}async showDialogueInSamePhase(e){await this.getGameManager().getDialogueManager().showDialogue(e)}storeDialogueLine(e,t){this.getGameManager().getDialogueStorageManager().storeLine(e,t)}getDialogueStorage(){return this.getGameManager().getDialogueStorageManager().getDialogueStorage()}async obtainCollectible(e){Nn(this.getGameManager(),`Obtained ${sn(e).title}`),Ll.getInstance().getUserStateManager().addCollectible(e)}displayPopUp(e,t,a,s){this.getGameManager().getPopupManager().displayPopUp(e,t,a,s)}destroyAllPopUps(){this.getGameManager().getPopupManager().destroyAllPopUps()}async destroyPopUp(e){this.getGameManager().getPopupManager().destroyPopUp(e)}async saveGame(){await this.getGameManager().getSaveManager().saveGame()}async saveSettings(e){await this.getGameManager().getSaveManager().saveSettings(e)}getLoadedUserState(){return this.getGameManager().getSaveManager().getLoadedUserState()}getSoundManager(){return Ll.getInstance().getSoundManager()}playSound(e){Ll.getInstance().getSoundManager().playSound(e)}playBgMusic(e){Ll.getInstance().getSoundManager().playBgMusic(e)}async stopAllSound(){Ll.getInstance().getSoundManager().stopAllSound()}pauseCurrBgMusic(){Ll.getInstance().getSoundManager().pauseCurrBgMusic()}continueCurrBgMusic(){Ll.getInstance().getSoundManager().continueCurrBgMusic()}applySoundSettings(e){Ll.getInstance().getSoundManager().applyUserSettings(e)}loadSounds(e){Ll.getInstance().getSoundManager().loadSounds(e)}startAnimation(e,t,a){const s=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().displayAnimation(s,t,a)}stopAnimation(e){const t=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().stopAnimation(t)}setDefaultCursor(e){this.getGameManager().getInputManager().setDefaultCursor(e)}enableKeyboardInput(e){this.getGameManager().getInputManager().enableKeyboardInput(e)}enableMouseInput(e){this.getGameManager().getInputManager().enableMouseInput(e)}enableSprite(e,t){t?this.getGameManager().input.enable(e):this.getGameManager().input.disable(e)}async popPhase(){await this.getGameManager().getPhaseManager().popPhase()}async pushPhase(e){await this.getGameManager().getPhaseManager().pushPhase(e)}async swapPhase(e){await this.getGameManager().getPhaseManager().swapPhase(e)}isCurrentPhase(e){return this.getGameManager().getPhaseManager().isCurrentPhase(e)}renderBackgroundLayerContainer(e){this.getGameManager().getBackgroundManager().renderBackgroundLayerContainer(e)}async promptNavigateToAssessment(e){0===await qn(Qn.getInstance().getGameManager(),"Are you ready for the challenge?",["Yes","No"])&&(window.open(`/courses/${yn()}/missions/${e}/0`,"blank"),window.focus())}async updateAssessmentState(){await Ll.getInstance().getUserStateManager().loadAssessments()}createCharacterSprite(e,t,a){return this.getGameManager().getCharacterManager().createCharacterSprite(e,t,a)}moveCharacter(e,t,a){this.getGameManager().getStateManager().moveCharacter(e,t,a)}updateCharacter(e,t){this.getGameManager().getStateManager().updateCharacter(e,t)}getDialogueById(e){return bn(this.getGameMap().getDialogueMap().get(e))}getCharacterById(e){return bn(this.getGameMap().getCharacterMap().get(e))}getActionById(e){return bn(this.getGameMap().getActionMap().get(e))}getObjectById(e){return bn(this.getGameMap().getObjectPropMap().get(e))}getBBoxById(e){return bn(this.getGameMap().getBBoxPropMap().get(e))}getAssetByKey(e){return this.getGameMap().getAssetByKey(e)}}const ei=Qn;let ti=function(e){return e.UserState="UserState",e.ChecklistState="ChecklistState",e.TasklistState="TasklistState",e}({}),ai=function(e){return e.collectibles="collectibles",e.assessments="assessments",e.achievements="achievements",e}({});class si{static async checkAllConditionsSatisfied(e){return(await Promise.all(e.map((async e=>await this.checkConditionSatisfied(e))))).every((e=>!0===e))}static async checkConditionSatisfied(e){const{state:t,conditionParams:a,boolean:s}=e;switch(t){case ti.UserState:return await ei.getInstance().isInUserState(a.userStateType,a.id)===s;case ti.ChecklistState:return ei.getInstance().isObjectiveComplete(a.id)===s;case ti.TasklistState:return ei.getInstance().isTaskComplete(a.id)===s;default:return!0}}}let ni=function(e){return e.MoveCharacter="MoveCharacter",e.UpdateCharacter="UpdateCharacter",e.ObtainCollectible="ObtainCollectible",e.CompleteObjective="CompleteObjective",e.CompleteTask="CompleteTask",e.ShowTask="ShowTask",e.PreviewLocation="PreviewLocation",e.AddItem="AddItem",e.RemoveItem="RemoveItem",e.ShowDialogue="ShowDialogue",e.ChangeBackground="ChangeBackground",e.StartAnimation="StartAnimation",e.StopAnimation="StopAnimation",e.RemoveLocationMode="RemoveLocationMode",e.AddLocationMode="AddLocationMode",e.AddPopup="AddPopup",e.MakeObjectBlink="MakeObjectBlink",e.MakeObjectGlow="MakeObjectGlow",e.PlayBGM="PlayBGM",e.PlaySFX="PlaySFX",e.ShowObjectLayer="ShowObjectLayer",e.NavigateToAssessment="NavigateToAssessment",e.UpdateAssessmentStatus="UpdateAssessmentStatus",e.Delay="Delay",e}({});class ii{static async executeGameAction(e,t){const a=ei.getInstance();switch(e){case ni.AddItem:return void a.addItem(t.gameItemType,t.locationId,t.id);case ni.RemoveItem:return void a.removeItem(t.gameItemType,t.locationId,t.id);case ni.AddLocationMode:return void a.addLocationMode(t.locationId,t.mode);case ni.RemoveLocationMode:return void a.removeLocationMode(t.locationId,t.mode);case ni.MoveCharacter:return void a.moveCharacter(t.id,t.locationId,t.position);case ni.UpdateCharacter:return void a.updateCharacter(t.id,t.expression);case ni.ChangeBackground:return void a.renderBackgroundLayerContainer(t.id);case ni.StartAnimation:return void a.startAnimation(t.id,t.startFrame,t.frameRate);case ni.StopAnimation:return void a.stopAnimation(t.id);case ni.PreviewLocation:return a.renderBackgroundLayerContainer(t.id),a.renderObjectLayerContainer(t.id),void a.renderBBoxLayerContainer(t.id);case ni.ObtainCollectible:return void a.obtainCollectible(t.id);case ni.CompleteObjective:return void a.completeObjective(t.id);case ni.CompleteTask:return void a.completeTask(t.id);case ni.ShowTask:return void a.showTask(t.id);case ni.ShowDialogue:return void(a.isCurrentPhase(Yn.Sequence)?await a.showDialogueInSamePhase(t.id):await a.showDialogue(t.id));case ni.AddPopup:return void await a.displayPopUp(t.id,t.position,t.duration,t.size);case ni.MakeObjectBlink:return void await a.makeObjectBlink(t.id,t.turnOn);case ni.MakeObjectGlow:return void await a.makeObjectGlow(t.id,t.turnOn);case ni.PlayBGM:return void Ll.getInstance().getSoundManager().playBgMusic(t.id);case ni.PlaySFX:return void await Ll.getInstance().getSoundManager().playSound(t.id);case ni.ShowObjectLayer:return void(t.show?a.showLayer(hn.Objects):a.hideLayer(hn.Objects));case ni.NavigateToAssessment:return void await a.promptNavigateToAssessment(t.assessmentId);case ni.UpdateAssessmentStatus:return void await a.updateAssessmentState();case ni.Delay:return void await pn(t.duration);default:return}}static isStateChangeAction(e){switch(e){case ni.AddItem:case ni.RemoveItem:case ni.AddLocationMode:case ni.RemoveLocationMode:case ni.MoveCharacter:case ni.UpdateCharacter:return!0;case ni.NavigateToAssessment:case ni.UpdateAssessmentStatus:case ni.PreviewLocation:case ni.ChangeBackground:case ni.StartAnimation:case ni.StopAnimation:case ni.ObtainCollectible:case ni.CompleteObjective:case ni.CompleteTask:case ni.ShowTask:case ni.ShowDialogue:case ni.AddPopup:case ni.MakeObjectBlink:case ni.MakeObjectGlow:case ni.PlayBGM:case ni.PlaySFX:case ni.ShowObjectLayer:case ni.Delay:return!1}}}class ri{async fastForwardGameActions(e){if(e)for(const t of e){const{actionType:e,actionParams:a}=ei.getInstance().getActionById(t);await ii.executeGameAction(e,a)}}async processGameActions(e){if(e){for(const t of e)await this.processGameAction(t);await ei.getInstance().saveGame()}}async processGameAction(e){const{actionType:t,actionParams:a,actionConditions:s,isRepeatable:n,interactionId:i}=ei.getInstance().getActionById(e);await this.checkCanPlayAction(n,i,s)&&(await ii.executeGameAction(t,a),ii.isStateChangeAction(t)&&ei.getInstance().triggerStateChangeAction(e),ei.getInstance().triggerInteraction(e))}async checkCanPlayAction(e,t,a){return(e||!ei.getInstance().hasTriggeredInteraction(t))&&await si.checkAllConditionsSatisfied(a)}}let oi=function(e){return e.navigation="navigation",e.locations="locations",e.talkTopics="talkTopics",e.dialogues="dialogues",e.objects="objects",e.boundingBoxes="boundingBoxes",e.characters="characters",e.actions="actions",e.bgmKey="bgmKey",e.collectibles="collectibles",e}({});class li{constructor(){this.game=ei.getInstance().getGameManager(),this.animationInstanceMap=new Map,this.isSprite=e=>e.type===nn.Sprite}createImage(e,t){var a,s,n,i;switch(e.type){case nn.Sprite:return this.createAnimation(e,(null===(a=e.config)||void 0===a?void 0:a.start)||0,(null===(s=e.config)||void 0===s?void 0:s.frameRate)||20),this.getAnimation(e);case nn.Image:return new Phaser.GameObjects.Image(this.game,(null===e||void 0===e||null===(n=e.config)||void 0===n?void 0:n.centreX)||0,(null===e||void 0===e||null===(i=e.config)||void 0===i?void 0:i.centreY)||0,t)}}displayAnimation(e,t,a){var s;const n=ei.getInstance().getAssetByKey(e.path);switch(n&&n.config&&(n.config.start=t,n.config.frameRate=a),null===(s=n.config)||void 0===s?void 0:s.animType){case rn.Object:const t=ei.getInstance().getCurrLocId();ei.getInstance().addItem(oi.objects,t,e.key);break;case rn.Background:ei.getInstance().renderBackgroundLayerContainer(e.key)}}createAnimation(e,t,a){if(this.isSprite(e)){var s,n,i;this.removeAnimation(e);const r=new Phaser.GameObjects.Sprite(this.game,(null===(s=e.config)||void 0===s?void 0:s.centreX)||0,(null===(n=e.config)||void 0===n?void 0:n.centreY)||0,e.path),o={key:e.path,frames:this.game.anims.generateFrameNumbers(e.path,{start:t,end:(null===(i=e.config)||void 0===i?void 0:i.endFrame)||0,first:0}),frameRate:a,repeat:-1};this.game.anims.create(o),this.animationInstanceMap.set(e.key,r)}}startAnimation(e){if(this.isSprite(e)){const t=this.getAnimation(e);t.play(e.path,!1),this.game.add.existing(t)}}stopAnimation(e){const t=this.animationInstanceMap.get(e.key);this.isSprite(e)&&t&&t.anims&&t.anims.stop()}removeAnimation(e){const t=this.animationInstanceMap.get(e.key);t&&(this.game.anims.remove(e.path),t.destroy(),this.animationInstanceMap.delete(e.key))}getAnimation(e){return bn(this.animationInstanceMap.get(e.key),`Image: ${e.path} not found`)}}function ci(e,t,a){const s=e.displayHeight/e.displayWidth;t?(e.displayWidth=t,e.displayHeight=a||t*s):(e.displayWidth=a/s,e.displayHeight=a)}function di(e,t,a){e.displayWidth>e.displayHeight?ci(e,0,a):ci(e,t)}function hi(e,t,a){e.displayWidth>e.displayHeight?ci(e,t):ci(e,0,a)}const ui=class{constructor(e,t){this.scene=e,this.awardsGetter=t,this.activePageNumber=0}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0);this.uiContainer=e;const t=Wn(this.scene,{assetKey:on.arrow.key,onUp:()=>this.nextPage(!1)}).setScale(tn.arrow.yScale,tn.arrow.yScale).setRotation(-90*Math.PI/180).setPosition(tn.arrow.x-tn.arrow.xOffset,tn.arrow.y),a=Wn(this.scene,{assetKey:on.arrow.key,onUp:()=>this.nextPage(!0)}).setScale(tn.arrow.xScale,tn.arrow.yScale).setRotation(90*Math.PI/180).setPosition(tn.arrow.x+tn.arrow.xOffset,tn.arrow.y);e.add([t,a]);const s=new Phaser.GameObjects.Sprite(this.scene,tn.preview.rect.x,tn.preview.rect.y,on.popUpFrame.key).setScale(1.2);return e.add(s),e.add(function(e){const t=new Phaser.GameObjects.Container(e,tn.preview.rect.xOffset,tn.preview.rect.yOffset),a=tn.preview.key,s=new Phaser.GameObjects.Rectangle(e,a.x,a.y,a.width,a.height,Ds.lightBlue,.1),n=new Phaser.GameObjects.Rectangle(e,a.x-a.width*s.originX*.75,a.y,a.width/4,a.height,Ds.lightBlue,.2),i=$s(e,"asset key",tn.preview.keyTagTextConfig,Ks),r=new Hs(e,tn.preview.explanation.x,tn.preview.explanation.y,Ys);return n.setInteractive(),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>r.setVisible(!0))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>r.setVisible(!1))),t.add([s,n,i,r]),t}(this.scene)),this.setPage(),e}setPage(){this.uiContainer&&(this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.createItemsContainer(),this.uiContainer.add(this.itemsContainer),this.setPreview())}setPreview(e){if(this.uiContainer){if(this.previewContainer&&this.previewContainer.destroy(),!e)return;let t;if(this.previewContainer=new Phaser.GameObjects.Container(this.scene,tn.preview.rect.xOffset,tn.preview.rect.yOffset),e.assetKey===Rs.nullInteractionId)t=$s(this.scene,"No preview available",tn.noPreviewTextConfig,Ks);else{const a=tn.preview.rect;t=new Phaser.GameObjects.Sprite(this.scene,0,0,e.assetKey),hi(t,a.dim,a.dim),t.setPosition(a.x,a.y)}const a=$s(this.scene,e.title,tn.preview.titleTextConfig,Xs),s=new Phaser.GameObjects.Text(this.scene,tn.preview.rect.x,tn.preview.rect.y+tn.preview.descText.yOffset,e.description,Zs).setOrigin(.5,0),n=!1===e.completed?"":e.assetKey,i=$s(this.scene,n,tn.preview.keyTextConfig,Ks),r=new Phaser.GameObjects.Rectangle(this.scene,tn.preview.rect.x,tn.preview.rect.y,tn.preview.rect.dim,tn.preview.rect.dim,0).setAlpha(e.completed?0:.8);this.previewContainer.add([t,r,a,s,i]),this.uiContainer.add(this.previewContainer)}}nextPage(e){const t=this.activePageNumber,a=mn(e?t+1:t-1,0,Number.MAX_SAFE_INTEGER);this.getItems(a).length>0&&(this.activePageNumber=a,this.setPage())}createItemsContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=this.getItems(this.activePageNumber),a=Fs({numOfItems:t.length,xSpacing:0,ySpacing:tn.list.ySpace});return e.add(t.map(((e,t)=>this.createItemButton(e.title,a[t][0],a[t][1]+tn.list.yStart,(()=>this.setPreview(e)),!1!==e.completed)))),e}createItemButton(e,t,a,s,n){const i=Wn(this.scene,{assetKey:on.awardsBanner.key,message:e,textConfig:tn.listTextConfig,bitMapTextStyle:Ws,onUp:s,onHoverEffect:n}).setPosition(t,a);return n||i.setAlpha(.5),i}getItems(e){const t=this.awardsGetter(),a=an(t),s=e*tn.itemsPerPage;return a.slice(s,s+tn.itemsPerPage)}};class gi{renderBackgroundLayerContainer(e){const t=ei.getInstance().getLocationAtId(e).assetKey;this.renderBackgroundImage(t)}renderBackgroundImage(e){ei.getInstance().clearSeveralLayers([hn.Background]),this.currentBackground=ei.getInstance().getAssetByKey(e);const t=ei.getInstance().getGameManager().getAnimationManager();let a;this.currentBackground&&(a=t.createImage(this.currentBackground,e),t.startAnimation(this.currentBackground),di(a,Ls.x,Ls.y),ei.getInstance().addToLayer(hn.Background,a),ei.getInstance().fadeInLayer(hn.Background))}}const pi=class{constructor(){this.bboxes=new Map,ei.getInstance().watchGameItemType(oi.boundingBoxes,this)}renderBBoxLayerContainer(e){ei.getInstance().clearSeveralLayers([hn.BBox]);const t=ei.getInstance().getGameItemsInLocation(oi.boundingBoxes,e);this.bboxes.clear(),t.map((e=>this.handleAdd(e)))}createBBox(e){const t=ei.getInstance().getGameManager(),{x:a,y:s,width:n,height:i,actionIds:r,interactionId:o}=e,l=new Phaser.GameObjects.Rectangle(t,a,s,n,i,0,0);return e.isInteractive&&l.setInteractive(),{sprite:l,clickArea:l,actionIds:r,interactionId:o}}handleAdd(e){const t=ei.getInstance().getBBoxById(e),a=this.createBBox(t);return ei.getInstance().addToLayer(hn.BBox,a.sprite),this.bboxes.set(e,a),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.bboxes.get(e);return!!t&&(this.bboxes.delete(e),t.sprite.destroy(),!0)}getActivatables(){return Array.from(this.bboxes.values())}},mi={charWidth:600,charRect:{x:{Left:350,Middle:_s.x,Right:Ls.x-350}}};class xi{constructor(){this.characterSpriteMap=new Map,ei.getInstance().watchGameItemType(oi.characters,this)}renderCharacterLayerContainer(e){const t=ei.getInstance().getGameItemsInLocation(oi.characters,e);this.characterSpriteMap.clear(),t.map((e=>this.handleAdd(e)))}createCharacterSprite(e,t,a){const s=ei.getInstance().getCharacterById(e),{defaultPosition:n,defaultExpression:i,expressions:r,scale:o}=s,l=mi.charRect.x[a||n],c=r.get(t||i),d=new Phaser.GameObjects.Image(ei.getInstance().getGameManager(),l,Ls.y,c).setOrigin(.5,1);return ci(d,mi.charWidth*o),d}handleAdd(e){const t=this.createCharacterSprite(e);return ei.getInstance().addToLayer(hn.Character,t),this.characterSpriteMap.set(e,t),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.characterSpriteMap.get(e);return!!t&&(this.characterSpriteMap.delete(e),t.destroy(),!0)}}const bi={key:Ns.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},yi={backButton:{y:.3*Ls.y},page:{yStart:.3*-Ls.y,ySpace:150},pageTextConfig:{x:.3*Ls.x,y:0,oriX:.1,oriY:.5},pageArea:{x:-869,y:-412,width:.72*Ls.x,height:.77*Ls.y}};let fi=function(e){return e.Log="Log",e.Tasks="Tasks",e.Collectibles="Collectibles",e.Achievements="Achievements",e}({});const vi=class{constructor(e,t,a){this.getSoundManager=()=>Ll.getInstance().getSoundManager(),this.scene=e,this.pages=t,this.pageManagers=a,this.pageMask=this.createPageMask(),this.pageUIContainers=new Array(t.length),this.currPageIndex=0,this.scene.getPhaseManager().addPhaseToMap(Yn.Dashboard,this)}createPageMask(){const e=new Phaser.GameObjects.Graphics(this.scene),{x:t,y:a,width:s,height:n}=yi.pageArea;return e.fillRect(t,a,s,n),e.createGeometryMask()}setPage(e){if(this.uiContainer){this.pageChosenContainer&&this.pageChosenContainer.destroy();const t=this.pageUIContainers[this.currPageIndex];t&&t.setVisible(!1),this.currPageIndex=e;let a=this.pageUIContainers[this.currPageIndex];a?a.setVisible(!0):(a=this.pageManagers[this.currPageIndex].createUIContainer(),a.setMask(this.pageMask),this.pageUIContainers[this.currPageIndex]=a,this.uiContainer.add(a));const s=this.getPageOptPositions(),n=this.currPageIndex,i=new Phaser.GameObjects.Sprite(this.scene,s[n][0],s[n][1]+yi.page.yStart,on.awardsPageChosen.key);this.pageChosenContainer=new Phaser.GameObjects.Container(this.scene,0,0,[i]),this.uiContainer.add(this.pageChosenContainer)}}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Rectangle(this.scene,0,0,Ls.x,4*Ls.y,0).setAlpha(.7).setInteractive(),a=new Phaser.GameObjects.Image(this.scene,0,0,on.awardsMenu.key);e.add([t,a]);const s=this.pages.map(((e,t)=>({text:e,callback:()=>this.setPage(t)}))),n=this.getPageOptPositions();e.add(s.map(((e,t)=>this.createPageOpt(e.text,n[t][0],n[t][1]+yi.page.yStart,e.callback))));const i=this.createPageOpt("Back",0,yi.backButton.y,(async()=>{this.scene.getPhaseManager().isCurrentPhase(Yn.Dashboard)&&await this.scene.getPhaseManager().popPhase()}));return e.add(i),e}getPageOptPositions(){return Fs({numOfItems:Object.keys(fi).length,xSpacing:0,ySpacing:yi.page.ySpace})}createPageOpt(e,t,a,s){return Wn(this.scene,{assetKey:on.awardsPage.key,message:e,textConfig:yi.pageTextConfig,bitMapTextStyle:bi,onUp:s}).setPosition(t,a)}async activateUI(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(hn.Dashboard,this.uiContainer),this.getSoundManager().playSound(dn.menuEnter.key),this.setPage(this.currPageIndex),this.uiContainer.setPosition(_s.x,-Ls.y),this.pageMask.geometryMask.setPosition(_s.x,-Ls.y),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...In,y:_s.y})}async deactivateUI(){this.uiContainer&&(this.pageUIContainers=new Array(this.pages.length),this.uiContainer.setPosition(this.uiContainer.x,this.uiContainer.y),this.getSoundManager().playSound(dn.menuExit.key),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...wn}),await pn(wn.duration),Cn(this.scene,this.uiContainer,{fadeDuration:50}))}};class ji{constructor(e){this.dialogueContent=e,this.currPart=e.keys().next().value,this.currLineNum=0}async generateNextLine(){const e=this.dialogueContent.get(this.currPart)[this.currLineNum];if(!e||!e.line)return{line:""};if(e.goto){let t=e.goto.part;if(await si.checkAllConditionsSatisfied(e.goto.conditions)||(t=e.goto.altPart),t){if(!this.dialogueContent.get(t))return{line:""};this.currPart=t,this.currLineNum=0}else this.currLineNum++}else this.currLineNum++;return e}updateCurrPart(e){this.currPart=e,this.currLineNum=0}}let Ci=function(e){return e.Left="Left",e.Middle="Middle",e.Right="Right",e}({}),Si=function(e){return e.Small="Small",e.Medium="Medium",e.Large="Large",e}({});class ki{static splitToParagraph(e){const t=[];return e.forEach((e=>{if(e.startsWith("\t")||e.startsWith("    ")){const a=e.startsWith("\t")?e.slice(1):e.slice(4);if(0===t.length)return void console.error("Unexpected tabs");t[t.length-1][1].push(a)}else t.push([e.trim(),[]])})),t}static mapByHeader(e,t){const a=new Map;if(!t(e[0]))return a.set("0",e),a;let s="";return e.forEach((e=>{if(t(e))return s=e,void a.set(e,[]);a.get(s).push(e)})),a}static splitWithLimit(e,t,a){if(a>=0){const s=e.split(t),n=s.slice(0,a);return n.push(s.slice(a).join(t)),n.map((e=>e.trim()))}return ki.splitByChar(e,t)}static splitByChar(e,t){return e.split(t).map((e=>e.trim()))}static splitToLines(e){return e.split("\n").map((e=>e.trimRight())).filter((e=>""!==e))}static splitToLinesAndRemoveComments(e){return this.removeMultiLineComments(e.split("\n"),"/*","*/").map((e=>this.removeSingleLineComment(e,"//"))).map((e=>e.trimRight())).filter((e=>""!==e))}static removeSingleLineComment(e,t,a=!0){const s=e.indexOf(t);return-1===s?e:a?e.slice(0,s):e.slice(s+t.length)}static removeMultiLineComments(e,t,a){const s=[];let n=!1;for(let i=0;i<e.length;i++){const r=e[i],o=[],l=this.findAllInstances(r,t),c=this.findAllInstances(r,a);let d=-1,h=0,u=0,g=n?[0]:[];for(;h<l.length||u<c.length;){const e=d;d=n?c[u++]+a.length:l[h++],d<=e?(console.error(`Comment mismatch: Line ${i+1},  Pos ${d+1}`),d=e):(g.push(d),n=!n),2===g.length&&(o.push([g[0],g[1]]),g=[])}1===g.length&&o.push([g[0],r.length]),s.push(this.removeCommentRegions(r,o))}return s}static removeCommentRegions(e,t){let a="",s=0;return t.forEach((t=>{a+=e.slice(s,t[0]),s=t[1]})),a+=e.slice(s,e.length),a}static findAllInstances(e,t){const a=[];let s=e.indexOf(t);for(;-1!==s;)a.push(s),s=e.indexOf(t,s+1);return a}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static toCapitalizedWords(e){return(e.match(/[A-Za-z][a-z]*/g)||[]).map(ki.capitalize).join(" ")}static toIntString(e){return Math.floor(e).toString()}static isEmptyString(e){return e===Rs.nullInteractionId}}class Ii{constructor(){this.getUsername=()=>Ll.getInstance().getAccountInfo().name}changeSpeakerTo(e){void 0!==e&&(this.currentSpeakerId&&ei.getInstance().clearSeveralLayers([hn.Speaker,hn.SpeakerBox]),this.showNewSpeaker(e))}showNewSpeaker(e){e&&(this.drawSpeakerSprite(e),this.drawSpeakerBox(e.speakerId))}drawSpeakerBox(e){if("narrator"===e)return;const t="you"===e?this.createSpeakerBox(this.getUsername(),Ci.Right):this.createSpeakerBox(ei.getInstance().getCharacterById(e).name,Ci.Left);ei.getInstance().addToLayer(hn.SpeakerBox,t)}drawSpeakerSprite({speakerId:e,speakerPosition:t,expression:a}){if(this.currentSpeakerId=e,"you"===e||"narrator"===e)return;const s=ei.getInstance().createCharacterSprite(e,a,t);ei.getInstance().addToLayer(hn.Speaker,s)}createSpeakerBox(e,t){const a=ei.getInstance().getGameManager(),s=new Phaser.GameObjects.Container(a,0,0),n=new Phaser.GameObjects.Image(a,_s.x,_s.y,on.speakerBox.key).setAlpha(.8),i=$s(a,"",On.speakerTextConfig,_n);return t===Ci.Right&&(n.displayWidth*=-1,i.x=Ls.x-i.x),s.add([n,i]),i.text=ki.capitalize(e),s}}class wi{constructor(){this.gameInputManager=new Un(ei.getInstance().getGameManager()),this.getDialogueGenerator=()=>this.dialogueGenerator,this.getDialogueRenderer=()=>this.dialogueRenderer,this.getSpeakerRenderer=()=>this.speakerRenderer,this.getInputManager=()=>this.gameInputManager,this.getUsername=()=>Ll.getInstance().getAccountInfo().name}async showDialogue(e){const t=ei.getInstance().getDialogueById(e);this.dialogueRenderer=new Gn(Ln),this.dialogueGenerator=new ji(t.content),this.speakerRenderer=new Ii,ei.getInstance().addToLayer(hn.Dialogue,this.dialogueRenderer.getDialogueContainer()),ei.getInstance().fadeInLayer(hn.Dialogue),await new Promise((e=>this.playWholeDialogue(e))),this.getDialogueRenderer().destroy(),this.getSpeakerRenderer().changeSpeakerTo(null)}async playWholeDialogue(e){await this.showNextLine(e),this.getInputManager().registerKeyboardListener(Bn.Next,"up",(async()=>{ei.getInstance().getGameManager().getPhaseManager().isCurrentPhaseTerminal()||await this.showNextLine(e)})),this.getDialogueRenderer().getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(async()=>{await this.showNextLine(e)}))}async showNextLine(e){ei.getInstance().playSound(dn.dialogueAdvance.key);const{line:t,speakerDetail:a,actionIds:s,prompt:n}=await this.getDialogueGenerator().generateNextLine(),i=t.replace("{name}",this.getUsername());if(this.getDialogueRenderer().changeText(i),this.getSpeakerRenderer().changeSpeakerTo(a),ei.getInstance().storeDialogueLine(i,a),ei.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!1),n){this.getInputManager().enableKeyboardInput(!1);const e=await qn(ei.getInstance().getGameManager(),n.promptTitle,n.choices.map((e=>e[0])));this.getInputManager().enableKeyboardInput(!0),this.getDialogueGenerator().updateCurrPart(n.choices[e][1])}await ei.getInstance().processGameActionsInSamePhase(s),ei.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!0),t||(this.getInputManager().clearKeyboardListeners([Bn.Next]),e())}}class Ai{constructor(){this.getUsername=()=>Ll.getInstance().getAccountInfo().name}storeLine(e,t){if(!t)return;this.dialogueStorage||(this.dialogueStorage=new Array);const a={speaker:this.getSpeakerName(t),line:e};this.dialogueStorage.push(a)}getSpeakerName(e){const t=null===e||void 0===e?void 0:e.speakerId;return t?"you"===t?this.getUsername():"narrator"===t?"Narrator":ei.getInstance().getCharacterById(t).name:""}clearDialogueStorage(){this.dialogueStorage=new Array}getDialogueStorage(){return this.dialogueStorage?this.dialogueStorage.map((e=>`${e.speaker}:\n${e.line}`)):new Array}}const Ti=320,Mi=50,Pi=Ti-20,Ei=Mi-20,Ni=_s.x-Ti/2,Ri=_s.y,Li=Ni+10,_i=Ri+10;function Oi(e){let t,a,s;e.load.on("start",(()=>{s=e.add.existing(Sn(e)),t=e.add.graphics(),a=e.add.graphics(),a.fillStyle(2236962,.8),a.fillRect(Ni,Ri,Ti,Mi)})),e.load.on("progress",(e=>{t.clear(),t.fillStyle(16777215,1),t.fillRect(Li,_i,Pi*e,Ei)})),e.load.on("complete",(function(){t.destroy(),a.destroy(),s.destroy()}))}class Di extends Phaser.GameObjects.Container{constructor(e,{choices:t,defaultChoiceIdx:a=0,maxXSpace:s=Ls.x,radioChoiceConfig:n={circleDim:20,checkedDim:10,outlineThickness:5},choiceTextConfig:i={x:0,y:0,oriX:.5,oriY:.5},bitmapTextStyle:r=Rs.defaultFontStyle},o,l,c=dn.radioButtonClick.key){super(e,o,l),this.activeChoiceIdx=a,this.choices=t,this.choiceTextConfig=i,this.bitmapTextStyle=r,this.radioChoiceConfig=n,this.buttonClickSoundKey=c;const d=this.getRadioButtons(t);this.buttonPositions=Bs({numOfItems:d.length,maxXSpace:s}),this.renderRadioButtons(d,this.buttonPositions,this.radioChoiceConfig),this.activate(a)}getRadioButtons(e){return e.map(((e,t)=>({text:e,callback:()=>this.activate(t)})))}renderRadioButtons(e,t,a){this.add(e.map(((e,s)=>this.createRadioButton(t[s][0],t[s][1],e.callback,a))))}createRadioButton(e,t,a,s){return new Phaser.GameObjects.Ellipse(this.scene,e,t,s.circleDim,s.circleDim,Ds.lightBlue).setStrokeStyle(s.outlineThickness,Ds.darkBlue).setInteractive({useHandCursor:!0}).addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{Ll.getInstance().getSoundManager().playSound(this.buttonClickSoundKey),a()}))}activate(e){this.activeChoiceIdx=e,this.activeChoice&&this.activeChoice.destroy(),this.activeChoice=new Phaser.GameObjects.Container(this.scene,this.buttonPositions[e][0],this.buttonPositions[e][1]);const t=$s(this.scene,this.choices[e],this.choiceTextConfig,this.bitmapTextStyle),a=new Phaser.GameObjects.Ellipse(this.scene,0,0,this.radioChoiceConfig.checkedDim,this.radioChoiceConfig.checkedDim,Ds.darkBlue);this.activeChoice.add([t,a]),this.add(this.activeChoice)}getValueIdx(){return this.activeChoiceIdx}getChoices(){return this.choices}getChosenChoice(){return this.activeChoiceIdx<this.choices.length?this.choices[this.activeChoiceIdx]:Rs.nullInteractionId}}const Gi=Di,Bi={key:Ns.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ui={key:Ns.zektonFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Fi={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},zi={optHeaderTextConfig:{x:.25*Ls.x,y:0,oriX:.5,oriY:.75},opt:{x:140,xSpace:.4*Ls.x,ySpace:.7*Ls.y},radioButtonsTextConfig:{x:0,y:-50,oriX:.5,oriY:.25},volContainerOpts:["0","0.25","0.5","1.0","1.5","2.0"]},Vi={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Hi={key:Ns.zektonFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},$i={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Wi={button:{y:.15*Ls.y},escapeOptTextConfig:{x:0,y:0,oriX:.37,oriY:.75},settings:{yOffset:.1*-_s.y,ySpace:.3*Ls.y},settingsTextConfig:{x:.38*Ls.x,y:.1*-_s.y,oriX:0,oriY:.5},radioButtons:{xSpace:.2*Ls.x},radioChoiceTextConfig:{x:0,y:-45,oriX:.5,oriY:.25},volOpt:{x:.05*Ls.x}};const Xi=class{constructor(e){this.getSoundManager=()=>Ll.getInstance().getSoundManager(),this.getSettingsSaveManager=()=>Ll.getInstance().getSaveManager(),this.scene=e,this.scene.getPhaseManager().addPhaseToMap(Yn.EscapeMenu,this)}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Image(this.scene,_s.x,_s.y,on.escapeMenuBackground.key).setDisplaySize(Ls.x,Ls.y).setInteractive({pixelPerfect:!0});e.add(t);const a=this.getSettings(),s=Bs({direction:Gs.Column,numOfItems:a.length,maxYSpace:Wi.settings.ySpace});e.add(a.map(((e,t)=>$s(this.scene,e,{...Wi.settingsTextConfig,y:s[t][1]+Wi.settingsTextConfig.y},$i))));const{bgmVolume:n,sfxVolume:i}=this.getSettingsSaveManager().getSettings(),r=zi.volContainerOpts.findIndex((e=>parseFloat(e)===i)),o=zi.volContainerOpts.findIndex((e=>parseFloat(e)===n));this.sfxVolumeRadioButtons=this.createSettingsRadioOptions(r,s[0][1]),this.bgmVolumeRadioButtons=this.createSettingsRadioOptions(o,s[1][1]),e.add([this.sfxVolumeRadioButtons,this.bgmVolumeRadioButtons]);const l=this.getOptButtons(),c=Bs({numOfItems:l.length});return e.add(l.map(((e,t)=>this.createEscapeOptButton(e.text,c[t][0],c[t][1]+Wi.button.y,e.callback)))),e}getSettings(){return["SFX","BGM"]}createSettingsRadioOptions(e,t){return new Gi(this.scene,{choices:zi.volContainerOpts,defaultChoiceIdx:e,maxXSpace:Wi.radioButtons.xSpace,radioChoiceConfig:{circleDim:15,checkedDim:10,outlineThickness:3},choiceTextConfig:Wi.radioChoiceTextConfig,bitmapTextStyle:Hi},Wi.volOpt.x,-_s.y+t+Wi.settings.yOffset)}getOptButtons(){return[{text:"Main Menu",callback:()=>{this.cleanUp(),Ll.getInstance().isGameType(Rl.Simulator)?this.scene.scene.start("GameSimulatorMenu"):this.scene.scene.start("MainMenu")}},{text:"Continue",callback:async()=>{this.scene.getPhaseManager().isCurrentPhase(Yn.EscapeMenu)&&await this.scene.getPhaseManager().popPhase()}},{text:"Apply Settings",callback:()=>this.applySettings()}]}createEscapeOptButton(e,t,a,s){return Wn(this.scene,{assetKey:on.mediumButton.key,message:e,textConfig:Wi.escapeOptTextConfig,bitMapTextStyle:Vi,onUp:s}).setPosition(t,a)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t={bgmVolume:this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1,sfxVolume:e};await this.getSettingsSaveManager().saveSettings(t),Ll.getInstance().getSoundManager().applyUserSettings(t)}cleanUp(){this.scene.getInputManager().clearListeners(),this.scene.getLayerManager().clearAllLayers()}activateUI(){const e=this.createUIContainer();this.getSoundManager().playSound(dn.menuEnter.key),this.scene.getLayerManager().addToLayer(hn.Escape,e)}deactivateUI(){this.getSoundManager().playSound(dn.menuExit.key),this.scene.getLayerManager().clearSeveralLayers([hn.Escape])}};const Ki=class{constructor(e){this.layers=new Map(un.map((t=>[t,new Phaser.GameObjects.Container(e,0,0)]))),this.layers.forEach((t=>e.add.existing(t)))}getLayer(e){return this.layers.get(e)}hideLayer(e){const t=this.layers.get(e);t&&t.setVisible(!1)&&t.setAlpha(0)}showLayer(e){const t=this.layers.get(e);t&&t.setVisible(!0)&&t.setAlpha(1)}async fadeInLayer(e,t=Rs.fadeDuration){const a=ei.getInstance().getGameManager(),s=this.layers.get(e);s.setVisible(!0),s.setAlpha(0),a.tweens.add(jn([s],t)),await pn(t)}async fadeOutLayer(e,t=Rs.fadeDuration){const a=ei.getInstance().getGameManager(),s=this.layers.get(e);s.setVisible(!0),s.setAlpha(1),a.tweens.add(vn([s],t)),await pn(t)}addToLayer(e,t){const a=this.layers.get(e);a&&a.add(t)}clearSeveralLayers(e){e.forEach((e=>this.clearLayerContents(e)))}clearAllLayers(){this.layers.forEach(((e,t)=>this.clearLayerContents(t)))}clearLayerContents(e){const t=this.layers.get(e);if(t)for(;t.list.length;)t.list[0].destroy()}},Zi={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},qi=.251*Ls.x,Yi={logTextConfig:{x:-.44*Ls.x,y:-.378*Ls.y,oriX:0,oriY:0},textMaxWidth:.68*Ls.x,logHeight:.7632*Ls.y,scrollbarTrack:{x:qi,y:.005*Ls.y,width:7,height:.73*Ls.y,color:5592405},scrollbarThumb:{x:qi,width:7,color:8947848},scrollSpeed:.5};const Ji=class{constructor(e){this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=ei.getInstance().getDialogueStorage();if(0===t.length)return e;const a=$s(this.scene,t.join("\n\n"),Yi.logTextConfig,Zi).setMaxWidth(Yi.textMaxWidth),s=Yi.logTextConfig.y-Math.max(a.height-Yi.logHeight,0);a.y=s,e.add(a);const n=new Phaser.GameObjects.Rectangle(this.scene,Yi.scrollbarTrack.x,Yi.scrollbarTrack.y,Yi.scrollbarTrack.width,Yi.scrollbarTrack.height,Yi.scrollbarTrack.color),i=Math.max(Yi.logHeight/a.height*Yi.scrollbarTrack.height,4*Yi.scrollbarThumb.width),r=Yi.scrollbarTrack.y+Yi.scrollbarTrack.height/2-i/2,o=(Yi.scrollbarTrack.height-i)/(Yi.logTextConfig.y-s),l=new Phaser.GameObjects.Rectangle(this.scene,Yi.scrollbarThumb.x,r,Yi.scrollbarThumb.width,i,Yi.scrollbarThumb.color);e.add(n),e.add(l),a.height<=Yi.logHeight&&(n.setVisible(!1),l.setVisible(!1));const{x:c,y:d,width:h,height:u}=yi.pageArea,g=new Phaser.GameObjects.Zone(this.scene,c+h/2,d+u/2,h,u);return g.setInteractive(),g.on("wheel",((e,t,n,i)=>{a.y=mn(a.y-n*Yi.scrollSpeed,s,Yi.logTextConfig.y),l.y=r-(a.y-s)*o})),e.add(g),e}};let Qi=function(e){return e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu",e}({});const er={Move:Yn.Move,Explore:Yn.Explore,Talk:Yn.Talk,Menu:Yn.Menu};class tr{constructor(e,t,a,s,n,i){this.scene=e,this.container=new Phaser.GameObjects.Container(e,t,a),this.imageGlow=new Phaser.GameObjects.Image(e,0,0,s).setAlpha(0).setBlendMode(Phaser.BlendModes.ADD),this.clickArea=new Phaser.GameObjects.Image(e,0,0,s).setAlpha(.01).setInteractive({pixelPerfect:!0});const r=ei.getInstance().getGameMap().getMapAssets().get(s),o=ei.getInstance().getGameManager().getAnimationManager();if(r){const e=o.createImage(r,s);switch(null===r||void 0===r?void 0:r.type){case nn.Sprite:this.clickArea.setAlpha(0),o.startAnimation(r);break;case nn.Image:n&&(ci(e,n,i),ci(this.imageGlow,n,i),ci(this.clickArea,n,i))}this.container.add([e,this.imageGlow,this.clickArea])}}startGlow(){this.glowClearer&&this.glowClearer(),this.glowClearer=kn(this.scene,this.imageGlow),this.imageGlow.setAlpha(1)}clearGlow(){this.glowClearer&&this.glowClearer(),this.imageGlow.setAlpha(0)}startBlink(){this.blinkClearer=kn(this.scene,this.getContainer())}clearBlink(){this.getContainer().setAlpha(1),this.blinkClearer&&this.blinkClearer()}getContainer(){return this.container}getClickArea(){return this.clickArea}}const ar=class{constructor(){this.objects=new Map,ei.getInstance().watchGameItemType(oi.objects,this)}renderObjectsLayerContainer(e){ei.getInstance().clearSeveralLayers([hn.Objects]);const t=ei.getInstance().getGameItemsInLocation(oi.objects,e);this.objects.clear(),t.map((e=>this.handleAdd(e)))}makeObjectGlow(e,t){const a=this.objects.get(e);a&&(t?a.sprite.startGlow():a.sprite.clearGlow())}makeObjectBlink(e,t){const a=this.objects.get(e);a&&(t?a.sprite.startBlink():a.sprite.clearBlink())}createObject(e){const t=ei.getInstance().getGameManager(),{assetKey:a,x:s,y:n,width:i,height:r,actionIds:o,interactionId:l}=e,c=new tr(t,s,n,a,i,r);return{sprite:c,clickArea:c.getClickArea(),actionIds:o,interactionId:l}}handleAdd(e){const t=ei.getInstance().getObjectById(e),a=this.createObject(t);return ei.getInstance().addToLayer(hn.Objects,a.sprite.getContainer()),this.objects.set(e,a),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.objects.get(e);return!!t&&(this.objects.delete(e),t.sprite.getContainer().destroy(),!0)}getActivatables(){return Array.from(this.objects.values())}};class sr{constructor(e,t){this.phaseStack=[Yn.None],this.phaseMap=e,this.interruptCheckCallback=()=>!1,this.interruptTransitionCallback=async()=>Rs.nullFunction(),this.transitionCallback=Rs.nullFunction,this.inputManager=t}addPhaseToMap(e,t){this.phaseMap.set(e,t)}setInterruptCheckCallback(e){this.interruptCheckCallback=e}setInterruptCallback(e){this.interruptTransitionCallback=e}setCallback(e){this.transitionCallback=e}async popPhase(){const e=this.phaseStack.pop();await this.executePhaseTransition(e,this.getCurrentPhase())}async pushPhase(e){const t=this.getCurrentPhase();e!==t&&(this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async swapPhase(e){const t=this.getCurrentPhase();e!==t&&(this.phaseStack.pop(),this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async executePhaseTransition(e,t){if(this.inputManager.enableKeyboardInput(!1),this.inputManager.enableMouseInput(!1),await this.phaseMap.get(e).deactivateUI(),this.interruptCheckCallback(e,t))return this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0),void await this.interruptTransitionCallback(e,t);this.transitionCallback(e,t),await this.phaseMap.get(t).activateUI(),this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0)}isCurrentPhase(e){return this.getCurrentPhase()===e}isCurrentPhaseTerminal(){return Object.values(Jn).includes(this.getCurrentPhase())}getCurrentPhase(){return this.phaseStack.length||(this.phaseStack=[Yn.None]),this.phaseStack[this.phaseStack.length-1]}}const nr={image:{xOffset:20,yOffset:20},rect:{x:{Left:400,Middle:_s.x,Right:Ls.x-400},y:{Small:325,Medium:350,Large:420},scale:{Small:.7,Medium:1,Large:1.5},width:280,height:280},tweenDuration:300};const ir=class{constructor(){this.currPopUp=new Map}async displayPopUp(e,t,a=Rs.popUpDuration,s=Si.Medium){this.destroyPopUp(t);const n=ei.getInstance().getGameManager(),i=new Phaser.GameObjects.Container(n,0,0),r=new Phaser.GameObjects.Image(n,nr.rect.x[t],nr.rect.y[s],on.popUpFrame.key).setScale(nr.rect.scale[s]),o=this.getAssetKey(e);if(!o)return;const l=new Phaser.GameObjects.Image(n,nr.rect.x[t]+nr.image.xOffset,nr.rect.y[s]+nr.image.yOffset,o);hi(l,nr.rect.width*nr.rect.scale[s],nr.rect.height*nr.rect.scale[s]),i.add([r,l]),this.currPopUp.set(t,i),ei.getInstance().addToLayer(hn.PopUp,i),ei.getInstance().playSound(dn.popUpEnter.key),i.setActive(!0),i.setVisible(!0),i.setScale(1,0),n.tweens.add(((e,t=500)=>({scaleY:1,targets:e,duration:t,ease:"Power1"}))([i],nr.tweenDuration)),await pn(nr.tweenDuration),setTimeout((()=>this.destroyPopUp(t)),a)}destroyAllPopUps(){this.currPopUp.forEach(((e,t,a)=>{this.destroyPopUp(t)}))}async destroyPopUp(e){const t=this.currPopUp.get(e);t&&(ei.getInstance().getGameManager().tweens.add(((e,t=500)=>({scaleY:0,targets:e,duration:t,ease:"Power1"}))([t],nr.tweenDuration)),await pn(nr.tweenDuration),t.setVisible(!1),t.setActive(!1),t.destroy(),this.currPopUp.delete(e),ei.getInstance().playSound(dn.popUpExit.key))}getAssetKey(e){const t=ei.getInstance().getGameMap().getObjectPropMap().get(e);if(t)return t.assetKey}};const rr=()=>({gameSaveStates:{},userSaveState:{collectibles:[],settings:{bgmVolume:1,sfxVolume:1},recentlyPlayedCheckpoint:[-1,-1],largestCompletedChapter:-1}}),or=()=>({lastCheckpointPlayed:0,currentLocation:void 0,currentPhase:Yn.Menu,chapterNewlyCompleted:!1,incompleteTasks:[],completedTasks:[],completedObjectives:[],triggeredInteractions:[],triggeredStateChangeActions:[]});function lr(e){return Array.from(e).filter((([e,t])=>t)).map((([e])=>e))}const cr=class{constructor(e){this.getGameMap=()=>this.gameMap,this.getCharacterAtId=e=>bn(this.gameMap.getCharacterMap().get(e)),this.getSaveManager=()=>Ll.getInstance().getSaveManager(),this.getChapterNewlyCompleted=()=>this.chapterNewlyCompleted,this.subscribers=new Map,this.gameMap=e.map,this.checkpointObjective=e.objectives,this.checkpointTask=e.tasks,this.chapterNewlyCompleted=!1,this.updatedLocations=new Set(this.gameMap.getLocationIds()),this.triggeredInteractions=new Map,this.triggeredStateChangeActions=[],this.loadStatesFromSaveManager()}loadStatesFromSaveManager(){this.triggeredStateChangeActions=this.getSaveManager().getTriggeredStateChangeActions(),this.getSaveManager().getTriggeredInteractions().forEach((e=>this.triggerInteraction(e))),this.getSaveManager().getCompletedObjectives().forEach((e=>this.checkpointObjective.setObjective(e,!0))),this.getSaveManager().getCompletedTasks().forEach((e=>{this.checkpointTask.setTask(e,!0),this.checkpointTask.showTask(e)})),this.getSaveManager().getIncompleteTasks().forEach((e=>{this.checkpointTask.setTask(e,!1),this.checkpointTask.showTask(e)})),this.chapterNewlyCompleted=this.getSaveManager().getChapterNewlyCompleted()}watchGameItemType(e,t){this.subscribers.set(e,t)}getSubscriberForItemType(e){return this.subscribers.get(e)}triggerInteraction(e){this.triggeredInteractions.set(e,!0)}triggerStateChangeAction(e){this.triggeredStateChangeActions.push(e)}hasTriggeredInteraction(e){return this.triggeredInteractions.get(e)}addLocationNotif(e){this.updatedLocations.add(e)}removeLocationNotif(e){this.updatedLocations.delete(e)}hasLocationNotif(e){return this.updatedLocations.has(e)}isCurrentLocation(e){return e===ei.getInstance().getCurrLocId()}getLocationModes(e){return Array.from(this.gameMap.getLocationAtId(e).modes)||[]}addLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.add(t),!this.isCurrentLocation(e)&&this.addLocationNotif(e)}removeLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.delete(t),!this.isCurrentLocation(e)&&this.addLocationNotif(e)}getGameItemsInLocation(e,t){const a=this.gameMap.getLocationAtId(t)[e];return void 0==a?[]:Array.from(a)}addItem(e,t,a){var s;const n=this.gameMap.getLocationAtId(t)[e];null===n||void 0===n||n.add(a),this.isCurrentLocation(t)?null===(s=this.getSubscriberForItemType(e))||void 0===s||s.handleAdd(a):this.addLocationNotif(t)}removeItem(e,t,a){var s;const n=this.gameMap.getLocationAtId(t)[e];null===n||void 0===n||n.delete(a),this.isCurrentLocation(t)?null===(s=this.getSubscriberForItemType(e))||void 0===s||s.handleDelete(a):this.addLocationNotif(t)}setObjProperty(e,t){this.gameMap.setItemInMap(oi.objects,e,t),this.gameMap.getLocations().forEach(((t,a)=>{var s;t.objects.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(oi.objects))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}setBBoxProperty(e,t){this.gameMap.setItemInMap(oi.boundingBoxes,e,t),this.gameMap.getLocations().forEach(((t,a)=>{var s;t.boundingBoxes.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(oi.boundingBoxes))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}moveCharacter(e,t,a){this.getCharacterAtId(e).defaultPosition=a,this.gameMap.getLocations().forEach(((t,a)=>{t.characters.has(e)&&this.removeItem(oi.characters,a,e)})),this.addItem(oi.characters,t,e)}updateCharacter(e,t){this.getCharacterAtId(e).defaultExpression=t,this.gameMap.getLocations().forEach(((t,a)=>{var s;t.characters.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(oi.characters))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}areAllObjectivesComplete(){return this.checkpointObjective.isAllComplete()}isObjectiveComplete(e){return this.checkpointObjective.getObjectiveState(e)}areObjectivesComplete(e){let t=!0;return e.forEach((e=>t=t&&this.isObjectiveComplete(e))),t}completeObjective(e){this.checkpointObjective.setObjective(e,!0)}isTaskComplete(e){return this.checkpointTask.getTaskState(e)}areTasksComplete(e){let t=!0;return e.forEach((e=>t=t&&this.isTaskComplete(e))),t}completeTask(e){this.checkpointTask.setTask(e,!0)}showTask(e){this.checkpointTask.showTask(e)}getAllVisibleTaskData(){return this.checkpointTask.getAllVisibleTaskData()}getCompletedObjectives(){return lr(this.checkpointObjective.getObjectives())}getCompletedTasks(){return lr(this.checkpointTask.getAllTasks())}getIncompleteTasks(){return this.checkpointTask.getAllIncompleteTasks()}getTriggeredInteractions(){return lr(this.triggeredInteractions)}getTriggeredStateChangeActions(){return this.triggeredStateChangeActions}},dr={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},hr=.251*Ls.x,ur={taskTextConfig:{x:-.42*Ls.x,y:-.378*Ls.y,oriX:0,oriY:0},textMaxWidth:.66*Ls.x,checkMark:{x:-.202*Ls.x,y:-.369*Ls.y,imageUrl:on.talkOptCheck.key},logHeight:.7632*Ls.y,scrollbarTrack:{x:hr,y:.005*Ls.y,width:7,height:.73*Ls.y,color:5592405},scrollbarThumb:{x:hr,width:7,color:8947848},scrollSpeed:.5};const gr=class{constructor(e){this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=ei.getInstance().getAllVisibleTaskData(),a=new Phaser.GameObjects.Container(this.scene,0,0);let s=0;if(0===t.length){const e=$s(this.scene,"No tasks available.",ur.taskTextConfig,dr).setMaxWidth(ur.textMaxWidth);a.add(e),s=e.height}else for(let m=0;m<t.length;m++){const e=t[m][0];if(t[m][1]){const e=new Phaser.GameObjects.Image(this.scene,ur.checkMark.x,ur.checkMark.y+s,ur.checkMark.imageUrl);a.add(e)}const n=$s(this.scene,e.title,{...ur.taskTextConfig,y:ur.taskTextConfig.y+s},dr).setMaxWidth(ur.textMaxWidth),i=$s(this.scene,"_",{...ur.taskTextConfig,y:ur.taskTextConfig.y+s},dr);i.setScale(n.width/i.width,1),a.add(n),a.add(i),s+=n.height;const r=$s(this.scene,e.description+(m<t.length-1?"\n ":""),{...ur.taskTextConfig,y:ur.taskTextConfig.y+s},dr).setMaxWidth(ur.textMaxWidth);a.add(r),s+=r.height}const n=-Math.max(s-ur.logHeight,0);a.y=n,e.add(a);const i=new Phaser.GameObjects.Rectangle(this.scene,ur.scrollbarTrack.x,ur.scrollbarTrack.y,ur.scrollbarTrack.width,ur.scrollbarTrack.height,ur.scrollbarTrack.color),r=Math.max(ur.logHeight/s*ur.scrollbarTrack.height,4*ur.scrollbarThumb.width),o=ur.scrollbarTrack.y+ur.scrollbarTrack.height/2-r/2,l=(ur.scrollbarTrack.height-r)/-n,c=new Phaser.GameObjects.Rectangle(this.scene,ur.scrollbarThumb.x,o,ur.scrollbarThumb.width,r,ur.scrollbarThumb.color);e.add(i),e.add(c),s<=ur.logHeight&&(i.setVisible(!1),c.setVisible(!1));const{x:d,y:h,width:u,height:g}=yi.pageArea,p=new Phaser.GameObjects.Zone(this.scene,d+u/2,h+g/2,u,g);return p.setInteractive(),p.on("wheel",((e,t,s,i)=>{a.y=mn(a.y-s*ur.scrollSpeed,n,0),c.y=o-(a.y-n)*l})),e.add(p),e}},pr=[{assetKey:on.gear.key,onUp:e=>async()=>{const t=e.getPhaseManager();t.isCurrentPhase(Yn.EscapeMenu)?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase(Yn.EscapeMenu):await t.pushPhase(Yn.EscapeMenu)}},{assetKey:on.journal.key,onUp:e=>async()=>{const t=e.getPhaseManager();t.isCurrentPhase(Yn.Dashboard)?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase(Yn.Dashboard):await t.pushPhase(Yn.Dashboard)}}],mr={firstButton:{x:Ls.x-37,y:37},xOffset:64,buttonConfigs:pr};const xr=class{constructor(e){this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0);return e.add(mr.buttonConfigs.map(((e,t)=>this.createToolbarButton(mr.firstButton.x-mr.xOffset*t,mr.firstButton.y,e)))),e}createToolbarButton(e,t,a){return Wn(this.scene,{assetKey:a.assetKey,onUp:a.onUp(this.scene)}).setPosition(e,t)}async renderToolbarContainer(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(hn.UI,this.uiContainer)}},br=.975*-_s.y,yr={key:Ns.zektonDarkFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class fr extends Phaser.GameObjects.Container{constructor(e,t){super(e,0,0),this.renderBackButton(t)}renderBackButton(e){const t=Wn(this.scene,{assetKey:on.topButton.key,message:"Back",textConfig:{x:0,y:br,oriX:.5,oriY:.25},bitMapTextStyle:yr,onUp:e}).setPosition(_s.x,_s.y);this.add(t)}}const vr=fr,jr={normal:`url(${xn("/ui/magnifying.png",!1)}), pointer`,hover:`url(${xn("/ui/magnifying_trigg.png",!1)}), pointer`,checked:`url(${xn("/ui/magnifying_check.png",!1)}), pointer`};const Cr=class{createUIContainer(){const e=ei.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new vr(e,(async()=>await ei.getInstance().swapPhase(Yn.Menu)));return t.add(a),t}async activateUI(){const e=ei.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),ei.getInstance().addToLayer(hn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-Ls.y),this.enableInteractions(),e.tweens.add({targets:this.uiContainer,...In}),ei.getInstance().setDefaultCursor(jr.normal),ei.getInstance().playSound(dn.modeEnter.key)}async deactivateUI(){const e=ei.getInstance().getGameManager();ei.getInstance().setDefaultCursor(Rs.defaultCursor),this.disableInteractions(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...wn}),await pn(500),Cn(e,this.uiContainer))}enableInteractions(){ei.getInstance().getAllActivatables().forEach((e=>{e.actionIds&&e.actionIds.length&&(e.clickArea.on("pointerout",(()=>this.explorePointerOut())),e.clickArea.on("pointerover",(()=>this.explorePointerOver(e.interactionId))),e.clickArea.on("pointerup",(async()=>{this.explorePointerUp(e.interactionId),await ei.getInstance().processGameActions(e.actionIds)})))}))}disableInteractions(){ei.getInstance().getAllActivatables().forEach((e=>{e.clickArea.off("pointerout"),e.clickArea.off("pointerover"),e.clickArea.off("pointerup")}))}explorePointerOver(e){ei.getInstance().hasTriggeredInteraction(e)?ei.getInstance().setDefaultCursor(jr.checked):ei.getInstance().setDefaultCursor(jr.hover)}explorePointerOut(){ei.getInstance().setDefaultCursor(jr.normal)}explorePointerUp(e){ei.getInstance().setDefaultCursor(Rs.defaultCursor),ei.getInstance().triggerInteraction(e),ei.getInstance().setDefaultCursor(jr.normal)}},Sr={key:Ns.zektonFont.key,size:45,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},kr={button:{yOffset:.3*Ls.y},entryTweenProps:{y:0,duration:500,ease:"Power2"},exitTweenProps:{y:.4*Ls.y,duration:300,ease:"Power2"}},Ir=0,wr=15,Ar=20,Tr=4,Mr=-68,Pr=20,Er=-30,Nr=20,Rr=12380122;const Lr=class{getLatestLocationModes(){const e=ei.getInstance().getCurrLocId();let t=ei.getInstance().getLocationModes(e);return 0===ei.getInstance().getGameItemsInLocation(oi.talkTopics,e).length&&(t=t.filter((e=>e!==Qi.Talk))),t}createUIContainer(){const e=ei.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Image(e,_s.x,_s.y,on.modeMenuBanner.key);t.add(a);const s=this.getLatestLocationModes(),n=this.getModeButtons(s),i=Bs({numOfItems:n.length}),r=n.map(((e,t)=>this.createLine(i[t][0],i[t][1]+kr.button.yOffset+Nr,e)));return t.add(n.map(((e,t)=>this.createModeButton(e.text,i[t][0],i[t][1]+kr.button.yOffset,e.callback)))),t.add(r),t}createLine(e,t,a){const s=ei.getInstance().getGameManager();a.text===Qi.Explore?e+=Mr:a.text===Qi.Move?e+=Pr:e+=Er;const n=s.add.line(Ir,wr,e,t,e+Ar,t,Rr);return n.setLineWidth(Tr),n}getModeButtons(e){return e.sort().map((e=>({text:e,callback:async()=>await ei.getInstance().swapPhase(er[e])})))}createModeButton(e,t,a,s){return Wn(ei.getInstance().getGameManager(),{assetKey:on.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.25},bitMapTextStyle:Sr,onUp:s}).setPosition(t,a)}async activateUI(){const e=ei.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),ei.getInstance().addToLayer(hn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,Ls.y),e.tweens.add({targets:this.uiContainer,...kr.entryTweenProps}),await pn(500),ei.getInstance().playSound(dn.modeEnter.key)}async deactivateUI(){const e=ei.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...kr.exitTweenProps}),await pn(500),Cn(e,this.uiContainer))}},_r={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Or={button:{xOffSet:.25*Ls.x,ySpace:.8*Ls.y},preview:{rect:{x:.3125*Ls.x,y:.515*Ls.y,width:.473*Ls.x,height:.56*Ls.y},frame:{x:.3*Ls.x}}};const Dr=class{setPreview(e,t){e.setTexture(t).setDisplaySize(Or.preview.rect.width,Or.preview.rect.height).setPosition(Or.preview.rect.x,Or.preview.rect.y)}getLatestNavigations(){return ei.getInstance().getGameItemsInLocation(oi.navigation,ei.getInstance().getCurrLocId())}createUIContainer(){const e=ei.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Sprite(e,Or.preview.frame.x,_s.y,on.locationPreviewFrame.key),s=new Phaser.GameObjects.Sprite(e,_s.x,_s.y,on.locationPreviewFill.key);t.add([a,s]);const n=this.getLatestNavigations(),i=this.getMoveButtons(n,s),r=Bs({numOfItems:i.length,numItemLimit:1,maxYSpace:Or.button.ySpace});t.add(i.map(((e,t)=>this.createMoveButton($n(t+1,e.text),r[t][0]+Or.button.xOffSet,r[t][1],e.callback,e.onHover,e.onOut))));const o=new vr(e,(async()=>await ei.getInstance().swapPhase(Yn.Menu)));return t.add(o),this.setPreview(s,on.defaultLocationImg.key),t}getMoveButtons(e,t){const a=e=>this.setPreview(t,e),s=()=>this.setPreview(t,on.defaultLocationImg.key);return e.map((e=>{const t=ei.getInstance().getLocationAtId(e);return{text:t.name,callback:async()=>{await ei.getInstance().swapPhase(Yn.Sequence),await ei.getInstance().changeLocationTo(e)},onHover:()=>a(t.previewKey||t.assetKey),onOut:()=>s()}}))}createMoveButton(e,t,a,s,n,i){return Wn(ei.getInstance().getGameManager(),{assetKey:on.longButton.key,message:e,textConfig:{x:0,y:0,oriX:.4,oriY:.15},bitMapTextStyle:_r,onUp:s,onHover:n,onOut:i}).setPosition(t,a)}registerKeyboardListener(){const e=ei.getInstance().getGameManager().getInputManager();this.getLatestNavigations().forEach(((t,a)=>{e.registerKeyboardListener(Bn.Options[a],"up",(async()=>{await ei.getInstance().swapPhase(Yn.Sequence),await ei.getInstance().changeLocationTo(t)}))}))}async activateUI(){const e=ei.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),ei.getInstance().addToLayer(hn.UI,this.uiContainer),this.registerKeyboardListener(),this.uiContainer.setPosition(this.uiContainer.x,-Ls.y),e.tweens.add({targets:this.uiContainer,...In}),ei.getInstance().playSound(dn.modeEnter.key)}removeKeyboardListener(){ei.getInstance().getGameManager().getInputManager().clearKeyboardListeners(Bn.Options)}async deactivateUI(){const e=ei.getInstance().getGameManager();this.removeKeyboardListener(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...wn}),await pn(500),Cn(e,this.uiContainer))}};const Gr=class{activateUI(){}deactivateUI(){}},Br={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ur={button:{ySpace:.7*Ls.y}};const Fr=class{getLatestTalkTopics(){return ei.getInstance().getGameItemsInLocation(oi.talkTopics,ei.getInstance().getCurrLocId())}createUIContainer(){const e=ei.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=this.getLatestTalkTopics(),s=this.getTalkTopicButtons(a),n=Bs({direction:Gs.Column,numOfItems:s.length,maxYSpace:Ur.button.ySpace});t.add(s.map(((e,t)=>this.createTalkTopicButton($n(t+1,e.text),n[t][0],n[t][1],e.callback)))),s.forEach(((a,s)=>{const i=new Phaser.GameObjects.Sprite(e,n[s][0],n[s][1],on.talkOptCheck.key);!!a.interactionId&&ei.getInstance().hasTriggeredInteraction(a.interactionId)&&t.add(i)}));const i=new vr(e,(async()=>await ei.getInstance().swapPhase(Yn.Menu)));return t.add(i),t}getTalkTopicButtons(e){return e.map((e=>({text:bn(ei.getInstance().getDialogueById(e)).title,callback:async()=>{ei.getInstance().triggerInteraction(e),await ei.getInstance().showDialogue(e)},interactionId:e})))}createTalkTopicButton(e,t,a,s){return Wn(ei.getInstance().getGameManager(),{assetKey:on.talkOptButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.2},bitMapTextStyle:Br,onUp:s}).setPosition(t,a)}registerKeyboardListener(){const e=this.getLatestTalkTopics(),t=ei.getInstance().getGameManager().getInputManager();e.forEach(((e,a)=>{t.registerKeyboardListener(Bn.Options[a],"up",(async()=>{ei.getInstance().triggerInteraction(e),await ei.getInstance().showDialogue(e)}))}))}async activateUI(){const e=ei.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),ei.getInstance().addToLayer(hn.UI,this.uiContainer),this.registerKeyboardListener(),this.uiContainer.setPosition(this.uiContainer.x,-Ls.y),e.tweens.add({targets:this.uiContainer,...In}),ei.getInstance().playSound(dn.modeEnter.key)}removeKeyboardListener(){ei.getInstance().getGameManager().getInputManager().clearKeyboardListeners(Bn.Options)}async deactivateUI(){const e=ei.getInstance().getGameManager();this.removeKeyboardListener(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...wn}),await pn(500),Cn(e,this.uiContainer))}};class zr extends Phaser.Scene{constructor(){super("GameManager"),this.getSaveManager=()=>Ll.getInstance().getSaveManager(),this.getStateManager=()=>bn(this.stateManager),this.getObjectManager=()=>bn(this.objectManager),this.getDialogueManager=()=>bn(this.dialogueManager),this.getCharacterManager=()=>bn(this.characterManager),this.getBBoxManager=()=>bn(this.boundingBoxManager),this.getActionManager=()=>bn(this.actionManager),this.getInputManager=()=>bn(this.inputManager),this.getLayerManager=()=>bn(this.layerManager),this.getPhaseManager=()=>bn(this.phaseManager),this.getBackgroundManager=()=>bn(this.backgroundManager),this.getAnimationManager=()=>bn(this.animationManager),this.getPopupManager=()=>bn(this.popUpManager),this.getEscapeManager=()=>bn(this.escapeManager),this.getCollectibleManager=()=>bn(this.collectibleManager),this.getAchievementManager=()=>bn(this.achievementManager),this.getLogManager=()=>bn(this.logManager),this.getDialogueStorageManager=()=>bn(this.dialogueStorageManager),this.getToolbarManager=()=>bn(this.toolbarManager),this.getTaskLogManager=()=>bn(this.taskLogManager),this.getDashboardManager=()=>bn(this.dashboardManager),this.currentLocationId=Rs.nullInteractionId,this.hasTransitioned=!1}init({gameCheckpoint:e,continueGame:t,chapterNum:a,checkpointNum:s}){ei.getInstance().setGameManager(this),Ll.getInstance().setCurrentSceneRef(this),this.getSaveManager().registerGameInfo(a,s,t),this.currentLocationId=this.getSaveManager().getLoadedLocation()||e.startingLoc,this.hasTransitioned=!1,this.stateManager=new cr(e),this.layerManager=new Ki(this),this.inputManager=new Un(this),this.phaseManager=new sr(new Map([[Yn.Menu,new Lr],[Yn.Move,new Dr],[Yn.Explore,new Cr],[Yn.Talk,new Fr],[Yn.Sequence,new Gr],[Yn.None,new Gr]]),this.inputManager),this.characterManager=new xi,this.objectManager=new ar,this.dialogueManager=new wi,this.actionManager=new ri,this.boundingBoxManager=new pi,this.backgroundManager=new gi,this.animationManager=new li,this.popUpManager=new ir,this.escapeManager=new Xi(this),this.collectibleManager=new ui(this,Ll.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new ui(this,Ll.getInstance().getUserStateManager().getAchievements),this.logManager=new Ji(this),this.dialogueStorageManager=new Ai,this.toolbarManager=new xr(this),this.taskLogManager=new gr(this),this.dashboardManager=new vi(this,[fi.Log,fi.Tasks,fi.Collectibles,fi.Achievements],[this.logManager,this.taskLogManager,this.collectibleManager,this.achievementManager])}preload(){Oi(this),this.getPhaseManager().setInterruptCheckCallback(((e,t)=>this.transitionChecker(e,t))),this.getPhaseManager().setInterruptCallback((async(e,t)=>await this.checkpointTransition())),this.getPhaseManager().setCallback((async(e,t)=>await this.handleCharacterLayer(e,t))),this.preloadLocationsAssets(),this.bindKeyboardTriggers()}preloadLocationsAssets(){const e=this.getStateManager().getGameMap();ei.getInstance().loadSounds(e.getSoundAssets()),e.getMapAssets().forEach(((e,t)=>{this.loadImage(e,t)}))}loadImage(e,t){switch(e.type){case nn.Image:this.load.image(t,xn(e.path,!0));break;case nn.Sprite:this.load.spritesheet(t,xn(e.path,!0),e.config)}}async create(){ei.getInstance().hideLayer(hn.Character),await this.changeLocationTo(this.currentLocationId,!0),await ei.getInstance().saveGame()}async renderLocation(e,t){const a=ei.getInstance().getLocationAtId(e);this.getToolbarManager().renderToolbarContainer(),await ei.getInstance().playBgMusic(a.bgmKey),this.getBackgroundManager().renderBackgroundLayerContainer(e),this.getObjectManager().renderObjectsLayerContainer(e),this.getBBoxManager().renderBBoxLayerContainer(e),this.getCharacterManager().renderCharacterLayerContainer(e),await this.getPhaseManager().swapPhase(Yn.Sequence),t&&(await this.getActionManager().fastForwardGameActions(this.getStateManager().getTriggeredStateChangeActions()),await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getGameStartActions())),await this.getActionManager().processGameActions(a.actionIds),this.getStateManager().hasLocationNotif(e)&&(await ei.getInstance().bringUpUpdateNotif(a.name),this.getStateManager().removeLocationNotif(e)),this.getPhaseManager().isCurrentPhase(Yn.Sequence)&&await this.getPhaseManager().swapPhase(Yn.Menu)}async changeLocationTo(e,t=!1){this.currentLocationId=e,await(async(e,t,a,s)=>{const n=Sn(e);e.getLayerManager().addToLayer(hn.Effects,n),n.setAlpha(0),e.tweens.add(jn([n],t)),await pn(t),await s(),await pn(a),n.setAlpha(1),e.tweens.add(vn([n],t)),await pn(t),n.destroy()})(this,300,500,(async()=>{await this.getLayerManager().clearAllLayers(),await this.renderLocation(e,t)})),this.getStateManager().triggerInteraction(e)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Bn.Menu,"up",(async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase(Yn.EscapeMenu)})),this.getInputManager().registerKeyboardListener(Bn.Dashboard,"up",(async()=>{this.getPhaseManager().isCurrentPhase(Yn.Dashboard)?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase(Yn.Dashboard):await this.getPhaseManager().pushPhase(Yn.Dashboard)})),this.registerMenuKeyboardListener(Bn.Explore,Qi.Explore,Yn.Explore),this.registerMenuKeyboardListener(Bn.Move,Qi.Move,Yn.Move),this.registerMenuKeyboardListener(Bn.Talk,Qi.Talk,Yn.Talk)}registerMenuKeyboardListener(e,t,a){this.getInputManager().registerKeyboardListener(e,"up",(async()=>{this.getCurrentLocationModes().includes(t)&&this.getPhaseManager().isCurrentPhase(Yn.Menu)?await this.getPhaseManager().pushPhase(a):this.getPhaseManager().isCurrentPhase(a)&&await this.getPhaseManager().swapPhase(Yn.Menu)}))}getCurrentLocationModes(){const e=this.currentLocationId;let t=this.getStateManager().getLocationModes(e);return 0===ei.getInstance().getGameItemsInLocation(oi.talkTopics,e).length&&(t=t.filter((e=>e!==Qi.Talk))),t}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers(),this.getDialogueStorageManager().clearDialogueStorage()}transitionChecker(e,t){return!this.hasTransitioned&&t!==Yn.Sequence&&ei.getInstance().areAllObjectivesComplete()&&!this.getStateManager().getChapterNewlyCompleted()}async checkpointTransition(){this.hasTransitioned=!0,await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getCheckpointCompleteActions()),this.getInputManager().setDefaultCursor(Rs.defaultCursor),this.getInputManager().enableMouseInput(!0),this.getInputManager().enableKeyboardInput(!0),this.tweens.add(jn([Sn(this).setAlpha(0)],Rs.fadeDuration)),await pn(Rs.fadeDuration),this.cleanUp(),this.scene.start("CheckpointTransition")}async handleCharacterLayer(e,t){e===Yn.Menu&&ei.getInstance().fadeOutLayer(hn.Character),t===Yn.Menu&&ei.getInstance().fadeInLayer(hn.Character)}}const Vr=zr;class Hr{constructor(){this.getTriggeredStateChangeActions=()=>this.getGameSaveState().triggeredStateChangeActions,this.getTriggeredInteractions=()=>this.getGameSaveState().triggeredInteractions,this.getCompletedObjectives=()=>this.getGameSaveState().completedObjectives,this.getCompletedTasks=()=>this.getGameSaveState().completedTasks,this.getIncompleteTasks=()=>this.getGameSaveState().incompleteTasks,this.getLoadedPhase=()=>this.getGameSaveState().currentPhase,this.getChapterNewlyCompleted=()=>this.getGameSaveState().chapterNewlyCompleted,this.getChapterNum=()=>bn(this.chapterNum),this.getCheckpointNum=()=>bn(this.checkpointNum),this.getFullSaveState=()=>this.fullSaveState,this.fullSaveState=rr()}async loadLastSaveState(){this.fullSaveState=await async function(){var e;const t={method:"GET",headers:Gl(Ll.getInstance().getAccountInfo().accessToken)},a=await fetch(`${y.Z.backendUrl}/v2/user`,t),s=await a.text(),n=null===(e=JSON.parse(s).courseRegistration)||void 0===e?void 0:e.gameStates;return R().isEmpty(n)?rr():n}()}registerGameInfo(e,t,a){this.chapterNum=e,this.checkpointNum=t,a||(this.fullSaveState.gameSaveStates[e]=or())}async saveGame(){Ll.getInstance().getCurrentSceneRef()instanceof Vr&&(this.fullSaveState=function(e,t,a){const s=ei.getInstance().getGameManager(),n=s.getStateManager(),i=s.getPhaseManager();return{gameSaveStates:{...e.gameSaveStates,[t]:{lastCheckpointPlayed:a,currentLocation:s.currentLocationId,currentPhase:i.getCurrentPhase(),chapterNewlyCompleted:n.getChapterNewlyCompleted(),incompleteTasks:n.getIncompleteTasks(),completedTasks:n.getCompletedTasks(),completedObjectives:n.getCompletedObjectives(),triggeredInteractions:n.getTriggeredInteractions(),triggeredStateChangeActions:n.getTriggeredStateChangeActions()}},userSaveState:{settings:e.userSaveState.settings,recentlyPlayedCheckpoint:[t,a],collectibles:Ll.getInstance().getUserStateManager().getCollectibles(),largestCompletedChapter:e.userSaveState.largestCompletedChapter}}}(this.fullSaveState,this.getChapterNum(),this.getCheckpointNum()),await Dl(this.fullSaveState))}async saveChapterComplete(e){this.fullSaveState.gameSaveStates[e].chapterNewlyCompleted=!0,e>this.getLargestCompletedChapterNum()&&(this.fullSaveState.userSaveState.largestCompletedChapter=e),await Dl(this.fullSaveState)}async saveSettings(e){this.fullSaveState.userSaveState.settings=e,await Dl(this.fullSaveState)}getSettings(){return this.fullSaveState.userSaveState.settings}getLoadedUserState(){return this.fullSaveState.userSaveState}getLargestCompletedChapterNum(){return this.fullSaveState.userSaveState.largestCompletedChapter}getGameSaveState(){return this.fullSaveState.gameSaveStates[this.getChapterNum()]||or()}getLoadedLocation(){return this.getGameSaveState().currentLocation}getChapterSaveState(e){return this.fullSaveState.gameSaveStates[e]||or()}}const $r={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};const Wr=["Clang. Thud. One hit to the wall, one hit to my flesh.","","They told me I was to be the pillar of this","spaceship - who knew they meant it literally?","- A. Halim"],Xr=["I blink synchronously with the screen;","I breathe as the machine steams on and off.","","Behind this closed space, my very blood fuels","these engines - hoping for you to find me.","- T. S. Chong"],Kr={yInterval:80,messageDuration:5e3};function Zr(e,t,a,s,n=50,i=50){const r=new Phaser.GameObjects.Rectangle(e,a,s,n,i,0,0),o="A"===t?Wr:Xr;r.setInteractive({useHandCursor:!0}),r.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>async function(e,t){const a=Sn(e).setInteractive().setAlpha(0),s=Fs({numOfItems:t.length,xSpacing:0,ySpacing:Kr.yInterval}),n={x:_s.x,y:0,oriX:.5,oriY:.5},i=_s.y-t.length*Kr.yInterval*.5;e.getLayerManager().addToLayer(hn.WorkerMessage,a),e.add.tween(jn([a],Rs.fadeDuration)),Ll.getInstance().getSoundManager().playSound(dn.radioStatic.key),await pn(Rs.fadeDuration),t.forEach(((t,a)=>{const r=function(e,t,a={x:0,y:0,oriX:.5,oriY:.5},s=$r,n=4,i=5,r=3){const o=[];for(let l=0;l<n;l++){const n={x:a.x+i*Math.random(),y:a.y+r*Math.random(),oriX:a.oriX,oriY:a.oriY},l=$s(e,t,n,s);l.setAlpha(.4).setBlendMode(Phaser.BlendModes.SCREEN),o.push(l)}return o.forEach((t=>{e.tweens.add({targets:t,x:t.x+i*Math.random(),y:t.y+r*Math.random(),alpha:.5,duration:20,yoyo:!0,loop:-1,loopDelay:1e3*Math.random()})})),o}(e,t,{...n,y:s[a][1]+i});r.forEach((t=>e.getLayerManager().addToLayer(hn.WorkerMessage,t))),setTimeout((()=>r.forEach((e=>e.destroy()))),Kr.messageDuration)})),await pn(Kr.messageDuration),Cn(e,a)}(e,o))),e.getLayerManager().addToLayer(hn.UI,r)}const qr={scrollSpeed:20,tileDim:2048,maxAwardsPerCol:2,arrow:{xOffset:875},award:{xSpace:300,yStart:300,ySpace:_s.y-50,dim:200},awardInfo:{width:300},banner:{xOffset:.28*-Ls.x},bannerTextConfig:{x:30,y:0,oriX:0,oriY:.5}},Yr={key:Ns.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Jr={fontFamily:"Verdana",fontSize:"30px",fill:Os.lightBlue,align:"center",wordWrap:{width:qr.award.dim-20}},Qr={fontFamily:"Verdana",fontSize:"20px",fill:Os.lightBlue,align:"left",wordWrap:{width:qr.awardInfo.width-20}},eo={fontFamily:"Verdana",fontSize:"15px",fill:Os.offWhite,align:"left",wordWrap:{width:qr.awardInfo.width-20}},to={fontFamily:"Verdana",fontSize:"15px",fill:Os.lightBlue,align:"left",wordWrap:{width:qr.awardInfo.width-20}};class ao extends Phaser.Scene{constructor(){super("AwardsHall"),this.getUserStateManager=()=>Ll.getInstance().getUserStateManager(),this.getInputManager=()=>bn(this.inputManager),this.getLayerManager=()=>bn(this.layerManager),Ll.getInstance().setCurrentSceneRef(this),this.isScrollLeft=!1,this.isScrollRight=!1,this.scrollLim=0,this.awardXSpace=0}init(){this.layerManager=new Ki(this),this.inputManager=new Un(this)}preload(){Oi(this)}async create(){const e=this.getUserStateManager().getAchievements().length,t=this.getUserStateManager().getCollectibles().length;this.awardXSpace=Math.ceil(Math.max(e,t)/qr.maxAwardsPerCol)*qr.award.xSpace,this.scrollLim=this.awardXSpace<Ls.x?0:this.awardXSpace-Ls.x,this.renderBackground(),this.renderAwards(),Zr(this,"A",.95*Ls.x,.99*Ls.y)}update(){if(!this.backgroundTile||!this.awardsContainer)return;let e=this.awardsContainer.x;this.isScrollRight?e-=qr.scrollSpeed:this.isScrollLeft&&(e+=qr.scrollSpeed),e=mn(e,-this.scrollLim,0),this.backgroundTile.tilePositionX=-e,this.awardsContainer.x=e}renderBackground(){this.backgroundTile&&this.backgroundTile.destroy(),this.backgroundTile=new Phaser.GameObjects.TileSprite(this,0,0,qr.tileDim,qr.tileDim,on.awardsBackground.key).setOrigin(0,.25),this.getLayerManager().addToLayer(hn.Background,this.backgroundTile);const e=["Achievements","Collectibles"],t=Bs({direction:Gs.Column,numOfItems:e.length});e.forEach(((e,a)=>{const s=this.createBanner(e,t[a][1]);this.getLayerManager().addToLayer(hn.UI,s)}));const a=Wn(this,{assetKey:on.chapterSelectArrow.key,onDown:()=>this.isScrollLeft=!0,onUp:()=>this.isScrollLeft=!1,onOut:()=>this.isScrollLeft=!1}).setPosition(_s.x-qr.arrow.xOffset,_s.y),s=Wn(this,{assetKey:on.chapterSelectArrow.key,onDown:()=>this.isScrollRight=!0,onUp:()=>this.isScrollRight=!1,onOut:()=>this.isScrollRight=!1}).setPosition(_s.x+qr.arrow.xOffset,_s.y).setScale(-1,1),n=new vr(this,(()=>{this.cleanUp(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(hn.UI,a),this.getLayerManager().addToLayer(hn.UI,s),this.getLayerManager().addToLayer(hn.UI,n)}renderAwards(){this.awardsContainer&&this.awardsContainer.destroy(),this.awardsContainer=new Phaser.GameObjects.Container(this,0,0);const e=this.getAwards(this.getUserStateManager().getAchievements()),t=Bs({direction:Gs.Column,numOfItems:e.length,numItemLimit:qr.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:qr.award.ySpace});this.awardsContainer.add(e.map(((e,a)=>this.createAward(e,t[a][0],t[a][1]+qr.award.yStart-_s.y))));const a=this.getAwards(this.getUserStateManager().getCollectibles()),s=Bs({direction:Gs.Column,numOfItems:a.length,numItemLimit:qr.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:qr.award.ySpace});this.awardsContainer.add(a.map(((e,t)=>this.createAward(e,s[t][0],s[t][1]+qr.award.yStart)))),this.getLayerManager().addToLayer(hn.Objects,this.awardsContainer)}getAwards(e){return an(e)}createAward(e,t,a){const s=new Phaser.GameObjects.Container(this,t,a);let n;if(e.assetKey===Rs.nullInteractionId){n=new Phaser.GameObjects.Rectangle(this,0,0,qr.award.dim,qr.award.dim,Ds.darkBlue,.8),n.setInteractive();const t=new Phaser.GameObjects.Text(this,0,0,e.title,Jr).setOrigin(.5,.5);s.add([n,t])}else n=new Phaser.GameObjects.Sprite(this,0,0,e.assetKey).setOrigin(.5),hi(n,qr.award.dim,qr.award.dim),n.setInteractive({pixelPerfect:!0,useHandCursor:!0}),s.add(n);const i=new Phaser.GameObjects.Rectangle(this,0,0,qr.award.dim,qr.award.dim,0).setAlpha(e.completed?0:.8);s.add(i);const r=((e,t)=>{const a=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Text(e,20,20,t.title,Qr),n=new Phaser.GameObjects.Text(e,20,s.getBounds().bottom+20,t.assetKey,eo),i=new Phaser.GameObjects.Text(e,20,n.getBounds().bottom+20,t.description,to),r=new Phaser.GameObjects.Rectangle(e,0,0,qr.awardInfo.width,i.getBounds().bottom+20,Ds.darkBlue).setOrigin(0,0).setAlpha(.8),o=new Phaser.GameObjects.Sprite(e,qr.awardInfo.width/2,0,on.scrollFrame.key),l=new Phaser.GameObjects.Sprite(e,qr.awardInfo.width/2,r.getBounds().bottom,on.scrollFrame.key);return a.add([r,s,i,o,l]),t.completed&&a.add(n),a.setVisible(!1),a})(this,e);return n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>r.setVisible(!0))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>r.setVisible(!1))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e=>{r.x=e.x+10,r.y=e.y-10})),this.getLayerManager().addToLayer(hn.UI,r),s}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createBanner(e,t){const a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Sprite(this,qr.banner.xOffset,0,on.awardsPage.key),n=$s(this,e,qr.bannerTextConfig,Yr);return a.add([s,n]),a}}const so=ao,no={keyTextConfig:{x:_s.x-100,y:0,oriX:.5,oriY:.5},keyDescTextConfig:{x:_s.x+100,y:0,oriX:.5,oriY:.5},key:{xOffset:Ls.x/5,yOffset1:_s.y-Ls.y/4,yOffset2:_s.y-Ls.y/1.5,yInterval:150},icon:{x:_s.x-100}},io={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ro={key:Ns.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class oo extends Phaser.Scene{constructor(){super("Bindings"),this.getInputManager=()=>bn(this.inputManager),this.getLayerManager=()=>bn(this.layerManager)}init(){this.layerManager=new Ki(this),this.inputManager=new Un(this)}create(){this.renderBackground(),this.renderBindings()}renderBackground(){const e=new Phaser.GameObjects.Image(this,_s.x,_s.y,on.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,_s.x,_s.y,Ls.x,Ls.y,0).setAlpha(.3);this.getLayerManager().addToLayer(hn.Background,e),this.getLayerManager().addToLayer(hn.Background,t)}renderBindings(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getBindings(),a=Fs({numOfItems:t.length,xSpacing:0,ySpacing:no.key.yInterval});e.add(t.map(((e,t)=>this.createBinding(e.key,e.text,a[t][1]<450?a[t][0]-no.key.xOffset:a[t][0]+no.key.xOffset,a[t][1]<450?a[t][1]+no.key.yOffset1:a[t][1]+no.key.yOffset2))));const s=new vr(this,(()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(hn.UI,e),this.getLayerManager().addToLayer(hn.UI,s)}getBindings(){return[{key:"Esc",text:"Escape Menu"},{key:"Tab",text:"Dashboard"},{key:"Space",text:"Next dialogue"},{key:"E",text:"Explore mode"},{key:"V",text:"Move mode"},{key:"T",text:"Talk mode"},{key:"<Number>",text:"       Select topics/locations"}]}createBinding(e,t,a,s){const n=new Phaser.GameObjects.Container(this,a,s),i=new Phaser.GameObjects.Sprite(this,no.icon.x,0,on.squareKeyboardIcon.key);if("Tab"===e)i.setTexture(on.medKeyboardIcon.key);if("Space"===e)i.setTexture(on.medKeyboardIcon.key);if("<Number>"===e)i.setTexture(on.medKeyboardIcon.key);const r=$s(this,e,no.keyTextConfig,io),o=$s(this,t,no.keyDescTextConfig,ro);return n.add([i,r,o]),n}}const lo=oo,co=(e,t,a)=>new Promise((s=>{"__MISSING"!==e.textures.get(t).key?s(t):(e.load.image(t,a),e.load.once(`filecomplete-image-${t}`,s),e.load.once("loaderror",s),e.load.start())})),ho=(e,t,a)=>new Promise((s=>{e.cache.text.exists(t)?s(t):(e.load.text(t,a),e.load.once(`filecomplete-text-${t}`,s),e.load.start())})),uo={key:Ns.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},go={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},po={key:Ns.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},mo={arrow:{xOffset:875},buttons:{scale:.65},resetButton:{xOffset:135,yOffset:85},playButton:{xOffset:55,yOffset:85},frame:{xOffset:12,yOffset:-4},scrollSpeed:100,indexTextConfig:{x:0,y:-110,oriX:.5,oriY:.5},titleTextConfig:{x:0,y:-50,oriX:.5,oriY:.5},pageNumberTextConfig:{x:_s.x,y:Ls.y-30,oriX:.5,oriY:.5},imageRect:{width:400,height:280},imageScale:{x:.8,y:.4},chapComplete:{y:10,height:30,text:"Chapter Completed"},grid:{chapPerRow:3,chapPerCol:3,chapPerPage:9,chapGapX:50,chapGapY:50}},xo=e=>xn(`/stories/${e}`,!0),bo={defaultCheckpoint:{key:"default-chap",path:xo("defaultCheckpoint.txt")},awardsMapping:{key:"awards-mapping",path:xo("awardsMapping.txt")},roomPreviewMapping:{key:"room-prev-mapping",path:xo("roomPreviewMapping.txt")}},yo={defaultCheckpoint:{key:"mock-default-chap",path:"../../assets/mockDefaultCheckpoint.txt"},awardsMapping:{key:"mock-awards-mapping",path:"../../assets/mockAwardsMapping.txt"},roomPreviewMapping:{key:"mock-room-prev-mapping",path:"../../assets/mockRoomPreviewMapping.txt"}},fo=bo;const vo=class{constructor(){this.getLocationAtId=e=>bn(this.locations.get(e),`Location ${e} was not found!`),this.getAssetByKey=e=>bn(this.mapAssets.get(e),`Asset ${e} not found!`),this.soundAssets=[],this.mapAssets=new Map,this.locations=new Map,this.dialogues=new Map,this.objects=new Map,this.boundingBoxes=new Map,this.characters=new Map,this.actions=new Map,this.gameStartActions=[],this.checkpointCompleteActions=[]}addSoundAsset(e){this.soundAssets.push(e)}addMapAsset(e,t){this.mapAssets.set(e,t)}getMapAssets(){return this.mapAssets}addLocation(e,t){this.locations.set(e,t)}setModesAt(e,t){this.getLocationAtId(e).modes=new Set(t)}setNavigationFrom(e,t){this.getLocationAtId(e).navigation=new Set(t)}getNavigationFrom(e){return this.getLocationAtId(e).navigation}setGameStartActions(e){this.gameStartActions=e}setCheckpointCompleteActions(e){this.checkpointCompleteActions=e}getGameStartActions(){return this.gameStartActions}getCheckpointCompleteActions(){return this.checkpointCompleteActions}getLocations(){return this.locations}getObjectPropMap(){return this.objects}getBBoxPropMap(){return this.boundingBoxes}getDialogueMap(){return this.dialogues}getCharacterMap(){return this.characters}getActionMap(){return this.actions}getSoundAssets(){return this.soundAssets}setItemInMap(e,t,a){this[e].set(t,a)}addItemToLocation(e,t,a){this.getLocationAtId(e)[t].add(a)}setBGMusicAt(e,t){this.getLocationAtId(e).bgmKey=t}getLocationIds(){return Array.from(this.locations.keys())}getAssetKeyFromId(e){var t,a;return bn((null===(t=this.objects.get(e))||void 0===t?void 0:t.assetKey)||(null===(a=this.locations.get(e))||void 0===a?void 0:a.assetKey),`Id ${e} not found!`)}};const jo=class{constructor(){this.objective=new Map,this.totalNumOfObjectives=0,this.numOfCompletedObjectives=0}setObjective(e,t){const a=this.objective.get(e);this.objective.set(e,t),void 0!==a&&a!==t&&this.numOfCompletedObjectives++}addObjective(e){this.objective.set(e,!1),this.totalNumOfObjectives++}addObjectives(e){e.forEach((e=>this.addObjective(e)))}isAllComplete(){return this.numOfCompletedObjectives>=this.totalNumOfObjectives}getObjectiveState(e){const t=this.objective.get(e);if(void 0===t)throw new Error(`Cannot find objective with the given task id "${e}"`);return t}getObjectives(){return this.objective}setObjectives(e){this.objective=e}};const Co=class{constructor(){this.tasks=new Map,this.taskDetails=new Map}setTask(e,t){this.tasks.set(e,t)}showTask(e){const t=this.taskDetails.get(e);if(void 0!==t){const a={...t,visible:!0};this.taskDetails.set(e,a)}}addTask(e){const t=e.taskId;this.tasks.set(t,!1),this.taskDetails.set(t,e)}addTasks(e){e.forEach((e=>this.addTask(e)))}getTaskState(e){const t=this.tasks.get(e);if(void 0===t)throw new Error(`Cannot find task with the given task id "${e}"`);return t}getTaskDetail(e){const t=this.taskDetails.get(e);if(void 0===t)throw new Error(`Cannot find task with the given task id "${e}"`);return t}getAllTasks(){return this.tasks}getAllIncompleteTasks(){const e=new Array;for(const a of this.tasks.keys()){var t;!this.tasks.get(a)&&null!==(t=this.taskDetails.get(a))&&void 0!==t&&t.visible&&e.push(a)}return e}getAllVisibleTaskData(){const e=new Array;for(const t of this.tasks.keys()){const a=this.getTaskState(t),s=this.getTaskDetail(t);void 0!==a&&void 0!==s&&s.visible&&e.push([s,a])}return e}},So={small:Si.Small,medium:Si.Medium,large:Si.Large},ko={left:Ci.Left,middle:Ci.Middle,right:Ci.Right},Io={talk:Qi.Talk,explore:Qi.Explore,move:Qi.Move,menu:Qi.Menu},wo={navigation:oi.navigation,talkTopics:oi.talkTopics,objects:oi.objects,boundingBoxes:oi.boundingBoxes,characters:oi.characters,actions:oi.actions,bgmKey:oi.bgmKey,collectibles:oi.collectibles},Ao={move_character:ni.MoveCharacter,update_character:ni.UpdateCharacter,obtain_collectible:ni.ObtainCollectible,complete_objective:ni.CompleteObjective,complete_task:ni.CompleteTask,show_task:ni.ShowTask,add_item:ni.AddItem,remove_item:ni.RemoveItem,change_background:ni.ChangeBackground,start_animation:ni.StartAnimation,stop_animation:ni.StopAnimation,show_dialogue:ni.ShowDialogue,add_mode:ni.AddLocationMode,remove_mode:ni.RemoveLocationMode,add_popup:ni.AddPopup,make_object_glow:ni.MakeObjectGlow,make_object_blink:ni.MakeObjectBlink,play_bgm:ni.PlayBGM,play_sfx:ni.PlaySFX,preview_location:ni.PreviewLocation,show_object_layer:ni.ShowObjectLayer,navigate_to_assessment:ni.NavigateToAssessment,update_assessment_status:ni.UpdateAssessmentStatus,delay:ni.Delay},To={checklist:ti.ChecklistState,tasklist:ti.TasklistState,userstate:ti.UserState},Mo={assessments:ai.assessments,achievements:ai.achievements,collectibles:ai.collectibles};class Po{static stringToSize(e){return So[e]||Si.Medium}static stringToPosition(e){return ko[e]||Ci.Middle}static stringToGameMode(e){return bn(Io[e],`Invalid location mode, ${e}`)}static stringToActionType(e){return bn(Ao[e],`Invalid action type, ${e}`)}static stringToGameStateStorage(e){return bn(To[e],`Invalid condition type, ${e}`)}static stringToGameItemType(e){return bn(wo[e],`Invalid entity type, ${e}`)}static stringToBoolean(e){return"false"!==e}static stringToUserStateType(e){return bn(Mo[e],`Invalid user state type ${e}`)}}let Eo=function(e){return e.locations="locations",e.objectives="objectives",e.tasks="tasks",e.bgms="bgms",e.sfxs="sfxs",e}({});class No{constructor(){this.gameAnimMaps=[Jo.checkpoint.map.getLocations(),Jo.checkpoint.map[oi.objects]],this.gameItemAsserts=new Map,this.gameEntityAsserts=new Map,this.gameAnimAsserts=[],this.allItemIds=new Set}registerId(e){if(this.allItemIds.has(e))throw new Error(`Duplicate item id ${e}`);this.allItemIds.add(e)}verifyAssertions(){this.verifyGameItemAssert(),this.verifyGameEntityAsserts(),this.verifyGameAnimAsserts()}assertItemType(e,t,a){e===oi.talkTopics?e=oi.dialogues:e===oi.navigation&&(e=oi.locations),this.gameItemAsserts.get(e)||this.gameItemAsserts.set(e,[]),this.gameItemAsserts.get(e).push({itemId:t,actionType:a})}verifyGameItemAssert(){this.gameItemAsserts.forEach(((e,t)=>{e.forEach((e=>{const{itemId:a,actionType:s}=e;if(!Jo.checkpoint.map[t].has(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find id "${a}" under ${t} entity type`)}))}))}assertItemTypes(e,t,a){t.forEach((t=>this.assertItemType(e,t,a)))}assertEntityType(e,t,a){this.gameEntityAsserts.get(e)||this.gameEntityAsserts.set(e,[]),this.gameEntityAsserts.get(e).push({itemId:t,actionType:a})}verifyGameEntityAsserts(){this.gameEntityAsserts.forEach(((e,t)=>{e.forEach((e=>{const{itemId:a,actionType:s}=e;switch(t){case Eo.locations:Jo.checkpoint.map.getLocationAtId(a);break;case Eo.objectives:if(void 0===Jo.checkpoint.objectives.getObjectives().get(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find objective id "${a}"`);break;case Eo.tasks:if(void 0===Jo.checkpoint.tasks.getAllTasks().get(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find task id "${a}"`);break;case Eo.bgms:const e=Jo.checkpoint.map.getSoundAssets().filter((e=>e.soundType===cn.BGM&&e.key===a)).length;if(0===e)throw new Error(`Cannot find bgm key "${a}"`);if(e>1)throw new Error(`More than 1 bgm key "${a}"`);break;case Eo.sfxs:const n=Jo.checkpoint.map.getSoundAssets().filter((e=>e.soundType===cn.SFX&&e.key===a)).length;if(0===n)throw new Error(`Cannot find sfx key "${a}"`);if(n>1)throw new Error(`More than 1 sfx key "${a}"`)}}))}))}assertAnimType(e,t){this.gameAnimAsserts.push({itemId:e,actionType:t})}verifyGameAnimAsserts(){this.gameAnimAsserts.forEach((e=>{const{itemId:t,actionType:a}=e;let s=!1;this.gameAnimMaps.forEach((e=>{e.get(t)&&(s=!0)})),s||this.actionAssertionError(t,"locationId or itemId",a)}))}actionAssertionError(e,t,a){throw new Error(`Expected type of "${t}" as argument for "${a}", obtained "${e}" which is either undefined or the wrong id.`)}}class Ro{static parse(e){const t="!"===e[0];t&&(e=e.slice(1));const[a,...s]=ki.splitByChar(e,".");switch(Po.stringToGameStateStorage(a)){case ti.ChecklistState:return Jo.validator.assertEntityType(Eo.objectives,s[0]),{state:ti.ChecklistState,conditionParams:{id:s[0]},boolean:!t};case ti.TasklistState:return Jo.validator.assertEntityType(Eo.tasks,s[0]),{state:ti.TasklistState,conditionParams:{id:s[0]},boolean:!t};case ti.UserState:return{state:ti.UserState,conditionParams:{userStateType:Po.stringToUserStateType(s[0]),id:s[1]},boolean:!t};default:throw new Error("Parsing error: Invalid condition param")}}}class Lo{static parseActions(e){return e.map((e=>this.parseAction(e)))}static parseAction(e){const[t,a]=ki.splitByChar(e,"if"),s=this.parseActionContent(t);return a&&(s.actionConditions=ki.splitByChar(a,"AND").map((e=>Ro.parse(e)))),Jo.checkpoint.map.setItemInMap(oi.actions,s.interactionId,s),s.interactionId}static parseActionContent(e){const[t,a]=ki.splitByChar(e,"(");let s=!1,n=t;"*"===t[t.length-1]&&(s=!0,n=n.slice(0,-1));const i=Po.stringToActionType(n),r=ki.splitByChar(a.slice(0,-1),","),o={};switch(i){case ni.ObtainCollectible:o.id=r[0];break;case ni.CompleteObjective:o.id=r[0],Jo.validator.assertEntityType(Eo.objectives,r[0],n);break;case ni.CompleteTask:case ni.ShowTask:o.id=r[0],Jo.validator.assertEntityType(Eo.tasks,r[0],n);break;case ni.PreviewLocation:case ni.ChangeBackground:o.id=r[0],Jo.validator.assertEntityType(Eo.locations,r[0],n);break;case ni.StartAnimation:o.id=r[0],o.startFrame=+r[1],o.frameRate=+r[2],o.assetCategory=r[3],Jo.validator.assertAnimType(r[0],n);break;case ni.StopAnimation:o.id=r[0],Jo.validator.assertAnimType(r[0],n);break;case ni.ShowDialogue:o.id=r[0],Jo.validator.assertItemType(oi.dialogues,r[0],n);break;case ni.AddItem:case ni.RemoveItem:const e=Po.stringToGameItemType(r[0]);o.gameItemType=e,o.locationId=r[1],Jo.validator.assertEntityType(Eo.locations,r[1],n),o.id=r[2],Jo.validator.assertItemType(e,r[2],n);break;case ni.AddLocationMode:case ni.RemoveLocationMode:Jo.validator.assertEntityType(Eo.locations,r[0],n),o.locationId=r[0],o.mode=Po.stringToGameMode(r[1]);break;case ni.AddPopup:Jo.validator.assertItemType(oi.objects,r[0],n),o.id=r[0],o.position=Po.stringToPosition(r[1]),r[2]&&(o.duration=1e3*parseInt(r[2])),r[3]&&(o.size=Po.stringToSize(r[3]));break;case ni.MakeObjectBlink:case ni.MakeObjectGlow:Jo.validator.assertItemType(oi.objects,r[0],n),o.id=r[0],o.turnOn=Po.stringToBoolean(r[1]);break;case ni.PlayBGM:o.id=r[0],Jo.validator.assertEntityType(Eo.bgms,r[0],n);break;case ni.PlaySFX:o.id=r[0],Jo.validator.assertEntityType(Eo.sfxs,r[0],n);break;case ni.ShowObjectLayer:o.show=Po.stringToBoolean(r[0]);break;case ni.UpdateCharacter:Jo.validator.assertItemType(oi.characters,r[0],n),o.id=r[0],o.expression=r[1];break;case ni.MoveCharacter:Jo.validator.assertItemType(oi.characters,r[0],n),Jo.validator.assertEntityType(Eo.locations,r[1],n),o.id=r[0],o.locationId=r[1],o.position=Po.stringToPosition(r[2]);break;case ni.NavigateToAssessment:o.assessmentId=r[0];break;case ni.Delay:o.duration=1e3*parseInt(r[0])}return{actionType:i,actionParams:o,actionConditions:[],interactionId:Jo.generateActionId(),isInteractive:!1,isRepeatable:s}}}class _o{static parsePrompt(e,t){return{promptTitle:e.split("prompt:")[1].trim(),choices:t.map(this.splitChoice)}}static splitChoice(e){const t=ki.splitWithLimit(e,"->",1);return[t[0].trim(),t[1].split(" ")[1].trim()]}}class Oo{static parse(e,t){t.forEach((t=>this.parseCharacterDetails(e,t)))}static characterAssetKey(e,t){return e+"-"+t}static characterAssetPath(e,t){return`/avatars/${e}/${e}.${t}.png`}static parseCharacterDetails(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o]=ki.splitByChar(t,",");Jo.validator.registerId(s);const l=new Map,c={id:s,name:n,expressions:l,defaultExpression:i,defaultPosition:Po.stringToPosition(r),scale:o?parseFloat(o):1};l.set(i,this.characterAssetKey(s,i)),Jo.checkpoint.map.addMapAsset(this.characterAssetKey(s,i),{type:nn.Image,path:this.characterAssetPath(s,i),key:s}),Jo.checkpoint.map.setItemInMap(oi.characters,s,c),a&&Jo.checkpoint.map.addItemToLocation(e,oi.characters,s)}}class Do{static parse(e){const[t,a,s]=ki.splitByChar(e.slice(1),","),n=Po.stringToPosition(s);return this.addCharacterExprToMap(t,a),{speakerId:t,expression:a,speakerPosition:n}}static addCharacterExprToMap(e,t){if("you"===e||"narrator"===e)return;const a=Jo.checkpoint.map.getCharacterMap().get(e);if(!a)throw new Error(`Character "${e}" not in map`);const s=t||a.defaultExpression;a.expressions.set(t,Oo.characterAssetKey(e,t||s)),Jo.checkpoint.map.addMapAsset(Oo.characterAssetKey(e,s),{path:Oo.characterAssetPath(e,s),type:nn.Image,key:e})}}class Go{static parse(e){ki.splitToParagraph(e).forEach((([e,t])=>{0!==t.length?this.parseDialogue(e,t):console.error("No dialogue found for dialogueId")}))}static parseDialogue(e,t){const[a,s]=ki.splitWithLimit(e,",",1);Jo.validator.registerId(a);const n={title:s,content:this.parseDialogueContent(t)};n.title||(n.title=ki.toCapitalizedWords(a)),Jo.checkpoint.map.setItemInMap(oi.dialogues,a,n)}static parseDialogueContent(e){return function(e,t){const a=new Map;return e.forEach(((e,s)=>{const n=t(e,s);a.set(s,n)})),a}(ki.mapByHeader(e,Bo),this.createDialogueLines)}static createDialogueLines(e){const t=[];let a=0;for(;a!==e.length;){const s=e[a];switch(!0){case Uo(s):const[n,i]=ki.splitByChar(s,"if"),[r,o]=i?ki.splitByChar(i,"else"):[null,null],l=r?ki.splitByChar(r,"AND").map((e=>Ro.parse(e))):[];t[t.length-1].goto={conditions:l,part:n.split(" ")[1],altPart:o};break;case Vo(s):const c=s,d=[];for(;e[a+1]&&Ho(e[a+1]);)a++,d.push(e[a].trim());const h=_o.parsePrompt(c,d);t[t.length-1].prompt=h;break;case Fo(s):const u=t[t.length-1];!u.actionIds&&(u.actionIds=[]),u.actionIds.push(Lo.parseAction(s));break;case zo(s):a++;const g=e[a];if(!g)throw new Error("Parsing error: Cannot change speaker without next line");t.push({line:g}),t[t.length-1].speakerDetail=Do.parse(s);break;default:t.push({line:s}),t[t.length-1].speakerDetail=Do.parse("@narrator")}a++}return t}}const Bo=e=>new RegExp(/^[0-9]+$/).test(e),Uo=e=>new RegExp(/^goto [0-9]+.*$/).test(e),Fo=e=>e&&("\t"===e[0]||"    "===e.slice(0,4)),zo=e=>e&&"@"===e[0],Vo=e=>e.trim().startsWith("prompt:"),Ho=e=>new RegExp(/-> +goto/).test(e);class $o{static parse(e){e.forEach((e=>{const[t,a,s,n,i]=ki.splitByChar(e,",");Jo.validator.registerId(t),Jo.checkpoint.map.addLocation(t,{id:"",name:"",assetKey:"",previewKey:null,modes:new Set([]),navigation:new Set([]),talkTopics:new Set([]),objects:new Set([]),boundingBoxes:new Set([]),bgmKey:"",characters:new Set([]),id:t,name:s,assetKey:this.locationAssetKey(a)}),Jo.checkpoint.map.addMapAsset(this.locationAssetKey(a),{type:nn[n]||nn.Image,key:t,path:this.locationPath(a),config:{frameWidth:Ls.x,frameHeight:Ls.y,centreX:_s.x,centreY:_s.y,endFrame:parseInt(i)-1||0,animType:rn.Background}})}))}static locationAssetKey(e){return e}static locationPath(e){return e}}class Wo{static parse(e,t){ki.splitToParagraph(t).forEach((([t,a])=>{const s=this.parseBBoxConfig(e,t);a.length&&(s.isInteractive=!0,s.actionIds=Lo.parseActions(a))}))}static parseBBoxConfig(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o]=ki.splitByChar(t,","),l={x:parseInt(n),y:parseInt(i),width:parseInt(r),height:parseInt(o),isInteractive:!1,interactionId:s};return Jo.validator.registerId(s),Jo.checkpoint.map.setItemInMap(oi.boundingBoxes,s,l),a&&Jo.checkpoint.map.addItemToLocation(e,oi.boundingBoxes,s),l}}class Xo{static parse(e,t,a){t.forEach(((t,s)=>{const[n,i,r]=ki.splitByChar(t,",");Jo.validator.registerId(n),Jo.checkpoint.map.addSoundAsset({key:n,path:i,config:{volume:parseFloat(r),loop:a===cn.BGM},soundType:a}),a===cn.BGM&&0===s&&Jo.checkpoint.map.setBGMusicAt(e,n)}))}}class Ko{static parse(e,t){ki.splitToParagraph(t).forEach((([t,a])=>{const s=this.parseObjectConfig(e,t);a.length&&(s.isInteractive=!0,s.actionIds=Lo.parseActions(a))}))}static objectAssetKey(e){return e}static objectPath(e){return e}static parseObjectConfig(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o,l,c,d]=ki.splitByChar(t,",");Jo.validator.registerId(s);const h={assetKey:this.objectAssetKey(n),x:parseInt(i),y:parseInt(r),width:parseInt(o)||void 0,height:parseInt(l)||void 0,isInteractive:!1,interactionId:s};return Jo.checkpoint.map.addMapAsset(this.objectAssetKey(n),{type:nn[c]||nn.Image,key:s,path:this.objectPath(n),config:{frameHeight:parseInt(l)||-1,frameWidth:parseInt(o)||-1,centreX:0,centreY:0,endFrame:parseInt(d)-1||0,animType:rn.Object}}),Jo.checkpoint.map.setItemInMap(oi.objects,s,h),a&&Jo.checkpoint.map.addItemToLocation(e,oi.objects,s),h}}class Zo{static parse(e,t){const a=Jo.checkpoint.map.getLocationAtId(e);ki.splitToParagraph(t).forEach((([e,t])=>{0===t.length&&e.includes(":")?this.parseLocationConfig(a,e):this.parseLocationParagraphs(a,e,t)}))}static parseLocationConfig(e,t){const[a,s]=ki.splitByChar(t,":"),n=ki.splitByChar(s,",");switch(a){case"modes":n.forEach((t=>{const a=Po.stringToGameMode(t);e.modes.add(a)}));break;case"nav":n.forEach((t=>{Jo.validator.assertEntityType(Eo.locations,t),e.navigation.add(t)}));break;case"talkTopics":const t=n;Jo.validator.assertItemTypes(oi.dialogues,t),e.talkTopics=new Set(t);break;case"preview":const[s]=n;if(s){const t="/preview"+s;Jo.checkpoint.map.addMapAsset(t,{type:nn.Image,key:e.id+"Preview",path:s}),e.previewKey=t}break;default:throw new Error(`Invalid config key "${a}" specified under location "${e.id}"`)}}static parseLocationParagraphs(e,t,a){switch(t){case"objects":Ko.parse(e.id,a);break;case"boundingBoxes":Wo.parse(e.id,a);break;case"characters":Oo.parse(e.id,a);break;case"bgm":Xo.parse(e.id,a,cn.BGM);break;case"sfx":Xo.parse(e.id,a,cn.SFX);break;case"actions":e.actionIds=Lo.parseActions(a);break;default:throw new Error(`Invalid location paragraph header "${t}"`)}}}class qo{static parse(e){const t=[];e.forEach((e=>{const[a,s,n]=ki.splitWithLimit(e,",",2),i={taskId:a,title:s,description:n,visible:!1};t.push(i)})),Jo.checkpoint.tasks.addTasks(t)}}class Yo{static generateActionId(){return Yo.actionIdNum++,`action#${Yo.actionIdNum}`}static init(){Yo.actionIdNum=0,Yo.checkpoint={map:new vo,startingLoc:"",objectives:new jo,tasks:new Co},Yo.validator=new No}static parse(e,t=!1){t||Yo.init();const a=ki.splitToLinesAndRemoveComments(e);ki.splitToParagraph(a).forEach((([e,t])=>{0===t.length&&e.includes(":")?Yo.parseCheckpointConfig(e):Yo.parseCheckpointParagraphs(e,t)||Zo.parse(e,t)})),Yo.validator.verifyAssertions()}static parseCheckpointConfig(e){const[t,a]=ki.splitByChar(e,":");if("startingLoc"!==t)throw new Error(`Invalid checkpoint config key, "${e}"`);Yo.validator.assertEntityType(Eo.locations,a),Yo.checkpoint.startingLoc=a}static parseCheckpointParagraphs(e,t){switch(e){case"objectives":Yo.checkpoint.objectives.addObjectives(t);break;case"tasks":qo.parse(t);break;case"locations":$o.parse(t);break;case"gameStartActions":Yo.checkpoint.map.setGameStartActions(Lo.parseActions(t));break;case"checkpointCompleteActions":Yo.checkpoint.map.setCheckpointCompleteActions(Lo.parseActions(t));break;case"dialogues":Go.parse(t);break;default:return!1}return!0}}const Jo=Yo;async function Qo(e,t,a){const s=Ll.getInstance().getIsUsingMock()?yo:fo,n=Ll.getInstance().getCurrentSceneRef(),i=Ll.getInstance().getGameChapters()[t].filenames[a];if(!i)return;await ho(n,i,i),await ho(n,s.defaultCheckpoint.key,s.defaultCheckpoint.path);const r=n.cache.text.get(i),o=n.cache.text.get(s.defaultCheckpoint.key);Jo.parse(o),Jo.parse(r,!0);const l=Jo.checkpoint;n.scene.start("GameManager",{gameCheckpoint:l,continueGame:e,chapterNum:t,checkpointNum:a})}function el(e,{title:t,imageUrl:a},s){const[n,i]=function(e){const t=Math.floor(e/mo.grid.chapPerPage);e%=mo.grid.chapPerPage;const a=Math.floor(e/mo.grid.chapPerRow),s=e%mo.grid.chapPerRow,n=(mo.grid.chapPerRow-1)/2,i=(mo.grid.chapPerCol-1)/2;let r=t*Ls.x+_s.x;r+=(s-n)*(mo.imageRect.width+mo.grid.chapGapX);let o=_s.y;return o+=(a-i)*(mo.imageRect.height+mo.grid.chapGapY),[r,o]}(s),r=new Phaser.GameObjects.Container(e,n,i),o=s<=Ll.getInstance().getSaveManager().getLargestCompletedChapterNum(),l=new Phaser.GameObjects.Image(e,0,0,a).setDisplaySize(mo.imageRect.width,mo.imageRect.height),c=new Phaser.GameObjects.Sprite(e,mo.frame.xOffset,mo.frame.yOffset,on.chapterSelectFrame.key).setScale(.99*mo.imageScale.x,.99*mo.imageScale.y),d=new Phaser.GameObjects.Rectangle(e,0,mo.chapComplete.y,mo.imageRect.width,mo.chapComplete.height,0).setOrigin(.5).setAlpha(.7).setInteractive().setVisible(o),h=$s(e,mo.chapComplete.text,{x:0,y:mo.chapComplete.y,oriX:.5,oriY:.5},uo).setVisible(o),u=new Hs(e,mo.resetButton.xOffset+8,mo.resetButton.yOffset-20,"Reset progress"),g=new Hs(e,mo.playButton.xOffset+8,mo.playButton.yOffset-20,"Play/Continue"),p=Wn(e,{assetKey:on.chapterRepeatButton.key,onUp:async()=>await Qo(!1,s,0),onHover:()=>u.setVisible(!0),onOut:()=>u.setVisible(!1)}).setPosition(mo.resetButton.xOffset,mo.resetButton.yOffset).setScale(mo.buttons.scale),m=Ll.getInstance().getSaveManager().getChapterSaveState(s).lastCheckpointPlayed,x=Wn(e,{assetKey:on.chapterContinueButton.key,onUp:async()=>await Qo(!0,s,m),onHover:()=>g.setVisible(!0),onOut:()=>g.setVisible(!1)}).setPosition(mo.playButton.xOffset,mo.playButton.yOffset).setScale(mo.buttons.scale),b=$s(e,`Chapter ${s}`,mo.indexTextConfig,uo),y=$s(e,t,mo.titleTextConfig,go),f=s<=Ll.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,v=new Phaser.GameObjects.Rectangle(e,0,0,mo.imageRect.width,mo.imageRect.height,0).setOrigin(.5).setAlpha(f?0:.8).setInteractive();return r.add([l,c,d,h,p,x,u,g,b,y,v]),r}class tl extends Phaser.Scene{constructor(){super("ChapterSelect"),this.getGameChapters=()=>Ll.getInstance().getGameChapters(),this.getLayerManager=()=>bn(this.layerManager),this.chaptersContainer=void 0,this.backButtonContainer=void 0,this.pageNumberText=void 0,this.targetPage=0}preload(){Oi(this)}async create(){Ll.getInstance().setCurrentSceneRef(this),this.layerManager=new Ki(this),await this.preloadChapterAssets(),this.renderBackground(),this.renderChapters()}update(){if(!this.chaptersContainer)return;const e=-this.targetPage*Ls.x;if(this.chaptersContainer.x>e){const t=this.chaptersContainer.x-mo.scrollSpeed;this.chaptersContainer.x=Math.max(t,e)}else if(e>this.chaptersContainer.x){const t=this.chaptersContainer.x+mo.scrollSpeed;this.chaptersContainer.x=Math.min(t,e)}}cleanUp(){this.getLayerManager().clearAllLayers()}async preloadChapterAssets(){await Promise.all(this.getGameChapters().map((async e=>await co(this,e.imageUrl,xn(e.imageUrl,!0)))))}renderBackground(){const e=new Phaser.GameObjects.Image(this,_s.x,_s.y,on.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,_s.x,_s.y,Ls.x,Ls.y,0).setAlpha(.3);this.getLayerManager().addToLayer(hn.Background,e),this.getLayerManager().addToLayer(hn.Background,t)}renderChapters(){this.backButtonContainer=new vr(this,(()=>{this.cleanUp(),this.scene.start("MainMenu")})),this.chaptersContainer=this.createChaptersContainer(),this.pageNumberText=$s(this,`1 / ${this.numPages()}`,mo.pageNumberTextConfig,po);const e=Math.min(Ll.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,this.getGameChapters().length-1);this.targetPage=Math.floor(e/mo.grid.chapPerPage),this.targetPage<0&&(this.targetPage=0),this.pageNumberText.setText(`${this.targetPage+1} / ${this.numPages()}`);const t=new Phaser.GameObjects.Image(this,_s.x,_s.y,on.chapterSelectBorder.key),a=Wn(this,{assetKey:on.chapterSelectArrow.key,onUp:()=>this.scrollPrevPage()}).setPosition(_s.x-mo.arrow.xOffset,_s.y),s=Wn(this,{assetKey:on.chapterSelectArrow.key,onUp:()=>this.scrollNextPage()}).setPosition(_s.x+mo.arrow.xOffset,_s.y).setScale(-1,1);this.getLayerManager().addToLayer(hn.UI,this.chaptersContainer),this.getLayerManager().addToLayer(hn.UI,this.backButtonContainer),this.getLayerManager().addToLayer(hn.UI,this.pageNumberText),this.getLayerManager().addToLayer(hn.UI,t),this.getLayerManager().addToLayer(hn.UI,a),this.getLayerManager().addToLayer(hn.UI,s)}createChaptersContainer(){const e=new Phaser.GameObjects.Container(this,0,0);return e.add(this.getGameChapters().map(((e,t)=>el(this,e,t)))).sort("depth").reverse(),e}numPages(){const e=Math.ceil(this.getGameChapters().length/mo.grid.chapPerPage);return Math.max(e,1)}scrollPrevPage(){var e;this.targetPage=Math.max(this.targetPage-1,0),null===(e=this.pageNumberText)||void 0===e||e.setText(`${this.targetPage+1} / ${this.numPages()}`)}scrollNextPage(){var e;const t=this.numPages();this.targetPage=Math.min(this.targetPage+1,t-1),null===(e=this.pageNumberText)||void 0===e||e.setText(`${this.targetPage+1} / ${t}`)}}const al=tl,sl={key:Ns.alienCowsFont.key,size:80,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},nl=1500,il={text:{chapter:"Chapter completed.",checkpoint:"Checkpoint reached."},transitionTextConfig:{x:_s.x,y:_s.y,oriX:.5,oriY:.5},tweenDuration:nl,entryTween:{alpha:1,duration:nl,ease:"Power2"},exitTween:{alpha:0,duration:nl,ease:"Power2"}};class rl extends Phaser.Scene{constructor(){super("CheckpointTransition")}preload(){Ll.getInstance().setCurrentSceneRef(this)}async create(){if(Ll.getInstance().isGameType(Rl.Simulator))return await this.showTransitionText(il.text.checkpoint),void await async function(){const e=Ll.getInstance().getCurrentSceneRef(),t=Ll.getInstance().getSSChapterSimFilenames();if(!t.length)return void e.scene.start("GameSimulatorMenu");const a=t.pop();await ho(e,a,xo(a)),await ho(e,fo.defaultCheckpoint.key,fo.defaultCheckpoint.path);const s=e.cache.text.get(a),n=e.cache.text.get(fo.defaultCheckpoint.key);Jo.parse(n),Jo.parse(s,!0);const i=Jo.checkpoint;return e.scene.start("GameManager",{gameCheckpoint:i,chapterNum:-1,checkpointNum:-1}),!0}();const e=Ll.getInstance().getSaveManager().getFullSaveState(),t=Ll.getInstance().getGameChapters(),[a,s]=e.userSaveState.recentlyPlayedCheckpoint;return this.isLastCheckpoint(t,a,s)?(await Ll.getInstance().getSaveManager().saveChapterComplete(a),await this.showTransitionText(il.text.chapter),this.isLastChapter(t,a)?void this.scene.start("ChapterSelect"):void await Qo(!0,a+1,0)):(await this.showTransitionText(il.text.checkpoint),void await Qo(!1,a,s+1))}async showTransitionText(e){const t=$s(this,e,il.transitionTextConfig,sl).setAlpha(0);this.add.existing(t),this.tweens.add({targets:t,...il.entryTween}),await pn(2*il.tweenDuration),this.tweens.add({targets:t,...il.exitTween}),await pn(il.tweenDuration)}isLastCheckpoint(e,t,a){return a>=e[t].filenames.length-1}isLastChapter(e,t){return t>=e.length-1}}const ol=rl,ll={key:Ns.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},cl={text:{chapterSelect:"Play Chapter",studentRoom:"Go to My Room",awards:"Awards Hall",settings:"Settings",bindings:"Key Bindings"},button:{ySpace:.5*Ls.y},buttonTextConfig:{x:600,y:0,oriX:1,oriY:.1},banner:{xHide:300},onFocusTween:{x:_s.x+200,duration:200,ease:"Power2"},outFocusTween:{x:_s.x+300,duration:200,ease:"Power2"},saBanner:{x:.3*Ls.x,y:.9*Ls.y}};class dl extends Phaser.Scene{constructor(){super("MainMenu"),this.getLayerManager=()=>bn(this.layerManager)}async create(){Ll.getInstance().setCurrentSceneRef(this),this.layerManager=new Ki(this),this.renderBackground(),this.renderOptionButtons(),Zr(this,"T",1.12*_s.x,1.1*_s.y),Ll.getInstance().getSoundManager().playBgMusic(dn.galacticHarmony.key)}renderBackground(){const e=new Phaser.GameObjects.Image(this,_s.x,_s.y,on.spaceshipBg.key).setDisplaySize(Ls.x,Ls.y),t=Sn(this).setAlpha(.15),a=new Phaser.GameObjects.Image(this,cl.saBanner.x,cl.saBanner.y,on.saBanner.key).setAlpha(.7);this.getLayerManager().addToLayer(hn.Background,e),this.getLayerManager().addToLayer(hn.Background,t),this.getLayerManager().addToLayer(hn.Background,a)}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=Bs({direction:Gs.Column,numOfItems:t.length,maxYSpace:cl.button.ySpace});e.add(t.map(((e,t)=>this.createOptionButton(e.text,a[t][0]+cl.banner.xHide,a[t][1],e.callback)))),this.getLayerManager().addToLayer(hn.UI,e)}createOptionButton(e,t,a,s){const n=e=>{this.tweens.add({targets:e,...cl.onFocusTween})},i=e=>{this.tweens.add({targets:e,...cl.outFocusTween})},r=Wn(this,{assetKey:on.mainMenuOptBanner.key,message:e,textConfig:cl.buttonTextConfig,bitMapTextStyle:ll,onUp:s,onHover:()=>n(r),onOut:()=>i(r),onHoverEffect:!1}).setPosition(t,a);return r}getOptionButtons(){return[{text:cl.text.chapterSelect,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("ChapterSelect")}},{text:cl.text.awards,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("AwardsHall")}},{text:cl.text.studentRoom,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("RoomPreview")}},{text:cl.text.settings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Settings")}},{text:cl.text.bindings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Bindings")}}]}}const hl=dl;var ul=a(92906);const gl='\nimport { prepend_remote_url, get_screen_width, get_screen_height, load_image, create_image, create_text, create_rect, add, set_display_size, set_alpha, set_origin } from \'game\';\n\nfunction preload() {\n    load_image("galaxy", prepend_remote_url("/locations/galaxy/normal.png"));\n}\n\nfunction create() {\n    const width = get_screen_width();\n    const height = get_screen_height();\n    const centre_x = width / 2;\n    const centre_y = height / 2;\n\n    const image = create_image(centre_x, centre_y, "galaxy");\n    const image_resized = set_display_size(image, width, height);\n\n    const black_tint = create_rect(centre_x, centre_y, width, height, 0x000011);\n    const black_tint_alpha = set_alpha(black_tint, 0.5);\n\n    const text = create_text(centre_x, centre_y, "Unable to fetch mission!");\n    const text_repos = set_origin(text, 0.5, 0.5);\n\n    add(image_resized);\n    add(black_tint_alpha);\n    add(text_repos);\n}\n\nfunction update() {}\n',pl={key:Ns.pixelFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ml={assessmentNumber:"MYROOM",verifiedText:"VERIFIED",tag:{width:128,height:50},hoverTagTextConfig:{x:64,y:0,oriX:.5,oriY:.55},refreshButton:{x:.95*Ls.x,y:.92*Ls.y}};var xl=a(71829);async function bl(){const e=await async function(){const e=(await(0,xl.$C)(Ll.getInstance().getAccountInfo())||[]).find((e=>e.number===ml.assessmentNumber));return e?e.id:null}();if(!e)return yl(null);return yl(await(0,xl.AZ)(e,Ll.getInstance().getAccountInfo()))}function yl(e){if(e){const t=e.questions[0],a=t.answer;return a||t.solutionTemplate}return gl}class fl extends Phaser.Scene{constructor(){super("RoomPreview"),this.sceneLoaded=!1,this.getVerifCont=()=>bn(this.verifCont),this.getUserStateManager=()=>Ll.getInstance().getUserStateManager(),this.getInputManager=()=>bn(this.inputManager),this.getLayerManager=()=>bn(this.layerManager),this.getPhaseManager=()=>bn(this.phaseManager),this.getEscapeManager=()=>bn(this.escapeManager),this.getCollectibleManager=()=>bn(this.collectibleManager),this.getAchievementManager=()=>bn(this.achievementManager),this.getToolbarManager=()=>bn(this.toolbarManager),this.getDashboardManager=()=>bn(this.dashboardManager),this.preloadImageMap=new Map,this.preloadSoundMap=new Map,this.preloadSpritesheetMap=new Map,this.studentCode=gl}init(){Ll.getInstance().setCurrentSceneRef(this),this.studentCode=Ll.getInstance().getRoomCode(),this.createContext()}preload(){Oi(this),this.verifCont=(e=>{const t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Rectangle(e,0,0,ml.tag.width,ml.tag.height,Ds.darkBlue).setOrigin(0,.5).setAlpha(.8),s=new Phaser.GameObjects.Sprite(e,0,0,on.verifiedFrame.key).setOrigin(0,.5),n=new Phaser.GameObjects.Rectangle(e,0,.5*-a.height,a.width,.05*a.height,Ds.offWhite).setOrigin(0,0),i=$s(e,ml.verifiedText,ml.hoverTagTextConfig,pl).setBlendMode(Phaser.BlendModes.DIFFERENCE);return e.tweens.add({targets:n,alpha:.2,y:.35*a.height,duration:2e3,ease:"Power0",yoyo:!0,loop:-1}),t.add([a,i,n,s]),t.setVisible(!1),t})(this)}async create(){await this.eval(this.studentCode),this.renderDefaultBackground(),await this.eval("preload();"),await Promise.all(Array.from(this.preloadImageMap).map((async([e,t])=>{await co(this,e,t)}))),await Promise.all(Array.from(this.preloadSoundMap).map((async([e,t])=>{var a,s,n;await(a=this,s=e,n=t,new Promise((e=>{null!==a.sound.get(s)?e(s):(a.load.audio(s,n).on("filecomplete",e),a.load.start())})))}))),await Promise.all(Array.from(this.preloadSpritesheetMap).map((async([e,[t,a]])=>{await((e,t,a,s)=>new Promise((n=>{"__MISSING"!==e.textures.get(t).key?n(t):(e.load.spritesheet(t,a,s),e.load.once(`filecomplete-spritesheet-${t}`,n),e.load.once("loaderror",n),e.load.start())})))(this,e,t,a)})));const e=new Hs(this,ml.refreshButton.x-200,ml.refreshButton.y-30,"Refresh Room"),t=Wn(this,{assetKey:on.chapterRepeatButton.key,onUp:async()=>{await Ll.getInstance().loadRoomCode(),this.studentCode=Ll.getInstance().getRoomCode(),this.getLayerManager().clearAllLayers(),this.sound.stopAll(),this.sceneLoaded=!1,this.scene.restart()},onHover:()=>e.setVisible(!0),onOut:()=>e.setVisible(!1)}).setPosition(ml.refreshButton.x,ml.refreshButton.y);await this.eval("create();"),Ll.getInstance().getSoundManager().playBgMusic(Rs.nullInteractionId),this.initialiseManagers(),this.bindKeyboardTriggers(),this.getLayerManager().addToLayer(hn.UI,this.getVerifCont()),this.getLayerManager().addToLayer(hn.UI,t),this.getLayerManager().addToLayer(hn.UI,e),this.getToolbarManager().renderToolbarContainer(),this.sceneLoaded=!0}update(){this.sceneLoaded&&this.eval("update();")}createContext(){this.context=(0,ul.kr)(D.Chapter.SOURCE_4,[],"playground",D.Variant.DEFAULT),this.context.moduleContexts.game={tabs:null,state:{scene:this,preloadImageMap:this.preloadImageMap,preloadSoundMap:this.preloadSoundMap,preloadSpritesheetMap:this.preloadSpritesheetMap,remotePath:e=>xn(e,!0),screenSize:Ls,createAward:(e,t,a)=>this.createAward(e,t,a)}}}async eval(e){await(0,oe.runInContext)(e,this.context)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",(async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase(Yn.EscapeMenu)})),this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",(async()=>{this.getPhaseManager().isCurrentPhase(Yn.Dashboard)?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase(Yn.Dashboard):await this.getPhaseManager().pushPhase(Yn.Dashboard)}))}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createAward(e,t,a){const s=this.getUserStateManager().getAchievements(),n=this.getUserStateManager().getCollectibles(),i=new Phaser.GameObjects.Sprite(this,e,t,on.cookies.key);if(!s.includes(a)&&!n.includes(a))return i;const r=sn(a);if(!r.completed)return i;const o=new Phaser.GameObjects.Sprite(this,e,t,r.assetKey);return this.attachVerificationTag(o)}attachVerificationTag(e){const t=this.getVerifCont();return e.setInteractive({pixelPerfect:!0,useHandCursor:!0}),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>t.setVisible(!0))),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>t.setVisible(!1))),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e=>{t.x=e.x+10,t.y=e.y-10})),e}renderDefaultBackground(){const e=new Phaser.GameObjects.Image(this,_s.x,_s.y,this.getDefaultBackgroundKey());di(e,Ls.x,Ls.y),this.add.existing(e)}getDefaultBackgroundKey(){const e=this.getUserStateManager().getAssessments().reverse(),t=Ll.getInstance().getRoomPreviewMapping();for(let a=0;a<e.length;a++)if(t.has(e[a]))return e[a];return on.sourceCrashedPod.key}initialiseManagers(){this.layerManager=new Ki(this),this.inputManager=new Un(this),this.phaseManager=new sr(new Map([[Yn.None,new Gr]]),this.inputManager),this.escapeManager=new Xi(this),this.collectibleManager=new ui(this,Ll.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new ui(this,Ll.getInstance().getUserStateManager().getAchievements),this.toolbarManager=new xr(this),this.dashboardManager=new vi(this,[fi.Collectibles,fi.Achievements],[this.collectibleManager,this.achievementManager])}}class vl extends Phaser.Scene{constructor(){super("Settings"),this.getSaveManager=()=>Ll.getInstance().getSaveManager(),this.getLayerManager=()=>bn(this.layerManager)}async create(){Ll.getInstance().setCurrentSceneRef(this),this.layerManager=new Ki(this),this.renderBackground(),this.renderOptions()}renderBackground(){const e=new Phaser.GameObjects.Image(this,_s.x,_s.y,on.spaceshipBg.key),t=new Phaser.GameObjects.Image(this,_s.x,_s.y,on.settingBanner.key);this.getLayerManager().addToLayer(hn.Background,e),this.getLayerManager().addToLayer(hn.Background,t)}renderOptions(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getSettingsHeader(),a=Bs({direction:Gs.Column,numOfItems:t.length,maxYSpace:zi.opt.ySpace});e.add(t.map(((e,t)=>this.createOptionHeader(e,a[t][1]))));const{bgmVolume:s,sfxVolume:n}=this.getSaveManager().getSettings(),i=zi.volContainerOpts.findIndex((e=>parseFloat(e)===n)),r=zi.volContainerOpts.findIndex((e=>parseFloat(e)===s));this.sfxVolumeRadioButtons=this.createOptRadioOptions(i,a[0][1]),this.bgmVolumeRadioButtons=this.createOptRadioOptions(r,a[1][1]);const o=Wn(this,{assetKey:on.mediumButton.key,message:"Apply Settings",textConfig:{x:0,y:0,oriX:.33,oriY:.85},bitMapTextStyle:Fi,onUp:()=>this.applySettings()}).setPosition(_s.x,.925*Ls.y),l=new vr(this,(()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(hn.UI,e),this.getLayerManager().addToLayer(hn.UI,this.sfxVolumeRadioButtons),this.getLayerManager().addToLayer(hn.UI,this.bgmVolumeRadioButtons),this.getLayerManager().addToLayer(hn.UI,o),this.getLayerManager().addToLayer(hn.UI,l)}getSettingsHeader(){return["SFX","BGM"]}createOptionHeader(e,t){const a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Image(this,_s.x,0,on.settingOption.key),n=$s(this,e,zi.optHeaderTextConfig,Ui);return a.add([s,n]),a}createOptRadioOptions(e,t){return new Gi(this,{choices:zi.volContainerOpts,defaultChoiceIdx:e,maxXSpace:zi.opt.xSpace,choiceTextConfig:zi.radioButtonsTextConfig,bitmapTextStyle:Bi},zi.opt.x,-_s.y+t)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t=this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1;await this.getSaveManager().saveSettings({bgmVolume:t,sfxVolume:e}),Ll.getInstance().getSoundManager().applyUserSettings(this.getSaveManager().getSettings())}}const jl=vl;const Cl=class{constructor(){this.getBaseSoundManager=()=>this.getCurrentScene().sound,this.getCurrentScene=()=>bn(Ll.getInstance().getCurrentSceneRef()),this.soundAssetMap=new Map,this.bgmVol=1,this.sfxVol=1,this.currBgMusicKey=Rs.nullInteractionId}applyUserSettings(e){if(this.bgmVol=void 0!==e.bgmVolume?e.bgmVolume:1,this.sfxVol=void 0!==e.sfxVolume?e.sfxVolume:1,this.currBgMusic&&this.currBgMusic.isPlaying){const e=bn(this.getSoundAsset(this.currBgMusicKey)),t=void 0!==e.config.volume?e.config.volume:1;this.currBgMusic.setVolume(t*this.bgmVol)}}addSoundAsset(e){this.soundAssetMap.set(e.key,e)}getSoundAsset(e){return this.soundAssetMap.get(e)}loadSounds(e){e.forEach((e=>{this.addSoundAsset(e),this.loadSound(e.key,xn(e.path,!0))}))}loadSoundAssetMap(e){Object.values(e).forEach((e=>{this.addSoundAsset(e),this.loadSound(e.key,xn(e.path,!1))}))}loadSound(e,t){this.getCurrentScene().load.audio(e,t)}playSound(e){const t=this.getSoundAsset(e);if(t){const e=void 0!==t.config.volume?t.config.volume:1;this.getBaseSoundManager().play(t.key,{...t.config,volume:e*this.sfxVol})}}playBgMusic(e,t){if(!Ll.getInstance().isMounted)return;if(this.currBgMusicKey===e)return;if(e===Rs.nullInteractionId&&this.currBgMusic)return this.fadeOutAndDestroyMusic(this.currBgMusic,t),this.currBgMusic=void 0,void(this.currBgMusicKey=e);this.currBgMusic&&this.fadeOutAndDestroyMusic(this.currBgMusic);const a=bn(this.getSoundAsset(e)),s=void 0!==a.config.volume?a.config.volume:1;this.currBgMusic=this.getBaseSoundManager().add(a.key,{...a.config,volume:s*this.bgmVol}),this.currBgMusicKey=a.key,this.currBgMusic.play()}fadeOutAndDestroyMusic(e,t=1e3){this.getCurrentScene().tweens.add({targets:e,...ln,duration:t}),setTimeout((()=>e.destroy()),2*t)}stopAllSound(){this.getBaseSoundManager().stopAll()}pauseCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPlaying&&this.currBgMusic.pause()}continueCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPaused&&this.currBgMusic.play()}};var Sl=a(18371);const kl=[{title:"Spaceship Emergency",imageUrl:"/locations/planet-y-orbit/crashing.png",filenames:["../../assets/mockChapter0.txt","../../assets/mockChapter0.1.txt"]},{title:"Alien Attack",imageUrl:"/locations/telebay/emergency.png",filenames:["../../assets/mockChapter1.txt"]},{title:"Jedi Master",imageUrl:"/locations/classroom/normal.png",filenames:["../../assets/mockChapter2.txt"]}];class Il{static parse(e){Il.awardsMapping=new Map;const t=ki.splitToLines(e);return ki.splitToParagraph(t).forEach((([,e])=>{Il.parseAwardParagraphs(e)})),this.awardsMapping}static parseAwardParagraphs(e){ki.splitToParagraph(e).forEach((([e,t])=>{const[a,s,n,i]=ki.splitWithLimit(t[0],",",3);Il.awardsMapping.set(e,{id:e,assetKey:a,assetPath:xn(s,!0),title:n,description:i,completed:!0})}))}}const wl=Il;class Al{static parse(e){Al.backgroundMapping=new Map;const t=ki.splitToLines(e);return ki.splitToParagraph(t).forEach((([e,t])=>{Al.backgroundMapping.set(e,xn(t[0],!0))})),Al.backgroundMapping}}const Tl=Al;class Ml extends Phaser.Scene{constructor(){super("Entry")}async preload(){Ll.getInstance().setCurrentSceneRef(this),this.preloadAssets(),Oi(this),await Ll.getInstance().loadGameChapters(),await Ll.getInstance().loadRoomCode(),await Ll.getInstance().getSaveManager().loadLastSaveState()}async create(){await this.preloadAwards(),await Ll.getInstance().getUserStateManager().loadUserState(),await this.preloadRoomPreviewBackgrounds(),this.applyLoadedSettings(),this.scene.start("MainMenu")}applyLoadedSettings(){const e=Ll.getInstance().getSaveManager().getSettings();Ll.getInstance().getSoundManager().applyUserSettings(e)}async preloadAwards(){const e=this.cache.text.get(fo.awardsMapping.key)||"",t=wl.parse(e);Ll.getInstance().setAwardsMapping(t),await Promise.all(Array.from(t.values()).map((async e=>await co(this,e.assetKey,e.assetPath))))}async preloadRoomPreviewBackgrounds(){const e=this.cache.text.get(fo.roomPreviewMapping.key)||"",t=Tl.parse(e);Ll.getInstance().setRoomPreviewMapping(t),await Promise.all(Array.from(t.entries()).map((async([e,t])=>await co(this,e,t))))}preloadAssets(){Ll.getInstance().getSoundManager().loadSoundAssetMap(dn),Object.values(on).forEach((e=>this.load.image(e.key,xn(e.path,!1)))),Object.values(Ns).forEach((e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))),Object.values(fo).forEach((e=>this.load.text(e.key,e.path)))}}const Pl=Ml;class El{constructor(){this.getCollectibles=()=>Array.from(this.collectibles),this.getAchievements=()=>Array.from(this.achievements),this.getAssessments=()=>Array.from(this.assessments),this.collectibles=new Set([]),this.achievements=new Set([]),this.assessments=new Set([])}async loadUserState(){Ll.getInstance().isGameType(Rl.Simulator)||(await this.loadAchievements(),await this.loadAssessments(),this.collectibles=new Set(Ll.getInstance().getSaveManager().getLoadedUserState().collectibles))}addCollectible(e){this.collectibles.add(e)}async loadAssessments(){const e=await(0,xl.$C)(Ll.getInstance().getAccountInfo());this.assessments=new Set((e||[]).filter((e=>"submitted"===e.status)).sort(((e,t)=>e.closeAt<=t.closeAt?-1:1)).map((e=>e.id.toString())))}async isInUserState(e,t){if(Ll.getInstance().isGameType(Rl.Game))return this[e].has(t);return 0===await qn(ei.getInstance().getGameManager(),`${ki.capitalize(e)} ${t}?`,["Yes","No"])}async loadAchievements(){const e=Ll.getInstance().getAwardsMapping(),t=Ll.getInstance().getAchievements(),a=Ll.getInstance().getGoals(),s=new Map;a.forEach((e=>s.set(e.uuid,e))),t.forEach((t=>{const a=t.uuid.toString(),n=t.goalUuids.reduce(((e,t)=>{var a;return e&&!(null===(a=s.get(t))||void 0===a||!a.completed)}),!0),i=e.get(a);if(i){const e={...i,completed:n};Ll.getInstance().addAwardMapping(e.assetKey,e),this.achievements.add(e.assetKey)}}))}}var Nl;let Rl=function(e){return e.Simulator="Simulator",e.Game="Game",e}({});class Ll extends Es.Game{constructor(e,t){super(e),this.getAwardsMapping=()=>bn(this.global.awardsMapping),this.getAccountInfo=()=>bn(this.global.accountInfo),this.getAchievements=()=>bn(this.global.achievements),this.getSoundManager=()=>bn(this.global.soundManager),this.getGoals=()=>bn(this.global.goals),this.getRoomPreviewMapping=()=>bn(this.global.roomPreviewMapping),this.getUserStateManager=()=>bn(this.global.userStateManager),this.getSaveManager=()=>bn(this.global.saveManager),this.getCurrentSceneRef=()=>bn(this.global.currentSceneRef),this.isGameType=e=>this.global.gameType===e,this.getSSChapterSimFilenames=()=>this.global.ssChapterSimFilenames,this.getIsUsingMock=()=>this.global.isUsingMock,this.getRoomCode=()=>this.global.roomCode,this.getGameChapters=()=>this.global.isUsingMock?kl:this.global.gameChapters,Ll.instance=this,this.isMounted=!0,this.global={awardsMapping:new Map,accountInfo:void 0,achievements:void 0,currentSceneRef:void 0,gameChapters:[],gameType:t,goals:void 0,isUsingMock:!1,roomCode:"",roomPreviewMapping:new Map,saveManager:new Hr,setGameSimState:Rs.nullFunction,soundManager:new Cl,ssChapterSimFilenames:[],userStateManager:new El}}stopAllSounds(){this.sound.stopAll()}setAccountInfo(e){this.global.accountInfo=e}setAchievements(e){this.global.achievements=e}setAwardsMapping(e){this.global.awardsMapping=e}addAwardMapping(e,t){this.global.awardsMapping.set(e,t)}setGoals(e){this.global.goals=e}setGameSimStateSetter(e){this.setGameSimState=e}setRoomPreviewMapping(e){this.global.roomPreviewMapping=e}async loadGameChapters(){this.global.gameChapters=await async function(){const e=gn.h.getState().session.courseId,t=await(0,Sl.WY)(`courses/${e}/stories`,"GET",{accessToken:Ll.getInstance().getAccountInfo().accessToken,refreshToken:Ll.getInstance().getAccountInfo().refreshToken});if(!t)return[];const a=200===t.status?await t.json():[],s=R().sortBy(a,(e=>new Date(e.openAt)));return s.forEach((e=>e.filenames=e.filenames.map(xo))),s}()}async loadRoomCode(){this.global.roomCode=await bl()}setGameSimState(e){this.global.setGameSimState(e)}setCurrentSceneRef(e){this.global.currentSceneRef=e}toggleUsingMock(e){this.global.isUsingMock=void 0===e?!this.global.isUsingMock:e}setChapterSimStack(e){this.global.ssChapterSimFilenames=e.reverse()}}Nl=Ll,Ll.getInstance=()=>bn(Nl.instance);const _l={debug:!0,type:Es.CANVAS,width:Ls.x,height:Ls.y,physics:{default:"arcade"},scale:{mode:Es.Scale.FIT,parent:"game-display"},fps:{target:24},scene:[Pl,hl,jl,al,Vr,ol,so,fl,lo]},Ol=()=>new Ll(_l,Rl.Game);async function Dl(e){if("student"!==Ll.getInstance().getAccountInfo().role)return;const t={method:"PUT",headers:Gl(Ll.getInstance().getAccountInfo().accessToken),body:JSON.stringify({gameStates:e})},a=await fetch(`${y.Z.backendUrl}/v2/courses/${yn()}/user/game_states`,t);return a&&a.ok?a:void 0}function Gl(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t.append("Content-Type","application/json"),t}const Bl=function(){const e=(0,j.ix)((e=>e.session)),t=(0,d.I0)(),a=(0,j.ix)((e=>e.achievement.achievements)),s=(0,j.ix)((e=>e.achievement.goals)),[n,i]=c.useState(!1),[r,o]=c.useState(!1);c.useEffect((()=>{t((0,Kt.getAchievements)()),t((0,Kt.getOwnGoals)())}),[t]),c.useEffect((()=>{const e=Ol();return()=>{e.isMounted=!1,e.stopAllSounds(),e.destroy(!0)}}),[]),c.useEffect((()=>{Ll.getInstance().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name}),Ll.getInstance().setAchievements(a),Ll.getInstance().setGoals(s)}),[e,a,s]);const{ref:l,toggle:h,fullscreen:u}=(0,Ps.O)(),g=c.useRef(null),p=c.useCallback((e=>{g.current=e,l(e)}),[l]),[m,x]=c.useState(0),[b,y]=c.useState("0px"),[v,C]=c.useState("0px");return c.useEffect((()=>{const e=()=>{if(g.current){const e=16/9,t=g.current.offsetHeight,a=g.current.offsetWidth,s=t/50,n=u||t*e>a?0:(a-t*e)/2;x(t/40),C(`${s}px`),y(`${n}px`)}},t=()=>{setTimeout(e,100)};return window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)}),[u]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{id:"game-display",ref:p,children:(0,f.jsx)(I.I,{id:"fullscreen-button",icon:u?E.d.MINIMIZE:E.d.FULLSCREEN,color:"white",htmlTitle:u?"Exit full screen":"Full screen",size:m,onClick:async()=>{h(),window.screen.orientation&&(u?window.screen.orientation.unlock():window.screen.orientation.lock("landscape"))},style:{left:b,padding:v}})}),n&&(0,f.jsxs)("div",{className:"Horizontal",children:[(0,f.jsx)("button",{onClick:async()=>{await Dl({}),alert("Game cleared! Please refresh")},children:"Clear data"}),(0,f.jsx)("button",{onClick:()=>{o(!r),Ll.getInstance().toggleUsingMock()},children:r?"Use Game Chapters":"Use Mock Chapters"})]})]})},Ul=()=>{const e=new Headers;return e.append("Access-Control-Allow-Origin","*"),e},Fl=e=>(e.setFullYear(e.getFullYear()+1),e),zl={debug:!0,type:Es.CANVAS,width:Ls.x,height:Ls.y,physics:{default:"arcade"},scale:{mode:Es.Scale.FIT,parent:"game-display"},fps:{target:24}},Vl={gameSimBg:{type:nn.Image,key:"student-room",path:"/locations/deathCube_ext/shields-down.png"},shortButton:{type:nn.Image,key:"short-button",path:"/ui/shortButton.png"},invertedButton:{type:nn.Image,key:"inverted-button",path:"/ui/invertedColorButton.png"},blueUnderlay:{type:nn.Image,key:"blue-underlay",path:"/ui/blueUnderlay.png"},topButton:{type:nn.Image,key:"top-button",path:"/ui/topButton.png"},colorIcon:{type:nn.Image,key:"color-icon",path:"/ui/colorIcon.png"},imageIcon:{type:nn.Image,key:"image-icon",path:"/ui/imageIcon.png"},bboxIcon:{type:nn.Image,key:"bbox-icon",path:"/ui/bboxIcon.png"},handIcon:{type:nn.Image,key:"hand-icon",path:"/ui/handIcon.png"},listIcon:{type:nn.Image,key:"list-icon",path:"/ui/listIcon.png"},eraseIcon:{type:nn.Image,key:"erase-icon",path:"/ui/eraserIcon.png"},iconBg:{type:nn.Image,key:"icon-bg",path:"/ui/modeIconBg.png"}},Hl={key:Ns.zektonDarkFont.key,size:35,align:Es.GameObjects.BitmapText.ALIGN_CENTER},$l={maxOptButtonsRow:2,optButton:{xSpace:.9*Ls.x,ySpace:.5*Ls.y},gameTxtStorageName:{defaultChapter:"defaultChapter",checkpointTxt:"checkpointTxt"}},Wl={id:-1,title:"",imageUrl:"/locations/spaceshipBackground.png",openAt:(new Date).toISOString(),closeAt:Fl(new Date).toISOString(),isPublished:!1,filenames:[]};let Xl=function(e){return e.DEFAULT="DEFAULT",e.ASSETVIEWER="ASSETVIEWER",e.CHAPTERSIMULATOR="CHAPTERSIMULATOR",e.CHAPTERPUBLISHER="CHAPTERPUBLISHER",e}({});class Kl extends Phaser.Scene{constructor(){super("GameSimulatorMenu"),this.getLayerManager=()=>bn(this.layerManager)}preload(){Ll.getInstance().setCurrentSceneRef(this),this.layerManager=new Ki(this),Oi(this),Object.values(on).forEach((e=>this.load.image(e.key,xn(e.path,!1)))),Object.values(Vl).forEach((e=>this.load.image(e.key,xn(e.path,!1)))),Object.values(Ns).forEach((e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))),Ll.getInstance().getSoundManager().loadSoundAssetMap(dn)}async create(){"student"!==Ll.getInstance().getAccountInfo().role?(this.renderBackground(),this.renderOptionButtons()):console.log("Students cannot use Game sim")}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=Bs({numOfItems:t.length,maxXSpace:$l.optButton.xSpace,maxYSpace:$l.optButton.ySpace,numItemLimit:$l.maxOptButtonsRow,redistributeLast:!0});e.add(t.map(((e,t)=>this.createOptButton(e.text,a[t][0],a[t][1],e.callback)))),this.getLayerManager().addToLayer(hn.UI,e)}getOptionButtons(){return[{text:"Simulate Chapters",callback:()=>{Ll.getInstance().setGameSimState(Xl.CHAPTERSIMULATOR)}},{text:"Publish / Edit Chapters",callback:()=>{Ll.getInstance().setGameSimState(Xl.CHAPTERPUBLISHER)}},{text:"View / Upload Assets",callback:()=>{Ll.getInstance().setGameSimState(Xl.ASSETVIEWER)}}]}createOptButton(e,t,a,s){return Wn(this,{assetKey:Vl.invertedButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.5},bitMapTextStyle:Hl,onUp:s}).setPosition(t,a)}simulateCheckpoint(){const e=sessionStorage.getItem($l.gameTxtStorageName.defaultChapter)||"",t=sessionStorage.getItem($l.gameTxtStorageName.checkpointTxt)||"";if(""===e&&""===t)return;this.getLayerManager().clearAllLayers(),Jo.parse(e),t&&Jo.parse(t,!0);const a=Jo.checkpoint;this.scene.start("GameManager",{gameCheckpoint:a,chapterNum:-1,checkpointNum:-1})}renderBackground(){const e=new Phaser.GameObjects.Image(this,_s.x,_s.y,Vl.gameSimBg.key);e.setDisplaySize(Ls.x,Ls.y);const t=new Phaser.GameObjects.Image(this,_s.x,_s.y,Vl.blueUnderlay.key).setAlpha(.5);this.getLayerManager().addToLayer(hn.Background,e),this.getLayerManager().addToLayer(hn.Background,t)}}const Zl=Kl;var ql=a(27513);const Yl=e=>async(t,a,s={},n={})=>{try{const i=function(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t}(Ll.getInstance().getAccountInfo().accessToken||"");Object.entries(s).forEach((([e,t])=>{i.append(e,t)}));const r={method:a,headers:i,...n};return fetch(y.Z.backendUrl+`/v2/courses/${yn()}/${e}/`+t,r)}finally{}},Jl=Yl("admin/assets"),Ql=Yl("stories"),ec=Yl("admin/stories");const tc=["locations","objects","images","avatars","ui","sfx","bgm","stories"];const ac=async()=>(await nc("stories")).filter((e=>e.startsWith("stories")&&e.endsWith("txt"))).map((e=>e.slice(8)));async function sc(){return(await Promise.all(tc.map((async e=>{const t=await nc(e);return t.length?t:[`${e}`]})))).reduce(((e,t)=>e.concat(t)),[])}async function nc(e){const t=await Jl(e,"GET",{"Content-Type":"application/json"});return 200===t.status?t.json():[]}async function ic(e,t){const a=await Promise.all(Array.from(e).map((async e=>{const a=await async function(e,t){const a=new FormData;a.set("upload",e);const s=await Jl(`${t}/${e.name}`,"POST",{},{body:a,mode:"cors"});return s?s.text():""}(e,t);return e.name+" => "+a})));return a.join("\n")}async function rc(){const e=await Ql("","GET"),t=200===e.status?await e.json():[];return R().sortBy(t,(e=>new Date(e.openAt)))}async function oc(e,t){const a=await ec(e,"POST",{"Content-Type":"application/json"},{body:JSON.stringify(t)});return 200===a.status?"Chapter successfully created/updated":a.text()}const lc=({assetPath:e})=>{const t=e||Rs.defaultAssetPath;return(0,f.jsx)("img",{alt:"asset",crossOrigin:"anonymous",src:xn(t,!!e),width:"150px",onError:e=>{e.target.onerror=null,e.target.src=xn(Rs.defaultAssetPath,!1)}})},cc=(0,c.memo)(lc);var dc=a(44805);const hc=()=>{const[e,t]=(0,c.useState)(),[a,s]=(0,c.useState)(tc[0]),[n,i]=(0,c.useState)(),[r,o]=(0,c.useState)(!1);function l(e){e.target.innerText&&(s(e.target.innerText),o(!1))}const d=(0,f.jsxs)(dc.v,{children:[tc.map((e=>(0,f.jsx)(tt.s,{onClick:l,id:e,text:e},e))),(0,f.jsx)(tt.s,{onClick:function(e){e.target.innerText&&(s(e.target.innerText),o(!0))},text:"Custom Folder"})]});return(0,f.jsxs)("div",{className:"LeftAlign",children:[(0,f.jsx)("h4",{children:"Choose a Folder to upload an asset to:"}),(0,f.jsx)(Oe.J,{placement:P.Ly.BOTTOM,content:d,children:(0,f.jsx)(m.z,{text:a})}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),r&&(0,f.jsx)(Wa.B,{placeholder:"Specify your own custom folder: e.g. 'locations/hallway'",onChange:function(e){i(e.target.value)}}),(0,f.jsx)("h4",{children:"Choose the asset File to be uploaded:"}),(0,f.jsx)("input",{type:"file",multiple:!0,onChange:function(e){if(!e.target.files)return;const a=e.target.files;t(a)}}),(0,f.jsx)(m.z,{onClick:async function(){const t=n||a;if(!e||!t)return;const s=await ic(e,t);alert(s)},children:"Upload"})]})};function uc(e,t){e&&e.forEach((e=>{t(e),uc(e.childNodes,t)}))}const gc=()=>{const{value:e}=(0,j.QT)(sc,[]),[t,a]=c.useState(""),[s,n]=c.useState([]);c.useEffect((()=>{n(function(e,t,a=[]){const s={};e.forEach((e=>(0,N.set)(s,e.split("/"),"FILE"))),a.forEach((e=>{s[e]&&"FILE"!==s[e]||(s[e]=[])}));const n=(e,a)=>Object.keys(a).map((s=>{const i="/"+e.join("/")+"/"+s;return{id:i,label:s,secondaryLabel:t(i),childNodes:"FILE"===a[s]?void 0:n([...e,s],a[s])}}));return n([],s)}(e,(e=>(0,f.jsx)(w.u,{content:"Delete",children:(0,f.jsx)(I.I,{icon:"trash",onClick:async()=>{const t=window.confirm(`Are you sure you want to delete ${e}?`);alert(t?await async function(e){const t=await Jl(e,"DELETE");return await t.text()||"Successfully Deleted"}(e):"Please double check before deleting an asset!\nThere is NO undoing this action!")}})})),tc))}),[e]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h3",{children:"View / Upload Assets"}),(0,f.jsxs)(ss.mQ,{animate:!0,id:"assetviewer",renderActiveTabPanelOnly:!0,children:[(0,f.jsx)(ns.O,{id:"view",title:"View Assets",panel:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(cc,{assetPath:t}),(0,f.jsx)("hr",{}),(0,f.jsx)("br",{}),(0,f.jsx)(ql.m,{contents:s,onNodeClick:(e,t)=>{const i=e.id.toString();e.childNodes||a(i);const r=(0,N.cloneDeep)(s),o=ql.m.nodeFromPath(t,r).isSelected;uc(r,(e=>e.isSelected=!1)),ql.m.nodeFromPath(t,r).isSelected=null===o||!o,ql.m.nodeFromPath(t,r).isExpanded=!ql.m.nodeFromPath(t,r).isExpanded,n(r)}})]})}),(0,f.jsx)(ns.O,{id:"upload",title:"Upload Assets",panel:(0,f.jsx)(hc,{})})]})]})};var pc=a(73074),mc=a(28488);const xc=c.memo((0,mc.W8)((({value:e})=>(0,f.jsx)("div",{children:(0,f.jsx)(m.z,{children:e})})))),bc=c.memo((0,mc.JN)((({items:e})=>(0,f.jsx)("div",{children:e&&e.map(((e,t)=>(0,f.jsx)(xc,{index:t,value:e},`item-${e}`)))})))),yc=({chapterDetail:e,chapterFilenames:t})=>{const{id:a}=e,{value:n,setValue:i,inputProps:r}=(0,j.Gl)(""),{value:o,setValue:l,inputProps:d}=(0,j.Gl)(""),{items:h,setItems:u,onSortEnd:g}=(()=>{const[e,t]=c.useState([]),a=c.useCallback((({oldIndex:e,newIndex:a})=>{t((t=>(0,pc.q)(t,e,a)))}),[]);return{items:e,setItems:t,onSortEnd:a}})(),[p,b]=(0,c.useState)(!1),[y,v]=(0,c.useState)(new Date),[C,S]=(0,c.useState)([]),[k,I]=(0,c.useState)(!1);(0,c.useEffect)((()=>{i(e.title),l(e.imageUrl),v(new Date(e.openAt)),u(e.filenames),b(e.isPublished),S((t||[]).filter((t=>!e.filenames.includes(t))))}),[e,u,l,v,i,t,k]);const w=(0,c.useCallback)((e=>{u((t=>t.filter((t=>t!==e)))),S((t=>[...t,e]))}),[u]),A=(0,c.useCallback)((e=>{u((t=>[...t,e])),S((t=>t.filter((t=>t!==e))))}),[u]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("h4",{children:["Title:"," ",(0,f.jsx)("input",{className:s.O4S,type:"text",placeholder:"New title",...r})]}),(0,f.jsx)("b",{children:"Open date: "}),y&&(0,Pe.gS)(y.toISOString()),(0,f.jsx)(dt.M,{onChange:e=>{e&&v(e)},showActionsBar:!0,highlightCurrentDay:!0}),(0,f.jsxs)("h4",{children:["Chapter Preview Image URL:"," ",(0,f.jsx)("input",{className:s.O4S,type:"text",...d})]}),(0,f.jsx)("h4",{children:"Chapter Files (.txt):"}),(0,f.jsx)(bc,{items:h,onSortEnd:g}),h.length>0?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{icon:"delete",onClick:()=>h.map(w),children:"Clear all selected files"}),(0,f.jsx)("br",{})]}):(0,f.jsx)("p",{children:"No file has been selected yet."}),(0,f.jsx)("br",{}),(0,f.jsx)("h4",{children:"All Available Chapter Files (.txt)"}),C&&C.map((e=>(0,f.jsx)("div",{children:(0,f.jsx)(m.z,{onClick:()=>A(e),icon:"add",children:e})},`choice-${e}`))),(0,f.jsx)("br",{}),(0,f.jsx)("hr",{}),(0,f.jsx)("br",{}),(0,f.jsx)(et.rs,{checked:p,labelElement:"Published",onChange:()=>b(!p)}),(0,f.jsx)(m.z,{onClick:async()=>{const e={openAt:y.toISOString(),closeAt:Fl(y).toISOString(),title:n,filenames:h,imageUrl:o,isPublished:p};if(!window.confirm(`Are you sure you want to save changes to Chapter ${a}: ${n}?\n\nChapter Information: ${JSON.stringify(e)}`))return;const t=parseInt(a)===Wl.id?await oc("",{story:e}):await oc(a,{story:e});alert(t)},children:"Save Changes"}),(0,f.jsx)(m.z,{intent:x.S.WARNING,onClick:()=>{window.confirm(`Are you sure you want to clear changes for Chapter ${a}: ${n}?`)&&(I(!k),alert("Cleared changes"))},children:"Clear Changes"}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{icon:"trash",intent:x.S.DANGER,onClick:async()=>{if(window.confirm(`Are you sure you want to delete Chapter ${a}: ${n}?`)){const e=await async function(e){const t=await ec(e,"DELETE");return 204===t.status?"Chapter successfully deleted":t.text()}(a);alert(e)}},children:"Delete Chapter"})]})},fc=(0,c.memo)(yc),vc=()=>{const{value:e}=(0,j.QT)(ac,[]),{value:t}=(0,j.QT)(rc,[]),[a,n]=(0,c.useState)(-1);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h3",{children:"Publish / Edit Chapters"}),(0,f.jsxs)("select",{className:s.skh,onChange:e=>n(e.target.key),children:[t.map(((e,t)=>(0,f.jsx)("option",{value:e.title,children:`Chapter ${t}: ${e.title}`},t))),(0,f.jsx)("option",{value:"",children:"New chapter"},Wl.id)]}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)("hr",{}),(0,f.jsx)(fc,{chapterDetail:t[a]||Wl,chapterFilenames:e})]})},jc=(0,c.memo)(vc,(()=>!0));a(25351);const Cc=({storageName:e,s3TxtFiles:t})=>{const[a,n]=(0,c.useState)(t[0]);const i=(0,f.jsx)("input",{type:"file",onChange:function(t){if(!t.target.files)return;const[a]=t.target.files;((e,t)=>{const a=new FileReader;a.readAsText(t),a.onloadend=t=>{a.result&&sessionStorage.setItem(e,a.result.toString())}})(e,a)},style:{width:"250px"}}),r=(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("select",{className:s.skh,onChange:async function(t){const a=t.target.value;n(a);const s=await fetch(xn(`/stories/${a}`,!0),{headers:Ul()}),i=await s.text();sessionStorage.setItem(e,i)},children:t.map((e=>(0,f.jsx)("option",{value:e,children:e},e)))}),(0,f.jsx)(m.z,{icon:"download",onClick:()=>window.open(xo(a))})]});return(0,f.jsxs)("div",{className:"LeftAlign",children:[(0,f.jsx)("hr",{}),(0,f.jsxs)(ss.mQ,{id:"Tabs",renderActiveTabPanelOnly:!0,children:[(0,f.jsx)(ns.O,{id:"own",title:"Local",panel:i}),(0,f.jsx)(ns.O,{id:"s3",title:"S3",panel:r})]},"vertical")]})},Sc=()=>{const{value:e}=(0,j.QT)(ac,[]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h3",{children:"Simulate Chapters"}),(0,f.jsx)("b",{children:"Choose the Main Chapter file:"}),(0,f.jsx)(Cc,{s3TxtFiles:e,storageName:$l.gameTxtStorageName.checkpointTxt}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)("b",{children:'Choose a Default Variables ("Default Checkpoint") file (Optional):'}),(0,f.jsx)(Cc,{s3TxtFiles:e,storageName:$l.gameTxtStorageName.defaultChapter}),(0,f.jsx)("br",{}),(0,f.jsx)("hr",{}),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{onClick:function(){Ll.getInstance().getCurrentSceneRef().simulateCheckpoint()},icon:"play",children:"Simulate Chapter"}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)(m.z,{onClick:function(e){sessionStorage.setItem($l.gameTxtStorageName.checkpointTxt,""),sessionStorage.setItem($l.gameTxtStorageName.defaultChapter,"")},children:"Reset All Files"}),(0,f.jsx)("br",{})]})},kc=()=>{const e=(0,j.ix)((e=>e.session)),[t,a]=c.useState(Xl.DEFAULT);return c.useEffect((()=>{(()=>{const e=new Ll(zl,Rl.Simulator);return e.scene.add("GameSimulatorMenu",Zl,!0),e.scene.add("GameManager",Vr),e.scene.add("CheckpointTransition",ol),e})().setGameSimStateSetter(a)}),[]),c.useEffect((()=>{Ll.getInstance().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name})}),[e]),(0,f.jsxs)("div",{className:"GameSimulatorWrapper",children:[(0,f.jsx)("div",{id:"game-display"}),(0,f.jsxs)("div",{className:"LeftAlign GameSimulatorPanel",children:[t===Xl.DEFAULT&&(0,f.jsx)("h3",{children:"Welcome to Game simulator!"}),t===Xl.CHAPTERSIMULATOR&&(0,f.jsx)(Sc,{}),t===Xl.CHAPTERPUBLISHER&&(0,f.jsx)(jc,{}),t===Xl.ASSETVIEWER&&(0,f.jsx)(gc,{})]})]})};a(22750);var Ic=a(96673);const wc=({options:e,selectedValue:t,onClick:a,buttonProps:s,popoverProps:n})=>(0,f.jsx)(Oe.J,{...n,interactionKind:"click",content:(0,f.jsx)(dc.v,{children:e.map((({value:e,label:t})=>(0,f.jsx)(tt.s,{text:t,onClick:()=>(e=>{null===a||void 0===a||a(e)})(e)},t)))}),children:(0,f.jsx)(m.z,{...s,children:(()=>{const a=e.find((({value:e})=>e===t));return null===a||void 0===a?void 0:a.label})()})});var Ac=a(4350),Tc=a(99018),Mc=a(1407);const Pc=({submissionId:e,progress:t})=>{const a=(0,d.I0)(),s=(0,j.ix)((e=>e.session.courseId));return(0,f.jsxs)(Ic.kC,{justifyContent:"justify-start",spaceX:"space-x-2",children:[(0,f.jsx)(L.rU,{to:`/courses/${s}/grading/${e}`,children:(0,f.jsx)(Ic.JO,{tooltip:"Grade",icon:()=>(0,f.jsx)(I.I,{icon:E.d.EDIT}),variant:"light"})}),(0,f.jsx)("button",{type:"button",style:{padding:0},hidden:t!==U.YO.graded&&t!==U.YO.submitted,onClick:async()=>{await(0,G.pG)({contents:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("p",{children:"Reautograde this submission?"}),(0,f.jsx)("p",{children:"Note: all manual adjustments will be reset to 0."})]}),positiveIntent:"danger",positiveLabel:"Reautograde"})&&a((0,b.reautogradeSubmission)(e))},children:(0,f.jsx)(Ic.JO,{tooltip:"Reautograde",icon:()=>(0,f.jsx)(I.I,{icon:E.d.REFRESH}),variant:"simple"})}),(0,f.jsx)("button",{type:"button",style:{padding:0},hidden:t!==U.YO.graded&&t!==U.YO.submitted,onClick:async()=>{await(0,G.pG)({contents:"Are you sure you want to unsubmit?",positiveIntent:"danger",positiveLabel:"Unsubmit"})&&a((0,b.unsubmitSubmission)(e))},children:(0,f.jsx)(Ic.JO,{tooltip:"Unsubmit",icon:()=>(0,f.jsx)(I.I,{icon:E.d.UNDO}),variant:"simple"})}),(0,f.jsx)(m.z,{onClick:async()=>{await(0,G.pG)({contents:"Publish this assessment's grading?",positiveIntent:"primary",positiveLabel:"Publish"})&&a((0,b.publishGrading)(e))},hidden:t!==U.YO.graded,text:"Publish"}),(0,f.jsx)(m.z,{onClick:async()=>{await(0,G.pG)({contents:"Unpublish this assessment's grading?",positiveIntent:"primary",positiveLabel:"Unpublish"})&&a((0,b.unpublishGrading)(e))},hidden:t!==U.YO.published,text:"Unpublish"})]})},Ec=Object.freeze({missions:"indigo",quests:"emerald",paths:"sky",[U.YO.autograded]:"purple",[U.YO.not_attempted]:"gray",[U.YO.attempting]:"red",[U.YO.attempted]:"red",[U.YO.submitted]:"yellow",[U.YO.graded]:"green",[U.YO.published]:"blue"});function Nc(e){const t=e.toLowerCase();return Ec[t]||"gray"}const Rc=({type:e,size:t="sm"})=>(0,f.jsx)(Ic.Ct,{text:"xs"===t?e.charAt(0).toUpperCase():e,size:t,color:Nc(e)}),Lc=({progress:e})=>{const t=e.charAt(0).toUpperCase()+e.slice(1);return(0,f.jsx)(Ic.Ct,{text:t,color:Nc(e),icon:()=>(0,f.jsx)(I.I,{icon:e===U.YO.autograded?E.d.AIRPLANE:e===U.YO.published?E.d.ENDORSED:e===U.YO.graded?E.d.TICK:e===U.YO.submitted?E.d.TIME:E.d.DISABLE,style:{marginRight:"0.5rem"}})})},_c=({filter:e,onRemove:t})=>{let a=e.value;return a=a.charAt(0).toUpperCase()+a.slice(1),(0,f.jsx)("button",{type:"button",className:"grading-overview-filterable-btns",onClick:()=>t(e),children:(0,f.jsx)(Ic.Ct,{text:a,icon:()=>(0,f.jsx)(I.I,{icon:E.d.CROSS,style:{marginRight:"0.25rem"}}),color:Nc(a)})})},Oc=({filters:e,onFilterRemove:t})=>(0,f.jsx)(Ic.kC,{justifyContent:"justify-start",spaceX:"space-x-1",children:e.map((e=>(0,f.jsx)(_c,{filter:e,onRemove:t},e.id)))}),Dc=(0,Tc.Cl)(),Gc=({column:e,value:t,children:a,onClick:s})=>(0,f.jsx)("button",{type:"button",className:"grading-overview-filterable-btns",onClick:()=>{e.setFilterValue(t),null===s||void 0===s||s()},children:a||t}),Bc=({totalRows:e,pageSize:t,submissions:a,updateEntries:s})=>{const n=(0,d.I0)(),i=(0,j.ix)((e=>e.workspaces.grading.submissionsTableFilters)),[r,o]=(0,c.useState)([...i.columnFilters]),[l,h]=(0,c.useState)(0),u=(0,c.useMemo)((()=>Math.ceil(e/t)-1),[e,t]),g=(0,c.useCallback)((()=>h(0)),[h]),[p,m]=(0,c.useState)(""),[x,b]=(0,c.useState)(""),y=(0,c.useMemo)((()=>(0,N.debounce)((e=>{g(),b(e)}),300)),[g]),v=(0,c.useMemo)((()=>{const e=[{id:"assessmentName",value:x},...r].map(Ac.Sl),t={};return e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),t}),[r,x]),C=(0,c.useMemo)((()=>{return e=g,[Dc.accessor("assessmentName",{header:"Name",cell:t=>(0,f.jsx)(Gc,{onClick:e,column:t.column,value:t.getValue()})}),Dc.accessor("assessmentType",{header:"Type",cell:t=>(0,f.jsx)(Gc,{onClick:e,column:t.column,value:t.getValue(),children:(0,f.jsx)(Rc,{type:t.getValue()})})}),Dc.accessor("studentName",{header:"Student(s)",cell:t=>{const a=t.getValue(),s=t.row.original.studentNames,n=a||"",i=(null===s||void 0===s?void 0:s.join(", "))||"";return(0,f.jsx)(Gc,{onClick:e,column:t.column,value:""!==n?n:i})}}),Dc.accessor("studentUsername",{header:"Username(s)",cell:t=>{const a=t.getValue(),s=t.row.original.studentUsernames,n=a||"",i=(null===s||void 0===s?void 0:s.join(", "))||"";return(0,f.jsx)(Gc,{onClick:e,column:t.column,value:""!==n?n:i})}}),Dc.accessor("groupName",{header:"Group",cell:t=>(0,f.jsx)(Gc,{onClick:e,column:t.column,value:t.getValue()})}),Dc.accessor("progress",{header:"Progress",cell:t=>(0,f.jsx)(Gc,{onClick:e,column:t.column,value:t.getValue(),children:(0,f.jsx)(Lc,{progress:t.getValue()})})}),Dc.accessor((({currentXp:e,xpBonus:t,maxXp:a})=>({currentXp:e,xpBonus:t,maxXp:a})),{header:"Raw XP (+Bonus)",enableColumnFilter:!1,cell:e=>{const{currentXp:t,xpBonus:a,maxXp:s}=e.getValue();return(0,f.jsxs)(Ic.kC,{justifyContent:"justify-start",spaceX:"space-x-2",children:[(0,f.jsxs)(Ic.xv,{children:[t," (+",a,")"]}),(0,f.jsx)(Ic.xv,{children:"/"}),(0,f.jsx)(Ic.xv,{children:s})]})}}),Dc.accessor((({submissionId:e,progress:t})=>({submissionId:e,progress:t})),{header:"Actions",enableColumnFilter:!1,cell:e=>{const{submissionId:t,progress:a}=e.getValue();return(0,f.jsx)(Pc,{submissionId:t,progress:a})}})];var e}),[g]),S=(0,Mc.b7)({data:a,columns:C,state:{columnFilters:r,pagination:{pageIndex:0,pageSize:t}},onColumnFiltersChange:o,getCoreRowModel:(0,Tc.sC)(),getFilteredRowModel:(0,Tc.vL)(),getPaginationRowModel:(0,Tc.G_)()});return(0,c.useEffect)((()=>{n((0,Ae.updateSubmissionsTableFilters)({columnFilters:r}))}),[r,n]),(0,c.useEffect)((()=>{g()}),[s,g]),(0,c.useEffect)((()=>{s(l,v)}),[s,l,v]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(Ic.kC,{marginTop:"mt-2",justifyContent:"justify-between",alignItems:"items-center",children:[(0,f.jsxs)(Ic.kC,{alignItems:"items-center",spaceX:"space-x-2",children:[(0,f.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",height:"1.75rem"},children:[(0,f.jsx)(I.I,{icon:E.d.FILTER_LIST}),(0,f.jsxs)(Ic.xv,{children:[r.length>0?"Filters: ":"No filters applied. Click on any cell to filter by its value."," "]})]}),(0,f.jsx)(Oc,{filters:r,onFilterRemove:({id:e,value:t})=>{const a=r.filter((a=>a.id!==e&&a.value!==t));o(a),g()}})]}),(0,f.jsx)(Ic.oi,{maxWidth:"max-w-sm",icon:()=>(0,f.jsx)(I.I,{icon:E.d.SEARCH,style:{marginLeft:"0.75rem"}}),placeholder:"Search by assessment name",value:p,onChange:e=>{m(e.target.value),y(e.target.value)}})]}),(0,f.jsxs)(Ic.iA,{marginTop:"mt-2",children:[(0,f.jsx)(Ic.ss,{children:S.getHeaderGroups().map((e=>(0,f.jsx)(Ic.SC,{children:e.headers.map((e=>(0,f.jsx)(Ic.xs,{children:e.isPlaceholder?null:(0,Mc.ie)(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),(0,f.jsx)(Ic.RM,{children:S.getRowModel().rows.map((e=>(0,f.jsx)(Ic.SC,{children:e.getVisibleCells().map((e=>(0,f.jsx)(Ic.pj,{children:(0,Mc.ie)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))}),(0,f.jsx)("div",{className:"grading-overview-footer-sibling"}),(0,f.jsx)(Ic.$_,{children:(0,f.jsxs)(Ic.kC,{justifyContent:"justify-center",spaceX:"space-x-3",children:[(0,f.jsx)(Ic.zx,{size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.DOUBLE_CHEVRON_LEFT}),variant:"light",onClick:()=>h(0),disabled:l<=0}),(0,f.jsx)(Ic.zx,{size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.ARROW_LEFT}),variant:"light",onClick:()=>h(l-1),disabled:l<=0}),(0,f.jsxs)(Ic.d8,{children:["Page ",l+1," of ",u+1]}),(0,f.jsx)(Ic.zx,{size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.ARROW_RIGHT}),variant:"light",onClick:()=>h(l+1),disabled:l>=u}),(0,f.jsx)(Ic.zx,{size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.DOUBLE_CHEVRON_RIGHT}),variant:"light",onClick:()=>h(u),disabled:l>=u})]})})]}),(0,f.jsx)(Ic.kC,{marginTop:"-mt-6",children:(0,f.jsx)(f.Fragment,{})})]})};var Uc=a(21288);const Fc="grading-editor-button",zc={header:[E.d.HEADER,"Header Styles"],bold:[E.d.BOLD,"Bold"],italic:[E.d.ITALIC,"Italic"],strikethrough:[E.d.STRIKETHROUGH,"Strikethrough"],link:[E.d.LINK,"Link"],quote:[E.d.CITATION,"Quote"],code:[E.d.CODE,"Monospaced"],image:[E.d.MEDIA,"Image"],"unordered-list":[E.d.UNGROUP_OBJECTS,"Bullets"],"ordered-list":[E.d.NUMBERED_LIST,"Numbering"],"checked-list":[E.d.SQUARE,"Checkboxes"]},Vc=e=>{switch(e){case"header":case"bold":case"italic":case"strikethrough":case"link":case"quote":case"code":case"image":case"unordered-list":case"ordered-list":case"checked-list":const[t,a]=zc[e];return{iconName:t,title:a};default:return{iconName:E.d.HELP}}},Hc=e=>{const t=(0,d.I0)(),{handleGradingSave:a,handleGradingSaveAndContinue:s,handleReautogradeAnswer:n}=(0,c.useMemo)((()=>({handleGradingSave:(...e)=>t((0,b.submitGrading)(...e)),handleGradingSaveAndContinue:(...e)=>t((0,b.submitGradingAndContinue)(...e)),handleReautogradeAnswer:(...e)=>t((0,b.reautogradeAnswer)(...e))})),[t]),[i,r]=(0,c.useState)(e.xpAdjustment.toString()),[o,l]=(0,c.useState)(e.comments),[h,u]=(0,c.useState)("write"),[g,y]=(0,c.useState)(!1);(0,c.useEffect)((()=>{v()}),[e.submissionId,e.questionId]);const v=()=>{r(e.xpAdjustment.toString()),l(e.comments),u("write"),y(!1)};const j=t=>()=>{const a=(0,ke.GA)(i||void 0)||void 0,s=e.initialXp+(a||0);s<0||s>e.maxXp?(0,F.N9)(`XP ${s.toString()} is out of bounds. Maximum xp is ${e.maxXp.toString()}.`):t(e.submissionId,e.questionId,a,o)},C=()=>{const t=(0,ke.GA)(i||void 0);return e.xpAdjustment!==t||e.comments!==o},S=C(),k=void 0===e.gradedAt,w={intent:S||k?x.S.WARNING:x.S.NONE,minimal:!S&&!k,className:Fc},A={intent:S?x.S.DANGER:x.S.NONE,minimal:!S,className:Fc},T={intent:S||k?x.S.SUCCESS:x.S.NONE,minimal:!S&&!k,className:Fc},M=e.initialXp+((0,ke.GA)(i||void 0)||0),N=`${e.initialXp>0?"-":""}${e.initialXp} to ${e.maxXp-e.initialXp}`;return(0,f.jsxs)("div",{className:"GradingEditor",children:[(0,f.jsx)(Ca.N,{when:!g&&(S||k),message:"You have unsaved changes. Are you sure you want to leave?"}),(0,f.jsx)("div",{className:"grading-editor-header",children:(0,f.jsxs)(p.H3,{children:["Currently Grading:",(0,f.jsx)("br",{}),e.studentNames.map(((t,a)=>(0,f.jsxs)("div",{children:[(0,f.jsxs)("span",{children:[t," (",e.studentUsernames[a],")"]}),(0,f.jsx)("br",{})]},a)))]})}),null!==e.solution?(0,f.jsx)("div",{className:"grading-editor-marking-scheme",children:(0,f.jsxs)(p.SU,{children:[e.solution.toString()," "]})}):null,(0,f.jsx)("div",{className:"grading-editor-container",children:(0,f.jsxs)("div",{className:"grading-editor-xp",children:[(0,f.jsxs)("div",{className:"autograder-xp",children:[(0,f.jsx)("div",{children:"Autograder XP:"}),(0,f.jsxs)("div",{children:[`${e.initialXp} / ${e.maxXp}`," ",(0,f.jsx)(m.z,{icon:"refresh",small:!0,minimal:!0,onClick:async()=>{await(0,G.pG)({contents:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("p",{children:"Reautograde this answer?"}),(0,f.jsx)("p",{children:"Note: manual adjustments will be reset to 0."})]}),positiveLabel:"Reautograde",positiveIntent:"danger"})&&n(e.submissionId,e.questionId)}})]})]}),(0,f.jsxs)("div",{className:"xp-adjustment",children:[(0,f.jsx)("div",{children:"XP adjustment:"}),(0,f.jsx)("div",{children:(0,f.jsx)(Ye.A,{className:"adjustment-input",onValueChange:(e,t)=>{r(t)},value:i||"",buttonPosition:P.Ly.RIGHT,fill:!0,placeholder:N,intent:M<0||M>e.maxXp?x.S.DANGER:x.S.NONE,min:0-e.initialXp,max:e.maxXp>e.initialXp?e.maxXp-e.initialXp:void 0,stepSize:50,minorStepSize:25,majorStepSize:100})})]}),(0,f.jsxs)("div",{className:"final-xp",children:[(0,f.jsx)("div",{children:"Final XP:"}),(0,f.jsx)("div",{children:`${M} / ${e.maxXp}`})]})]})}),(0,f.jsx)("div",{className:"react-mde-parent",children:(0,f.jsx)(Uc.default,{value:o,onChange:l,selectedTab:h,onTabChange:e=>u(e),generateMarkdownPreview:e=>Promise.resolve((0,f.jsx)(se.Z,{content:e,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0})),minEditorHeight:200,maxEditorHeight:1e3,minPreviewHeight:240,getIcon:function(e){const t=Vc(e);return(0,f.jsx)(I.I,{icon:t.iconName,htmlTitle:t.title})}})}),"write"===h&&(0,f.jsxs)("div",{className:"grading-editor-draft-buttons",children:[(0,f.jsx)("div",{className:"grading-editor-save-button",children:(0,f.jsx)(te.Z,{label:"Save Changes",icon:E.d.FLOPPY_DISK,onClick:j(a),options:w})}),(0,f.jsx)("div",{className:"grading-editor-discard-button",children:(0,f.jsx)(te.Z,{label:"Discard Changes",icon:E.d.TRASH,onClick:()=>{C()&&!window.confirm("This will reset the editor. Are you sure?")||(r(e.xpAdjustment.toString()),l(e.comments),(0,F.rO)("Discarded!",1e3))},options:A})})]}),(0,f.jsx)("div",{className:"grading-editor-save-continue-button",children:(0,f.jsx)(te.Z,{label:"Save and Continue",icon:E.d.UPDATED,onClick:j(((e,t,a,n)=>{y(!0),s(e,t,a,n)})),options:T})}),e.graderName&&e.gradedAt&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Me.i,{}),(0,f.jsxs)("div",{className:"grading-editor-last-graded-details",children:["Last edited by ",(0,f.jsx)("b",{children:e.graderName})," on ",(0,Pe.Dh)(e.gradedAt)]})]})]})},$c="grading",Wc="// This answer does not have significant changes from the given solution\n// template and has thus been flagged as unanswered.\n// If you think this is wrong, please ignore and grade accordingly.\n\n\n",Xc=e=>{var t,a,n,o,g,p,m,x,y,v;const C=(0,h.s0)(),{selectedTab:S,setSelectedTab:k}=(0,Se.__)($c,me.B_.grading),I=(0,j.ix)((t=>t.session.gradings.get(e.submissionId))),w=(0,j.ix)((e=>e.session.courseId)),{autogradingResults:A,isFolderModeEnabled:T,activeEditorTabIndex:M,editorTabs:P,editorTestcases:N,isRunning:R,output:L,replValue:_,currentSubmission:O,currentQuestion:B}=(0,j.ix)((e=>e.workspaces[$c])),F=(0,d.I0)(),{handleBrowseHistoryDown:z,handleBrowseHistoryUp:V,handleClearContext:H,handleDeclarationNavigate:$,handleEditorEval:W,handleSetActiveEditorTabIndex:J,handleRemoveEditorTabByIndex:ee,handleEditorValueChange:te,handleEditorUpdateBreakpoints:ne,handleGradingFetch:ie,handleReplEval:re,handleReplOutputClear:oe,handleReplValueChange:le,handleResetWorkspace:ce,handleChangeExecTime:de,handleSideContentHeightChange:he,handleTestcaseEval:ue,handleRunAllTestcases:ge,handleUpdateCurrentSubmissionId:xe,handleUpdateHasUnsavedChanges:be,handlePromptAutocomplete:ye}=(0,c.useMemo)((()=>({handleBrowseHistoryDown:()=>F((0,Ae.browseReplHistoryDown)($c)),handleBrowseHistoryUp:()=>F((0,Ae.browseReplHistoryUp)($c)),handleClearContext:(e,t)=>F((0,Ae.beginClearContext)($c,e,t)),handleDeclarationNavigate:e=>F((0,Ae.navigateToDeclaration)($c,e)),handleEditorEval:()=>F((0,Ae.evalEditor)($c)),handleSetActiveEditorTabIndex:e=>F((0,Ae.updateActiveEditorTabIndex)($c,e)),handleRemoveEditorTabByIndex:e=>F((0,Ae.removeEditorTab)($c,e)),handleEditorValueChange:(e,t)=>F((0,Ae.updateEditorValue)($c,0,t)),handleEditorUpdateBreakpoints:(e,t)=>F((0,Ae.setEditorBreakpoint)($c,e,t)),handleGradingFetch:e=>F((0,b.fetchGrading)(e)),handleReplEval:()=>F((0,Ae.evalRepl)($c)),handleReplOutputClear:()=>F((0,Ae.clearReplOutput)($c)),handleReplValueChange:e=>F((0,Ae.updateReplValue)(e,$c)),handleResetWorkspace:e=>F((0,Ae.resetWorkspace)($c,e)),handleChangeExecTime:e=>F((0,Ae.changeExecTime)(e,$c)),handleSideContentHeightChange:e=>F((0,Ce.changeSideContentHeight)(e,$c)),handleTestcaseEval:e=>F((0,Ae.evalTestcase)($c,e)),handleRunAllTestcases:()=>F((0,Ae.runAllTestcases)($c)),handleUpdateCurrentSubmissionId:(e,t)=>F((0,Ae.updateCurrentSubmissionId)(e,t)),handleUpdateHasUnsavedChanges:e=>F((0,Ae.updateHasUnsavedChanges)($c,e)),handlePromptAutocomplete:(e,t,a)=>F((0,Ae.promptAutocomplete)($c,e,t,a))})),[F]);(0,c.useEffect)((()=>{if(ie(e.submissionId),!I)return;let t=e.questionId;e.questionId>=I.answers.length&&(t=I.answers.length-1);const a=I.answers[t].question;let s="";a.type===U.LD.programming&&(a.answer?a.answer.trim()===a.solutionTemplate.trim()?(s=Wc+a.answer,(0,G.qY)({contents:"Question has not been answered."})):s=a.answer:s=a.solutionTemplate||""),te(0,s)}),[]),(0,c.useEffect)((()=>{if(void 0===I)return;const t=e.questionId;void 0===I.answers[t]?C(`/courses/${w}/grading`):fe(e)}));const fe=e=>{var t;const a=e.submissionId,s=e.questionId;if(O===a&&B===s)return;const n=I.answers[s].question;let i=[],r="",o="",l="",c=[];if(n.type===U.LD.programming){var d;const e=n;i=e.autogradingResults,o=e.prepend,l=e.postpend,c=e.testcases,r=e.answer,r||(r=e.solutionTemplate),r.trim()===(null===(d=e.solutionTemplate)||void 0===d?void 0:d.trim())&&((0,G.qY)({contents:"Question has not been answered."}),r=Wc+r)}ne(0,[]),xe(a,s),ce({autogradingResults:i,editorTabs:[{value:r,highlightedLines:[],breakpoints:[]}],programPrependValue:o,programPostpendValue:l,editorTestcases:c}),de(null!==(t=n.library.execTimeMs)&&void 0!==t?t:u.t7.grading.execTime),H(n.library,!0),be(!1),r&&te(0,r)},ve=()=>{W(),S===me.B_.autograder&&ge()};if(void 0===I)return(0,f.jsx)(i.t,{className:l()("WorkspaceParent",s.Pyr),description:"Getting assessment ready...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})});const ke=e.questionId>=I.answers.length?I.answers.length-1:e.questionId,Ie=I.answers[ke].question,Te={controlBarProps:(t=>{const a=`/courses/${w}/grading`,s=a+`/${e.submissionId}`,n=[t+1,I.answers.length],i=(0,f.jsx)(Z.g,{onClickNext:()=>C(s+`/${(t+1).toString()}`),onClickReturn:()=>C(a),questionProgress:n},"next_question"),r=(0,f.jsx)(q.f,{onClick:()=>C(s+`/${(t-1).toString()}`),questionProgress:n},"previous_question"),o=(0,f.jsx)(Y.M,{questionProgress:n},"question_view");return{editorButtons:[(0,f.jsx)(Q.h,{isEntrypointFileDefined:null!==M,handleEditorEval:ve},"run")],flowButtons:[r,o,i]}})(ke),editorContainerProps:Ie.type===U.LD.programming||Ie.type===U.LD.voting?{editorVariant:"normal",isFolderModeEnabled:T,activeEditorTabIndex:M,setActiveEditorTabIndex:J,removeEditorTabByIndex:ee,editorTabs:P.map(ae.F),editorSessionId:"",sessionDetails:null,handleDeclarationNavigate:$,handleEditorEval:ve,handleEditorValueChange:te,handleEditorUpdateBreakpoints:ne,handlePromptAutocomplete:ye,isEditorAutorun:!1,sourceChapter:(null===Ie||void 0===Ie||null===(t=Ie.library)||void 0===t?void 0:t.chapter)||D.Chapter.SOURCE_4,sourceVariant:null!==(a=null===Ie||void 0===Ie||null===(n=Ie.library)||void 0===n?void 0:n.variant)&&void 0!==a?a:D.Variant.DEFAULT,externalLibraryName:(null===Ie||void 0===Ie||null===(o=Ie.library)||void 0===o||null===(g=o.external)||void 0===g?void 0:g.name)||"NONE"}:void 0,handleSideContentHeightChange:he,mcqProps:{mcq:Ie,handleMCQSubmit:e=>{}},sideBarProps:{tabs:[]},sideContentProps:((e,t)=>{var a;const s=[{label:`Grading: Question ${t+1}`,iconName:E.d.TICK,body:(0,f.jsx)(Hc,{solution:I.answers[t].question.solution,questionId:I.answers[t].question.id,submissionId:e.submissionId,initialXp:I.answers[t].grade.xp,xpAdjustment:I.answers[t].grade.xpAdjustment,maxXp:I.answers[t].question.maxXp,studentNames:I.answers[t].student.name?[I.answers[t].student.name]:I.answers[t].team.map((e=>e.name)),studentUsernames:I.answers[t].student.username?[I.answers[t].student.username]:I.answers[t].team.map((e=>e.username)),comments:null!==(a=I.answers[t].grade.comments)&&void 0!==a?a:"",graderName:I.answers[t].grade.grader?I.answers[t].grade.grader.name:void 0,gradedAt:I.answers[t].grade.gradedAt?I.answers[t].grade.gradedAt:void 0}),id:me.B_.grading},{label:`Question ${t+1}`,iconName:E.d.NINJA,body:(0,f.jsx)(se.Z,{content:I.answers[t].question.content}),id:me.B_.questionOverview},{label:"Autograder",iconName:E.d.AIRPLANE,body:(0,f.jsx)(pe,{testcases:N,autogradingResults:A,handleTestcaseEval:ue,workspaceLocation:"grading"}),id:me.B_.autograder},{label:"Briefing",iconName:E.d.BRIEFCASE,body:(0,f.jsx)(se.Z,{content:I?I.assessment.summaryLong:"Briefing Unavailable. Try refreshing the page."}),id:me.B_.briefing}];I.answers[t].question.library.external.symbols.includes("get_matrix")&&s.push({label:"Tone Matrix",iconName:E.d.GRID_VIEW,body:(0,f.jsx)(je.Z,{}),id:me.B_.toneMatrix});return{onChange:(e,t,a)=>{e!==t&&k(e)},tabs:{beforeDynamicTabs:s,afterDynamicTabs:[]},workspaceLocation:$c}})(e,ke),replProps:{handleBrowseHistoryDown:z,handleBrowseHistoryUp:V,handleReplEval:re,handleReplValueChange:le,output:L,replValue:_,sourceChapter:(null===Ie||void 0===Ie||null===(p=Ie.library)||void 0===p?void 0:p.chapter)||D.Chapter.SOURCE_4,sourceVariant:null!==(m=null===Ie||void 0===Ie||null===(x=Ie.library)||void 0===x?void 0:x.variant)&&void 0!==m?m:D.Variant.DEFAULT,externalLibrary:(null===Ie||void 0===Ie||null===(y=Ie.library)||void 0===y||null===(v=y.external)||void 0===v?void 0:v.name)||"NONE",replButtons:(()=>{const e=(0,f.jsx)(X._,{handleReplOutputClear:oe},"clear_repl");return[(0,f.jsx)(K.e,{handleReplEval:re,isRunning:R},"eval_repl"),e]})()}};return(0,f.jsx)("div",{className:l()("WorkspaceParent",s.Pyr),children:(0,f.jsx)(we.Z,{...Te})})},Kc=[{value:!1,label:"my groups"},{value:!0,label:"all groups"}],Zc=[{value:!1,label:"unpublished"},{value:!0,label:"all"}],qc=[{value:10,label:"10"},{value:15,label:"15"},{value:25,label:"25"},{value:50,label:"50"}],Yc=()=>{var e,t,a,s;const{courseId:n,gradingOverviews:o,role:l,group:g}=(0,j.kP)(),p=(0,h.UO)(),m=l===u.uU.Admin,[x,y]=(0,c.useState)(m||null===g),[v,C]=(0,c.useState)(10),[S,k]=(0,c.useState)(!1),w=(0,d.I0)(),A=(0,c.useCallback)(((e,t)=>{w((0,b.fetchGradingOverviews)(x,(0,Ac.__)(S),(0,Ac.Fo)(e,v),t))}),[w,x,S,v]);if(p.submissionId&&(null===(e=p.submissionId)||void 0===e||!e.match(_.CJ))||p.questionId&&(null===(t=p.questionId)||void 0===t||!t.match(_.CJ)))return(0,f.jsx)(h.Fg,{to:`/courses/${n}/grading`});const T=(0,ke.GA)(p.submissionId),M=(0,ke.GA)(p.questionId)||0;if(null!==T)return(0,f.jsx)(Xc,{questionId:M,submissionId:T});const N=(0,f.jsx)(i.t,{className:"Grading",description:"Fetching submissions...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})}),R=null!==(a=null===o||void 0===o||null===(s=o.data)||void 0===s?void 0:s.map((e=>e.studentName?e:{...e,studentName:Array.isArray(e.studentNames)?e.studentNames.join(", "):e.studentNames})))&&void 0!==a?a:[];return(0,f.jsx)(Le.Z,{loadContentDispatch:()=>w((0,b.fetchGradingOverviews)(x)),display:void 0===(null===o||void 0===o?void 0:o.data)?N:(0,f.jsxs)(Ic.Zb,{children:[(0,f.jsx)(Ic.kC,{justifyContent:"justify-between",children:(0,f.jsxs)(Ic.kC,{justifyContent:"justify-start",spaceX:"space-x-6",children:[(0,f.jsx)(Ic.Dx,{children:"Submissions"}),(0,f.jsx)(Ic.zx,{variant:"light",size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.EXPORT,style:{marginRight:"0.5rem"}}),onClick:()=>(0,Ac.gN)(o.data),children:"Export to CSV"})]})}),(0,f.jsxs)(Ic.kC,{justifyContent:"justify-start",marginTop:"mt-2",spaceX:"space-x-2",children:[(0,f.jsx)(Ic.xv,{children:"Viewing"}),(0,f.jsx)(wc,{options:Zc,selectedValue:S,onClick:k,popoverProps:{position:P.Ly.BOTTOM},buttonProps:{minimal:!0,rightIcon:"caret-down"}}),(0,f.jsx)(Ic.xv,{children:"submissions from"}),(0,f.jsx)(wc,{options:Kc,selectedValue:x,onClick:y,popoverProps:{position:P.Ly.BOTTOM},buttonProps:{minimal:!0,rightIcon:"caret-down"}}),(0,f.jsx)(Ic.xv,{children:"showing"}),(0,f.jsx)(wc,{options:qc,selectedValue:v,onClick:C,popoverProps:{position:P.Ly.BOTTOM},buttonProps:{minimal:!0,rightIcon:"caret-down"}}),(0,f.jsx)(Ic.xv,{children:"entries per page."})]}),(0,f.jsx)(Bc,{totalRows:o.count,pageSize:v,submissions:R,updateEntries:A})]}),fullWidth:!0})};var Jc=a(61691);const Qc=()=>{const[e,t]=(0,c.useState)(u.Vf[0]),[a,s]=(0,c.useState)(!1),{sourceChapter:n=y.Z.defaultSourceChapter,sourceVariant:i=y.Z.defaultSourceVariant}=(0,j.kP)(),r=(0,d.I0)(),o=(0,c.useCallback)((e=>r((0,Ae.changeSublanguage)(e))),[r]),l=(0,c.useCallback)((e=>{s(!0),t(e)}),[s,t]),h=(0,c.useCallback)((()=>{s(!1)}),[s]),p=(0,c.useCallback)((()=>{s(!1),o(e)}),[e,s,o]),b=(0,c.useCallback)(((e,{handleClick:t})=>(0,f.jsx)(tt.s,{onClick:t,text:e.displayName},e.displayName)),[]),v=(0,c.useCallback)((({itemsParentRef:e,renderItem:t,items:a})=>{const s=a.filter((({variant:e})=>e===D.Variant.DEFAULT)),n=a.filter((({variant:e})=>e!==D.Variant.DEFAULT));return(0,f.jsxs)(dc.v,{ulRef:e,children:[s.map(t),n.length>0&&(0,f.jsx)(tt.s,{text:"Variants",icon:"cog",children:n.map(t)},"variant-menu")]})}),[]),C=nt.P.ofType(),S=(0,f.jsxs)(g.V,{canEscapeKeyClose:!0,canOutsideClickClose:!0,className:"change-default-lang-dialog",icon:E.d.ERROR,isCloseButtonShown:!0,isOpen:a,onClose:h,title:"Updating default Source sublanguage",children:[(0,f.jsxs)(T.a,{children:["Are you sure you want to update the ",(0,f.jsx)("b",{children:"default Playground Source sublanguage"})," from"," ",(0,u.w$)(n,i)," to ",(0,f.jsx)("b",{children:e.displayName}),"?"]}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",onClick:h,options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Confirm",onClick:p,options:{minimal:!1,intent:x.S.DANGER}})]})})]});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(C,{items:u.Vf,onItemSelect:l,itemRenderer:b,itemListRenderer:v,filterable:!1,children:(0,f.jsxs)(m.z,{rightIcon:E.d.DOUBLE_CARET_VERTICAL,children:[(0,f.jsx)("span",{className:"hidden-xs hidden-sm",children:"Default sublanguage: "}),(0,f.jsx)("span",{children:(0,u.w$)(n,i)})]})}),S]})};var ed=a(50022),td=a(47520);const ad=({assessmentId:e})=>{const t=(0,j.rU)();return(0,f.jsx)("div",{className:"control-button-container",children:(0,f.jsx)(te.Z,{icon:E.d.PEOPLE,onClick:async()=>{const a=await(0,xl.xi)(e,t),s=document.createElement("div"),n={rowData:a,columnDefs:[{field:"student_name"},{field:"answer"},{field:"final_score"}]},i=(0,td.createGrid)(s,n);i.exportDataAsCsv(),i.destroy()},label:"Export Score Leaderboard"})})},sd=({assessmentId:e})=>{const t=(0,j.rU)({throwWhenEmpty:!0});return(0,f.jsx)("div",{className:"control-button-container",children:(0,f.jsx)(te.Z,{icon:E.d.PEOPLE,onClick:async()=>{const a=await(0,xl.Bx)(e,t),s=document.createElement("div"),n={rowData:a,columnDefs:[{field:"student_name"},{field:"answer"},{field:"final_score"}]},i=(0,td.createGrid)(s,n);i.exportDataAsCsv(),i.destroy()},label:"Export Popular Vote Leaderboard"})})};var nd=a(6627);const id="ConfigureControls_reassign-voting-warning__7XXQq",rd="ConfigureControls_confirm-assign-voting__wYbGn",od="ConfigureControls_current-voting-status__2MQNm",ld="ConfigureControls_confirm-assign-text__n5YX7",cd="ConfigureControls_voting-status-text__Lkydw",dd=({handleAssignEntriesForVoting:e,assessmentId:t,isVotingPublished:a})=>{const[s,n]=(0,c.useState)(!1),i=(0,c.useCallback)((()=>n(!0)),[]),r=(0,c.useCallback)((()=>{e(t)}),[t,e]),o=(0,c.useCallback)((()=>n(!1)),[]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:od,children:[(0,f.jsx)(nd.Z,{}),(0,f.jsxs)("p",{className:cd,children:["Current Voting Status: Entries have ",!a&&(0,f.jsx)("b",{children:"not "})," been assigned"]})]}),s?(0,f.jsxs)("div",{className:rd,children:[(0,f.jsx)(I.I,{icon:"reset"}),(0,f.jsxs)("p",{className:ld,children:["Are you sure you want to ",(0,f.jsxs)("b",{children:[a?"re-assign":"assign"," entries?"]})]}),(0,f.jsxs)(Pa.h,{children:[(0,f.jsx)(m.z,{small:!0,intent:"success",onClick:r,children:"Assign"}),(0,f.jsx)(m.z,{small:!0,intent:"danger",onClick:o,children:"Cancel"})]})]}):(0,f.jsx)("div",{className:"control-button-container",children:(0,f.jsx)(te.Z,{icon:E.d.RESET,onClick:i,label:(a?"Reassign":"Assign")+" entries for voting"})}),a&&(0,f.jsxs)("p",{className:id,children:[(0,f.jsx)("b",{children:"All existing votes"})," will be ",(0,f.jsx)("b",{children:"deleted"})," upon reassigning entries!"]})]})},hd=({handleConfigureAssessment:e,handleAssignEntriesForVoting:t,data:a})=>{const[s,n]=(0,c.useState)(!1),[i,r]=(0,c.useState)(!!a.hasVotingFeatures),[o,l]=(0,c.useState)(!!a.hasTokenCounter),[d,h]=(0,c.useState)(!1),[u]=(0,c.useState)(!!a.isVotingPublished),p=(0,c.useCallback)((()=>n(!0)),[]),m=(0,c.useCallback)((()=>n(!1)),[]),b=(0,c.useCallback)((()=>{const{id:t}=a;e(t,i,o),m()}),[a,m,e,o,i]),y=(0,c.useCallback)((()=>l((e=>!e))),[]),v=(0,c.useCallback)((()=>r((e=>!e))),[]),j=(0,c.useCallback)((()=>h((e=>!e))),[]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{icon:E.d.COG,onClick:p}),(0,f.jsxs)(g.V,{icon:E.d.Cog,isOpen:s,onClose:m,title:"Configuring assessment",canOutsideClickClose:!0,children:[(0,f.jsxs)(T.a,{children:[(0,f.jsxs)("p",{children:["This ",(0,f.jsx)("b",{children:"configuration tool"})," allows you to fine-tune this assessment. Any changes made here will ",(0,f.jsx)("b",{children:"override"})," any assessment configurations in the admin panel."]}),(0,f.jsxs)("div",{className:"general-configs",children:[(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"General Configurations"})}),(0,f.jsx)(Me.i,{}),(0,f.jsx)(et.rs,{className:"has-token-counter",checked:o,onChange:y,inline:!0,label:"Enable token counter"})]}),(0,f.jsxs)("div",{className:"team-related-configs",children:[(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"Team-Related Configurations"})}),(0,f.jsx)(Me.i,{}),(0,f.jsx)(et.rs,{className:"is-team-assessment",onChange:j,inline:!0,label:"Is team assessment"}),(0,f.jsx)(A.U,{isOpen:d,children:(0,f.jsxs)("div",{className:"numeric-input-container",children:[(0,f.jsx)(ed.S,{}),(0,f.jsx)("p",{className:"max-team-size",children:"Max team size"}),(0,f.jsx)(Ye.A,{})]})})]}),(0,f.jsxs)("div",{className:"voting-related-configs",children:[(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"Voting-Related Configurations"})}),(0,f.jsx)(Me.i,{}),(0,f.jsx)(et.rs,{className:"has-voting-features",checked:i,onChange:v,inline:!0,label:"Enable voting features"}),(0,f.jsx)(A.U,{isOpen:i,children:(0,f.jsxs)("div",{className:"voting-related-controls",children:[(0,f.jsx)(ad,{assessmentId:a.id}),(0,f.jsx)(sd,{assessmentId:a.id}),(0,f.jsx)(dd,{handleAssignEntriesForVoting:t,assessmentId:a.id,isVotingPublished:u})]})})]})]}),(0,f.jsx)(M.c,{actions:(0,f.jsx)(te.Z,{label:"Save",icon:E.d.UPLOAD,onClick:b,options:{minimal:!1,intent:x.S.PRIMARY}})})]})]})},ud=({handleDeleteAssessment:e,data:t})=>{const[a,s]=(0,c.useState)(!1),n=(0,c.useCallback)((()=>s(!0)),[]),i=(0,c.useCallback)((()=>s(!1)),[]),r=(0,c.useCallback)((()=>{const{id:a}=t;e(a),i()}),[t,i,e]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{icon:E.d.TRASH,onClick:n}),(0,f.jsxs)(g.V,{icon:E.d.WARNING_SIGN,isOpen:a,onClose:i,title:"Deleting assessment",canOutsideClickClose:!0,children:[(0,f.jsxs)(T.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",(0,f.jsx)("b",{children:"delete"})," the assessment ",(0,f.jsx)("i",{children:t.title}),"?"]}),(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"All submissions and their answers will be deleted as well."})})]}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",icon:E.d.CROSS,onClick:i,options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Confirm",icon:E.d.TRASH,onClick:r,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})};var gd=a(18267);const pd=e=>{const[t,a]=c.useState(void 0),[s,i]=c.useState(!1),[r,o]=c.useState(!1),[d,h]=c.useState(-1);c.useEffect((()=>{e.assessmentConfigurations&&-1===d&&h(e.assessmentConfigurations[0].assessmentConfigId)}),[e.assessmentConfigurations,d]);const{handleUploadAssessment:u}=e,g=c.useMemo((()=>{var t;return null===(t=e.assessmentConfigurations)||void 0===t?void 0:t.map((e=>({value:e.assessmentConfigId,label:e.type})))}),[e.assessmentConfigurations]),p=c.useCallback((()=>{-1!==d?(t&&(u(t,r,d),o(!1)),a(void 0)):(0,F.N9)("Please select a valid assessment type before uploading!")}),[t,r,u,d]),m=c.useCallback((()=>a(void 0)),[a]),b=c.useCallback((e=>{a(e[0]),o(!1)}),[a]),y=c.useCallback((e=>{e.length>1&&(0,F.N9)("Uploading multiple files at once is not currently supported!",2e3)}),[]),{getRootProps:v,getInputProps:j,isFocused:C,isDragActive:k,isDragAccept:I,isDragReject:w}=(0,gd.uI)({multiple:!1,onDropAccepted:b,onDropRejected:y}),A=c.useMemo((()=>l()("dropzone-base",C||k?"dropzone-active":void 0,I?"dropzone-accept":void 0,w?"dropzone-reject":void 0)),[C,k,I,w]),T=c.useCallback((()=>{r?o(!1):i(!0)}),[r,i,o]),M=c.useMemo((()=>(0,f.jsx)("div",{className:"toggle-button-wrapper",children:(0,f.jsx)(et.rs,{checked:r,onChange:T})})),[r,T]),P=c.useCallback((()=>{o(!0),i(!1)}),[o]),N=c.useCallback((()=>{i(!1)}),[i]),R=c.useMemo((()=>(0,f.jsxs)("div",{className:"dropzone-controls",children:[(0,f.jsx)(te.Z,{label:"Yes",icon:E.d.CONFIRM,onClick:P,options:{minimal:!1,intent:x.S.DANGER}}),(0,f.jsx)(te.Z,{label:"No",icon:E.d.CROSS,onClick:N,options:{minimal:!1}})]})),[N,P]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(n.Z,{elevation:S.u.TWO,interactive:!0,children:(0,f.jsxs)("div",{...v({className:A}),children:[(0,f.jsx)("input",{...j()}),(0,f.jsx)("p",{children:"Drag 'n' drop a file here, or click to select a file"})]})}),t&&(0,f.jsxs)(n.Z,{className:"dropzone-prompt",elevation:S.u.TWO,interactive:!0,children:[(0,f.jsx)("h3",{children:null===t||void 0===t?void 0:t.name}),!s&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"dropzone-controls",children:[(0,f.jsx)(rs.L,{options:g,onChange:e=>h(parseInt(e.target.value)),value:d}),(0,f.jsx)(te.Z,{label:"Confirm Upload",icon:E.d.UPLOAD,onClick:p,options:{minimal:!1,intent:x.S.DANGER}}),(0,f.jsx)(te.Z,{label:"Cancel Upload",icon:E.d.DELETE,onClick:m,options:{minimal:!1}})]}),(0,f.jsxs)("div",{className:"dropzone-controls",children:[(0,f.jsx)("p",{children:"Force update opened assessment"}),M]})]}),s&&(0,f.jsx)("p",{children:"Are you sure that you want to force update the assessment?"}),s&&R]})]})};var md=a(15348);const xd="YYYY-MM-DD HH:mm:ss ZZ",bd=({data:e,forOpenDate:t,handleAssessmentChangeDate:a})=>{const s=new Date(2010,0,0),n=new Date(2030,11,31),i=t?e.openAt:e.closeAt,r=$t()(i,$t().ISO_8601,!0),[o,l]=(0,c.useState)(!1),[d,h]=(0,c.useState)(r),u=(0,c.useCallback)((()=>l(!0)),[]),p=(0,c.useCallback)((()=>l(!1)),[]),m=(0,c.useCallback)((()=>{if(d){const{id:s,openAt:n,closeAt:i}=e;a(s,t?d.toISOString():n,t?i:d.toISOString()),p()}else(0,F.N9)("No date and time selected!",2e3),h(r)}),[d,r,e,a,t,p]),b=c.useCallback((e=>h($t()(e))),[]),y=c.useCallback((()=>{(0,F.N9)("Failed to parse date string! Defaulting to current date.",2e3),h(r)}),[r]),v=(0,f.jsx)(md.S,{formatDate:e=>$t()(e).format(xd),onChange:b,onError:y,parseDate:e=>{const t=$t()(e,xd,!0);return!!t.isValid()&&t.toDate()},placeholder:`${xd} or select a date`,value:null===d||void 0===d?void 0:d.toISOString(),disableTimezoneSelect:!0,timePrecision:"second",fill:!0,minDate:s,maxDate:n,closeOnSelection:!1});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{className:"date-cell-text",children:r.format(xd)}),(0,f.jsx)(te.Z,{icon:E.d.EDIT,onClick:u}),(0,f.jsxs)(g.V,{icon:E.d.INFO_SIGN,isOpen:o,onClose:p,title:"Updating assessment settings",canOutsideClickClose:!0,children:[(0,f.jsxs)(T.a,{children:[(0,f.jsxs)("p",{children:[t?"Opening":"Closing"," date and time:"]}),v]}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",icon:E.d.CROSS,onClick:p,options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Confirm",icon:E.d.TICK,onClick:m,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})},yd=({data:e,onTeamSizeChange:t})=>{const a=e.maxTeamSize,s=(0,c.useCallback)((s=>{a!==s&&t(e.id,s)}),[e.id,a,t]);return(0,f.jsxs)(Ic.kC,{children:[(0,f.jsx)(Ic.zx,{size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.MINUS}),variant:"light",onClick:()=>{if(a>1){s(a-1)}},disabled:1===a}),(0,f.jsx)("span",{children:a}),(0,f.jsx)(Ic.zx,{size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.PLUS}),variant:"light",onClick:()=>{s(a+1)}})]})},fd=({data:e,handlePublishAssessment:t})=>{const[a,s]=(0,c.useState)(!1),[n]=(0,c.useState)(!!e.isPublished),i=(0,c.useCallback)((()=>s(!0)),[]),r=(0,c.useCallback)((()=>s(!1)),[]),o=(0,c.useCallback)((()=>{const{id:a}=e;t(!n,a),r()}),[e,n,r,t]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(et.rs,{className:"publish-cell",checked:n,onChange:i}),(0,f.jsxs)(g.V,{icon:E.d.WARNING_SIGN,isOpen:a,onClose:r,title:(n?"Unpublish":"Publish")+" assessment",canOutsideClickClose:!0,children:[(0,f.jsxs)(T.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",(0,f.jsx)("b",{children:n?"unpublish":"publish"})," the assessment"," ",(0,f.jsx)("i",{children:e.title}),"?"]}),n?(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:"This will hide the assessment for students and prevent them from uploading new answers. Admins and staff are not affected."})}):null]}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",icon:E.d.CROSS,onClick:r,options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Confirm",icon:E.d.CONFIRM,onClick:o,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})},vd=(e,t,a)=>[{keyID:"1",callbackFn:a,data:e,change:"Unpublish all submissions",description:"Non-published submissions are not affected.",icon:E.d.CROSS_CIRCLE},{keyID:"2",callbackFn:t,data:e,change:"Publish graded submissions",description:"Ungraded or already-published submissions are not affected.",icon:E.d.ENDORSED}],jd=({keyID:e,callbackFn:t,data:a,change:s,description:n,icon:i})=>{const[r,o]=(0,c.useState)(!1),l=(0,c.useCallback)((()=>o(!0)),[]),d=(0,c.useCallback)((()=>o(!1)),[]),h=(0,c.useCallback)((()=>{const{id:e}=a;t(e),d()}),[a,d,t]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.u,{content:s,placement:"top",children:(0,f.jsx)(m.z,{minimal:!0,onClick:l,icon:i},e)}),(0,f.jsxs)(g.V,{icon:E.d.WARNING_SIGN,isOpen:r,onClose:d,title:s,canOutsideClickClose:!0,children:[(0,f.jsxs)(T.a,{children:[(0,f.jsxs)("p",{children:["Are you sure you want to ",s.toLowerCase()," for the assessment: ",(0,f.jsx)("i",{children:a.title}),"?"]}),(0,f.jsx)("p",{children:n})]}),(0,f.jsx)(M.c,{actions:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(te.Z,{label:"Cancel",icon:E.d.CROSS,onClick:d,options:{minimal:!1}}),(0,f.jsx)(te.Z,{label:"Confirm",icon:E.d.CONFIRM,onClick:h,options:{minimal:!1,intent:x.S.DANGER}})]})})]})]})},Cd=({data:e,handlePublishGradingAll:t,handleUnpublishGradingAll:a})=>{const s=(0,c.useMemo)((()=>vd(e,t,a)),[e,t,a]);return(0,f.jsx)(f.Fragment,{children:s.map((e=>(0,c.createElement)(jd,{...e,key:e.keyID})))})},Sd=(e,t)=>{const a=new Date(t);return a<e?-1:a>e?1:0},kd=e=>{const[t,a]=(0,c.useState)(!1),{assessmentOverviews:s,assessmentConfigurations:n}=(0,j.kP)();let o;const l=[{field:"number",headerName:"ID",width:50},{headerName:"Title",field:"title"},{headerName:"Category",field:"type",width:100},{headerName:"Open Date",field:"openAt",filter:"agDateColumnFilter",filterParams:{comparator:Sd,inRangeInclusive:!0},sortingOrder:["desc","asc",null],cellRenderer:bd,cellRendererParams:{handleAssessmentChangeDate:e.handleAssessmentChangeDate,forOpenDate:!0},width:150},{headerName:"Close Date",field:"closeAt",filter:"agDateColumnFilter",filterParams:{comparator:Sd,inRangeInclusive:!0},sortingOrder:["desc","asc",null],cellRenderer:bd,cellRendererParams:{handleAssessmentChangeDate:e.handleAssessmentChangeDate,forOpenDate:!1},width:150},{headerName:"Max Team Size",field:"maxTeamSize",cellRenderer:yd,cellRendererParams:{onTeamSizeChange:e.handleAssessmentChangeTeamSize},width:100},{headerName:"Publish",field:"placeholderPublish",cellRenderer:fd,cellRendererParams:{handlePublishAssessment:e.handlePublishAssessment},width:70,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}},{headerName:"Release Grading",field:"placeholderReleaseGrading",cellRenderer:Cd,cellRendererParams:{handlePublishGradingAll:e.handlePublishGradingAll,handleUnpublishGradingAll:e.handleUnpublishGradingAll},width:120,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}},{headerName:"Delete",field:"placeholderDelete",cellRenderer:ud,cellRendererParams:{handleDeleteAssessment:e.handleDeleteAssessment},width:70,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}},{headerName:"Configure",field:"placeholderConfigure",cellRenderer:hd,cellRendererParams:{handleConfigureAssessment:e.handleConfigureAssessment,handleAssignEntriesForVoting:e.handleAssignEntriesForVoting},width:70,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}}],d=(0,f.jsxs)("div",{className:"GridControls ground-control-controls",children:[(0,f.jsx)(m.z,{active:t,icon:E.d.CLOUD_UPLOAD,intent:t?x.S.PRIMARY:x.S.NONE,onClick:()=>{a(!t)},children:(0,f.jsx)("span",{className:"hidden-xs",children:"Upload assessment"})}),(0,f.jsx)(Qc,{}),(0,f.jsx)(m.z,{icon:E.d.REFRESH,onClick:e.handleAssessmentOverviewFetch,children:(0,f.jsx)("span",{className:"hidden-xs",children:"Refresh assessments"})})]}),h=(0,f.jsx)(A.U,{isOpen:t,keepChildrenMounted:!0,children:(0,f.jsx)(pd,{handleUploadAssessment:e.handleUploadAssessment,assessmentConfigurations:n})}),u=(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Xa.AgGridReact,{alwaysShowHorizontalScroll:!0,domLayout:"autoHeight",columnDefs:l,defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{o=e.api,o.sizeColumnsToFit(),o.applyColumnState({state:[{colId:"openAt",sort:"desc"},{colId:"closeAt",sort:"desc"}]})},onGridSizeChanged:()=>{o&&o.sizeColumnsToFit()},rowData:s,rowHeight:35,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})});if(!s)return(0,f.jsx)(i.t,{description:"Fetching assessments...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})});const g=(0,f.jsxs)("div",{className:"GroundControl",children:[d,h,(0,f.jsx)(Me.i,{}),u]});return(0,f.jsx)("div",{children:(0,f.jsx)(Le.Z,{display:g,loadContentDispatch:()=>{e.handleAssessmentOverviewFetch(),e.handleFetchCourseConfigs()}})})},Id=(0,d.$j)((e=>({})),(e=>(0,Na.DE)({handleAssessmentChangeDate:Jc.changeDateAssessment,handleAssessmentChangeTeamSize:Jc.changeTeamSizeAssessment,handleAssessmentOverviewFetch:b.fetchAssessmentOverviews,handleDeleteAssessment:Jc.deleteAssessment,handleUploadAssessment:Jc.uploadAssessment,handlePublishAssessment:Jc.publishAssessment,handlePublishGradingAll:Jc.publishGradingAll,handleUnpublishGradingAll:Jc.unpublishGradingAll,handleFetchCourseConfigs:b.fetchCourseConfig,handleConfigureAssessment:Jc.configureAssessment,handleAssignEntriesForVoting:Jc.assignEntriesForVoting},e)))(kd),wd=e=>{const{data:t}=e;let a=!1;null!==t.notificationPreference&&null!==t.notificationPreference.isEnabled&&(a=t.notificationPreference.isEnabled);const s=c.useCallback((()=>{e.setStateHandler(e.rowIndex,!a)}),[e,a]);return(0,f.jsx)(et.rs,{checked:a,onChange:s})},Ad=e=>{const[t,a]=c.useState(),s=e.data[e.field];s.sort(((e,t)=>e.minutes-t.minutes));const n=e=>e.minutes>=60?Math.round(e.minutes/60*100)/100+" hour(s)":`${e.minutes} minute(s)`,i=e.data.isEnabled;let r;const o=s.filter((e=>e.isDefault));let l;if(1===o.length&&(r=o[0]),null!==e.data.notificationPreference){const t=s.filter((t=>t.id===e.data.notificationPreference.timeOptionId));1===t.length&&(l=t[0])}if(l||r){const e=l||r;t&&t.id===e.id||a(e)}return(0,f.jsx)(nt.P,{filterable:!1,items:s,itemRenderer:(e,{handleClick:t,handleFocus:a,modifiers:s,query:i})=>(0,f.jsx)(tt.s,{active:s.active,disabled:s.disabled,onClick:t,onFocus:a,roleStructure:"listoption",text:n(e)},e.id),onItemSelect:t=>{a(t),e.setStateHandler(e.rowIndex,t)},noResults:(0,f.jsx)(tt.s,{disabled:!0,text:"No results.",roleStructure:"listoption"}),disabled:!i,children:(0,f.jsx)(m.z,{text:t?n(t):"Choose default",rightIcon:"caret-down",disabled:!i})})},Td=()=>{const e=c.useRef(),t=(0,d.I0)(),a=(0,j.ix)((e=>e.session)),[s,n]=(0,c.useState)(!1),i=c.useRef(a.configurableNotificationConfigs);c.useEffect((()=>{a.courseRegId&&t((0,b.fetchConfigurableNotificationConfigs)(a.courseRegId))}),[t,a.courseRegId]),c.useEffect((()=>{var e;void 0!==a.configurableNotificationConfigs&&(i.current=(0,N.cloneDeep)(a.configurableNotificationConfigs)),null===(e=i.current)||void 0===e||e.forEach((e=>{null===e.notificationPreference&&(e.notificationPreference={id:-1,isEnabled:!0,timeOptionId:null})}))}),[a]);const r=[{headerName:"Notification Type",field:"notificationType.name",rowDrag:!0},{headerName:"Assessment Type",field:"assessmentConfig.type",valueFormatter:e=>{var t;return(null===(t=e.data.assessmentConfig)||void 0===t?void 0:t.type)||"-"}},{headerName:"Recipients",field:"notificationType.forStaff",valueFormatter:e=>e.data.notificationType.forStaff?"Staff":"Student"},{headerName:"Reminder",field:"timeOptions",cellRenderer:Ad,cellRendererParams:{setStateHandler:(t,a)=>{var s,r,o;const l=[...null!==(s=i.current)&&void 0!==s?s:[]];l[t].notificationPreference.timeOptionId=a.id,i.current=l,null===(r=e.current)||void 0===r||null===(o=r.getDisplayedRowAtIndex(t))||void 0===o||o.setDataValue("timeOptions",l[t].timeOptions),n(!0)},field:"timeOptions"}},{headerName:"Enabled",field:"notificationPreference.isEnabled",cellRenderer:wd,cellRendererParams:{setStateHandler:(t,a)=>{var s,r,o;const l=[...null!==(s=i.current)&&void 0!==s?s:[]];l[t].notificationPreference.isEnabled=a,i.current=l,null===(r=e.current)||void 0===r||null===(o=r.getDisplayedRowAtIndex(t))||void 0===o||o.setDataValue("notificationPreference.isEnabled",a),n(!0)},field:"notificationPreference.isEnabled"}}],o=(0,f.jsxs)("div",{children:[(0,f.jsx)(p.H1,{children:"Notifications"}),(0,f.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,f.jsx)(Xa.AgGridReact,{domLayout:"autoHeight",columnDefs:r,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:t=>{e.current=t.api,t.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.sizeColumnsToFit()},rowData:i.current,rowHeight:36,rowDragManaged:!0,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})}),(0,f.jsx)(m.z,{text:"Save",style:{marginTop:"15px"},disabled:!s,intent:s?x.S.WARNING:x.S.NONE,onClick:()=>{var e,r;if(!s)return;const o=null!==(e=null===(r=i.current)||void 0===r?void 0:r.map((e=>({...e.notificationPreference,notificationConfigId:e.id}))))&&void 0!==e?e:[];t((0,b.updateNotificationPreferences)(o,a.courseRegId)),n(!1)}})]});return(0,f.jsx)(Le.Z,{display:o,fullWidth:!1})};var Md=a(30561),Pd=a(85323),Ed=a.n(Pd);class Nd extends c.PureComponent{constructor(e){super(e),this.recorder=void 0,this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.updateTimerDuration=()=>{this.setState({duration:this.props.getTimerDuration()})},this.handleTruncatePlaybackData=()=>{const e=this.props.playbackData.inputs.filter((e=>e.time<=1e3*this.props.currentPlayerTime));this.props.handleResetInputs(e)},this.handleRecorderPausing=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleSetSourcecastData:t,handleTimerPause:a}=this.props;clearInterval(this.state.updater),e(!0),a(),this.recorder.pause();t("","","",window.URL.createObjectURL(this.recorder.exportWAV()),this.props.playbackData)},this.handleRecorderStarting=()=>{this.recorder=new(Ed());const{handleRecordInit:e,handleSetIsEditorReadonly:t,handleTimerStart:a}=this.props;this.recorder.start().then((()=>{e(),t(!1),a();const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s})}),(e=>{alert("Microphone not found: "+e)}))},this.handleRecorderResuming=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleTimerResume:t}=this.props;e(!1),t(-1);const a=setInterval(this.updateTimerDuration,100);this.setState({updater:a}),this.recorder.resume()},this.handleRecorderResumingFromCurrent=()=>{if(!this.recorder)return;const{currentPlayerTime:e,handleSetIsEditorReadonly:t,handleTimerResume:a}=this.props;this.handleTruncatePlaybackData(),t(!1),a(1e3*e);const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s}),this.recorder.resume(e)},this.handleRecorderStopping=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleTimerStop:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.recorder.stop(),this.setState({fileDataBlob:this.recorder.exportWAV()}),this.recorder.clear()},this.handleRecorderResetting=()=>{const{handleSetIsEditorReadonly:e,handleTimerReset:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.setState({duration:0}),this.recorder&&(this.recorder.stop(),this.recorder.clear())},this.handleRecorderSaving=()=>{this.state.fileDataBlob?this.props.handleSaveSourcecastData(this.state.saveTitle,this.state.saveDescription,this.state.saveUID,this.state.fileDataBlob,this.props.playbackData):alert("No recording found")},this.renderLabel=e=>{const t=Math.floor(e/60),a=Math.floor(e-60*t);return(t<10?"0"+t:t)+":"+(a<10?"0"+a:a)},this.handleSaveTitleInputChange=e=>{this.setState({saveTitle:e.target.value})},this.handleSaveDescriptionInputChange=e=>{this.setState({saveDescription:e.target.value})},this.handleSaveUIDInputChange=e=>{this.setState({saveUID:e.target.value})},this.state={dialogOpen:!1,duration:0,updater:void 0,saveTitle:"",saveDescription:"",saveUID:""}}async componentDidMount(){Ed().getPermission().then((()=>{}),(e=>{alert("Microphone not found: "+e)}))}render(){const e=(0,f.jsx)(te.Z,{label:"Record Pause",icon:E.d.SNOWFLAKE,onClick:this.props.handleRecordPause}),t=(0,f.jsx)(te.Z,{label:"Pause",icon:E.d.PAUSE,onClick:this.handleRecorderPausing}),a=(0,f.jsx)(te.Z,{label:"Resume",icon:E.d.PLAY,onClick:this.handleRecorderResuming}),i=(0,f.jsx)(te.Z,{label:"Resume Here",icon:E.d.PLAY,onClick:this.handleRecorderResumingFromCurrent}),r=(0,f.jsx)(te.Z,{label:"Record",icon:E.d.PLAY,onClick:this.handleRecorderStarting}),o=(0,f.jsx)(te.Z,{label:"Stop",icon:E.d.STOP,onClick:this.handleRecorderStopping}),l=(0,f.jsx)(te.Z,{label:"Reset",icon:E.d.REFRESH,onClick:this.handleRecorderResetting}),c=(0,f.jsx)(te.Z,{label:"Upload",icon:E.d.FLOPPY_DISK,onClick:this.handleOpenDialog});return(0,f.jsxs)("div",{children:[(0,f.jsxs)(g.V,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Upload Sourcecast",canOutsideClickClose:!0,children:[(0,f.jsxs)("div",{className:s.TmF,children:[(0,f.jsx)(Wa.B,{id:"title",leftIcon:E.d.HEADER,onChange:this.handleSaveTitleInputChange,placeholder:"Title",value:this.state.saveTitle}),(0,f.jsx)("br",{}),(0,f.jsx)(Wa.B,{id:"description",leftIcon:E.d.LIST_DETAIL_VIEW,onChange:this.handleSaveDescriptionInputChange,placeholder:"Description",value:this.state.saveDescription}),(0,f.jsx)("br",{}),(0,f.jsx)(Wa.B,{id:"uid",leftIcon:E.d.KEY,onChange:this.handleSaveUIDInputChange,placeholder:"UID (optional, only alphanumeric, dash and underscore allowed)",value:this.state.saveUID})]}),(0,f.jsx)("div",{className:s.Alt,children:(0,f.jsxs)("div",{className:s.e$L,children:[(0,f.jsx)(te.Z,{label:"Confirm Upload",icon:E.d.TICK,onClick:this.handleRecorderSaving}),(0,f.jsx)(te.Z,{label:"Cancel",icon:E.d.CROSS,onClick:this.handleCloseDialog})]})})]}),(0,f.jsx)("br",{}),(0,f.jsx)("div",{className:"Timer",children:(0,f.jsx)(n.Z,{elevation:2,style:{background:"#24323F"},children:(0,f.jsx)(p.H1,{children:this.renderLabel(this.props.recordingStatus!==$.bl.paused?this.state.duration/1e3:this.props.currentPlayerTime)})})}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{className:"RecorderControl",children:[this.props.recordingStatus===$.bl.notStarted&&r,this.props.recordingStatus===$.bl.paused&&a,this.props.recordingStatus===$.bl.paused&&i,this.props.recordingStatus===$.bl.recording&&t,this.props.recordingStatus===$.bl.recording&&e,this.props.recordingStatus===$.bl.paused&&o,this.props.recordingStatus===$.bl.finished&&c,this.props.recordingStatus!==$.bl.notStarted&&l]}),(0,f.jsx)("br",{})]})}}const Rd=Nd,Ld="sourcereel",_d="sourcecast",Od="Welcome to Sourcereel!",Dd=()=>{const{selectedTab:e,setSelectedTab:t}=(0,Se.__)(Ld,me.B_.sourcereel),a=(0,j.ix)((e=>e.session.courseId)),{chapter:n,variant:i}=(0,j.ix)((e=>e.workspaces[Ld].context)),{audioUrl:r,currentPlayerTime:o,codeDeltasToApply:h,inputToApply:u,playbackDuration:g,playbackStatus:m,sourcecastIndex:x}=(0,j.ix)((e=>e.workspaces.sourcecast)),{isFolderModeEnabled:b,activeEditorTabIndex:y,editorTabs:v,externalLibrary:C,isDebugging:S,isEditorAutorun:k,isEditorReadonly:I,isRunning:w,output:A,playbackData:T,recordingStatus:M,replValue:P,timeElapsedBeforePause:N,timeResumed:R}=(0,j.ix)((e=>e.workspaces[Ld])),L=(0,d.I0)(),{handleChapterSelect:_,handleEditorEval:O,handleEditorValueChange:G,handleExternalSelect:B,handleRecordInput:U,handleReplEval:F,handleSetSourcecastStatus:z,handleSetIsEditorReadonly:V}=(0,c.useMemo)((()=>({handleChapterSelect:e=>L((0,Ae.chapterSelect)(e,D.Variant.DEFAULT,Ld)),handleEditorEval:()=>L((0,Ae.evalEditor)(Ld)),handleEditorValueChange:e=>L((0,Ae.updateEditorValue)(Ld,0,e)),handleExternalSelect:e=>L((0,Ae.externalLibrarySelect)(e,Ld)),handleRecordInput:e=>L((0,Md.recordInput)(e,Ld)),handleReplEval:()=>L((0,Ae.evalRepl)(Ld)),handleSetSourcecastStatus:e=>L((0,Aa.setSourcecastStatus)(e,_d)),handleSetIsEditorReadonly:e=>L((0,Ae.setIsEditorReadonly)(Ld,e))})),[L]);(0,c.useEffect)((()=>{(0,wa.fetchSourcecastIndex)(_d)}),[]),(0,c.useEffect)((()=>{if(u)switch(u.type){case"activeTabChange":t(u.data);break;case"chapterSelect":_(u.data);break;case"externalLibrarySelect":B(u.data);break;case"forcePause":z($.PO.forcedPaused)}}),[u]);const H=()=>N+Date.now()-R,Z=(0,c.useMemo)((()=>({handleDebuggerPause:()=>L((0,Ia.beginDebuggerPause)(Ld)),handleDebuggerResume:()=>L((0,Ia.debuggerResume)(Ld)),handleDebuggerReset:()=>L((0,Ia.debuggerReset)(Ld)),handleInterruptEval:()=>L((0,Ia.beginInterruptExecution)(Ld)),handleToggleEditorAutorun:()=>L((0,Ae.toggleEditorAutorun)(Ld))})),[L]),q=(0,f.jsx)(Ta.k,{handleDebuggerPause:Z.handleDebuggerPause,handleDebuggerResume:Z.handleDebuggerResume,handleDebuggerReset:Z.handleDebuggerReset,handleEditorEval:()=>{O(),M===$.bl.recording&&U({time:H(),type:"keyboardCommand",data:$.SO.run})},handleInterruptEval:Z.handleInterruptEval,handleToggleEditorAutorun:Z.handleToggleEditorAutorun,isEntrypointFileDefined:null!==y,isDebugging:S,isEditorAutorun:k,isRunning:w},"autorun"),Y=(0,f.jsx)(W.b,{handleChapterSelect:({chapter:e},t)=>{_(e),M===$.bl.recording&&U({time:H(),type:"chapterSelect",data:e})},isFolderModeEnabled:b,sourceChapter:n,sourceVariant:i},"chapter"),J=(0,c.useMemo)((()=>(0,f.jsx)(X._,{handleReplOutputClear:()=>L((0,Ae.clearReplOutput)(Ld))},"clear_repl")),[L]),Q=(0,f.jsx)(K.e,{handleReplEval:F,isRunning:w},"eval_repl"),ee=(0,c.useMemo)((()=>({setActiveEditorTabIndex:e=>L((0,Ae.updateActiveEditorTabIndex)(Ld,e)),removeEditorTabByIndex:e=>L((0,Ae.removeEditorTab)(Ld,e)),handleDeclarationNavigate:e=>L((0,Ae.navigateToDeclaration)(Ld,e)),handleEditorUpdateBreakpoints:e=>L((0,Ae.setEditorBreakpoint)(Ld,0,e))})),[L]),te={handleEditorEval:O,handleEditorValueChange:G,handleRecordInput:U,codeDeltasToApply:h,inputToApply:u,isEditorAutorun:k,isEditorReadonly:I,editorVariant:_d,isFolderModeEnabled:b,activeEditorTabIndex:y,setActiveEditorTabIndex:ee.setActiveEditorTabIndex,removeEditorTabByIndex:ee.removeEditorTabByIndex,editorTabs:v.map(ae.F),handleDeclarationNavigate:ee.handleDeclarationNavigate,handleEditorUpdateBreakpoints:ee.handleEditorUpdateBreakpoints,editorSessionId:"",getTimerDuration:H,isPlaying:m===$.PO.playing,isRecording:M===$.bl.recording},se=(0,za.Z)(Ld),ne=Fa(Ld),ie=(0,c.useMemo)((()=>({handleBrowseHistoryDown:()=>L((0,Ae.browseReplHistoryDown)(Ld)),handleBrowseHistoryUp:()=>L((0,Ae.browseReplHistoryUp)(Ld)),handleReplValueChange:e=>L((0,Ae.updateReplValue)(e,Ld)),handleDeleteSourcecastEntry:e=>L((0,Md.deleteSourcecastEntry)(e,_d)),handleResetInputs:e=>L((0,Md.resetInputs)(e,Ld)),handleSaveSourcecastData:(e,t,a,s,n)=>L((0,Aa.saveSourcecastData)(e,t,a,s,n,_d)),handleSetSourcecastData:(e,t,a,s,n)=>L((0,Aa.setSourcecastData)(e,t,a,s,n,_d)),handleTimerPause:()=>L((0,Md.timerPause)(Ld)),handleTimerReset:()=>L((0,Md.timerReset)(Ld)),handleTimerResume:e=>L((0,Md.timerResume)(e,Ld)),handleTimerStart:()=>L((0,Md.timerStart)(Ld)),handleTimerStop:()=>L((0,Md.timerStop)(Ld))})),[L]),re={controlBarProps:{editorButtons:[q,Y]},editorContainerProps:te,handleSideContentHeightChange:e=>L((0,Ce.changeSideContentHeight)(e,Ld)),replProps:{output:A,replValue:P,handleBrowseHistoryDown:ie.handleBrowseHistoryDown,handleBrowseHistoryUp:ie.handleBrowseHistoryUp,handleReplEval:F,handleReplValueChange:ie.handleReplValueChange,sourceChapter:n,sourceVariant:i,externalLibrary:C,replButtons:[Q,J]},sideBarProps:{tabs:[]},sideContentProps:{onChange:e=>{t(e),M===$.bl.recording&&U({time:H(),type:"activeTabChange",data:e})},selectedTabId:e,tabs:{beforeDynamicTabs:[{label:"Recording Panel",iconName:E.d.COMPASS,body:(0,f.jsxs)("div",{children:[(0,f.jsx)("span",{className:"Multi-line",children:(0,f.jsxs)(p.SU,{children:[" ",Od," "]})}),(0,f.jsx)(Rd,{currentPlayerTime:o,editorValue:v[0].value,getTimerDuration:H,playbackData:T,handleRecordInit:()=>{const e={chapter:n,externalLibrary:C,editorValue:v[0].value};L((0,Md.recordInit)(e,Ld))},handleRecordPause:()=>U({time:H(),type:"forcePause",data:null}),handleResetInputs:ie.handleResetInputs,handleSaveSourcecastData:ie.handleSaveSourcecastData,handleSetSourcecastData:ie.handleSetSourcecastData,handleSetIsEditorReadonly:V,handleTimerPause:ie.handleTimerPause,handleTimerReset:ie.handleTimerReset,handleTimerResume:ie.handleTimerResume,handleTimerStart:ie.handleTimerStart,handleTimerStop:ie.handleTimerStop,recordingStatus:M})]}),id:me.B_.sourcereel},{label:"Sourcecast Table",iconName:E.d.EDIT,body:(0,f.jsx)("div",{children:(0,f.jsx)(Qa,{handleDeleteSourcecastEntry:ie.handleDeleteSourcecastEntry,sourcecastIndex:x,courseId:a})}),id:me.B_.introduction},se,ne],afterDynamicTabs:[]},workspaceLocation:Ld}},oe=(0,c.useMemo)((()=>({handleSetCurrentPlayerTime:e=>L((0,Aa.setCurrentPlayerTime)(e,_d)),handleSetCodeDeltasToApply:e=>L((0,Aa.setCodeDeltasToApply)(e,_d)),handleSetInputToApply:e=>L((0,Aa.setInputToApply)(e,_d)),handleSetSourcecastDuration:e=>L((0,Aa.setSourcecastDuration)(e,_d)),handlePromptAutocomplete:(e,t,a)=>L((0,Ae.promptAutocomplete)(Ld,e,t,a))})),[L]),le={handleChapterSelect:_,handleEditorValueChange:G,handleExternalSelect:B,handleSetSourcecastStatus:z,handleSetIsEditorReadonly:V,audioUrl:r,currentPlayerTime:o,playbackData:T,playbackStatus:m,handleSetCurrentPlayerTime:oe.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:oe.handleSetCodeDeltasToApply,handleSetInputToApply:oe.handleSetInputToApply,handleSetSourcecastDuration:oe.handleSetSourcecastDuration,handlePromptAutocomplete:oe.handlePromptAutocomplete,duration:g};return(0,f.jsxs)("div",{className:l()("Sourcereel",s.Pyr),children:[M===$.bl.paused?(0,f.jsx)(Ha,{...le}):void 0,(0,f.jsx)(we.Z,{...re})]})};var Gd=a(98280);const Bd={"form-container":"TeamFormation_form-container__p8c9Y","form-field":"TeamFormation_form-field__256xR","student-form-field":"TeamFormation_student-form-field__H4-mk","input-container":"TeamFormation_input-container__tniYE","form-label":"TeamFormation_form-label__X8JzA","form-select":"TeamFormation_form-select__aTuX-","form-footer":"TeamFormation_form-footer__+Y5OJ","form-field-row":"TeamFormation_form-field-row__m8nyJ"},Ud=()=>{const{teamId:e}=(0,h.UO)(),{courseId:t,students:a,assessmentOverviews:s,teamFormationOverviews:n}=(0,j.kP)(),i=(0,d.I0)(),[r,o]=(0,c.useState)(void 0),[l,u]=(0,c.useState)([[]]),g=(0,h.s0)();let p=r?r.maxTeamSize:0;(0,c.useEffect)((()=>{if(e){const t=null===n||void 0===n?void 0:n.find((t=>t.teamId.toString()===e));if(t){const e=null===s||void 0===s?void 0:s.find((e=>e.id===t.assessmentId));o(e);const n=t.studentIds.map((e=>null===a||void 0===a?void 0:a.filter((e=>t.studentIds.includes(e.userId))).map((e=>({label:e.name,value:e}))))).slice(0,1);u(n)}}}),[s,a,n,e]);return(0,f.jsx)("div",{className:Bd["form-container"],children:(0,f.jsxs)(L.l0,{children:[(0,f.jsxs)("h2",{children:[e?"Edit":"Create New"," Team"]}),(0,f.jsxs)("div",{className:Bd["form-field-row"],children:[(0,f.jsxs)("div",{className:Bd["form-field"],children:[(0,f.jsx)("label",{htmlFor:"assessment",className:Bd["form-label"],children:"Assessment"}),(0,f.jsx)(Gd.ZP,{id:"assessment",options:null===s||void 0===s?void 0:s.map((e=>({label:e.title,value:e}))),value:r?{label:r.title,value:r}:null,onChange:e=>{return t=null===e||void 0===e?void 0:e.value,o(t),void(p=null===t||void 0===t?void 0:t.maxTeamSize);var t},isSearchable:!0,className:Bd["form-select"]})]}),r&&(0,f.jsxs)("div",{className:Bd["form-field"],children:[(0,f.jsx)("label",{className:Bd["form-label"],children:"Max No. of Students:"}),(0,f.jsx)("input",{type:"text",className:Bd["form-select"],value:p,readOnly:!0,disabled:!0})]})]}),l.map(((e,t)=>(0,f.jsxs)("div",{className:Bd["student-form-field"],children:[(0,f.jsx)("label",{htmlFor:`team-${t}`,className:Bd["form-label"],children:"Students"}),(0,f.jsxs)("div",{className:Bd["input-container"],children:[(0,f.jsx)(Gd.ZP,{id:`team-${t}`,options:null===a||void 0===a?void 0:a.map((e=>({label:e.name,value:e}))),isMulti:!0,isSearchable:!0,value:e,onChange:(e,a)=>((e,t,a)=>{const s=[...l];s[e]=t,u(s)})(t,e),className:Bd["form-select"]}),t>0&&(0,f.jsx)("button",{type:"button",onClick:()=>(e=>{const t=[...l];t.splice(e,1),u(t)})(t),className:Bd["remove-button"],children:"Remove Team"})]})]},t))),e?null:(0,f.jsx)(m.z,{onClick:()=>{u([...l,[]])},intent:"primary",children:"Add Another Team"}),(0,f.jsxs)("div",{className:Bd["form-footer"],children:[(0,f.jsx)(m.z,{onClick:()=>{g(`/courses/${t}/teamformation`)},intent:"danger",children:"Back"}),(0,f.jsx)("div",{children:(0,f.jsx)(m.z,{onClick:()=>{if(!r)return void alert("Please select an assessment.");const a=l.some((e=>0===e.length));if(a)return void alert("Each team must have at least one student.");const s=l.some((e=>e.length>r.maxTeamSize));s?alert("The number of students in a team cannot exceed the max team size."):(i(e?(0,b.updateTeam)(parseInt(e,10),r,l):(0,b.createTeam)(r,l)),g(`/courses/${t}/teamformation`))},intent:"success",children:"Submit"})})]})]})})};var Fd=a(55837);const zd=()=>{const e=(0,h.s0)(),t=(0,d.I0)(),[a,s]=(0,c.useState)(null),{courseId:n,students:i}=(0,j.ix)((e=>e.session)),r=(0,j.ix)((e=>e.session.assessmentOverviews)),[o,l]=(0,c.useState)(void 0);let u=o?o.maxTeamSize:0;return(0,f.jsx)("div",{className:Bd["form-container"],children:(0,f.jsxs)(L.l0,{children:[(0,f.jsx)("h2",{children:"Import Team"}),(0,f.jsxs)("div",{className:Bd["form-field-row"],children:[(0,f.jsxs)("div",{className:Bd["form-field"],children:[(0,f.jsx)("label",{htmlFor:"assessment",className:Bd["form-label"],children:"Assessment"}),(0,f.jsx)(Gd.ZP,{id:"assessment",options:null===r||void 0===r?void 0:r.map((e=>({label:e.title,value:e}))),value:o?{label:o.title,value:o}:null,onChange:e=>{return t=null===e||void 0===e?void 0:e.value,l(t),void(u=null===t||void 0===t?void 0:t.maxTeamSize);var t},isSearchable:!0,className:Bd["form-select"]})]}),o&&(0,f.jsxs)("div",{className:Bd["form-field"],children:[(0,f.jsx)("label",{className:Bd["form-label"],children:"Max No. Student:"}),(0,f.jsx)("input",{type:"text",className:Bd["form-select"],value:u,readOnly:!0,disabled:!0})]})]}),(0,f.jsx)(Fd.b,{multiple:!1,handleChange:e=>{s(e)},name:"file",types:["XLSX","XLS"]}),(0,f.jsx)("p",{children:a?`File name: ${a.name}`:"No file uploaded"}),(0,f.jsxs)("div",{className:Bd["form-footer"],children:[(0,f.jsx)(m.z,{intent:"danger",onClick:()=>{e(`/courses/${n}/teamformation`)},children:"Back"}),(0,f.jsx)("div",{children:(0,f.jsx)(m.z,{intent:"success",onClick:()=>{o?a?(t((0,b.bulkUploadTeam)(o,a,i)),e(`/courses/${n}/teamformation`)):alert("Please upload the teams."):alert("Please select an assessment.")},children:"Submit"})})]})]})})},Vd=({filter:e,onRemove:t})=>{let a=e.value;return a=a.charAt(0).toUpperCase()+a.slice(1),(0,f.jsx)("button",{type:"button",onClick:()=>t(e),style:{padding:0},children:(0,f.jsx)(Ic.Ct,{text:a,icon:()=>(0,f.jsx)(I.I,{icon:E.d.CROSS,style:{marginRight:"0.25rem"}}),color:Nc(a)})})},Hd=({filters:e,onFilterRemove:t})=>(0,f.jsx)(Ic.kC,{justifyContent:"justify-start",spaceX:"space-x-1",children:e.map((e=>(0,f.jsx)(Vd,{filter:e,onRemove:t},e.id)))}),$d=({teamId:e})=>{const t=(0,d.I0)(),{courseId:a}=(0,j.kP)(),s=(0,c.useCallback)((async()=>{await(0,G.pG)({contents:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("p",{children:"Delete this team?"}),(0,f.jsx)("p",{children:"Note: All submissions made by the team will be lost."})]}),positiveIntent:"danger",positiveLabel:"Delete Team"})&&t((0,b.deleteTeam)(e))}),[t,e]);return(0,f.jsxs)(Ic.kC,{justifyContent:"justify-start",spaceX:"space-x-2",children:[(0,f.jsx)(L.rU,{to:`/courses/${a}/teamformation/edit/${e}`,children:(0,f.jsx)(Ic.JO,{tooltip:"Edit",icon:()=>(0,f.jsx)(I.I,{icon:E.d.EDIT}),variant:"light"})}),(0,f.jsx)("button",{type:"button",style:{padding:0},onClick:s,children:(0,f.jsx)(Ic.JO,{tooltip:"Delete",icon:()=>(0,f.jsx)(I.I,{icon:E.d.TRASH}),variant:"simple"})})]})},Wd=(0,Tc.Cl)(),Xd=[Wd.accessor("assessmentName",{header:"Assessment",cell:e=>(0,f.jsx)(Kd,{column:e.column,value:e.getValue()})}),Wd.accessor("assessmentType",{header:"Type",cell:e=>(0,f.jsx)(Kd,{column:e.column,value:e.getValue(),children:(0,f.jsx)(Rc,{type:e.getValue()})})}),Wd.accessor("studentNames",{header:"Students",cell:e=>e.getValue().map(((t,a)=>(0,f.jsxs)(c.Fragment,{children:[(0,f.jsx)(Kd,{column:e.column,value:t,children:t}),", "]},a))),filterFn:(e,t,a)=>{const s=e.original[t];return"string"===typeof s||"number"===typeof s?s===a:s.some((e=>e===a))}}),Wd.accessor((({teamId:e})=>({teamId:e})),{header:"Actions",enableColumnFilter:!1,cell:e=>{const{teamId:t}=e.getValue();return(0,f.jsx)($d,{teamId:t})}})],Kd=({column:e,value:t,children:a})=>(0,f.jsx)("button",{type:"button",onClick:()=>{e.setFilterValue(t)},style:{padding:0},children:a||t}),Zd=({group:e,teams:t})=>{const a=[];e&&a.push({id:"groupName",value:e});const[s,n]=(0,c.useState)([...a]),[i,r]=(0,c.useState)(null),o=(0,Mc.b7)({data:t,columns:Xd,state:{columnFilters:s,globalFilter:i},onColumnFiltersChange:n,onGlobalFilterChange:r,globalFilterFn:(e,t,a)=>{for(const s of(0,Ie.Yd)(e.original)){const t=e.original[s];if(Array.isArray(t)){for(const e of t)if("string"===typeof e&&e.includes(a))return!0}else if("string"===typeof t&&t.includes(a))return!0}return!1},getCoreRowModel:(0,Tc.sC)(),getFilteredRowModel:(0,Tc.vL)(),getPaginationRowModel:(0,Tc.G_)()});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(Ic.kC,{marginTop:"mt-2",justifyContent:"justify-between",alignItems:"items-center",children:[(0,f.jsxs)(Ic.kC,{alignItems:"items-center",spaceX:"space-x-2",children:[(0,f.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",height:"1.75rem"},children:[(0,f.jsx)(I.I,{icon:E.d.FILTER_LIST}),(0,f.jsxs)(Ic.xv,{children:[s.length>0?"Filters: ":"No filters applied. Click on any cell to filter by its value."," "]})]}),(0,f.jsx)(Hd,{filters:s,onFilterRemove:({id:e,value:t})=>{const a=s.filter((a=>a.id!==e&&a.value!==t));n(a)}})]}),(0,f.jsx)(Ic.oi,{maxWidth:"max-w-sm",icon:()=>(0,f.jsx)(I.I,{icon:E.d.SEARCH,style:{marginLeft:"0.75rem"}}),placeholder:"Search for any value here...",onChange:e=>r(e.target.value)})]}),(0,f.jsxs)(Ic.iA,{marginTop:"mt-2",children:[(0,f.jsx)(Ic.ss,{children:o.getHeaderGroups().map((e=>(0,f.jsx)(Ic.SC,{children:e.headers.map((e=>(0,f.jsx)(Ic.xs,{children:e.isPlaceholder?null:(0,Mc.ie)(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),(0,f.jsx)(Ic.RM,{children:o.getRowModel().rows.map((e=>(0,f.jsx)(Ic.SC,{children:e.getVisibleCells().map((e=>(0,f.jsx)(Ic.pj,{children:(0,Mc.ie)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))})]}),(0,f.jsx)("div",{children:(0,f.jsxs)(Ic.kC,{justifyContent:"justify-center",spaceX:"space-x-3",children:[(0,f.jsx)(Ic.zx,{size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.ARROW_LEFT}),variant:"light",onClick:()=>o.previousPage(),disabled:!o.getCanPreviousPage()}),(0,f.jsxs)(Ic.d8,{children:["Page ",o.getState().pagination.pageIndex+1," of ",o.getPageCount()]}),(0,f.jsx)(Ic.zx,{size:"xs",icon:()=>(0,f.jsx)(I.I,{icon:E.d.ARROW_RIGHT}),variant:"light",onClick:()=>o.nextPage(),disabled:!o.getCanNextPage()})]})})]})},qd=({teams:e})=>{const{courseId:t,group:a}=(0,j.kP)(),s=(0,h.s0)(),n=e;return(0,f.jsxs)(Ic.Zb,{children:[(0,f.jsxs)(Ic.kC,{justifyContent:"justify-between",children:[(0,f.jsx)(Ic.Dx,{children:"Teams"}),(0,f.jsxs)(Ic.kC,{justifyContent:"justify-end",spaceX:"space-x-2",children:[(0,f.jsx)(m.z,{onClick:()=>{s(`/courses/${t}/teamformation/create`)},children:"Create Team"}),(0,f.jsx)(m.z,{onClick:()=>{s(`/courses/${t}/teamformation/import`)},children:"Import Team"})]})]}),(0,f.jsx)(Zd,{group:a,teams:n})]})},Yd=()=>{var e;const{teamFormationOverviews:t}=(0,j.kP)(),a=null!==(e=null===t||void 0===t?void 0:t.map((e=>e.studentNames?e:{...e,studentName:"(user has yet to log in)"})))&&void 0!==e?e:[],s=(0,f.jsx)(i.t,{className:"TeamFormation",description:"Fetching teams...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})});return(0,f.jsx)(Le.Z,{display:void 0===t?s:(0,f.jsx)(qd,{teams:a}),fullWidth:!0})},Jd=()=>{const e=(0,d.I0)();c.useEffect((()=>{e((0,b.fetchStudents)()),e((0,b.fetchNotifications)()),e((0,b.fetchTeamFormationOverviews)(!1))}),[e]);const{agreedToResearch:t,assessmentConfigurations:a,enableGame:s,role:n}=(0,j.kP)(),i=n!==u.uU.Student?[(0,f.jsx)(h.AW,{path:"groundcontrol",element:(0,f.jsx)(Id,{})},0),(0,f.jsx)(h.AW,{path:`grading/${_.R6}`,element:(0,f.jsx)(Yc,{})},1),(0,f.jsx)(h.AW,{path:"sourcereel",element:(0,f.jsx)(Dd,{})},2),(0,f.jsx)(h.AW,{path:"gamesimulator",element:(0,f.jsx)(kc,{})},3),(0,f.jsx)(h.AW,{path:"teamformation",element:(0,f.jsx)(Yd,{})},4),(0,f.jsx)(h.AW,{path:"teamformation/create",element:(0,f.jsx)(Ud,{})},5),(0,f.jsx)(h.AW,{path:`teamformation/edit/${_.Bz}`,element:(0,f.jsx)(Ud,{})},6),(0,f.jsx)(h.AW,{path:"teamformation/import",element:(0,f.jsx)(zd,{})},7),(0,f.jsx)(h.AW,{path:"dashboard",element:(0,f.jsx)(Ms,{})},8)]:null;return(0,f.jsxs)("div",{className:C.Z.Academy,children:[y.Z.showResearchPrompt&&null===t&&(0,f.jsx)(v,{}),(0,f.jsxs)(h.Z5,{children:[null===a||void 0===a?void 0:a.map((e=>(0,f.jsx)(h.AW,{path:`${(0,ke.q1)(e.type)}/${_._T}`,element:(0,f.jsx)(He,{assessmentConfiguration:e})},e.type))),s&&(0,f.jsx)(h.AW,{path:"game",element:(0,f.jsx)(Bl,{})}),(0,f.jsx)(h.AW,{path:"/notipreference",element:(0,f.jsx)(Td,{})}),(0,f.jsx)(h.AW,{path:"sourcecast/:sourcecastId?",element:(0,f.jsx)(as,{})}),(0,f.jsx)(h.AW,{path:"achievements/*",element:(0,f.jsx)(ka,{})}),(0,f.jsx)(h.AW,{path:"",element:(0,f.jsx)(h.Fg,{replace:!0,to:s?"game":a&&a.length>0?`${(0,ke.q1)(a[0].type)}`:n===u.uU.Admin?"adminpanel":"/404"})}),i,n===u.uU.Admin&&(0,f.jsx)(h.AW,{path:"adminpanel",element:(0,f.jsx)(ws,{})}),(0,f.jsx)(h.AW,{path:"*",element:(0,f.jsx)($e.default,{})})]})]})},Qd=()=>{const e=(0,d.I0)(),t=(0,h.s0)(),{courseId:a}=(0,j.kP)(),{courseId:o}=(0,h.UO)(),u=null!=o?parseInt(o,10):void 0;return c.useEffect((()=>{if(null===o||void 0===o||!o.match(_.CJ))return t("/");void 0===u||Number.isNaN(u)||a===u||e((0,b.updateLatestViewedCourse)(u))}),[a,e,u,t,o]),Number.isNaN(u)?(0,f.jsx)(h.Fg,{to:"/"}):u===a?(0,f.jsx)(Jd,{}):(0,f.jsx)("div",{className:l()(C.Z["Academy-switching-courses"],s.Pyr),children:(0,f.jsx)(n.Z,{className:s.W7H,children:(0,f.jsx)(i.t,{description:"Switching courses...",icon:(0,f.jsx)(r.$,{size:r.E.LARGE})})})})},eh=Qd;eh.displayName="Academy";const th=Qd},36896:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Component:()=>d,default:()=>h});var s=a(39997),n=a(16499),i=a(95725),r=a(41418),o=a.n(r),l=(a(72791),a(80184));const c=()=>(0,l.jsx)("div",{className:o()("NoPage",s.Pyr),"data-testid":"NotFound-Component",children:(0,l.jsx)(n.t,{icon:i.d.ERROR,title:"404 Not Found",description:"The requested resource could not be found"})}),d=c;d.displayName="NotFound";const h=c},88115:(e,t,a)=>{var s={"./_lib/buildFormatLongFn/index.js":[35063,7],"./_lib/buildLocalizeFn/index.js":[64028,7],"./_lib/buildMatchFn/index.js":[27758,7],"./_lib/buildMatchPatternFn/index.js":[35568,7],"./af/_lib/formatDistance/index.js":[79254,7,55468],"./af/_lib/formatLong/index.js":[85475,7,86224],"./af/_lib/formatRelative/index.js":[20330,7,60458],"./af/_lib/localize/index.js":[81789,7,49845],"./af/_lib/match/index.js":[86090,7,14865],"./af/index.js":[74682,7,72534],"./ar-DZ/_lib/formatDistance/index.js":[6990,7,59922],"./ar-DZ/_lib/formatLong/index.js":[16954,7,88932],"./ar-DZ/_lib/formatRelative/index.js":[72970,7,4080],"./ar-DZ/_lib/localize/index.js":[63798,7,90938],"./ar-DZ/_lib/match/index.js":[10138,7,47210],"./ar-DZ/index.js":[80779,7,60617],"./ar-EG/_lib/formatDistance/index.js":[73466,7,31492],"./ar-EG/_lib/formatLong/index.js":[45991,7,99338],"./ar-EG/_lib/formatRelative/index.js":[17217,7,40511],"./ar-EG/_lib/localize/index.js":[63069,7,67291],"./ar-EG/_lib/match/index.js":[24402,7,75416],"./ar-EG/index.js":[47232,7,99193],"./ar-MA/_lib/formatDistance/index.js":[80166,7,9801],"./ar-MA/_lib/formatLong/index.js":[22005,7,97562],"./ar-MA/_lib/formatRelative/index.js":[72523,7,27990],"./ar-MA/_lib/localize/index.js":[14763,7,50340],"./ar-MA/_lib/match/index.js":[36505,7,18640],"./ar-MA/index.js":[99530,7,56907],"./ar-SA/_lib/formatDistance/index.js":[3448,7,29405],"./ar-SA/_lib/formatLong/index.js":[14657,7,90667],"./ar-SA/_lib/formatRelative/index.js":[9619,7,58337],"./ar-SA/_lib/localize/index.js":[76797,7,89547],"./ar-SA/_lib/match/index.js":[29468,7,63590],"./ar-SA/index.js":[6114,7,77188],"./ar-TN/_lib/formatDistance/index.js":[42307,7,24830],"./ar-TN/_lib/formatLong/index.js":[91977,7,54698],"./ar-TN/_lib/formatRelative/index.js":[97942,7,45604],"./ar-TN/_lib/localize/index.js":[75544,7,90002],"./ar-TN/_lib/match/index.js":[84213,7,72410],"./ar-TN/index.js":[93417,7,15569],"./ar/_lib/formatDistance/index.js":[13099,7,97872],"./ar/_lib/formatLong/index.js":[52961,7,69357],"./ar/_lib/formatRelative/index.js":[35938,7,48320],"./ar/_lib/localize/index.js":[17261,7,18228],"./ar/_lib/match/index.js":[64239,7,55928],"./ar/index.js":[74896,7,6083],"./az/_lib/formatDistance/index.js":[81983,7,47736],"./az/_lib/formatLong/index.js":[76132,7,76604],"./az/_lib/formatRelative/index.js":[54692,7,8667],"./az/_lib/localize/index.js":[27385,7,11652],"./az/_lib/match/index.js":[44877,7,94954],"./az/index.js":[95123,7,68349],"./be-tarask/_lib/formatDistance/index.js":[32822,7,47841],"./be-tarask/_lib/formatLong/index.js":[52884,7,73055],"./be-tarask/_lib/formatRelative/index.js":[13681,7,92982,28264],"./be-tarask/_lib/localize/index.js":[86361,7,94251],"./be-tarask/_lib/match/index.js":[62030,7,71114],"./be-tarask/index.js":[83350,7,92982,51156],"./be/_lib/formatDistance/index.js":[86954,7,560],"./be/_lib/formatLong/index.js":[67958,7,48012],"./be/_lib/formatRelative/index.js":[29656,7,92982,36021],"./be/_lib/localize/index.js":[11947,7,9214],"./be/_lib/match/index.js":[68127,7,58479],"./be/index.js":[20379,7,92982,59052],"./bg/_lib/formatDistance/index.js":[42697,7,28981],"./bg/_lib/formatLong/index.js":[60725,7,82299],"./bg/_lib/formatRelative/index.js":[34985,7,6915],"./bg/_lib/localize/index.js":[14145,7,71431],"./bg/_lib/match/index.js":[93429,7,37128],"./bg/index.js":[21614,7,83933],"./bn/_lib/formatDistance/index.js":[36406,7,54110],"./bn/_lib/formatLong/index.js":[62226,7,57319],"./bn/_lib/formatRelative/index.js":[34758,7,313],"./bn/_lib/localize/index.js":[84834,9,52058],"./bn/_lib/match/index.js":[61772,7,26018],"./bn/index.js":[96893,7,62769],"./bs/_lib/formatDistance/index.js":[93482,7,62477],"./bs/_lib/formatLong/index.js":[26339,7,25559],"./bs/_lib/formatRelative/index.js":[85291,7,69810],"./bs/_lib/localize/index.js":[43818,7,46335],"./bs/_lib/match/index.js":[63300,7,57210],"./bs/index.js":[90904,7,24145],"./ca/_lib/formatDistance/index.js":[23140,7,93414],"./ca/_lib/formatLong/index.js":[3319,7,77285],"./ca/_lib/formatRelative/index.js":[45824,7,30639],"./ca/_lib/localize/index.js":[14583,7,98371],"./ca/_lib/match/index.js":[21179,7,24113],"./ca/index.js":[52606,7,16409],"./cs/_lib/formatDistance/index.js":[8066,7,76326],"./cs/_lib/formatLong/index.js":[15081,7,45022],"./cs/_lib/formatRelative/index.js":[90226,7,25526],"./cs/_lib/localize/index.js":[86109,7,19025],"./cs/_lib/match/index.js":[1708,7,31458],"./cs/index.js":[95726,7,15040],"./cy/_lib/formatDistance/index.js":[21612,7,78248],"./cy/_lib/formatLong/index.js":[76573,7,65416],"./cy/_lib/formatRelative/index.js":[33912,7,21454],"./cy/_lib/localize/index.js":[25269,7,43325],"./cy/_lib/match/index.js":[48867,7,46328],"./cy/index.js":[97792,7,87605],"./da/_lib/formatDistance/index.js":[20666,7,77466],"./da/_lib/formatLong/index.js":[82112,7,54307],"./da/_lib/formatRelative/index.js":[22130,7,54897],"./da/_lib/localize/index.js":[94541,7,70679],"./da/_lib/match/index.js":[91735,7,4794],"./da/index.js":[22616,7,88650],"./de-AT/_lib/localize/index.js":[6037,7,92708],"./de-AT/index.js":[15219,7,11133],"./de/_lib/formatDistance/index.js":[68802,7,50816],"./de/_lib/formatLong/index.js":[55867,7,9710],"./de/_lib/formatRelative/index.js":[91068,7,85754],"./de/_lib/localize/index.js":[51573,7,25325],"./de/_lib/match/index.js":[40252,7,46081],"./de/index.js":[15407,7,21773],"./el/_lib/formatDistance/index.js":[50002,7,88466],"./el/_lib/formatLong/index.js":[84909,7,67992],"./el/_lib/formatRelative/index.js":[54652,7,95695],"./el/_lib/localize/index.js":[25015,7,59315],"./el/_lib/match/index.js":[51903,7,60526],"./el/index.js":[66986,7,52025],"./en-AU/_lib/formatLong/index.js":[59195,7,5474],"./en-AU/index.js":[70238,7,75811],"./en-CA/_lib/formatDistance/index.js":[98499,7,95951],"./en-CA/_lib/formatLong/index.js":[76072,7,45074],"./en-CA/index.js":[52326,7,64368],"./en-GB/_lib/formatLong/index.js":[37679,7,81834],"./en-GB/index.js":[97302,7,58912],"./en-IE/index.js":[38059,7,41432],"./en-IN/_lib/formatLong/index.js":[35759,7,56071],"./en-IN/index.js":[2392,7,72062],"./en-NZ/_lib/formatLong/index.js":[79607,7,7882],"./en-NZ/index.js":[23893,7,84898],"./en-US/_lib/formatDistance/index.js":[42682,7],"./en-US/_lib/formatLong/index.js":[12128,7],"./en-US/_lib/formatRelative/index.js":[62118,7],"./en-US/_lib/localize/index.js":[58336,7],"./en-US/_lib/match/index.js":[38787,7],"./en-US/index.js":[30609,7],"./en-ZA/_lib/formatLong/index.js":[54168,7,74430],"./en-ZA/index.js":[80583,7,80963],"./eo/_lib/formatDistance/index.js":[52352,7,38747],"./eo/_lib/formatLong/index.js":[40575,7,88689],"./eo/_lib/formatRelative/index.js":[34310,7,4335],"./eo/_lib/localize/index.js":[28386,7,87263],"./eo/_lib/match/index.js":[56126,7,18376],"./eo/index.js":[56546,7,75454],"./es/_lib/formatDistance/index.js":[25247,7,31643],"./es/_lib/formatLong/index.js":[58953,7,38879],"./es/_lib/formatRelative/index.js":[78293,7,73288],"./es/_lib/localize/index.js":[4291,7,37098],"./es/_lib/match/index.js":[87878,7,3409],"./es/index.js":[1259,7,91402],"./et/_lib/formatDistance/index.js":[36243,7,83368],"./et/_lib/formatLong/index.js":[58209,7,50689],"./et/_lib/formatRelative/index.js":[13585,7,80617],"./et/_lib/localize/index.js":[48308,7,92793],"./et/_lib/match/index.js":[70620,7,62752],"./et/index.js":[22052,7,96700],"./eu/_lib/formatDistance/index.js":[68789,7,39161],"./eu/_lib/formatLong/index.js":[9410,7,4082],"./eu/_lib/formatRelative/index.js":[24774,7,39523],"./eu/_lib/localize/index.js":[43010,7,29884],"./eu/_lib/match/index.js":[46965,7,28991],"./eu/index.js":[48734,7,75916],"./fa-IR/_lib/formatDistance/index.js":[48073,7,41807],"./fa-IR/_lib/formatLong/index.js":[2924,7,16783],"./fa-IR/_lib/formatRelative/index.js":[8536,7,36202],"./fa-IR/_lib/localize/index.js":[65444,7,42225],"./fa-IR/_lib/match/index.js":[32764,7,17573],"./fa-IR/index.js":[17432,7,47443],"./fi/_lib/formatDistance/index.js":[26136,7,97374],"./fi/_lib/formatLong/index.js":[20173,7,14063],"./fi/_lib/formatRelative/index.js":[9370,7,11908],"./fi/_lib/localize/index.js":[42885,7,53454],"./fi/_lib/match/index.js":[85266,7,700],"./fi/index.js":[80925,7,5997],"./fr-CA/_lib/formatLong/index.js":[11565,7,5517],"./fr-CA/index.js":[26364,7,6470],"./fr-CH/_lib/formatLong/index.js":[73291,7,46329],"./fr-CH/_lib/formatRelative/index.js":[4349,7,42728],"./fr-CH/index.js":[96546,7,82609],"./fr/_lib/formatDistance/index.js":[92366,7,92707],"./fr/_lib/formatLong/index.js":[85358,7,61772],"./fr/_lib/formatRelative/index.js":[31479,7,25580],"./fr/_lib/localize/index.js":[77030,7,59770],"./fr/_lib/match/index.js":[19104,7,49930],"./fr/index.js":[31790,7,2389],"./fy/_lib/formatDistance/index.js":[65058,7,9247],"./fy/_lib/formatLong/index.js":[81256,7,34583],"./fy/_lib/formatRelative/index.js":[94526,7,53786],"./fy/_lib/localize/index.js":[38309,7,89670],"./fy/_lib/match/index.js":[62638,7,51613],"./fy/index.js":[2617,7,37404],"./gd/_lib/formatDistance/index.js":[63931,7,8926],"./gd/_lib/formatLong/index.js":[61123,7,32641],"./gd/_lib/formatRelative/index.js":[86033,7,76084],"./gd/_lib/localize/index.js":[3863,7,18386],"./gd/_lib/match/index.js":[91534,7,34192],"./gd/index.js":[56382,7,57109],"./gl/_lib/formatDistance/index.js":[1049,7,9620],"./gl/_lib/formatLong/index.js":[51759,7,29533],"./gl/_lib/formatRelative/index.js":[25849,7,45010],"./gl/_lib/localize/index.js":[70892,7,9468],"./gl/_lib/match/index.js":[20368,7,96119],"./gl/index.js":[15156,7,66539],"./gu/_lib/formatDistance/index.js":[70869,7,7606],"./gu/_lib/formatLong/index.js":[70816,7,21603],"./gu/_lib/formatRelative/index.js":[63403,7,10399],"./gu/_lib/localize/index.js":[30412,7,26640],"./gu/_lib/match/index.js":[27840,7,96605],"./gu/index.js":[99567,7,11455],"./he/_lib/formatDistance/index.js":[40776,7,44388],"./he/_lib/formatLong/index.js":[18818,7,70481],"./he/_lib/formatRelative/index.js":[39560,7,87860],"./he/_lib/localize/index.js":[7114,7,17819],"./he/_lib/match/index.js":[31124,7,8314],"./he/index.js":[89661,7,66936],"./hi/_lib/formatDistance/index.js":[10454,7,38750],"./hi/_lib/formatLong/index.js":[22003,7,23601],"./hi/_lib/formatRelative/index.js":[91283,7,72739],"./hi/_lib/localize/index.js":[49277,9,43959],"./hi/_lib/match/index.js":[2541,7,64813],"./hi/index.js":[35598,7,39184],"./hr/_lib/formatDistance/index.js":[94187,7,87513],"./hr/_lib/formatLong/index.js":[79013,7,11893],"./hr/_lib/formatRelative/index.js":[44347,7,64858],"./hr/_lib/localize/index.js":[83615,7,93592],"./hr/_lib/match/index.js":[48424,7,57706],"./hr/index.js":[36774,7,23666],"./ht/_lib/formatDistance/index.js":[54108,7,35018],"./ht/_lib/formatLong/index.js":[4904,7,99887],"./ht/_lib/formatRelative/index.js":[25671,7,96455],"./ht/_lib/localize/index.js":[87087,7,68778],"./ht/_lib/match/index.js":[59806,7,78394],"./ht/index.js":[77243,7,94989],"./hu/_lib/formatDistance/index.js":[1021,7,65563],"./hu/_lib/formatLong/index.js":[46699,7,33212],"./hu/_lib/formatRelative/index.js":[67163,7,38217],"./hu/_lib/localize/index.js":[68367,7,82129],"./hu/_lib/match/index.js":[87475,7,39375],"./hu/index.js":[94101,7,6504],"./hy/_lib/formatDistance/index.js":[70470,7,9446],"./hy/_lib/formatLong/index.js":[11645,7,89046],"./hy/_lib/formatRelative/index.js":[32147,7,25038],"./hy/_lib/localize/index.js":[38937,7,28328],"./hy/_lib/match/index.js":[2032,7,8591],"./hy/index.js":[64085,7,17822],"./id/_lib/formatDistance/index.js":[91545,7,90243],"./id/_lib/formatLong/index.js":[28124,7,50599],"./id/_lib/formatRelative/index.js":[64066,7,80680],"./id/_lib/localize/index.js":[54159,7,50417],"./id/_lib/match/index.js":[93031,7,50931],"./id/index.js":[54473,7,35820],"./is/_lib/formatDistance/index.js":[63213,7,32680],"./is/_lib/formatLong/index.js":[91517,7,31131],"./is/_lib/formatRelative/index.js":[5819,7,91658],"./is/_lib/localize/index.js":[50456,7,81017],"./is/_lib/match/index.js":[83813,7,26574],"./is/index.js":[69787,7,68003],"./it-CH/_lib/formatLong/index.js":[4879,7,76709],"./it-CH/index.js":[56374,7,74061],"./it/_lib/formatDistance/index.js":[65014,7,84519],"./it/_lib/formatLong/index.js":[46843,7,30799],"./it/_lib/formatRelative/index.js":[54325,7,48433],"./it/_lib/localize/index.js":[95652,7,32126],"./it/_lib/match/index.js":[4476,7,9267],"./it/index.js":[70556,7,36936],"./ja-Hira/_lib/formatDistance/index.js":[71939,7,46608],"./ja-Hira/_lib/formatLong/index.js":[3497,7,21308],"./ja-Hira/_lib/formatRelative/index.js":[98957,7,25551],"./ja-Hira/_lib/localize/index.js":[49519,7,79733],"./ja-Hira/_lib/match/index.js":[47758,7,13831],"./ja-Hira/index.js":[84460,7,44331],"./ja/_lib/formatDistance/index.js":[75639,7,31221],"./ja/_lib/formatLong/index.js":[89790,7,28725],"./ja/_lib/formatRelative/index.js":[22015,7,2370],"./ja/_lib/localize/index.js":[85448,7,71469],"./ja/_lib/match/index.js":[91809,7,84248],"./ja/index.js":[88116,7,70789],"./ka/_lib/formatDistance/index.js":[35693,7,27282],"./ka/_lib/formatLong/index.js":[51422,7,39040],"./ka/_lib/formatRelative/index.js":[334,7,83665],"./ka/_lib/localize/index.js":[52430,7,72240],"./ka/_lib/match/index.js":[98566,7,95796],"./ka/index.js":[32436,7,90666],"./kk/_lib/formatDistance/index.js":[67695,7,48801],"./kk/_lib/formatLong/index.js":[39911,7,35597],"./kk/_lib/formatRelative/index.js":[9922,7,54223],"./kk/_lib/localize/index.js":[94718,7,50219],"./kk/_lib/match/index.js":[88699,7,45502],"./kk/index.js":[70905,7,29546],"./km/_lib/formatDistance/index.js":[76236,7,34329],"./km/_lib/formatLong/index.js":[76650,7,58860],"./km/_lib/formatRelative/index.js":[32704,7,39538],"./km/_lib/localize/index.js":[24551,7,27591],"./km/_lib/match/index.js":[50670,7,92973],"./km/index.js":[85122,7,13054],"./kn/_lib/formatDistance/index.js":[27828,7,43433],"./kn/_lib/formatLong/index.js":[40170,7,24951],"./kn/_lib/formatRelative/index.js":[7635,7,45549],"./kn/_lib/localize/index.js":[41348,7,7185],"./kn/_lib/match/index.js":[94938,7,79619],"./kn/index.js":[23479,7,67650],"./ko/_lib/formatDistance/index.js":[2071,7,59778],"./ko/_lib/formatLong/index.js":[11961,7,46717],"./ko/_lib/formatRelative/index.js":[96114,7,97722],"./ko/_lib/localize/index.js":[14199,7,798],"./ko/_lib/match/index.js":[50238,7,55675],"./ko/index.js":[51772,7,24152],"./lb/_lib/formatDistance/index.js":[10678,7,51443],"./lb/_lib/formatLong/index.js":[45595,7,96965],"./lb/_lib/formatRelative/index.js":[61633,7,4274],"./lb/_lib/localize/index.js":[31048,7,83038],"./lb/_lib/match/index.js":[24028,7,32216],"./lb/index.js":[71555,7,75131],"./lt/_lib/formatDistance/index.js":[81410,7,46100],"./lt/_lib/formatLong/index.js":[68306,7,66863],"./lt/_lib/formatRelative/index.js":[42974,7,62915],"./lt/_lib/localize/index.js":[46622,7,22302],"./lt/_lib/match/index.js":[4854,7,7547],"./lt/index.js":[54677,7,60804],"./lv/_lib/formatDistance/index.js":[39377,7,14181],"./lv/_lib/formatLong/index.js":[86766,7,48246],"./lv/_lib/formatRelative/index.js":[13829,7,38189],"./lv/_lib/localize/index.js":[12325,7,88738],"./lv/_lib/match/index.js":[91408,7,91217],"./lv/index.js":[30037,7,18688],"./mk/_lib/formatDistance/index.js":[9695,7,33921],"./mk/_lib/formatLong/index.js":[55109,7,8298],"./mk/_lib/formatRelative/index.js":[80269,7,36078],"./mk/_lib/localize/index.js":[11003,7,18711],"./mk/_lib/match/index.js":[16739,7,13787],"./mk/index.js":[76751,7,52946],"./mn/_lib/formatDistance/index.js":[87153,7,82285],"./mn/_lib/formatLong/index.js":[92492,7,72884],"./mn/_lib/formatRelative/index.js":[41942,7,18585],"./mn/_lib/localize/index.js":[67271,7,2572],"./mn/_lib/match/index.js":[25054,7,18115],"./mn/index.js":[37157,7,76602],"./ms/_lib/formatDistance/index.js":[98580,7,27543],"./ms/_lib/formatLong/index.js":[89720,7,85408],"./ms/_lib/formatRelative/index.js":[48497,7,16625],"./ms/_lib/localize/index.js":[31269,7,67136],"./ms/_lib/match/index.js":[9733,7,99924],"./ms/index.js":[44344,7,68976],"./mt/_lib/formatDistance/index.js":[9705,7,42560],"./mt/_lib/formatLong/index.js":[19486,7,35672],"./mt/_lib/formatRelative/index.js":[12174,7,84940],"./mt/_lib/localize/index.js":[87084,7,53817],"./mt/_lib/match/index.js":[51962,7,84164],"./mt/index.js":[23257,7,80817],"./nb/_lib/formatDistance/index.js":[18326,7,4668],"./nb/_lib/formatLong/index.js":[58974,7,63081],"./nb/_lib/formatRelative/index.js":[81015,7,52266],"./nb/_lib/localize/index.js":[35609,7,5441],"./nb/_lib/match/index.js":[35402,7,7850],"./nb/index.js":[52545,7,1202],"./nl-BE/_lib/formatDistance/index.js":[74702,7,19455],"./nl-BE/_lib/formatLong/index.js":[31302,7,14950],"./nl-BE/_lib/formatRelative/index.js":[81309,7,13183],"./nl-BE/_lib/localize/index.js":[81324,7,78650],"./nl-BE/_lib/match/index.js":[58819,7,59900],"./nl-BE/index.js":[94289,7,94935],"./nl/_lib/formatDistance/index.js":[40289,7,15907],"./nl/_lib/formatLong/index.js":[71584,7,56985],"./nl/_lib/formatRelative/index.js":[22832,7,53099],"./nl/_lib/localize/index.js":[80518,7,44668],"./nl/_lib/match/index.js":[86341,7,32713],"./nl/index.js":[47650,7,93921],"./nn/_lib/formatDistance/index.js":[49215,7,22265],"./nn/_lib/formatLong/index.js":[56789,7,54522],"./nn/_lib/formatRelative/index.js":[76631,7,84390],"./nn/_lib/localize/index.js":[64,7,28092],"./nn/_lib/match/index.js":[68468,7,59968],"./nn/index.js":[85411,7,76851],"./oc/_lib/formatDistance/index.js":[63894,7,45094],"./oc/_lib/formatLong/index.js":[40456,7,30517],"./oc/_lib/formatRelative/index.js":[68211,7,79896],"./oc/_lib/localize/index.js":[47172,7,7994],"./oc/_lib/match/index.js":[34622,7,90502],"./oc/index.js":[28898,7,17205],"./pl/_lib/formatDistance/index.js":[84067,7,55254],"./pl/_lib/formatLong/index.js":[39762,7,74086],"./pl/_lib/formatRelative/index.js":[97608,7,36366],"./pl/_lib/localize/index.js":[92513,7,49152],"./pl/_lib/match/index.js":[81037,7,55478],"./pl/index.js":[57237,7,47074],"./pt-BR/_lib/formatDistance/index.js":[94402,7,57946],"./pt-BR/_lib/formatLong/index.js":[70219,7,42623],"./pt-BR/_lib/formatRelative/index.js":[84407,7,88001],"./pt-BR/_lib/localize/index.js":[27055,7,37469],"./pt-BR/_lib/match/index.js":[31404,7,12914],"./pt-BR/index.js":[25835,7,48519],"./pt/_lib/formatDistance/index.js":[56361,7,92324],"./pt/_lib/formatLong/index.js":[20255,7,65963],"./pt/_lib/formatRelative/index.js":[61458,7,37510],"./pt/_lib/localize/index.js":[3166,7,23970],"./pt/_lib/match/index.js":[31067,7,76025],"./pt/index.js":[46439,7,66037],"./ro/_lib/formatDistance/index.js":[78549,7,13198],"./ro/_lib/formatLong/index.js":[3947,7,34193],"./ro/_lib/formatRelative/index.js":[67217,7,70350],"./ro/_lib/localize/index.js":[23079,7,4830],"./ro/_lib/match/index.js":[31923,7,54251],"./ro/index.js":[42473,7,90970],"./ru/_lib/formatDistance/index.js":[20991,7,34770],"./ru/_lib/formatLong/index.js":[42644,7,87692],"./ru/_lib/formatRelative/index.js":[45744,7,48237],"./ru/_lib/localize/index.js":[15958,7,60957],"./ru/_lib/match/index.js":[84257,7,48037],"./ru/index.js":[27773,7,27614],"./sk/_lib/formatDistance/index.js":[1843,7,67523],"./sk/_lib/formatLong/index.js":[34148,7,43572],"./sk/_lib/formatRelative/index.js":[74490,7,7711],"./sk/_lib/localize/index.js":[96540,7,93739],"./sk/_lib/match/index.js":[67518,7,12604],"./sk/index.js":[29604,7,4138],"./sl/_lib/formatDistance/index.js":[25190,7,74778],"./sl/_lib/formatLong/index.js":[67123,7,74397],"./sl/_lib/formatRelative/index.js":[41230,7,81888],"./sl/_lib/localize/index.js":[18668,7,7987],"./sl/_lib/match/index.js":[45932,7,26537],"./sl/index.js":[52792,7,39693],"./sq/_lib/formatDistance/index.js":[26652,7,26338],"./sq/_lib/formatLong/index.js":[44933,7,44213],"./sq/_lib/formatRelative/index.js":[68933,7,16987],"./sq/_lib/localize/index.js":[92941,7,21835],"./sq/_lib/match/index.js":[14170,7,224],"./sq/index.js":[42870,7,73226],"./sr-Latn/_lib/formatDistance/index.js":[609,7,97835],"./sr-Latn/_lib/formatLong/index.js":[94394,7,50343],"./sr-Latn/_lib/formatRelative/index.js":[51251,7,18913],"./sr-Latn/_lib/localize/index.js":[69554,7,75989],"./sr-Latn/_lib/match/index.js":[15689,7,71165],"./sr-Latn/index.js":[46732,7,63122],"./sr/_lib/formatDistance/index.js":[27352,7,42648],"./sr/_lib/formatLong/index.js":[50455,7,52883],"./sr/_lib/formatRelative/index.js":[43039,7,34468],"./sr/_lib/localize/index.js":[50574,7,56162],"./sr/_lib/match/index.js":[81764,7,23476],"./sr/index.js":[76600,7,8514],"./sv/_lib/formatDistance/index.js":[13977,7,48142],"./sv/_lib/formatLong/index.js":[86777,7,94375],"./sv/_lib/formatRelative/index.js":[71530,7,47795],"./sv/_lib/localize/index.js":[62931,7,36682],"./sv/_lib/match/index.js":[77262,7,22972],"./sv/index.js":[88573,7,43924],"./ta/_lib/formatDistance/index.js":[80825,7,8263],"./ta/_lib/formatLong/index.js":[4433,7,98459],"./ta/_lib/formatRelative/index.js":[95694,7,35136],"./ta/_lib/localize/index.js":[96828,7,74594],"./ta/_lib/match/index.js":[43903,7,99426],"./ta/index.js":[84588,7,33739],"./te/_lib/formatDistance/index.js":[38968,7,31594],"./te/_lib/formatLong/index.js":[81098,7,31518],"./te/_lib/formatRelative/index.js":[28283,7,34082],"./te/_lib/localize/index.js":[41533,7,58749],"./te/_lib/match/index.js":[5186,7,47173],"./te/index.js":[17631,7,5876],"./th/_lib/formatDistance/index.js":[32819,7,3330],"./th/_lib/formatLong/index.js":[24247,7,90412],"./th/_lib/formatRelative/index.js":[58155,7,45203],"./th/_lib/localize/index.js":[60254,7,25367],"./th/_lib/match/index.js":[86319,7,65156],"./th/index.js":[88002,7,21408],"./tr/_lib/formatDistance/index.js":[77302,7,75325],"./tr/_lib/formatLong/index.js":[32946,7,91178],"./tr/_lib/formatRelative/index.js":[67003,7,87039],"./tr/_lib/localize/index.js":[2945,7,78958],"./tr/_lib/match/index.js":[24552,7,17290],"./tr/index.js":[34848,7,90203],"./ug/_lib/formatDistance/index.js":[84769,7,83928],"./ug/_lib/formatLong/index.js":[18384,7,92028],"./ug/_lib/formatRelative/index.js":[47243,7,7873],"./ug/_lib/localize/index.js":[88480,7,1027],"./ug/_lib/match/index.js":[89933,7,33173],"./ug/index.js":[41296,7,26744],"./uk/_lib/formatDistance/index.js":[99785,7,60889],"./uk/_lib/formatLong/index.js":[3250,7,7700],"./uk/_lib/formatRelative/index.js":[99101,7,92982,68977],"./uk/_lib/localize/index.js":[99145,7,55248],"./uk/_lib/match/index.js":[4014,7,36013],"./uk/index.js":[75099,7,92982,20671],"./uz-Cyrl/_lib/formatDistance/index.js":[80036,7,36694],"./uz-Cyrl/_lib/formatLong/index.js":[57430,7,9698],"./uz-Cyrl/_lib/formatRelative/index.js":[70145,7,62460],"./uz-Cyrl/_lib/localize/index.js":[43520,7,46430],"./uz-Cyrl/_lib/match/index.js":[79014,7,47302],"./uz-Cyrl/index.js":[2051,7,52570],"./uz/_lib/formatDistance/index.js":[57663,7,63062],"./uz/_lib/formatLong/index.js":[97836,7,53234],"./uz/_lib/formatRelative/index.js":[15295,7,14393],"./uz/_lib/localize/index.js":[94622,7,61603],"./uz/_lib/match/index.js":[42382,7,2181],"./uz/index.js":[1039,7,28110],"./vi/_lib/formatDistance/index.js":[89528,7,37639],"./vi/_lib/formatLong/index.js":[48580,7,93187],"./vi/_lib/formatRelative/index.js":[22993,7,92448],"./vi/_lib/localize/index.js":[20764,7,35983],"./vi/_lib/match/index.js":[89470,7,66482],"./vi/index.js":[67392,7,65679],"./zh-CN/_lib/formatDistance/index.js":[95867,7,94291],"./zh-CN/_lib/formatLong/index.js":[33002,7,61872],"./zh-CN/_lib/formatRelative/index.js":[10317,7,38178],"./zh-CN/_lib/localize/index.js":[89546,7,65535],"./zh-CN/_lib/match/index.js":[885,7,78602],"./zh-CN/index.js":[58479,7,24994],"./zh-HK/_lib/formatDistance/index.js":[38408,7,66824],"./zh-HK/_lib/formatLong/index.js":[64131,7,39983],"./zh-HK/_lib/formatRelative/index.js":[57346,7,8462],"./zh-HK/_lib/localize/index.js":[62651,7,54019],"./zh-HK/_lib/match/index.js":[56470,7,43970],"./zh-HK/index.js":[26241,7,50126],"./zh-TW/_lib/formatDistance/index.js":[42341,7,48085],"./zh-TW/_lib/formatLong/index.js":[76463,7,50815],"./zh-TW/_lib/formatRelative/index.js":[78396,7,73782],"./zh-TW/_lib/localize/index.js":[58664,7,7028],"./zh-TW/_lib/match/index.js":[8765,7,21919],"./zh-TW/index.js":[47370,7,470]};function n(e){if(!a.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],n=t[0];return Promise.all(t.slice(2).map(a.e)).then((()=>a.t(n,16|t[1])))}n.keys=()=>Object.keys(s),n.id=88115,e.exports=n},34957:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});const s={Application__main:"Academy_Application__main__WbAGW",WorkspaceParent:"Academy_WorkspaceParent__QkrJ0","bp5-tag":"Academy_bp5-tag__qdxCt",badge:"Academy_badge__T8ws1","bp5-overlay":"Academy_bp5-overlay__NG6bM","bp5-popover-content":"Academy_bp5-popover-content__D5ZSM","badge-tag":"Academy_badge-tag__A0vj4",Academy:"Academy_Academy__1mjfJ","Academy-switching-courses":"Academy_Academy-switching-courses__aaVIr"}},5602:(e,t,a)=>{"use strict";e.exports=a.p+"static/media/default_cover_image.e2be07249bb127696687.jpg"}}]);
//# sourceMappingURL=46729.a96e4c37.chunk.js.map